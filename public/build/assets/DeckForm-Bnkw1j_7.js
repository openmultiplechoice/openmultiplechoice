import{p as J,l as U,g as t,m as B,a as X,i as Z,f as A,b as V,s as p,c as R,d as f,e as tt,h as E,j as l,t as Q,u as q,k as y,n as pt,o as H,q as _,r as nt}from"./lifecycle-BvmTvt_c.js";import{o as bt}from"./index-client-DUeXGvoC.js";import{s as rt,a as Y,e as z,p as K,b as ot,c as W,i as ct}from"./event-modifiers-C9-V6teM.js";import{k as gt,r as ht,h as xt,Q as yt}from"./QuestionForm-DLV85khG.js";import{p as M,s as G}from"./props-DkMS-7Z0.js";import{h as qt}from"./html-DWUw1S_J.js";import{b as kt}from"./input-CvY2ozlN.js";import{b as wt}from"./this-DymA9FIw.js";import{d as Et,p as O}from"./purify.es-Dnvgf1Dd.js";import"./style-BxdPOk1g.js";import"./select-DOPylVjq.js";import"./lodash-DjGC5Q8M.js";import"./_commonjsHelpers-Cpj98o6Y.js";var Ct=A('<form action="#" class="mt-3"><div class="mb-3"><label class="form-label">Case text</label> <input type="hidden"/> <trix-editor></trix-editor> <!></div></form>',2),It=A(`<div class="alert alert-light mt-5" role="alert"><p><strong>Delete case?</strong> A case can only be deleted if it's not associated with any question.</p> <button type="button" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i> Delete case</button></div>`),Qt=A("<!> <!>",1);function Dt($,k){J(k,!1);let a=M(k,"kase",12),s=M(k,"cases",8),b=M(k,"handleCaseRemove",8),C=B(),e=B("");function S(d){d.addEventListener("trix-change",function(){a(a().text=document.getElementById("caseText"+a().id).value,!0),E(e,'<p class="text-end">Saving ...</p>'),D()}),d.toolbarElement.style.display="none",d.addEventListener("trix-focus",function(r){r.target.toolbarElement.style.display="block"}),d.addEventListener("trix-blur",function(r){r.target.toolbarElement.contains(document.activeElement)||(r.target.toolbarElement.style.display="none")})}var u;function D(){u&&u.cancel(),u=Et(()=>{axios.put("/api/cases/"+a().id,a()).then(function(d){E(e,'<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(d){E(e,'<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(d)})},500,{maxWait:2e3}),u()}U(()=>t(C),()=>{t(C)&&S(t(C))}),X(),Z();var I=Qt(),F=V(I);gt(F,()=>(y(a()),q(()=>a().id)),d=>{var r=Ct(),g=l(r),v=l(g),h=p(v,2),w=p(h,2);Q(()=>rt(w,"id",`editor-case${y(a()),q(()=>a().id)??""}`)),G(w,1,"bg-light trix-content"),Q(()=>rt(w,"input",`caseText${y(a()),q(()=>a().id)??""}`)),wt(w,o=>E(C,o),()=>t(C));var T=p(w,2);qt(T,()=>t(e)),Q(()=>{Y(v,"for",`caseText${y(a()),q(()=>a().id)??""}`),Y(h,"id",`caseText${y(a()),q(()=>a().id)??""}`)}),kt(h,()=>a().text,o=>a(a().text=o,!0)),f(d,r)});var L=p(F,2);{var c=d=>{var r=It(),g=p(l(r),2);Q(v=>g.disabled=v,[()=>(y(s()),y(a()),q(()=>s().some(v=>v.questions?v.questions.some(h=>h.case_id===a().id):!1)))]),z("click",g,K(()=>{confirm("Are you sure you want to delete this case?")&&b()(a().id)})),f(d,r)};R(L,d=>{b()&&d(c)})}f($,I),tt()}var Tt=A('<button type="button" aria-current="true"><small><!></small></button>'),At=A('<button type="button" aria-current="true"><small><i class="bi bi-clipboard2-pulse"></i> <!></small></button>'),Lt=A('<div class="list-group"></div> <div class="list-group mt-2"></div>',1),St=A("<p>Loading ...</p>");function Ft($,k){J(k,!1);const a=B();let s=M(k,"data",12);U(()=>y(s()),()=>{E(a,s()?s().questions.find(u=>u.id===s().current_question_id):null)}),X(),Z();var b=pt(),C=V(b);{var e=u=>{var D=Lt(),I=V(D);ot(I,5,()=>(y(s()),q(()=>s().questions)),ct,(L,c,d)=>{var r=Tt();let g;var v=l(r),h=l(v);{var w=o=>{var m=H();Q(N=>W(m,N),[()=>(y(O),t(c),q(()=>O.sanitize(t(c).text).replace(/<\/?[^>]+(>|$)/g,"")))]),f(o,m)},T=o=>{var m=H();m.nodeValue=`Question Nr. ${d+1}`,f(o,m)};R(h,o=>{t(c),q(()=>t(c).text)?o(w):o(T,!1)})}Q(o=>g=G(r,1,"list-group-item list-group-item-action text-truncate",null,g,o),[()=>({"list-group-item-dark":t(c).id===s().current_question_id,"list-group-item-light":t(c).id!==s().current_question_id,"bg-warning-subtle":s().current_case_id&&t(c).case_id===s().current_case_id})]),z("click",r,K(()=>{s(s().current_question_id=t(c).id,!0),s(s().current_case_id=null,!0)})),f(L,r)});var F=p(I,2);ot(F,5,()=>(y(s()),q(()=>s().cases)),ct,(L,c,d)=>{var r=At();let g;var v=l(r),h=p(l(v),2);{var w=o=>{var m=H();Q(N=>W(m,N),[()=>(y(O),t(c),q(()=>O.sanitize(t(c).text).replace(/<\/?[^>]+(>|$)/g,"")))]),f(o,m)},T=o=>{var m=H();m.nodeValue=`Case Nr. ${d+1}`,f(o,m)};R(h,o=>{t(c),q(()=>t(c).text)?o(w):o(T,!1)})}Q(o=>g=G(r,1,"list-group-item list-group-item-action text-truncate",null,g,o),[()=>({"list-group-item-dark":t(c).id===s().current_case_id,"list-group-item-info":t(c).id!==s().current_case_id&&!(t(a)&&t(a).case_id===t(c).id),"list-group-item-warning":t(a)&&t(a).case_id===t(c).id})]),z("click",r,K(()=>{s(s().current_case_id=t(c).id,!0),s(s().current_question_id=null,!0)})),f(L,r)}),f(u,D)},S=u=>{var D=St();f(u,D)};R(C,u=>{s()?u(e):u(S,!1)})}f($,b),tt()}var j=ht(()=>xt),Nt=A('<div class="row"><div class="col"><h4 class="text-truncate"><a class="text-reset text-decoration-none"> </a></h4></div></div> <div class="sticky-top bg-white mb-3" style="z-index: 20;"><div class="row"><div class="col d-grid d-sm-block gap-2 py-3"><button type="button" class="btn btn-sm btn-primary" title="Add a new MC question (Shortcut: Alt+Q)">Add MC question</button> <button type="button" class="btn btn-sm btn-primary">Add card question</button> <button type="button" class="btn btn-sm btn-light"><i class="bi bi-clipboard2-pulse"></i> Add case</button></div></div> <div class="row"><div class="col"><div class="border-dark" style="border-bottom: dotted; border-width: 1px;"></div></div></div></div> <div class="row"><div class="col-md-4"><!></div> <div class="col-md-8"><!> <!></div></div>',1);function Bt($,k){J(k,!1);const a=B(),s=B();let b=M(k,"id",8),C=M(k,"name",8),e=B({cases:[],questions:[]}),S=0;const u=1e3;bt(()=>{j(j().filter=function(){return!0}),j()("alt+Q",function(n){n.preventDefault();const i=Date.now();i-S>u&&(I("mc"),S=i)}),axios.get("/api/decks/"+b()).then(function(n){E(e,n.data);const i=D();i&&t(e).questions.some(x=>x.id===parseInt(i))?_(e,t(e).current_question_id=parseInt(i)):t(e).questions.length>0&&_(e,t(e).current_question_id=t(e).questions[t(e).questions.length-1].id)}).catch(function(n){alert(n)})});function D(){return new URLSearchParams(window.location.search).get("question_id")}function I(n){var i={id:null,text:"",type:n||"mc",correct_answer_id:null,images:[],answers:[]};axios.post("/api/decks/"+b()+"/questions",i).then(function(x){i.id=x.data.id,_(e,t(e).questions=[...t(e).questions,i]),_(e,t(e).current_question_id=i.id),nt().then(()=>{const it=document.getElementById("editor-questionText");it&&it.focus()})}).catch(function(x){alert(x)}),window.scrollTo({top:0,behavior:"smooth"})}function F(){var n={deck_id:b()};axios.post("/api/cases",n).then(function(i){_(e,t(e).cases=[...t(e).cases,i.data]),_(e,t(e).current_case_id=i.data.id),_(e,t(e).current_question_id=null),nt().then(()=>{const x=document.getElementById("editor-case"+i.data.id);x&&x.focus()})}).catch(function(i){alert(i)}),window.scrollTo({top:0,behavior:"smooth"})}function L(n){axios.delete("/api/decks/"+b()+"/questions/"+n).then(function(i){_(e,t(e).questions=t(e).questions.filter(x=>x.id!==n)),t(e).questions.length>0&&_(e,t(e).current_question_id=t(e).questions[t(e).questions.length-1].id)}).catch(function(i){alert(i)})}function c(n){axios.delete("/api/decks/"+b()+"/cases/"+n).then(function(i){_(e,t(e).cases=t(e).cases.filter(x=>x.id!==n)),t(e).questions.length>0&&_(e,t(e).current_question_id=t(e).questions[t(e).questions.length-1].id)}).catch(function(i){alert(i)})}U(()=>t(e),()=>{E(a,t(e)?t(e).questions.find(n=>n.id===t(e).current_question_id):null)}),U(()=>t(e),()=>{E(s,t(e)?t(e).cases.find(n=>n.id===t(e).current_case_id):null)}),X(),Z();var d=Nt(),r=V(d),g=l(r),v=l(g),h=l(v),w=l(h),T=p(r,2),o=l(T),m=l(o),N=l(m),et=p(N,2),dt=p(et,2),lt=p(T,2),at=l(lt),ut=l(at);Ft(ut,{get data(){return t(e)},set data(n){E(e,n)},$$legacy:!0});var vt=p(at,2),st=l(vt);{var mt=n=>{yt(n,{showConfigEditor:"true",showCaseSelector:"true",handleQuestionRemove:L,get question(){return t(a)},set question(i){E(a,i)},get cases(){return t(e).cases},set cases(i){_(e,t(e).cases=i)},$$legacy:!0})};R(st,n=>{t(a)&&n(mt)})}var _t=p(st,2);{var ft=n=>{Dt(n,{handleCaseRemove:c,get kase(){return t(s)},set kase(i){E(s,i)},get cases(){return t(e).cases},set cases(i){_(e,t(e).cases=i)},$$legacy:!0})};R(_t,n=>{t(s)&&n(ft)})}Q(()=>{Y(v,"title",C()),Y(h,"href",`/decks/${b()??""}`),W(w,C())}),z("click",N,()=>{I("mc")}),z("click",et,()=>{I("card")}),z("click",dt,F),f($,d),tt()}const P=document.getElementById("DeckForm");new Bt({target:P,props:{id:P.dataset.deckId,name:P.dataset.deckName,moduleId:P.dataset.moduleId}});
