import{S as ge,i as we,s as ne,b as d,t as ee,g as w,c as s,J as B,a as Q,h as u,D as V,l as W,n as te,d as S,r as ie,H as Z,k as X,p as U,B as qe,y as Ee,w as ve,x as ke,K as He,G as oe,q as Te,m as Ce,e as Ie,o as Ae,u as Le,v as Qe,z as Se,j as Be}from"./index-B80I9K_4.js";import{e as x,u as ae,d as Me,o as Re}from"./each-DkBj6IvG.js";import{d as ye}from"./purify.es-DfBF0len.js";function De(l){let e,n,o,i,c,f,m,_,v,b,H,T,q,r,y,h,g,J,I,N,D,F,A,E,C,j,K,M,z,k;return{c(){e=d("form"),n=d("div"),o=d("label"),i=ee("Answer text"),f=w(),m=d("input"),v=w(),b=d("trix-editor"),q=w(),r=new Z(!1),y=w(),h=d("div"),g=d("label"),J=ee("Answer hint (optional)"),N=w(),D=d("input"),A=w(),E=d("trix-editor"),K=w(),M=new Z(!1),s(o,"for",c="answerText"+l[0].id),s(o,"class","form-label"),s(m,"id",_="answerText"+l[0].id),s(m,"type","hidden"),B(b,"id",H="editor-answer"+l[0].id),B(b,"class","bg-light"),B(b,"input",T="answerText"+l[0].id),r.a=null,s(n,"class","mb-3"),s(g,"for",I="answerHint"+l[0].id+"t"),s(g,"class","form-label"),s(D,"id",F="answerHint"+l[0].id),s(D,"type","hidden"),B(E,"id",C="editor-answerHint"+l[0].id),B(E,"class","bg-light"),B(E,"input",j="answerHint"+l[0].id),M.a=null,s(h,"class","mb-3"),s(e,"action","#"),s(e,"class","mt-3")},m(a,t){Q(a,e,t),u(e,n),u(n,o),u(o,i),u(n,f),u(n,m),V(m,l[0].text),u(n,v),u(n,b),l[5](b),u(n,q),r.m(l[3],n),u(e,y),u(e,h),u(h,g),u(g,J),u(h,N),u(h,D),V(D,l[0].hint),u(h,A),u(h,E),l[7](E),u(h,K),M.m(l[3],h),z||(k=[W(m,"input",l[4]),W(D,"input",l[6])],z=!0)},p(a,[t]){t&1&&c!==(c="answerText"+a[0].id)&&s(o,"for",c),t&1&&_!==(_="answerText"+a[0].id)&&s(m,"id",_),t&1&&V(m,a[0].text),t&1&&H!==(H="editor-answer"+a[0].id)&&B(b,"id",H),t&1&&T!==(T="answerText"+a[0].id)&&B(b,"input",T),t&8&&r.p(a[3]),t&1&&I!==(I="answerHint"+a[0].id+"t")&&s(g,"for",I),t&1&&F!==(F="answerHint"+a[0].id)&&s(D,"id",F),t&1&&V(D,a[0].hint),t&1&&C!==(C="editor-answerHint"+a[0].id)&&B(E,"id",C),t&1&&j!==(j="answerHint"+a[0].id)&&B(E,"input",j),t&8&&M.p(a[3])},i:te,o:te,d(a){a&&S(e),l[5](null),l[7](null),z=!1,ie(k)}}}function Fe(l,e,n){let{answer:o}=e,i,c,f="";function m(r){r.addEventListener("trix-change",function(){n(0,o.text=document.getElementById("answerText"+o.id).value,o),n(0,o.hint=document.getElementById("answerHint"+o.id).value,o),n(3,f='<p class="text-end">Saving ...</p>'),v()}),r.toolbarElement.style.display="none",r.addEventListener("trix-focus",function(y){y.target.toolbarElement.style.display="block"}),r.addEventListener("trix-blur",function(y){y.target.toolbarElement.contains(document.activeElement)||(y.target.toolbarElement.style.display="none")})}var _;function v(){_&&_.cancel(),_=ye(()=>{axios.put("/api/answers/"+o.id,o).then(function(r){n(3,f='<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(r){n(3,f='<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(r)})},500,{maxWait:2e3}),_()}function b(){o.text=this.value,n(0,o)}function H(r){X[r?"unshift":"push"](()=>{i=r,n(1,i)})}function T(){o.hint=this.value,n(0,o)}function q(r){X[r?"unshift":"push"](()=>{c=r,n(2,c)})}return l.$$set=r=>{"answer"in r&&n(0,o=r.answer)},l.$$.update=()=>{l.$$.dirty&2&&i&&m(i),l.$$.dirty&4&&c&&m(c)},[o,i,c,f,b,H,T,q]}class Ne extends ge{constructor(e){super(),we(this,e,Fe,De,ne,{answer:0})}}function re(l,e,n){const o=l.slice();return o[29]=e[n],o[30]=e,o[31]=n,o}function ue(l,e,n){const o=l.slice();return o[32]=e[n],o}function de(l){let e,n,o;return{c(){e=d("button"),e.textContent="Close editor",s(e,"type","button"),s(e,"class","btn btn-outline-secondary btn-sm")},m(i,c){Q(i,e,c),n||(o=W(e,"click",U(function(){He(l[1])&&l[1].apply(this,arguments)})),n=!0)},p(i,c){l=i},d(i){i&&S(e),n=!1,o()}}}function ce(l){let e,n,o,i,c,f,m,_,v,b,H,T,q,r,y,h,g,J,I,N,D,F,A,E,C,j,K,M,z,k,a,t,p,G,O,P,le,Y,$,se;return{c(){e=d("div"),n=d("label"),n.textContent="Question text",o=w(),i=d("input"),c=w(),f=d("trix-editor"),m=w(),_=new Z(!1),v=w(),b=d("div"),H=d("label"),H.textContent="Question hint (optional)",T=w(),q=d("input"),r=w(),y=d("trix-editor"),h=w(),g=new Z(!1),J=w(),I=d("div"),N=d("label"),N.textContent="Question comment (optional)",D=w(),F=d("input"),A=w(),E=d("trix-editor"),C=w(),j=new Z(!1),K=w(),M=d("div"),z=d("div"),k=d("input"),a=w(),t=d("label"),t.innerHTML='<i class="bi bi-cone-striped"></i> <strong>Invalid question</strong> - Is the answer unknown or disputed? Invalid questions remain in deck but are not counted into results.',p=w(),G=d("div"),O=d("div"),P=d("input"),le=w(),Y=d("label"),Y.innerHTML='<i class="bi bi-eraser-fill"></i> <strong>Needs review</strong> - Does this question need to be reviewed and improved? Questions marked for review remain in deck and are counted into results.',s(n,"for","questionText"),s(n,"class","form-label"),s(i,"id","questionText"),s(i,"type","hidden"),B(f,"id","editor-questionText"),B(f,"class","bg-light"),B(f,"input","questionText"),_.a=null,s(e,"class","mt-3 mb-3"),s(H,"for","questionHint"),s(H,"class","form-label"),s(q,"id","questionHint"),s(q,"type","hidden"),B(y,"id","editor-questionHint"),B(y,"class","bg-light"),B(y,"input","questionHint"),g.a=null,s(b,"class","mt-3 mb-3"),s(N,"for","questionComment"),s(N,"class","form-label"),s(F,"id","questionComment"),s(F,"type","hidden"),B(E,"id","editor-questionComment"),B(E,"class","bg-light"),B(E,"input","questionComment"),j.a=null,s(I,"class","mt-3 mb-3"),s(k,"type","checkbox"),s(k,"class","form-check-input"),s(k,"id","checkInvalidQuestion"),s(t,"class","form-check-label"),s(t,"for","checkInvalidQuestion"),s(z,"class","form-check"),s(M,"class","mb-3"),s(P,"type","checkbox"),s(P,"class","form-check-input"),s(P,"id","checkNeedsReview"),s(Y,"class","form-check-label"),s(Y,"for","checkNeedsReview"),s(O,"class","form-check"),s(G,"class","mb-3")},m(L,R){Q(L,e,R),u(e,n),u(e,o),u(e,i),V(i,l[0].text),u(e,c),u(e,f),l[16](f),u(e,m),_.m(l[5],e),Q(L,v,R),Q(L,b,R),u(b,H),u(b,T),u(b,q),V(q,l[0].hint),u(b,r),u(b,y),l[18](y),u(b,h),g.m(l[5],b),Q(L,J,R),Q(L,I,R),u(I,N),u(I,D),u(I,F),V(F,l[0].comment),u(I,A),u(I,E),l[20](E),u(I,C),j.m(l[5],I),Q(L,K,R),Q(L,M,R),u(M,z),u(z,k),k.checked=l[0].is_invalid,u(z,a),u(z,t),Q(L,p,R),Q(L,G,R),u(G,O),u(O,P),P.checked=l[0].needs_review,u(O,le),u(O,Y),$||(se=[W(i,"input",l[15]),W(q,"input",l[17]),W(F,"input",l[19]),W(k,"change",l[21]),W(k,"click",U(l[13])),W(P,"change",l[22]),W(P,"click",U(l[14]))],$=!0)},p(L,R){R[0]&1&&V(i,L[0].text),R[0]&32&&_.p(L[5]),R[0]&1&&V(q,L[0].hint),R[0]&32&&g.p(L[5]),R[0]&1&&V(F,L[0].comment),R[0]&32&&j.p(L[5]),R[0]&1&&(k.checked=L[0].is_invalid),R[0]&1&&(P.checked=L[0].needs_review)},d(L){L&&(S(e),S(v),S(b),S(J),S(I),S(K),S(M),S(p),S(G)),l[16](null),l[18](null),l[20](null),$=!1,ie(se)}}}function fe(l){let e;return{c(){e=d("div"),e.innerHTML='<div class="alert alert-secondary" role="alert">Don&#39;t forget to set the correct answer!</div>',s(e,"class","col")},m(n,o){Q(n,e,o)},d(n){n&&S(e)}}}function me(l){let e,n,o=l[32].comment+"",i;return{c(){e=d("div"),n=d("p"),i=ee(o),s(n,"class","card-text"),s(e,"class","card-body")},m(c,f){Q(c,e,f),u(e,n),u(n,i)},p(c,f){f[0]&1&&o!==(o=c[32].comment+"")&&Be(i,o)},d(c){c&&S(e)}}}function pe(l,e){let n,o,i,c,f,m,_,v,b,H,T;function q(){return e[23](e[32])}let r=e[32].comment&&me(e);return{key:l,first:null,c(){n=d("div"),o=d("div"),i=d("div"),c=d("button"),c.innerHTML='<i class="bi bi-trash"></i>',f=w(),m=d("img"),v=w(),r&&r.c(),b=w(),s(c,"type","button"),s(c,"class","btn btn-sm btn-light"),s(i,"class","card-header bg-transparent"),oe(m.src,_="/"+e[32].path)||s(m,"src",_),s(m,"class","card-img-top"),s(m,"alt",""),s(o,"class","card"),Te(o,"width","18rem"),s(n,"class","col"),this.first=n},m(y,h){Q(y,n,h),u(n,o),u(o,i),u(i,c),u(o,f),u(o,m),u(o,v),r&&r.m(o,null),u(n,b),H||(T=W(c,"click",U(q)),H=!0)},p(y,h){e=y,h[0]&1&&!oe(m.src,_="/"+e[32].path)&&s(m,"src",_),e[32].comment?r?r.p(e,h):(r=me(e),r.c(),r.m(o,null)):r&&(r.d(1),r=null)},d(y){y&&S(n),r&&r.d(),H=!1,T()}}}function _e(l){let e,n,o,i,c;function f(){return l[25](l[29])}return{c(){e=d("button"),n=d("i"),s(n,"class","bi bi-check-lg"),s(e,"type","button"),s(e,"class",o="btn btn-sm "+(l[6]===l[29].id?"btn-success":"btn-light")),s(e,"title","Set as correct answer")},m(m,_){Q(m,e,_),u(e,n),i||(c=W(e,"click",U(f)),i=!0)},p(m,_){l=m,_[0]&65&&o!==(o="btn btn-sm "+(l[6]===l[29].id?"btn-success":"btn-light"))&&s(e,"class",o)},d(m){m&&S(e),i=!1,c()}}}function he(l,e){let n,o,i,c,f,m,_,v,b,H;function T(h){e[24](h,e[29],e[30],e[31])}let q={};e[29]!==void 0&&(q.answer=e[29]),o=new Ne({props:q}),X.push(()=>Ce(o,"answer",T));let r=e[0].type==="mc"&&_e(e);function y(){return e[26](e[29])}return{key:l,first:null,c(){n=Ie(),Ae(o.$$.fragment),c=w(),f=d("div"),r&&r.c(),m=w(),_=d("button"),_.innerHTML='<i class="bi bi-trash"></i>',s(_,"type","button"),s(_,"class","btn btn-sm btn-light"),s(_,"title","Remove answer"),s(f,"class","text-end mb-2"),this.first=n},m(h,g){Q(h,n,g),Le(o,h,g),Q(h,c,g),Q(h,f,g),r&&r.m(f,null),u(f,m),u(f,_),v=!0,b||(H=W(_,"click",U(y)),b=!0)},p(h,g){e=h;const J={};!i&&g[0]&1&&(i=!0,J.answer=e[29],Qe(()=>i=!1)),o.$set(J),e[0].type==="mc"?r?r.p(e,g):(r=_e(e),r.c(),r.m(f,m)):r&&(r.d(1),r=null)},i(h){v||(ve(o.$$.fragment,h),v=!0)},o(h){ke(o.$$.fragment,h),v=!1},d(h){h&&(S(n),S(c),S(f)),Se(o,h),r&&r.d(),b=!1,H()}}}function be(l){let e,n,o;return{c(){e=d("button"),e.textContent="Add answer",s(e,"class","btn btn-sm btn-primary")},m(i,c){Q(i,e,c),n||(o=W(e,"click",l[11]),n=!0)},p:te,d(i){i&&S(e),n=!1,o()}}}function je(l){let e,n,o,i=l[0].id,c,f,m,_,v,b,H,T,q,r=[],y=new Map,h,g=[],J=new Map,I,N,D,F,A=l[1]&&de(l),E=ce(l),C=!l[6]&&l[0].type==="mc"&&fe(),j=x(l[0].images);const K=a=>a[32].id;for(let a=0;a<j.length;a+=1){let t=ue(l,j,a),p=K(t);y.set(p,r[a]=pe(p,t))}let M=x(l[0].answers);const z=a=>a[29].id;for(let a=0;a<M.length;a+=1){let t=re(l,M,a),p=z(t);J.set(p,g[a]=he(p,t))}let k=(l[0].type==="mc"||l[0].answers.length===0)&&be(l);return{c(){e=d("div"),n=d("form"),A&&A.c(),o=w(),E.c(),c=w(),f=d("div"),m=d("label"),m.textContent="Add image",_=w(),v=d("input"),H=w(),C&&C.c(),T=w(),q=d("div");for(let a=0;a<r.length;a+=1)r[a].c();h=w();for(let a=0;a<g.length;a+=1)g[a].c();I=w(),k&&k.c(),s(m,"for","image"),s(m,"class","form-label"),s(v,"class","form-control"),s(v,"type","file"),s(v,"id",b="imageInput"+l[0].id),s(v,"name","image"),s(f,"class","mb-3"),s(n,"action","#"),s(n,"class","mt-3"),s(q,"class","row row-cols-1 row-cols-lg-3 g4"),s(e,"class","mt-1 mb-1")},m(a,t){Q(a,e,t),u(e,n),A&&A.m(n,null),u(n,o),E.m(n,null),u(n,c),u(n,f),u(f,m),u(f,_),u(f,v),u(e,H),C&&C.m(e,null),u(e,T),u(e,q);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(q,null);u(e,h);for(let p=0;p<g.length;p+=1)g[p]&&g[p].m(e,null);u(e,I),k&&k.m(e,null),N=!0,D||(F=[W(v,"input",l[9]),W(n,"submit",U(l[8]))],D=!0)},p(a,t){a[1]?A?A.p(a,t):(A=de(a),A.c(),A.m(n,o)):A&&(A.d(1),A=null),t[0]&1&&ne(i,i=a[0].id)?(E.d(1),E=ce(a),E.c(),E.m(n,c)):E.p(a,t),(!N||t[0]&1&&b!==(b="imageInput"+a[0].id))&&s(v,"id",b),!a[6]&&a[0].type==="mc"?C||(C=fe(),C.c(),C.m(e,T)):C&&(C.d(1),C=null),t[0]&1025&&(j=x(a[0].images),r=ae(r,t,K,1,a,j,y,q,Me,pe,null,ue)),t[0]&4289&&(M=x(a[0].answers),qe(),g=ae(g,t,z,1,a,M,J,e,Re,he,I,re),Ee()),a[0].type==="mc"||a[0].answers.length===0?k?k.p(a,t):(k=be(a),k.c(),k.m(e,null)):k&&(k.d(1),k=null)},i(a){if(!N){for(let t=0;t<M.length;t+=1)ve(g[t]);N=!0}},o(a){for(let t=0;t<g.length;t+=1)ke(g[t]);N=!1},d(a){a&&S(e),A&&A.d(),E.d(a),C&&C.d();for(let t=0;t<r.length;t+=1)r[t].d();for(let t=0;t<g.length;t+=1)g[t].d();k&&k.d(),D=!1,ie(F)}}}function We(){return{id:null,text:""}}function ze(l,e,n){let o,{question:i}=e,{toggleEditor:c}=e,f,m,_,v="";function b(t){t.addEventListener("trix-change",function(){n(0,i.text=document.getElementById("questionText").value,i),n(0,i.comment=document.getElementById("questionComment").value,i),n(0,i.hint=document.getElementById("questionHint").value,i),n(5,v='<p class="text-end">Saving ...</p>'),q()}),t.toolbarElement.style.display="none",t.addEventListener("trix-focus",function(p){p.target.toolbarElement.style.display="block"}),t.addEventListener("trix-blur",function(p){p.target.toolbarElement.contains(document.activeElement)||(p.target.toolbarElement.style.display="none")})}function H(t){t!==i.correct_answer_id&&(n(0,i.correct_answer_id=t,i),axios.put("/api/questions/"+i.id,i).then(function(p){}).catch(function(p){alert(p)}))}var T;function q(){T&&T.cancel(),T=ye(()=>{axios.put("/api/questions/"+i.id,i).then(function(t){n(5,v='<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(t){n(5,v='<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(t)})},500,{maxWait:2e3}),T()}function r(){var t=new FormData,p=document.getElementById("imageInput"+i.id);t.set("image",p.files[0]),axios.post("/api/questions/"+i.id+"/images",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(G){p.value="";var O=G.data;n(0,i.images=[...i.images,O],i)}).catch(function(G){p.value="",alert(G)})}function y(t){axios.delete("/api/images/"+t).then(function(p){n(0,i.images=i.images.filter(G=>G.id!==t),i)}).catch(function(p){alert(p)})}function h(){var t=We();axios.post("/api/questions/"+i.id+"/answers",t).then(function(p){t.id=p.data.id,n(0,i.answers=[...i.answers,t],i)}).catch(function(p){alert(p)})}function g(t){axios.delete("/api/answers/"+t).then(function(p){n(0,i.answers=i.answers.filter(G=>G.id!==t),i)}).catch(function(p){alert(p)})}function J(){axios.put("/api/questions/"+i.id,{is_invalid:!i.is_invalid}).then(function(t){n(0,i.is_invalid=!i.is_invalid,i)}).catch(function(t){alert(t)})}function I(){axios.put("/api/questions/"+i.id,{needs_review:!i.needs_review}).then(function(t){n(0,i.needs_review=!i.needs_review,i)}).catch(function(t){alert(t)})}function N(){i.text=this.value,n(0,i)}function D(t){X[t?"unshift":"push"](()=>{f=t,n(2,f)})}function F(){i.hint=this.value,n(0,i)}function A(t){X[t?"unshift":"push"](()=>{_=t,n(4,_)})}function E(){i.comment=this.value,n(0,i)}function C(t){X[t?"unshift":"push"](()=>{m=t,n(3,m)})}function j(){i.is_invalid=this.checked,n(0,i)}function K(){i.needs_review=this.checked,n(0,i)}const M=t=>{y(t.id)};function z(t,p,G,O){G[O]=t,n(0,i)}const k=t=>{H(t.id)},a=t=>{g(t.id)};return l.$$set=t=>{"question"in t&&n(0,i=t.question),"toggleEditor"in t&&n(1,c=t.toggleEditor)},l.$$.update=()=>{l.$$.dirty[0]&1&&n(6,o=i.correct_answer_id),l.$$.dirty[0]&4&&f&&b(f),l.$$.dirty[0]&8&&m&&b(m),l.$$.dirty[0]&16&&_&&b(_)},[i,c,f,m,_,v,o,H,q,r,y,h,g,J,I,N,D,F,A,E,C,j,K,M,z,k,a]}class Oe extends ge{constructor(e){super(),we(this,e,ze,je,ne,{question:0,toggleEditor:1},null,[-1,-1])}}export{Oe as Q};
