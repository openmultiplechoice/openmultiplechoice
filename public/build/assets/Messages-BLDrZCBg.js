import{S as de,i as fe,s as me,g as I,e as O,a as M,w as L,B as G,x as N,y as K,d as w,E as ge,b as k,c as _,h,l as H,p as S,r as U,f as ke,k as V,m as W,o as re,u as ce,v as F,z as _e,J as ve,t as R,j as z,C as A,n as P,H as ye}from"./index-B80I9K_4.js";import{e as J,u as Me,o as we}from"./each-DkBj6IvG.js";import{p as Q,d as Ie}from"./purify.es-DfBF0len.js";import{U as qe}from"./UserSettingsStore-BgSeteCb.js";import{f as X,p as Y}from"./parseISO-Ds5nI7_t.js";function Z(u,t,e){const s=u.slice();return s[20]=t[e],s[21]=t,s[22]=e,s}function $(u){let t,e,s;function n(o,r){return o[5]?Ee:Ce}let a=n(u),l=a(u),i=u[6]&&ne(u);return{c(){t=k("div"),e=k("div"),l.c(),s=I(),i&&i.c(),_(e,"class","row"),_(t,"class","mt-1 mb-1")},m(o,r){M(o,t,r),h(t,e),l.m(e,null),h(t,s),i&&i.m(t,null)},p(o,r){a===(a=n(o))&&l?l.p(o,r):(l.d(1),l=a(o),l&&(l.c(),l.m(e,null))),o[6]?i?i.p(o,r):(i=ne(o),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},d(o){o&&w(t),l.d(),i&&i.d()}}}function Ee(u){let t,e,s,n,a,l,i,o,r,c,b,f,m,v,p,d,g,E,C;return{c(){t=k("div"),e=k("form"),s=k("div"),n=k("input"),l=I(),i=k("trix-editor"),o=I(),r=k("div"),c=k("input"),f=I(),m=k("label"),m.textContent="Anonymous",v=I(),p=k("input"),d=I(),g=k("button"),g.textContent="Cancel",_(n,"id","message"),_(n,"type","hidden"),_(n,"name","message"),n.value=a=u[0].text,ve(i,"input","message"),_(s,"class","mb-3"),_(c,"type","checkbox"),_(c,"class","form-check-input"),_(c,"id","anonymous"),c.checked=b=u[0].is_anonymous,_(m,"class","form-check-label"),_(m,"for","anonymous"),_(r,"class","mb-3 form-check"),_(p,"class","btn btn-sm btn-primary"),_(p,"type","submit"),p.value="Save",_(g,"class","btn btn-link mr-0"),_(e,"class","mt-3 mb-3"),_(t,"class","col-md")},m(B,T){M(B,t,T),h(t,e),h(e,s),h(s,n),h(s,l),h(s,i),h(e,o),h(e,r),h(r,c),h(r,f),h(r,m),h(e,v),h(e,p),h(e,d),h(e,g),E||(C=[H(g,"click",S(u[11])),H(e,"submit",S(u[13]))],E=!0)},p(B,T){T&1&&a!==(a=B[0].text)&&(n.value=a),T&1&&b!==(b=B[0].is_anonymous)&&(c.checked=b)},d(B){B&&w(t),E=!1,U(C)}}}function Ce(u){let t,e,s,n,a,l=X(Y(u[0].created_at),"dd.MM.yyyy HH:mm")+"",i,o,r;function c(p,d){return p[0].is_deleted?He:Se}let b=c(u),f=b(u),m=!u[0].is_deleted&&ee(u),v=u[0].author&&!u[0].is_deleted&&se(u);return{c(){t=k("div"),f.c(),e=I(),s=k("p"),n=k("small"),m&&m.c(),a=I(),i=R(l),o=I(),v&&v.c(),_(s,"class","text-muted text-end mb-0"),_(t,"class",r="col-md offset-md-"+u[1])},m(p,d){M(p,t,d),f.m(t,null),h(t,e),h(t,s),h(s,n),m&&m.m(n,null),h(n,a),h(n,i),h(n,o),v&&v.m(n,null)},p(p,d){b===(b=c(p))&&f?f.p(p,d):(f.d(1),f=b(p),f&&(f.c(),f.m(t,e))),p[0].is_deleted?m&&(m.d(1),m=null):m?m.p(p,d):(m=ee(p),m.c(),m.m(n,a)),d&1&&l!==(l=X(Y(p[0].created_at),"dd.MM.yyyy HH:mm")+"")&&z(i,l),p[0].author&&!p[0].is_deleted?v?v.p(p,d):(v=se(p),v.c(),v.m(n,null)):v&&(v.d(1),v=null),d&2&&r!==(r="col-md offset-md-"+p[1])&&_(t,"class",r)},d(p){p&&w(t),f.d(),m&&m.d(),v&&v.d()}}}function He(u){let t;return{c(){t=k("p"),t.innerHTML="<small><i>deleted</i></small>",_(t,"class","rounded-2 bg-light-subtle p-1 mb-0 text-muted")},m(e,s){M(e,t,s)},p:P,d(e){e&&w(t)}}}function Se(u){let t,e=u[0].text&&x(u);return{c(){t=k("p"),e&&e.c(),_(t,"class","rounded-2 bg-light p-2 mb-0")},m(s,n){M(s,t,n),e&&e.m(t,null)},p(s,n){s[0].text?e?e.p(s,n):(e=x(s),e.c(),e.m(t,null)):e&&(e.d(1),e=null)},d(s){s&&w(t),e&&e.d()}}}function x(u){let t,e=Q.sanitize(u[0].text)+"",s;return{c(){t=new ye(!1),s=O(),t.a=s},m(n,a){t.m(e,n,a),M(n,s,a)},p(n,a){a&1&&e!==(e=Q.sanitize(n[0].text)+"")&&t.p(e)},d(n){n&&(w(s),t.d())}}}function ee(u){let t,e,s,n,a,l,i,o,r,c,b,f,m,v,p=u[10].id===u[0].author_id&&te(u);return{c(){var d,g,E,C;t=R(u[9]),e=I(),s=k("button"),n=k("i"),a=I(),l=R(u[8]),i=I(),o=k("button"),r=k("i"),c=I(),p&&p.c(),b=I(),f=k("button"),f.textContent="Reply",_(n,"class","bi"),A(n,"bi-hand-thumbs-up-fill",((d=u[7])==null?void 0:d.thumb)==="up"),A(n,"bi-hand-thumbs-up",((g=u[7])==null?void 0:g.thumb)!=="up"),_(s,"class","btn"),_(r,"class","bi"),A(r,"bi-hand-thumbs-down-fill",((E=u[7])==null?void 0:E.thumb)==="down"),A(r,"bi-hand-thumbs-down",((C=u[7])==null?void 0:C.thumb)!=="down"),_(o,"class","btn"),_(f,"class","btn btn-sm btn-link link-dark")},m(d,g){M(d,t,g),M(d,e,g),M(d,s,g),h(s,n),M(d,a,g),M(d,l,g),M(d,i,g),M(d,o,g),h(o,r),M(d,c,g),p&&p.m(d,g),M(d,b,g),M(d,f,g),m||(v=[H(s,"click",S(u[17])),H(o,"click",S(u[18])),H(f,"click",S(u[12]))],m=!0)},p(d,g){var E,C,B,T;g&512&&z(t,d[9]),g&128&&A(n,"bi-hand-thumbs-up-fill",((E=d[7])==null?void 0:E.thumb)==="up"),g&128&&A(n,"bi-hand-thumbs-up",((C=d[7])==null?void 0:C.thumb)!=="up"),g&256&&z(l,d[8]),g&128&&A(r,"bi-hand-thumbs-down-fill",((B=d[7])==null?void 0:B.thumb)==="down"),g&128&&A(r,"bi-hand-thumbs-down",((T=d[7])==null?void 0:T.thumb)!=="down"),d[10].id===d[0].author_id?p?p.p(d,g):(p=te(d),p.c(),p.m(b.parentNode,b)):p&&(p.d(1),p=null)},d(d){d&&(w(t),w(e),w(s),w(a),w(l),w(i),w(o),w(c),w(b),w(f)),p&&p.d(d),m=!1,U(v)}}}function te(u){let t,e,s,n,a;return{c(){t=k("button"),t.textContent="Edit",e=I(),s=k("button"),s.textContent="Delete",_(t,"class","btn btn-sm btn-link link-dark"),_(s,"class","btn btn-sm btn-link link-dark")},m(l,i){M(l,t,i),M(l,e,i),M(l,s,i),n||(a=[H(t,"click",S(u[11])),H(s,"click",S(u[15]))],n=!0)},p:P,d(l){l&&(w(t),w(e),w(s)),n=!1,U(a)}}}function se(u){let t=(u[0].author.public_name?u[0].author.public_name:u[0].author.name)+"",e;return{c(){e=R(t)},m(s,n){M(s,e,n)},p(s,n){n&1&&t!==(t=(s[0].author.public_name?s[0].author.public_name:s[0].author.name)+"")&&z(e,t)},d(s){s&&w(e)}}}function ne(u){let t,e,s,n,a,l,i,o,r,c,b,f,m,v,p;return{c(){t=k("div"),e=k("div"),s=k("form"),n=k("input"),l=I(),i=k("div"),i.innerHTML='<input id="replyMessage" type="hidden" name="replyMessage" value=""/> <trix-editor input="replyMessage"></trix-editor>',o=I(),r=k("div"),r.innerHTML='<input type="checkbox" class="form-check-input" id="replyAnonymous" checked=""/> <label class="form-check-label" for="replyAnonymous">Anonymous</label>',c=I(),b=k("input"),f=I(),m=k("button"),m.textContent="Cancel",_(n,"id","parentMessageId"),_(n,"type","hidden"),n.value=a=u[0].id,_(i,"class","mb-3"),_(r,"class","mb-3 form-check"),_(b,"class","btn btn-sm btn-primary"),_(b,"type","submit"),b.value="Send reply",_(m,"class","btn btn-link mr-0"),_(s,"class","mt-3 mb-3"),_(e,"class","col-md"),_(t,"class","row")},m(d,g){M(d,t,g),h(t,e),h(e,s),h(s,n),h(s,l),h(s,i),h(s,o),h(s,r),h(s,c),h(s,b),h(s,f),h(s,m),v||(p=[H(m,"click",S(u[12])),H(s,"submit",S(u[14]))],v=!0)},p(d,g){g&1&&a!==(a=d[0].id)&&(n.value=a)},d(d){d&&w(t),v=!1,U(p)}}}function le(u){let t,e,s=J(u[0].childs),n=[];for(let l=0;l<s.length;l+=1)n[l]=ie(Z(u,s,l));const a=l=>N(n[l],1,1,()=>{n[l]=null});return{c(){for(let l=0;l<n.length;l+=1)n[l].c();t=O()},m(l,i){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(l,i);M(l,t,i),e=!0},p(l,i){if(i&31){s=J(l[0].childs);let o;for(o=0;o<s.length;o+=1){const r=Z(l,s,o);n[o]?(n[o].p(r,i),L(n[o],1)):(n[o]=ie(r),n[o].c(),L(n[o],1),n[o].m(t.parentNode,t))}for(G(),o=s.length;o<n.length;o+=1)a(o);K()}},i(l){if(!e){for(let i=0;i<s.length;i+=1)L(n[i]);e=!0}},o(l){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)N(n[i]);e=!1},d(l){l&&w(t),ke(n,l)}}}function ie(u){let t,e,s;function n(l){u[19](l,u[20],u[21],u[22])}let a={indent:u[1]+1,addMessage:u[2],updateMessage:u[3],questionId:u[4]};return u[20]!==void 0&&(a.message=u[20]),t=new be({props:a}),V.push(()=>W(t,"message",n)),{c(){re(t.$$.fragment)},m(l,i){ce(t,l,i),s=!0},p(l,i){u=l;const o={};i&2&&(o.indent=u[1]+1),i&4&&(o.addMessage=u[2]),i&8&&(o.updateMessage=u[3]),i&16&&(o.questionId=u[4]),!e&&i&1&&(e=!0,o.message=u[20],F(()=>e=!1)),t.$set(o)},i(l){s||(L(t.$$.fragment,l),s=!0)},o(l){N(t.$$.fragment,l),s=!1},d(l){_e(t,l)}}}function Be(u){let t,e,s,n=(!u[0].is_deleted||u[0].is_deleted&&u[0].childs)&&$(u),a=u[0].childs&&le(u);return{c(){n&&n.c(),t=I(),a&&a.c(),e=O()},m(l,i){n&&n.m(l,i),M(l,t,i),a&&a.m(l,i),M(l,e,i),s=!0},p(l,[i]){!l[0].is_deleted||l[0].is_deleted&&l[0].childs?n?n.p(l,i):(n=$(l),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null),l[0].childs?a?(a.p(l,i),i&1&&L(a,1)):(a=le(l),a.c(),L(a,1),a.m(e.parentNode,e)):a&&(G(),N(a,1,1,()=>{a=null}),K())},i(l){s||(L(a),s=!0)},o(l){N(a),s=!1},d(l){l&&(w(t),w(e)),n&&n.d(l),a&&a.d(l)}}}function Te(u,t,e){let s,n,a,l;ge(u,qe,y=>e(10,l=y));let{message:i}=t,{indent:o}=t,{addMessage:r}=t,{updateMessage:c}=t,{questionId:b}=t;var f=!1,m=!1;function v(){e(5,f=!f)}function p(){e(6,m=!m)}function d(){var y={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.put("/api/messages/"+i.id,y).then(function(q){v(),e(0,i.text=q.data.text,i),c(i)}).catch(function(q){alert(q)})}function g(){var y={text:document.getElementById("replyMessage").value,parent_message_id:document.getElementById("parentMessageId").value,is_anonymous:document.getElementById("replyAnonymous").checked};axios.post("/api/questions/"+b+"/messages",y).then(function(q){p(),r(q.data)}).catch(function(q){alert(q)})}function E(){axios.delete("/api/messages/"+i.id).then(function(y){e(0,i.text="",i),e(0,i.is_deleted=!0,i),c(i)}).catch(function(y){alert(y)})}function C(y){a!==null?a.thumb===y?axios.delete("/api/messages/"+i.id+"/thumbs/"+a.id).then(function(q){e(0,i.thumbs=i.thumbs.filter(D=>D.user_id===void 0),i),c(i)}).catch(function(q){alert(q)}):axios.put("/api/messages/"+i.id+"/thumbs/"+a.id,{type:y}).then(function(q){i.thumbs.find(D=>D.user_id!==void 0).thumb=y,c(i)}).catch(function(q){alert(q)}):axios.post("/api/messages/"+i.id+"/thumbs",{type:y}).then(function(q){i.thumbs.push({thumb:q.data.type,user_id:q.data.user_id,id:q.data.id}),c(i)}).catch(function(q){alert(q)})}const B=()=>C("up"),T=()=>C("down");function pe(y,q,D,he){D[he]=y,e(0,i)}return u.$$set=y=>{"message"in y&&e(0,i=y.message),"indent"in y&&e(1,o=y.indent),"addMessage"in y&&e(2,r=y.addMessage),"updateMessage"in y&&e(3,c=y.updateMessage),"questionId"in y&&e(4,b=y.questionId)},u.$$.update=()=>{u.$$.dirty&1&&e(9,s=i.thumbs.filter(y=>y.thumb==="up").length??0),u.$$.dirty&1&&e(8,n=i.thumbs.filter(y=>y.thumb==="down").length??0),u.$$.dirty&1&&e(7,a=i.thumbs.find(y=>y.user_id!==void 0)??null)},[i,o,r,c,b,f,m,a,n,s,l,v,p,d,g,E,C,B,T,pe]}class be extends de{constructor(t){super(),fe(this,t,Te,Be,me,{message:0,indent:1,addMessage:2,updateMessage:3,questionId:4})}}function ue(u,t,e){const s=u.slice();return s[13]=t[e],s[14]=t,s[15]=e,s}function ae(u){let t,e;return{c(){t=k("p"),e=R(u[3])},m(s,n){M(s,t,n),h(t,e)},p(s,n){n&8&&z(e,s[3])},d(s){s&&w(t)}}}function oe(u,t){let e,s,n,a,l;function i(c){t[8](c,t[13],t[14],t[15])}function o(c){t[9](c)}let r={indent:0,addMessage:t[4],updateMessage:t[5]};return t[13]!==void 0&&(r.message=t[13]),t[0]!==void 0&&(r.questionId=t[0]),s=new be({props:r}),V.push(()=>W(s,"message",i)),V.push(()=>W(s,"questionId",o)),{key:u,first:null,c(){e=O(),re(s.$$.fragment),this.first=e},m(c,b){M(c,e,b),ce(s,c,b),l=!0},p(c,b){t=c;const f={};!n&&b&4&&(n=!0,f.message=t[13],F(()=>n=!1)),!a&&b&1&&(a=!0,f.questionId=t[0],F(()=>a=!1)),s.$set(f)},i(c){l||(L(s.$$.fragment,c),l=!0)},o(c){N(s.$$.fragment,c),l=!1},d(c){c&&w(e),_e(s,c)}}}function Le(u){let t,e,s;return{c(){t=k("button"),t.innerHTML='<i class="bi bi-chat-square-dots"></i> Add comment',_(t,"class","btn btn-sm btn-outline-secondary")},m(n,a){M(n,t,a),e||(s=H(t,"click",S(u[7])),e=!0)},p:P,d(n){n&&w(t),e=!1,s()}}}function Ae(u){let t,e,s,n,a,l,i,o,r,c,b;return{c(){t=k("div"),e=k("form"),s=k("div"),s.innerHTML='<input id="message" type="hidden" name="message" value=""/> <trix-editor input="message"></trix-editor>',n=I(),a=k("div"),a.innerHTML='<input type="checkbox" class="form-check-input" id="anonymous" checked=""/> <label class="form-check-label" for="anonymous">Anonymous</label>',l=I(),i=k("input"),o=I(),r=k("button"),r.textContent="Cancel",_(s,"class","mb-3"),_(a,"class","mb-3 form-check"),_(i,"class","btn btn-sm btn-primary"),_(i,"type","submit"),i.value="Send",_(r,"class","btn btn-link mr-0"),_(e,"action","#"),_(e,"class","mt-3 mb-3"),_(t,"class","mt-3")},m(f,m){M(f,t,m),h(t,e),h(e,s),h(e,n),h(e,a),h(e,l),h(e,i),h(e,o),h(e,r),c||(b=[H(r,"click",S(u[7])),H(e,"submit",S(u[6]))],c=!0)},p:P,d(f){f&&w(t),c=!1,U(b)}}}function Ne(u){let t,e=[],s=new Map,n,a,l=J(u[2]);const i=f=>f[13].id;for(let f=0;f<l.length;f+=1){let m=ue(u,l,f),v=i(m);s.set(v,e[f]=oe(v,m))}let o=null;l.length||(o=ae(u));function r(f,m){return f[1]?Ae:Le}let c=r(u),b=c(u);return{c(){t=k("div");for(let f=0;f<e.length;f+=1)e[f].c();o&&o.c(),n=I(),b.c(),_(t,"class","mt-3 mb-3")},m(f,m){M(f,t,m);for(let v=0;v<e.length;v+=1)e[v]&&e[v].m(t,null);o&&o.m(t,null),h(t,n),b.m(t,null),a=!0},p(f,[m]){m&61&&(l=J(f[2]),G(),e=Me(e,m,i,1,f,l,s,t,we,oe,n,ue),K(),!l.length&&o?o.p(f,m):l.length?o&&(o.d(1),o=null):(o=ae(f),o.c(),o.m(t,n))),c===(c=r(f))&&b?b.p(f,m):(b.d(1),b=c(f),b&&(b.c(),b.m(t,null)))},i(f){if(!a){for(let m=0;m<l.length;m+=1)L(e[m]);a=!0}},o(f){for(let m=0;m<e.length;m+=1)N(e[m]);a=!1},d(f){f&&w(t);for(let m=0;m<e.length;m+=1)e[m].d();o&&o.d(),b.d()}}}function j(u){var t=structuredClone(u),e={},s=[];t.forEach(a=>{if(!a.parent_message_id&&!a.legacy_parent_message_id){s.push(a);return}var l=a.parent_message_id;if(!l){const i=t.find(o=>o.legacy_message_id===a.legacy_parent_message_id);i?l=i.id:console.error("Parent message not found for message",a)}e[l]||(e[l]=[]),e[l].push(a)});function n(a){var l=a.id;e[l]&&(a.childs=e[l],a.childs.forEach(i=>{n(i)}))}return s.forEach(a=>{n(a)}),s}function De(u,t,e){let{questionId:s}=t;var n=!1,a=[],l=[],i="Loading comments ...",o;function r(){a=[],e(3,i="Loading comments ..."),o&&o.cancel(),o=Ie(()=>{axios.get("/api/questions/"+s+"/messages").then(function(d){if(a=d.data,a.length===0){e(3,i="No comments yet");return}e(2,l=j(a))}).catch(function(d){alert(d)})},1e3,{maxWait:2e3}),o()}function c(d){a.push(d),e(2,l=j(a))}function b(d){const g=a.findIndex(E=>E.id===d.id);a[g]=d,e(2,l=j(a))}function f(){var d={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.post("/api/questions/"+s+"/messages",d).then(function(g){m(),a.push(g.data),e(2,l=j(a))}).catch(function(g){alert(g)})}function m(){e(1,n=!n)}function v(d,g,E,C){E[C]=d,e(2,l),e(0,s)}function p(d){s=d,e(0,s)}return u.$$set=d=>{"questionId"in d&&e(0,s=d.questionId)},u.$$.update=()=>{u.$$.dirty&1&&(e(2,l=[]),e(1,n=!1),r())},[s,n,l,i,c,b,f,m,v,p]}class Oe extends de{constructor(t){super(),fe(this,t,De,Ne,me,{questionId:0})}}export{Oe as M};
