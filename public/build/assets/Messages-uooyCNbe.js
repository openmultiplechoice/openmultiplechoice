import{S as me,i as _e,s as pe,d as q,w as N,x as S,z as V,A as W,a as C,b as I,e as O,K as ve,c as f,f as b,g as d,m as we,v as K,l as B,p as L,k as G,r as J,u as be,y as X,B as he,C as ge,q as U,t as j,j as Me,o as D,n as P,H as Ie}from"./index-C5hKwDc9.js";import{e as Q,u as qe,o as Ce}from"./each-JoEH9o9l.js";import{p as x,d as Ee}from"./purify.es-CzHI0FGf.js";import{U as He}from"./UserSettingsStore-DIGhToub.js";import{f as $,p as ee}from"./parseISO-nqt9u7wd.js";function te(u,t,e){const n=u.slice();return n[18]=t[e],n[19]=t,n[20]=e,n}function ne(u){let t,e,n;function i(a,_){return a[5]?Ae:Te}let s=i(u),l=s(u),o=u[6]&&ue(u);return{c(){t=b("div"),e=b("div"),l.c(),n=I(),o&&o.c(),d(e,"class","row"),d(t,"class","mt-1 mb-1")},m(a,_){C(a,t,_),f(t,e),l.m(e,null),f(t,n),o&&o.m(t,null)},p(a,_){s===(s=i(a))&&l?l.p(a,_):(l.d(1),l=s(a),l&&(l.c(),l.m(e,null))),a[6]?o?o.p(a,_):(o=ue(a),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},d(a){a&&q(t),l.d(),o&&o.d()}}}function Ae(u){let t,e,n,i,s,l,o,a,_,p,h,c,r,k,H,E,m,g,M;return{c(){t=b("div"),e=b("form"),n=b("div"),i=b("input"),l=I(),o=b("trix-editor"),a=I(),_=b("div"),p=b("input"),c=I(),r=b("label"),r.textContent="Anonymous",k=I(),H=b("input"),E=I(),m=b("button"),m.textContent="Cancel",d(i,"id","message"),d(i,"type","hidden"),d(i,"name","message"),i.value=s=u[0].text,Me(o,"input","message"),d(n,"class","mb-3"),d(p,"type","checkbox"),d(p,"class","form-check-input"),d(p,"id","anonymous"),p.checked=h=u[0].is_anonymous,d(r,"class","form-check-label"),d(r,"for","anonymous"),d(_,"class","mb-3 form-check"),d(H,"class","btn btn-sm btn-primary"),d(H,"type","submit"),H.value="Save",d(m,"class","btn btn-link mr-0"),d(e,"class","mt-3 mb-3"),d(t,"class","col-md")},m(T,y){C(T,t,y),f(t,e),f(e,n),f(n,i),f(n,l),f(n,o),f(e,a),f(e,_),f(_,p),f(_,c),f(_,r),f(e,k),f(e,H),f(e,E),f(e,m),g||(M=[B(m,"click",L(u[9])),B(e,"submit",L(u[11]))],g=!0)},p(T,y){y&1&&s!==(s=T[0].text)&&(i.value=s),y&1&&h!==(h=T[0].is_anonymous)&&(p.checked=h)},d(T){T&&q(t),g=!1,K(M)}}}function Te(u){let t,e,n,i,s,l,o=$(ee(u[0].created_at),"dd.MM.yyyy HH:mm")+"",a,_,p;function h(g,M){return g[0].is_deleted?Se:Be}let c=h(u),r=c(u),k=!u[0].is_deleted&&le(u);function H(g,M){if(g[0].is_anonymous)return Ne;if(g[0].author&&!g[0].is_deleted)return Le}let E=H(u),m=E&&E(u);return{c(){t=b("div"),r.c(),e=I(),n=b("p"),i=b("small"),s=b("div"),k&&k.c(),l=I(),a=j(o),_=I(),m&&m.c(),d(s,"class","d-flex align-items-center py-1"),d(n,"class","text-muted text-end mb-0"),d(t,"class",p="col-md offset-md-"+u[1])},m(g,M){C(g,t,M),r.m(t,null),f(t,e),f(t,n),f(n,i),f(i,s),k&&k.m(s,null),f(s,l),f(s,a),f(s,_),m&&m.m(s,null)},p(g,M){c===(c=h(g))&&r?r.p(g,M):(r.d(1),r=c(g),r&&(r.c(),r.m(t,e))),g[0].is_deleted?k&&(k.d(1),k=null):k?k.p(g,M):(k=le(g),k.c(),k.m(s,l)),M&1&&o!==(o=$(ee(g[0].created_at),"dd.MM.yyyy HH:mm")+"")&&U(a,o),E===(E=H(g))&&m?m.p(g,M):(m&&m.d(1),m=E&&E(g),m&&(m.c(),m.m(s,null))),M&2&&p!==(p="col-md offset-md-"+g[1])&&d(t,"class",p)},d(g){g&&q(t),r.d(),k&&k.d(),m&&m.d()}}}function Se(u){let t;return{c(){t=b("p"),t.innerHTML="<small><i>deleted</i></small>",d(t,"class","rounded-2 bg-light-subtle p-1 mb-0 text-muted")},m(e,n){C(e,t,n)},p:P,d(e){e&&q(t)}}}function Be(u){let t,e=u[0].text&&se(u);return{c(){t=b("p"),e&&e.c(),d(t,"class","rounded-2 bg-light p-2 mb-0 text-break")},m(n,i){C(n,t,i),e&&e.m(t,null)},p(n,i){n[0].text?e?e.p(n,i):(e=se(n),e.c(),e.m(t,null)):e&&(e.d(1),e=null)},d(n){n&&q(t),e&&e.d()}}}function se(u){let t,e=x.sanitize(u[0].text)+"",n;return{c(){t=new Ie(!1),n=O(),t.a=n},m(i,s){t.m(e,i,s),C(i,n,s)},p(i,s){s&1&&e!==(e=x.sanitize(i[0].text)+"")&&t.p(e)},d(i){i&&(q(n),t.d())}}}function le(u){let t,e,n,i,s,l=u[0].thumbs_up_count+"",o,a,_,p,h,c,r,k,H=u[0].thumbs_down_count+"",E,m,g,M,T,y,v=u[8].id===u[0].author_id&&ie(u);return{c(){var w,A,R,z;t=b("div"),e=b("button"),n=b("i"),i=I(),s=b("span"),o=j(l),a=I(),_=b("span"),_.textContent="|",p=I(),h=b("button"),c=b("i"),r=I(),k=b("span"),E=j(H),m=I(),v&&v.c(),g=I(),M=b("button"),M.textContent="Reply",d(n,"class","bi"),D(n,"bi-hand-thumbs-up-fill",((w=u[7])==null?void 0:w.type)==="up"),D(n,"bi-hand-thumbs-up",((A=u[7])==null?void 0:A.type)!=="up"),d(e,"class","btn mx-0 ps-0 pe-1"),d(s,"class","pe-1 font-monospace"),d(_,"class","px-1"),d(c,"class","bi"),D(c,"bi-hand-thumbs-down-fill",((R=u[7])==null?void 0:R.type)==="down"),D(c,"bi-hand-thumbs-down",((z=u[7])==null?void 0:z.type)!=="down"),d(h,"class","btn mx-0 px-1"),d(k,"class","pe-1 font-monospace"),d(t,"class","d-flex rounded-4 align-items-center bg-light ms-auto px-2"),d(M,"class","btn btn-sm btn-link link-dark")},m(w,A){C(w,t,A),f(t,e),f(e,n),f(t,i),f(t,s),f(s,o),f(t,a),f(t,_),f(t,p),f(t,h),f(h,c),f(t,r),f(t,k),f(k,E),C(w,m,A),v&&v.m(w,A),C(w,g,A),C(w,M,A),T||(y=[B(e,"click",L(u[15])),B(h,"click",L(u[16])),B(M,"click",L(u[10]))],T=!0)},p(w,A){var R,z,Y,Z;A&128&&D(n,"bi-hand-thumbs-up-fill",((R=w[7])==null?void 0:R.type)==="up"),A&128&&D(n,"bi-hand-thumbs-up",((z=w[7])==null?void 0:z.type)!=="up"),A&1&&l!==(l=w[0].thumbs_up_count+"")&&U(o,l),A&128&&D(c,"bi-hand-thumbs-down-fill",((Y=w[7])==null?void 0:Y.type)==="down"),A&128&&D(c,"bi-hand-thumbs-down",((Z=w[7])==null?void 0:Z.type)!=="down"),A&1&&H!==(H=w[0].thumbs_down_count+"")&&U(E,H),w[8].id===w[0].author_id?v?v.p(w,A):(v=ie(w),v.c(),v.m(g.parentNode,g)):v&&(v.d(1),v=null)},d(w){w&&(q(t),q(m),q(g),q(M)),v&&v.d(w),T=!1,K(y)}}}function ie(u){let t,e,n,i,s;return{c(){t=b("button"),t.textContent="Edit",e=I(),n=b("button"),n.textContent="Delete",d(t,"class","btn btn-sm btn-link link-dark"),d(n,"class","btn btn-sm btn-link link-dark")},m(l,o){C(l,t,o),C(l,e,o),C(l,n,o),i||(s=[B(t,"click",L(u[9])),B(n,"click",L(u[13]))],i=!0)},p:P,d(l){l&&(q(t),q(e),q(n)),i=!1,K(s)}}}function Le(u){let t,e,n=(u[0].author.public_name?u[0].author.public_name:u[0].author.name)+"",i;return{c(){t=b("strong"),e=b("span"),i=j(n),d(e,"class","ps-2")},m(s,l){C(s,t,l),f(t,e),f(e,i)},p(s,l){l&1&&n!==(n=(s[0].author.public_name?s[0].author.public_name:s[0].author.name)+"")&&U(i,n)},d(s){s&&q(t)}}}function Ne(u){let t;return{c(){t=b("i"),d(t,"class","bi bi-incognito ps-2"),d(t,"title","anonymous")},m(e,n){C(e,t,n)},p:P,d(e){e&&q(t)}}}function ue(u){let t,e,n,i,s,l,o,a,_,p,h,c,r,k,H;return{c(){t=b("div"),e=b("div"),n=b("form"),i=b("input"),l=I(),o=b("div"),o.innerHTML='<input id="replyMessage" type="hidden" name="replyMessage" value=""/> <trix-editor input="replyMessage"></trix-editor>',a=I(),_=b("div"),_.innerHTML='<input type="checkbox" class="form-check-input" id="replyAnonymous" checked=""/> <label class="form-check-label" for="replyAnonymous">Anonymous</label>',p=I(),h=b("input"),c=I(),r=b("button"),r.textContent="Cancel",d(i,"id","parentMessageId"),d(i,"type","hidden"),i.value=s=u[0].id,d(o,"class","mb-3"),d(_,"class","mb-3 form-check"),d(h,"class","btn btn-sm btn-primary"),d(h,"type","submit"),h.value="Send reply",d(r,"class","btn btn-link mr-0"),d(n,"class","mt-3 mb-3"),d(e,"class","col-md"),d(t,"class","row")},m(E,m){C(E,t,m),f(t,e),f(e,n),f(n,i),f(n,l),f(n,o),f(n,a),f(n,_),f(n,p),f(n,h),f(n,c),f(n,r),k||(H=[B(r,"click",L(u[10])),B(n,"submit",L(u[12]))],k=!0)},p(E,m){m&1&&s!==(s=E[0].id)&&(i.value=s)},d(E){E&&q(t),k=!1,K(H)}}}function oe(u){let t,e,n=Q(u[0].childs),i=[];for(let l=0;l<n.length;l+=1)i[l]=ae(te(u,n,l));const s=l=>N(i[l],1,1,()=>{i[l]=null});return{c(){for(let l=0;l<i.length;l+=1)i[l].c();t=O()},m(l,o){for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(l,o);C(l,t,o),e=!0},p(l,o){if(o&31){n=Q(l[0].childs);let a;for(a=0;a<n.length;a+=1){const _=te(l,n,a);i[a]?(i[a].p(_,o),S(i[a],1)):(i[a]=ae(_),i[a].c(),S(i[a],1),i[a].m(t.parentNode,t))}for(V(),a=n.length;a<i.length;a+=1)s(a);W()}},i(l){if(!e){for(let o=0;o<n.length;o+=1)S(i[o]);e=!0}},o(l){i=i.filter(Boolean);for(let o=0;o<i.length;o+=1)N(i[o]);e=!1},d(l){l&&q(t),we(i,l)}}}function ae(u){let t,e,n;function i(l){u[17](l,u[18],u[19],u[20])}let s={indent:u[1]+1,addMessage:u[2],updateMessage:u[3],questionId:u[4]};return u[18]!==void 0&&(s.message=u[18]),t=new ke({props:s}),G.push(()=>J(t,"message",i)),{c(){ge(t.$$.fragment)},m(l,o){he(t,l,o),n=!0},p(l,o){u=l;const a={};o&2&&(a.indent=u[1]+1),o&4&&(a.addMessage=u[2]),o&8&&(a.updateMessage=u[3]),o&16&&(a.questionId=u[4]),!e&&o&1&&(e=!0,a.message=u[18],X(()=>e=!1)),t.$set(a)},i(l){n||(S(t.$$.fragment,l),n=!0)},o(l){N(t.$$.fragment,l),n=!1},d(l){be(t,l)}}}function De(u){let t,e,n,i=(!u[0].is_deleted||u[0].is_deleted&&u[0].childs)&&ne(u),s=u[0].childs&&oe(u);return{c(){i&&i.c(),t=I(),s&&s.c(),e=O()},m(l,o){i&&i.m(l,o),C(l,t,o),s&&s.m(l,o),C(l,e,o),n=!0},p(l,[o]){!l[0].is_deleted||l[0].is_deleted&&l[0].childs?i?i.p(l,o):(i=ne(l),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null),l[0].childs?s?(s.p(l,o),o&1&&S(s,1)):(s=oe(l),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(V(),N(s,1,1,()=>{s=null}),W())},i(l){n||(S(s),n=!0)},o(l){N(s),n=!1},d(l){l&&(q(t),q(e)),i&&i.d(l),s&&s.d(l)}}}function Re(u,t,e){let n,i;ve(u,He,y=>e(8,i=y));let{message:s}=t,{indent:l}=t,{addMessage:o}=t,{updateMessage:a}=t,{questionId:_}=t;var p=!1,h=!1;function c(){e(5,p=!p)}function r(){e(6,h=!h)}function k(){var y={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.put("/api/messages/"+s.id,y).then(function(v){c(),e(0,s.text=v.data.text,s),e(0,s.is_anonymous=v.data.is_anonymous,s),a(s)}).catch(function(v){alert(v)})}function H(){var y={text:document.getElementById("replyMessage").value,parent_message_id:document.getElementById("parentMessageId").value,is_anonymous:document.getElementById("replyAnonymous").checked};axios.post("/api/questions/"+_+"/messages",y).then(function(v){r(),o(v.data)}).catch(function(v){alert(v)})}function E(){confirm("Are you sure you want to delete this message?")&&axios.delete("/api/messages/"+s.id).then(function(y){e(0,s.text="",s),e(0,s.is_deleted=!0,s),a(s)}).catch(function(y){alert(y)})}function m(y){n!==null?n.type===y?axios.delete("/api/messages/"+s.id+"/thumbs/"+n.id).then(function(v){e(0,s.thumbs=s.thumbs.filter(w=>w.user_id===void 0),s),y==="up"?e(0,s.thumbs_up_count-=1,s):e(0,s.thumbs_down_count-=1,s),a(s)}).catch(function(v){alert(v)}):axios.put("/api/messages/"+s.id+"/thumbs/"+n.id,{type:y}).then(function(v){s.thumbs.find(w=>w.user_id!==void 0).type=y,y==="up"?(e(0,s.thumbs_up_count+=1,s),e(0,s.thumbs_down_count-=1,s)):(e(0,s.thumbs_down_count+=1,s),e(0,s.thumbs_up_count-=1,s)),a(s)}).catch(function(v){alert(v)}):axios.post("/api/messages/"+s.id+"/thumbs",{type:y}).then(function(v){s.thumbs.push({type:v.data.type,user_id:v.data.user_id,id:v.data.id}),y==="up"?e(0,s.thumbs_up_count+=1,s):e(0,s.thumbs_down_count+=1,s),a(s)}).catch(function(v){alert(v)})}const g=()=>m("up"),M=()=>m("down");function T(y,v,w,A){w[A]=y,e(0,s)}return u.$$set=y=>{"message"in y&&e(0,s=y.message),"indent"in y&&e(1,l=y.indent),"addMessage"in y&&e(2,o=y.addMessage),"updateMessage"in y&&e(3,a=y.updateMessage),"questionId"in y&&e(4,_=y.questionId)},u.$$.update=()=>{u.$$.dirty&1&&e(7,n=s.thumbs.find(y=>y.user_id!==void 0)??null)},[s,l,o,a,_,p,h,n,i,c,r,k,H,E,m,g,M,T]}class ke extends me{constructor(t){super(),_e(this,t,Re,De,pe,{message:0,indent:1,addMessage:2,updateMessage:3,questionId:4})}}function fe(u,t,e){const n=u.slice();return n[14]=t[e],n[15]=t,n[16]=e,n}function ce(u){let t,e=[],n=new Map,i,s,l=Q(u[3]);const o=c=>c[14].id;for(let c=0;c<l.length;c+=1){let r=fe(u,l,c),k=o(r);n.set(k,e[c]=re(k,r))}let a=null;l.length||(a=de(u));function _(c,r){return c[2]?Ue:ze}let p=_(u),h=p(u);return{c(){t=b("div");for(let c=0;c<e.length;c+=1)e[c].c();a&&a.c(),i=I(),h.c(),d(t,"class","mt-3 mb-3")},m(c,r){C(c,t,r);for(let k=0;k<e.length;k+=1)e[k]&&e[k].m(t,null);a&&a.m(t,null),f(t,i),h.m(t,null),s=!0},p(c,r){r&121&&(l=Q(c[3]),V(),e=qe(e,r,o,1,c,l,n,t,Ce,re,i,fe),W(),!l.length&&a?a.p(c,r):l.length?a&&(a.d(1),a=null):(a=de(c),a.c(),a.m(t,i))),p===(p=_(c))&&h?h.p(c,r):(h.d(1),h=p(c),h&&(h.c(),h.m(t,null)))},i(c){if(!s){for(let r=0;r<l.length;r+=1)S(e[r]);s=!0}},o(c){for(let r=0;r<e.length;r+=1)N(e[r]);s=!1},d(c){c&&q(t);for(let r=0;r<e.length;r+=1)e[r].d();a&&a.d(),h.d()}}}function de(u){let t,e;return{c(){t=b("p"),e=j(u[4])},m(n,i){C(n,t,i),f(t,e)},p(n,i){i&16&&U(e,n[4])},d(n){n&&q(t)}}}function re(u,t){let e,n,i,s,l;function o(p){t[9](p,t[14],t[15],t[16])}function a(p){t[10](p)}let _={indent:0,addMessage:t[5],updateMessage:t[6]};return t[14]!==void 0&&(_.message=t[14]),t[0]!==void 0&&(_.questionId=t[0]),n=new ke({props:_}),G.push(()=>J(n,"message",o)),G.push(()=>J(n,"questionId",a)),{key:u,first:null,c(){e=O(),ge(n.$$.fragment),this.first=e},m(p,h){C(p,e,h),he(n,p,h),l=!0},p(p,h){t=p;const c={};!i&&h&8&&(i=!0,c.message=t[14],X(()=>i=!1)),!s&&h&1&&(s=!0,c.questionId=t[0],X(()=>s=!1)),n.$set(c)},i(p){l||(S(n.$$.fragment,p),l=!0)},o(p){N(n.$$.fragment,p),l=!1},d(p){p&&q(e),be(n,p)}}}function ze(u){let t,e,n;return{c(){t=b("button"),t.innerHTML='<i class="bi bi-chat-square-dots"></i> Add comment',d(t,"class","btn btn-sm btn-outline-secondary")},m(i,s){C(i,t,s),e||(n=B(t,"click",L(u[8])),e=!0)},p:P,d(i){i&&q(t),e=!1,n()}}}function Ue(u){let t,e,n,i,s,l,o,a,_,p,h;return{c(){t=b("div"),e=b("form"),n=b("div"),n.innerHTML='<input id="message" type="hidden" name="message" value=""/> <trix-editor input="message"></trix-editor>',i=I(),s=b("div"),s.innerHTML='<input type="checkbox" class="form-check-input" id="anonymous" checked=""/> <label class="form-check-label" for="anonymous">Anonymous</label>',l=I(),o=b("input"),a=I(),_=b("button"),_.textContent="Cancel",d(n,"class","mb-3 text-break"),d(s,"class","mb-3 form-check"),d(o,"class","btn btn-sm btn-primary"),d(o,"type","submit"),o.value="Send",d(_,"class","btn btn-link mr-0"),d(e,"action","#"),d(e,"class","mt-3 mb-3"),d(t,"class","mt-3")},m(c,r){C(c,t,r),f(t,e),f(e,n),f(e,i),f(e,s),f(e,l),f(e,o),f(e,a),f(e,_),p||(h=[B(_,"click",L(u[8])),B(e,"submit",L(u[7]))],p=!0)},p:P,d(c){c&&q(t),p=!1,K(h)}}}function je(u){let t,e,n=u[1].isAnswered&&ce(u);return{c(){n&&n.c(),t=O()},m(i,s){n&&n.m(i,s),C(i,t,s),e=!0},p(i,[s]){i[1].isAnswered?n?(n.p(i,s),s&2&&S(n,1)):(n=ce(i),n.c(),S(n,1),n.m(t.parentNode,t)):n&&(V(),N(n,1,1,()=>{n=null}),W())},i(i){e||(S(n),e=!0)},o(i){N(n),e=!1},d(i){i&&q(t),n&&n.d(i)}}}function F(u){var t=structuredClone(u),e={},n=[];t.forEach(s=>{if(!s.parent_message_id&&!s.legacy_parent_message_id){n.push(s);return}var l=s.parent_message_id;if(!l){const o=t.find(a=>a.legacy_message_id===s.legacy_parent_message_id);o?l=o.id:console.error("Parent message not found for message",s)}e[l]||(e[l]=[]),e[l].push(s)}),Object.values(e).forEach(s=>{s.sort((l,o)=>o.thumbs_up_count-o.thumbs_down_count-(l.thumbs_up_count-l.thumbs_down_count))}),n.sort((s,l)=>l.thumbs_up_count-l.thumbs_down_count-(s.thumbs_up_count-s.thumbs_down_count));function i(s){var l=s.id;e[l]&&(s.childs=e[l],s.childs.forEach(o=>{i(o)}))}return n.forEach(s=>{i(s)}),n}function ye(u,t){return u.map(e=>e.id===t.id?{...t,childs:e.childs}:e.childs?{...e,childs:ye(e.childs,t)}:e)}function Oe(u,t,e){let{questionId:n}=t,{questionContext:i}=t;var s=!1,l=[],o=[],a="Loading comments ...",_;function p(){l=[],e(4,a="Loading comments ..."),_&&_.cancel();const m=n;_=Ee(()=>{axios.get("/api/questions/"+n+"/messages").then(function(g){if(m===n){if(l=g.data,l.length===0){e(3,o=[]),e(4,a="No comments yet");return}e(3,o=F(l))}}).catch(function(g){alert(g)})},1e3,{maxWait:2e3}),_()}function h(m){l.push(m),e(3,o=F(l))}function c(m){const g=l.findIndex(M=>M.id===m.id);l[g]=m,e(3,o=ye(o,m))}function r(){var m={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.post("/api/questions/"+n+"/messages",m).then(function(g){k(),l.push(g.data),e(3,o=F(l))}).catch(function(g){alert(g)})}function k(){e(2,s=!s)}function H(m,g,M,T){M[T]=m,e(3,o),e(0,n)}function E(m){n=m,e(0,n)}return u.$$set=m=>{"questionId"in m&&e(0,n=m.questionId),"questionContext"in m&&e(1,i=m.questionContext)},u.$$.update=()=>{u.$$.dirty&1&&(e(3,o=[]),e(2,s=!1),p())},[n,i,s,o,a,h,c,r,k,H,E]}class Fe extends me{constructor(t){super(),_e(this,t,Oe,je,pe,{questionId:0,questionContext:1})}}export{Fe as M};
