import{S as _t,i as bt,s as ze,n as Se,d as T,v as Oe,g as l,h as ie,j as X,a as O,c,l as Y,f as r,t as he,b as y,H as He,E as gt,k as ke,w as wt,x as vt,z as Ot,A as Kt,p as _e,e as yt,F as Mt,O as Qt,N as Ye,D as Ie,r as St,u as It,y as Dt,B as jt,C as Bt,I as De,J as kt,K as Xe,q as Et,m as Rt}from"./index-CTA786D7.js";import{e as ye,u as Ze,d as Pt,o as Nt}from"./each-KlFnVOXz.js";import{_ as xe}from"./lodash-DBMh2b1a.js";import{d as Ct,p as je}from"./purify.es-CzHI0FGf.js";const Re=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Pe(e,t,n,s){e.addEventListener?e.addEventListener(t,n,s):e.attachEvent&&e.attachEvent("on".concat(t),n)}function Ae(e,t,n,s){e.removeEventListener?e.removeEventListener(t,n,s):e.detachEvent&&e.detachEvent("on".concat(t),n)}function At(e,t){const n=t.slice(0,t.length-1);for(let s=0;s<n.length;s++)n[s]=e[n[s].toLowerCase()];return n}function Ht(e){typeof e!="string"&&(e=""),e=e.replace(/\s/g,"");const t=e.split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function zt(e,t){const n=e.length>=t.length?e:t,s=e.length>=t.length?t:e;let i=!0;for(let o=0;o<n.length;o++)s.indexOf(n[o])===-1&&(i=!1);return i}const Le={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":Re?173:189,"=":Re?61:187,";":Re?59:186,"'":222,"[":219,"]":221,"\\":220},re={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},Qe={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},x={16:!1,18:!1,17:!1,91:!1},U={};for(let e=1;e<20;e++)Le["f".concat(e)]=111+e;let z=[],qe=null,qt="all";const me=new Map,Ke=e=>Le[e.toLowerCase()]||re[e.toLowerCase()]||e.toUpperCase().charCodeAt(0),Ft=e=>Object.keys(Le).find(t=>Le[t]===e),Gt=e=>Object.keys(re).find(t=>re[t]===e);function Lt(e){qt=e||"all"}function Te(){return qt||"all"}function Ut(){return z.slice(0)}function Wt(){return z.map(e=>Ft(e)||Gt(e)||String.fromCharCode(e))}function Jt(){const e=[];return Object.keys(U).forEach(t=>{U[t].forEach(n=>{let{key:s,scope:i,mods:o,shortcut:u}=n;e.push({scope:i,shortcut:u,mods:o,keys:s.split("+").map(a=>Ke(a))})})}),e}function Vt(e){const t=e.target||e.srcElement,{tagName:n}=t;let s=!0;const i=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(i||n==="TEXTAREA"||n==="SELECT")&&!t.readOnly)&&(s=!1),s}function Yt(e){return typeof e=="string"&&(e=Ke(e)),z.indexOf(e)!==-1}function Xt(e,t){let n,s;e||(e=Te());for(const i in U)if(Object.prototype.hasOwnProperty.call(U,i))for(n=U[i],s=0;s<n.length;)n[s].scope===e?n.splice(s,1).forEach(u=>{let{element:a}=u;return Fe(a)}):s++;Te()===e&&Lt(t||"all")}function Zt(e){let t=e.keyCode||e.which||e.charCode;const n=z.indexOf(t);if(n>=0&&z.splice(n,1),e.key&&e.key.toLowerCase()==="meta"&&z.splice(0,z.length),(t===93||t===224)&&(t=91),t in x){x[t]=!1;for(const s in re)re[s]===t&&(ce[s]=!1)}}function Tt(e){if(typeof e>"u")Object.keys(U).forEach(i=>{Array.isArray(U[i])&&U[i].forEach(o=>Me(o)),delete U[i]}),Fe(null);else if(Array.isArray(e))e.forEach(i=>{i.key&&Me(i)});else if(typeof e=="object")e.key&&Me(e);else if(typeof e=="string"){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];let[i,o]=n;typeof i=="function"&&(o=i,i=""),Me({key:e,scope:i,method:o,splitKey:"+"})}}const Me=e=>{let{key:t,scope:n,method:s,splitKey:i="+"}=e;Ht(t).forEach(u=>{const a=u.split(i),p=a.length,k=a[p-1],g=k==="*"?"*":Ke(k);if(!U[g])return;n||(n=Te());const m=p>1?At(re,a):[],_=[];U[g]=U[g].filter(v=>{const b=(s?v.method===s:!0)&&v.scope===n&&zt(v.mods,m);return b&&_.push(v.element),!b}),_.forEach(v=>Fe(v))})};function $e(e,t,n,s){if(t.element!==s)return;let i;if(t.scope===n||t.scope==="all"){i=t.mods.length>0;for(const o in x)Object.prototype.hasOwnProperty.call(x,o)&&(!x[o]&&t.mods.indexOf(+o)>-1||x[o]&&t.mods.indexOf(+o)===-1)&&(i=!1);(t.mods.length===0&&!x[16]&&!x[18]&&!x[17]&&!x[91]||i||t.shortcut==="*")&&(t.keys=[],t.keys=t.keys.concat(z),t.method(e,t)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function et(e,t){const n=U["*"];let s=e.keyCode||e.which||e.charCode;if(!ce.filter.call(this,e))return;if((s===93||s===224)&&(s=91),z.indexOf(s)===-1&&s!==229&&z.push(s),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const p=Qe[a];e[a]&&z.indexOf(p)===-1?z.push(p):!e[a]&&z.indexOf(p)>-1?z.splice(z.indexOf(p),1):a==="metaKey"&&e[a]&&(z=z.filter(k=>k in Qe||k===s))}),s in x){x[s]=!0;for(const a in re)re[a]===s&&(ce[a]=!0);if(!n)return}for(const a in x)Object.prototype.hasOwnProperty.call(x,a)&&(x[a]=e[Qe[a]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(z.indexOf(17)===-1&&z.push(17),z.indexOf(18)===-1&&z.push(18),x[17]=!0,x[18]=!0);const i=Te();if(n)for(let a=0;a<n.length;a++)n[a].scope===i&&(e.type==="keydown"&&n[a].keydown||e.type==="keyup"&&n[a].keyup)&&$e(e,n[a],i,t);if(!(s in U))return;const o=U[s],u=o.length;for(let a=0;a<u;a++)if((e.type==="keydown"&&o[a].keydown||e.type==="keyup"&&o[a].keyup)&&o[a].key){const p=o[a],{splitKey:k}=p,g=p.key.split(k),m=[];for(let _=0;_<g.length;_++)m.push(Ke(g[_]));m.sort().join("")===z.sort().join("")&&$e(e,p,i,t)}}function ce(e,t,n){z=[];const s=Ht(e);let i=[],o="all",u=document,a=0,p=!1,k=!0,g="+",m=!1,_=!1;for(n===void 0&&typeof t=="function"&&(n=t),Object.prototype.toString.call(t)==="[object Object]"&&(t.scope&&(o=t.scope),t.element&&(u=t.element),t.keyup&&(p=t.keyup),t.keydown!==void 0&&(k=t.keydown),t.capture!==void 0&&(m=t.capture),typeof t.splitKey=="string"&&(g=t.splitKey),t.single===!0&&(_=!0)),typeof t=="string"&&(o=t),_&&Tt(e,o);a<s.length;a++)e=s[a].split(g),i=[],e.length>1&&(i=At(re,e)),e=e[e.length-1],e=e==="*"?"*":Ke(e),e in U||(U[e]=[]),U[e].push({keyup:p,keydown:k,scope:o,mods:i,shortcut:s[a],method:n,key:s[a],splitKey:g,element:u});if(typeof u<"u"&&window){if(!me.has(u)){const v=function(){let b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return et(b,u)},d=function(){let b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;et(b,u),Zt(b)};me.set(u,{keydownListener:v,keyupListenr:d,capture:m}),Pe(u,"keydown",v,m),Pe(u,"keyup",d,m)}if(!qe){const v=()=>{z=[]};qe={listener:v,capture:m},Pe(window,"focus",v,m)}}}function xt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(U).forEach(n=>{U[n].filter(i=>i.scope===t&&i.shortcut===e).forEach(i=>{i&&i.method&&i.method()})})}function Fe(e){const t=Object.values(U).flat();if(t.findIndex(s=>{let{element:i}=s;return i===e})<0){const{keydownListener:s,keyupListenr:i,capture:o}=me.get(e)||{};s&&i&&(Ae(e,"keyup",i,o),Ae(e,"keydown",s,o),me.delete(e))}if((t.length<=0||me.size<=0)&&(Object.keys(me).forEach(i=>{const{keydownListener:o,keyupListenr:u,capture:a}=me.get(i)||{};o&&u&&(Ae(i,"keyup",u,a),Ae(i,"keydown",o,a),me.delete(i))}),me.clear(),Object.keys(U).forEach(i=>delete U[i]),qe)){const{listener:i,capture:o}=qe;Ae(window,"focus",i,o),qe=null}}const Ne={getPressedKeyString:Wt,setScope:Lt,getScope:Te,deleteScope:Xt,getPressedKeyCodes:Ut,getAllKeyCodes:Jt,isPressed:Yt,filter:Vt,trigger:xt,unbind:Tt,keyMap:Le,modifier:re,modifierMap:Qe};for(const e in Ne)Object.prototype.hasOwnProperty.call(Ne,e)&&(ce[e]=Ne[e]);if(typeof window<"u"){const e=window.hotkeys;ce.noConflict=t=>(t&&window.hotkeys===ce&&(window.hotkeys=e),ce),window.hotkeys=ce}function $t(e){let t,n,s,i,o,u,a,p,k,g,m,_,v,d,b,q,I,H,B,R,P,W,F,ee,M,A,E,C,te,ne,G,se,Q,J,h,w,S,de,Z,le,ue,ae,be,fe;return{c(){t=r("form"),n=r("div"),s=r("label"),i=he("Answer text"),u=y(),a=r("input"),k=y(),g=r("trix-editor"),v=y(),d=new He(!1),b=y(),q=r("div"),I=r("div"),H=r("h2"),B=r("button"),R=he("Answer hint (optional)"),ee=y(),M=r("div"),A=r("div"),E=r("div"),C=r("input"),ne=y(),G=r("trix-editor"),J=y(),h=new He(!1),w=y(),S=r("div"),de=he("A hint that will be shown once the user has answered the question."),l(s,"for",o="answerText"+e[0].id),l(s,"class","form-label"),l(a,"id",p="answerText"+e[0].id),l(a,"type","hidden"),X(g,"id",m="editor-answer"+e[0].id),X(g,"class","bg-light trix-content"),X(g,"input",_="answerText"+e[0].id),d.a=null,l(n,"class","mb-3"),l(B,"class",P="accordion-button text-black bg-white py-2 px-3 "+(e[3]?"":"collapsed")),l(B,"type","button"),l(B,"data-bs-toggle","collapse"),l(B,"data-bs-target",W="#collapseAnswerHint"+e[0].id),l(B,"aria-expanded","false"),l(B,"aria-controls",F="#collapseAnswerHint"+e[0].id),l(H,"class","accordion-header"),l(C,"id",te="answerHint"+e[0].id),l(C,"type","hidden"),X(G,"id",se="editor-answerHint"+e[0].id),X(G,"class","bg-light trix-content"),X(G,"input",Q="answerHint"+e[0].id),h.a=w,l(S,"id",Z="answerHint"+e[0].id),l(S,"class","form-text"),l(E,"class","mb-3"),l(A,"class","accordion-body"),l(M,"id",le="collapseAnswerHint"+e[0].id),l(M,"class",ue="accordion-collapse collapse "+(e[3]?"show":"")),l(I,"class","accordion-item"),l(q,"class","accordion my-2 "),l(q,"id",ae="accordionAnswerHint"+e[0].id),l(t,"action","#")},m(D,j){O(D,t,j),c(t,n),c(n,s),c(s,i),c(n,u),c(n,a),ie(a,e[0].text),c(n,k),c(n,g),e[6](g),c(n,v),d.m(e[4],n),c(t,b),c(t,q),c(q,I),c(I,H),c(H,B),c(B,R),c(I,ee),c(I,M),c(M,A),c(A,E),c(E,C),ie(C,e[0].hint),c(E,ne),c(E,G),e[8](G),c(E,J),h.m(e[4],E),c(E,w),c(E,S),c(S,de),be||(fe=[Y(a,"input",e[5]),Y(C,"input",e[7])],be=!0)},p(D,[j]){j&1&&o!==(o="answerText"+D[0].id)&&l(s,"for",o),j&1&&p!==(p="answerText"+D[0].id)&&l(a,"id",p),j&1&&ie(a,D[0].text),j&1&&m!==(m="editor-answer"+D[0].id)&&X(g,"id",m),j&1&&_!==(_="answerText"+D[0].id)&&X(g,"input",_),j&16&&d.p(D[4]),j&8&&P!==(P="accordion-button text-black bg-white py-2 px-3 "+(D[3]?"":"collapsed"))&&l(B,"class",P),j&1&&W!==(W="#collapseAnswerHint"+D[0].id)&&l(B,"data-bs-target",W),j&1&&F!==(F="#collapseAnswerHint"+D[0].id)&&l(B,"aria-controls",F),j&1&&te!==(te="answerHint"+D[0].id)&&l(C,"id",te),j&1&&ie(C,D[0].hint),j&1&&se!==(se="editor-answerHint"+D[0].id)&&X(G,"id",se),j&1&&Q!==(Q="answerHint"+D[0].id)&&X(G,"input",Q),j&16&&h.p(D[4]),j&1&&Z!==(Z="answerHint"+D[0].id)&&l(S,"id",Z),j&1&&le!==(le="collapseAnswerHint"+D[0].id)&&l(M,"id",le),j&8&&ue!==(ue="accordion-collapse collapse "+(D[3]?"show":""))&&l(M,"class",ue),j&1&&ae!==(ae="accordionAnswerHint"+D[0].id)&&l(q,"id",ae)},i:Se,o:Se,d(D){D&&T(t),e[6](null),e[8](null),be=!1,Oe(fe)}}}function ei(e,t,n){let{answer:s}=t,i,o,u,a="";gt(()=>{const b=document.getElementById("collapseAnswerHint"+s.id);b&&b.addEventListener("shown.bs.collapse",()=>{o&&o.focus()}),n(3,u=!!s.hint)});function p(b){b.addEventListener("trix-change",function(){n(0,s.text=document.getElementById("answerText"+s.id).value,s),n(0,s.hint=document.getElementById("answerHint"+s.id).value,s),n(4,a='<p class="text-end">Saving ...</p>'),g()})}var k;function g(){k&&k.cancel(),k=Ct(()=>{axios.put("/api/answers/"+s.id,s).then(function(b){n(4,a='<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(b){n(4,a='<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(b)})},500,{maxWait:2e3}),k()}function m(){s.text=this.value,n(0,s)}function _(b){ke[b?"unshift":"push"](()=>{i=b,n(1,i)})}function v(){s.hint=this.value,n(0,s)}function d(b){ke[b?"unshift":"push"](()=>{o=b,n(2,o)})}return e.$$set=b=>{"answer"in b&&n(0,s=b.answer)},e.$$.update=()=>{e.$$.dirty&2&&i&&p(i),e.$$.dirty&4&&o&&p(o)},[s,i,o,u,a,m,_,v,d]}class ti extends _t{constructor(t){super(),bt(this,t,ei,$t,ze,{answer:0})}}function tt(e,t,n){const s=e.slice();return s[46]=t[n],s[47]=t,s[48]=n,s}function it(e,t,n){const s=e.slice();return s[49]=t[n],s}function nt(e,t,n){const s=e.slice();return s[52]=t[n],s}function st(e){let t,n,s;return{c(){t=r("button"),t.textContent="Close editor",l(t,"type","button"),l(t,"class","btn btn-outline-secondary btn-sm")},m(i,o){O(i,t,o),n||(s=Y(t,"click",_e(function(){Qt(e[2])&&e[2].apply(this,arguments)})),n=!0)},p(i,o){e=i},d(i){i&&T(t),n=!1,s()}}}function ii(e){let t,n,s,i,o,u,a,p,k,g=ye(e[1]),m=[];for(let _=0;_<g.length;_+=1)m[_]=lt(nt(e,g,_));return{c(){t=r("div"),n=r("div"),s=r("div"),s.innerHTML='<label for="case" class="col-form-label small fw-bold"><i class="bi bi-clipboard2-pulse"></i> CASE</label>',i=y(),o=r("div"),u=r("select"),a=r("option"),a.textContent="Select case";for(let _=0;_<m.length;_+=1)m[_].c();l(s,"class","col-auto"),a.__value="",ie(a,a.__value),l(u,"id","case"),l(u,"class","form-select"),e[9]===void 0&&kt(()=>e[27].call(u)),l(o,"class","col-auto"),l(n,"class","row g-3 align-items-center"),l(t,"class","alert alert-light"),l(t,"role","alert")},m(_,v){O(_,t,v),c(t,n),c(n,s),c(n,i),c(n,o),c(o,u),c(u,a);for(let d=0;d<m.length;d+=1)m[d]&&m[d].m(u,null);De(u,e[9],!0),p||(k=[Y(u,"change",e[27]),Y(u,"change",e[21])],p=!0)},p(_,v){if(v[0]&3){g=ye(_[1]);let d;for(d=0;d<g.length;d+=1){const b=nt(_,g,d);m[d]?m[d].p(b,v):(m[d]=lt(b),m[d].c(),m[d].m(u,null))}for(;d<m.length;d+=1)m[d].d(1);m.length=g.length}v[0]&514&&De(u,_[9])},d(_){_&&T(t),Rt(m,_),p=!1,Oe(k)}}}function ni(e){let t,n,s,i,o=je.sanitize(e[1].find(e[26]).text)+"",u,a,p,k,g;return{c(){t=r("div"),n=r("p"),n.innerHTML='<i class="bi bi-clipboard2-pulse"></i> CASE',s=y(),i=r("p"),u=y(),a=r("div"),p=r("button"),p.innerHTML='<i class="bi bi-trash"></i> Remove case',l(n,"class","small fw-bold"),l(i,"class","trix-content"),l(t,"class","alert alert-secondary m-1"),l(t,"role","alert"),l(p,"type","button"),l(p,"class","btn btn-sm btn-light"),l(p,"title","Remove case"),l(a,"class","text-end m-1")},m(m,_){O(m,t,_),c(t,n),c(t,s),c(t,i),i.innerHTML=o,O(m,u,_),O(m,a,_),c(a,p),k||(g=Y(p,"click",_e(e[22])),k=!0)},p(m,_){_[0]&3&&o!==(o=je.sanitize(m[1].find(m[26]).text)+"")&&(i.innerHTML=o)},d(m){m&&(T(t),T(u),T(a)),k=!1,g()}}}function lt(e){let t,n=xe.truncate(je.sanitize(e[52].text,{ALLOWED_TAGS:[]}),{length:30})+"",s,i,o;return{c(){t=r("option"),s=he(n),t.__value=i=e[52].id,ie(t,t.__value),t.selected=o=e[0].case_id==e[52].id},m(u,a){O(u,t,a),c(t,s)},p(u,a){a[0]&2&&n!==(n=xe.truncate(je.sanitize(u[52].text,{ALLOWED_TAGS:[]}),{length:30})+"")&&Et(s,n),a[0]&2&&i!==(i=u[52].id)&&(t.__value=i,ie(t,t.__value)),a[0]&3&&o!==(o=u[0].case_id==u[52].id)&&(t.selected=o)},d(u){u&&T(t)}}}function ot(e){let t,n,s,i,o,u,a,p,k,g,m,_,v,d,b,q,I,H,B,R,P,W,F,ee,M,A,E,C,te,ne,G,se,Q,J,h,w,S,de,Z,le,ue,ae,be,fe,D,j,ge,f,L,V,$,Ge,Ee,Ue,we,pe,We,Ce,Be,Je;function Ve(K,N){if(K[5]&&K[0].case_id)return ni;if(K[5]&&K[1]&&K[1].length>0)return ii}let ve=Ve(e),oe=ve&&ve(e);return{c(){oe&&oe.c(),t=y(),n=r("div"),s=r("label"),s.textContent="Question text",i=y(),o=r("input"),u=y(),a=r("trix-editor"),p=y(),k=new He(!1),g=y(),m=r("div"),_=r("div"),v=r("h2"),d=r("button"),b=he("Question hint (optional)"),I=y(),H=r("div"),B=r("div"),R=r("div"),P=r("input"),W=y(),F=r("trix-editor"),ee=y(),M=new He(!1),A=y(),E=r("div"),E.textContent="A hint that can be shown to the user if they are stuck.",te=y(),ne=r("div"),G=r("div"),se=r("h2"),Q=r("button"),J=he("Question comment (optional)"),w=y(),S=r("div"),de=r("div"),Z=r("div"),le=r("input"),ue=y(),ae=r("trix-editor"),be=y(),fe=new He(!1),D=y(),j=r("div"),j.textContent=`A comment that will be shown once the user has answered the question.
                                It can be used to explain the correct answer or provide additional
                                information, for example sources.`,f=y(),L=r("div"),V=r("div"),$=r("input"),Ge=y(),Ee=r("label"),Ee.innerHTML='<i class="bi bi-cone-striped"></i> <strong>Invalid question</strong> - Is the answer unknown or disputed? Invalid questions remain in deck but are not counted into results.',Ue=y(),we=r("div"),pe=r("input"),We=y(),Ce=r("label"),Ce.innerHTML='<i class="bi bi-eraser-fill"></i> <strong>Needs review</strong> - Does this question need to be reviewed and improved? Questions marked for review remain in deck and are counted into results.',l(s,"for","questionText"),l(s,"class","form-label"),l(o,"id","questionText"),l(o,"type","hidden"),X(a,"id","editor-questionText"),X(a,"class","bg-light trix-content"),X(a,"input","questionText"),k.a=null,l(n,"class","mt-3 mb-2"),l(d,"class",q="accordion-button text-black bg-white py-2 px-3 "+(e[10]?"":"collapsed")),l(d,"type","button"),l(d,"data-bs-toggle","collapse"),l(d,"data-bs-target","#collapseQuestionHint"),l(d,"aria-expanded","false"),l(d,"aria-controls","collapseQuestionHint"),l(v,"class","accordion-header"),l(P,"id","questionHint"),l(P,"type","hidden"),X(F,"id","editor-questionHint"),X(F,"class","bg-light trix-content"),X(F,"input","questionHint"),M.a=A,l(E,"id","questionHint"),l(E,"class","form-text"),l(R,"class","mt-3 mb-3"),l(B,"class","accordion-body"),l(H,"id","collapseQuestionHint"),l(H,"class",C="accordion-collapse collapse "+(e[10]?"show":"")),l(_,"class","accordion-item"),l(m,"class","accordion my-2 "),l(m,"id","accordionQuestionHint"),l(Q,"class",h="accordion-button text-black bg-white py-2 px-3 "+(e[11]?"":"collapsed")),l(Q,"type","button"),l(Q,"data-bs-toggle","collapse"),l(Q,"data-bs-target","#collapseQuestionComment"),l(Q,"aria-expanded","false"),l(Q,"aria-controls","collapseQuestionComment"),l(se,"class","accordion-header"),l(le,"id","questionComment"),l(le,"type","hidden"),X(ae,"id","editor-questionComment"),X(ae,"class","bg-light trix-content"),X(ae,"input","questionComment"),fe.a=D,l(j,"id","questionHint"),l(j,"class","form-text"),l(Z,"class","mt-3 mb-3"),l(de,"class","accordion-body"),l(S,"id","collapseQuestionComment"),l(S,"class",ge="accordion-collapse collapse "+(e[11]?"show":"")),l(G,"class","accordion-item"),l(ne,"class","accordion my-2"),l(ne,"id","accordionQuestionComment"),l($,"type","checkbox"),l($,"class","form-check-input"),l($,"id","checkInvalidQuestion"),l(Ee,"class","form-check-label"),l(Ee,"for","checkInvalidQuestion"),l(V,"class","form-check mb-3"),l(pe,"type","checkbox"),l(pe,"class","form-check-input"),l(pe,"id","checkNeedsReview"),l(Ce,"class","form-check-label"),l(Ce,"for","checkNeedsReview"),l(we,"class","form-check"),l(L,"class","mb-3 p-3 bg-light rounded")},m(K,N){oe&&oe.m(K,N),O(K,t,N),O(K,n,N),c(n,s),c(n,i),c(n,o),ie(o,e[0].text),c(n,u),c(n,a),e[29](a),c(n,p),k.m(e[12],n),O(K,g,N),O(K,m,N),c(m,_),c(_,v),c(v,d),c(d,b),c(_,I),c(_,H),c(H,B),c(B,R),c(R,P),ie(P,e[0].hint),c(R,W),c(R,F),e[31](F),c(R,ee),M.m(e[12],R),c(R,A),c(R,E),O(K,te,N),O(K,ne,N),c(ne,G),c(G,se),c(se,Q),c(Q,J),c(G,w),c(G,S),c(S,de),c(de,Z),c(Z,le),ie(le,e[0].comment),c(Z,ue),c(Z,ae),e[33](ae),c(Z,be),fe.m(e[12],Z),c(Z,D),c(Z,j),O(K,f,N),O(K,L,N),c(L,V),c(V,$),$.checked=e[0].is_invalid,c(V,Ge),c(V,Ee),c(L,Ue),c(L,we),c(we,pe),pe.checked=e[0].needs_review,c(we,We),c(we,Ce),Be||(Je=[Y(o,"input",e[28]),Y(P,"input",e[30]),Y(le,"input",e[32]),Y($,"change",e[34]),Y($,"click",_e(e[23])),Y(pe,"change",e[35]),Y(pe,"click",_e(e[24]))],Be=!0)},p(K,N){ve===(ve=Ve(K))&&oe?oe.p(K,N):(oe&&oe.d(1),oe=ve&&ve(K),oe&&(oe.c(),oe.m(t.parentNode,t))),N[0]&1&&ie(o,K[0].text),N[0]&4096&&k.p(K[12]),N[0]&1024&&q!==(q="accordion-button text-black bg-white py-2 px-3 "+(K[10]?"":"collapsed"))&&l(d,"class",q),N[0]&1&&ie(P,K[0].hint),N[0]&4096&&M.p(K[12]),N[0]&1024&&C!==(C="accordion-collapse collapse "+(K[10]?"show":""))&&l(H,"class",C),N[0]&2048&&h!==(h="accordion-button text-black bg-white py-2 px-3 "+(K[11]?"":"collapsed"))&&l(Q,"class",h),N[0]&1&&ie(le,K[0].comment),N[0]&4096&&fe.p(K[12]),N[0]&2048&&ge!==(ge="accordion-collapse collapse "+(K[11]?"show":""))&&l(S,"class",ge),N[0]&1&&($.checked=K[0].is_invalid),N[0]&1&&(pe.checked=K[0].needs_review)},d(K){K&&(T(t),T(n),T(g),T(m),T(te),T(ne),T(f),T(L)),oe&&oe.d(K),e[29](null),e[31](null),e[33](null),Be=!1,Oe(Je)}}}function at(e){let t;return{c(){t=r("div"),t.innerHTML='<div class="alert alert-warning" role="alert">Don&#39;t forget to set the correct answer!</div>',l(t,"class","col")},m(n,s){O(n,t,s)},d(n){n&&T(t)}}}function ct(e){let t,n,s=e[49].comment+"",i;return{c(){t=r("div"),n=r("p"),i=he(s),l(n,"class","card-text"),l(t,"class","card-body")},m(o,u){O(o,t,u),c(t,n),c(n,i)},p(o,u){u[0]&1&&s!==(s=o[49].comment+"")&&Et(i,s)},d(o){o&&T(t)}}}function rt(e,t){let n,s,i,o,u,a,p,k,g,m,_;function v(){return t[36](t[49])}let d=t[49].comment&&ct(t);return{key:e,first:null,c(){n=r("div"),s=r("div"),i=r("div"),o=r("button"),o.innerHTML='<i class="bi bi-trash"></i>',u=y(),a=r("img"),k=y(),d&&d.c(),g=y(),l(o,"type","button"),l(o,"class","btn btn-sm btn-light"),l(i,"class","card-header bg-transparent"),Ye(a.src,p="/"+t[49].path)||l(a,"src",p),l(a,"class","card-img-top"),l(a,"alt",""),l(s,"class","card"),Ie(s,"width","18rem"),l(n,"class","col"),this.first=n},m(b,q){O(b,n,q),c(n,s),c(s,i),c(i,o),c(s,u),c(s,a),c(s,k),d&&d.m(s,null),c(n,g),m||(_=Y(o,"click",_e(v)),m=!0)},p(b,q){t=b,q[0]&1&&!Ye(a.src,p="/"+t[49].path)&&l(a,"src",p),t[49].comment?d?d.p(t,q):(d=ct(t),d.c(),d.m(s,null)):d&&(d.d(1),d=null)},d(b){b&&T(n),d&&d.d(),m=!1,_()}}}function dt(e){let t,n,s,i,o;function u(){return e[38](e[46])}return{c(){t=r("button"),n=r("i"),l(n,"class","bi bi-check-lg"),l(t,"type","button"),l(t,"class",s="btn btn-sm "+(e[13]===e[46].id?"btn-success":"btn-light")),l(t,"title","Set as correct answer")},m(a,p){O(a,t,p),c(t,n),i||(o=Y(t,"click",_e(u)),i=!0)},p(a,p){e=a,p[0]&8193&&s!==(s="btn btn-sm "+(e[13]===e[46].id?"btn-success":"btn-light"))&&l(t,"class",s)},d(a){a&&T(t),i=!1,o()}}}function ut(e,t){let n,s,i,o,u,a,p,k,g,m;function _(q){t[37](q,t[46],t[47],t[48])}let v={};t[46]!==void 0&&(v.answer=t[46]),s=new ti({props:v}),ke.push(()=>St(s,"answer",_));let d=t[0].type==="mc"&&dt(t);function b(){return t[39](t[46])}return{key:e,first:null,c(){n=r("div"),Bt(s.$$.fragment),o=y(),u=r("div"),d&&d.c(),a=y(),p=r("button"),p.innerHTML='<i class="bi bi-trash"></i>',l(p,"type","button"),l(p,"class","btn btn-sm btn-light"),l(p,"title","Delete answer"),l(u,"class","text-end mb-2"),l(n,"class","mt-3 mb-1 px-3 pt-2 pb-1 bg-light-subtle rounded"),Ie(n,"border","2px dotted "+(t[13]===t[46].id?"green":"lightgray")),this.first=n},m(q,I){O(q,n,I),jt(s,n,null),c(n,o),c(n,u),d&&d.m(u,null),c(u,a),c(u,p),k=!0,g||(m=Y(p,"click",_e(b)),g=!0)},p(q,I){t=q;const H={};!i&&I[0]&1&&(i=!0,H.answer=t[46],Dt(()=>i=!1)),s.$set(H),t[0].type==="mc"?d?d.p(t,I):(d=dt(t),d.c(),d.m(u,a)):d&&(d.d(1),d=null),I[0]&8193&&Ie(n,"border","2px dotted "+(t[13]===t[46].id?"green":"lightgray"))},i(q){k||(vt(s.$$.fragment,q),k=!0)},o(q){wt(s.$$.fragment,q),k=!1},d(q){q&&T(n),It(s),d&&d.d(),g=!1,m()}}}function ft(e){let t,n,s,i,o,u;return{c(){t=r("div"),n=r("div"),s=r("div"),i=r("button"),i.textContent="Add answer",l(i,"class","btn btn-sm btn-primary"),l(i,"title","Add a new answer (Shortcut: Alt+A)"),l(s,"class","col"),l(n,"class","row py-3"),l(t,"class","sticky-bottom bg-white mt-3"),Ie(t,"z-index","10")},m(a,p){O(a,t,p),c(t,n),c(n,s),c(s,i),o||(u=Y(i,"click",e[18]),o=!0)},p:Se,d(a){a&&T(t),o=!1,u()}}}function pt(e){let t,n,s,i,o,u,a,p,k,g,m,_,v,d,b,q,I,H,B,R,P,W,F,ee,M=(e[0].answers.length<=1||e[0].type==="card")&&mt(e),A=e[3]&&ht(e);return{c(){t=r("div"),t.innerHTML='<div class="col"><div class="mb-3 border-dark" style="border-bottom: dotted; border-width: 1px;"></div></div>',n=y(),s=r("div"),i=r("div"),o=r("span"),o.textContent="ID",u=y(),a=r("input"),k=y(),g=r("div"),m=r("div"),m.innerHTML='<label for="questionType" class="col-form-label fw-bold">Question type:</label>',_=y(),v=r("div"),d=r("select"),M&&M.c(),b=r("option"),q=he("mc"),B=y(),R=r("div"),R.innerHTML=`<span id="questionTypeHelp" class="form-text">Can be either multiple choice (MC) or card (CARD). <strong>Card Questions
                    can have only one or no answer.</strong></span>`,P=y(),A&&A.c(),W=yt(),l(t,"class","row"),l(o,"class","input-group-text"),l(a,"type","text"),l(a,"class","form-control"),a.value=p=e[0].id,a.disabled=!0,a.readOnly=!0,l(i,"class","input-group mb-3"),l(m,"class","col-auto"),b.__value="mc",ie(b,b.__value),b.selected=I=e[0].type=="mc",l(d,"id","questionType"),l(d,"class","form-select font-monospace text-uppercase"),d.disabled=H=e[0].answers.length>1,e[0].type===void 0&&kt(()=>e[40].call(d)),l(v,"class","col-auto"),l(R,"class","col-auto"),l(g,"class","row g-3 align-items-center"),l(s,"class","alert alert-light"),l(s,"role","alert")},m(E,C){O(E,t,C),O(E,n,C),O(E,s,C),c(s,i),c(i,o),c(i,u),c(i,a),c(s,k),c(s,g),c(g,m),c(g,_),c(g,v),c(v,d),M&&M.m(d,null),c(d,b),c(b,q),De(d,e[0].type,!0),c(g,B),c(g,R),O(E,P,C),A&&A.m(E,C),O(E,W,C),F||(ee=[Y(d,"change",e[40]),Y(d,"change",e[20])],F=!0)},p(E,C){C[0]&1&&p!==(p=E[0].id)&&a.value!==p&&(a.value=p),E[0].answers.length<=1||E[0].type==="card"?M?M.p(E,C):(M=mt(E),M.c(),M.m(d,b)):M&&(M.d(1),M=null),C[0]&1&&I!==(I=E[0].type=="mc")&&(b.selected=I),C[0]&1&&H!==(H=E[0].answers.length>1)&&(d.disabled=H),C[0]&1&&De(d,E[0].type),E[3]?A?A.p(E,C):(A=ht(E),A.c(),A.m(W.parentNode,W)):A&&(A.d(1),A=null)},d(E){E&&(T(t),T(n),T(s),T(P),T(W)),M&&M.d(),A&&A.d(E),F=!1,Oe(ee)}}}function mt(e){let t,n,s;return{c(){t=r("option"),n=he("card"),t.__value="card",ie(t,t.__value),t.selected=s=e[0].type=="card"},m(i,o){O(i,t,o),c(t,n)},p(i,o){o[0]&1&&s!==(s=i[0].type=="card")&&(t.selected=s)},d(i){i&&T(t)}}}function ht(e){let t,n,s,i,o,u;return{c(){t=r("div"),n=r("p"),n.innerHTML="<strong>Delete question?</strong> Deleting a question will also delete all associated answers and images.",s=y(),i=r("button"),i.innerHTML='<i class="bi bi-trash"></i> Delete question',l(i,"type","button"),l(i,"class","btn btn-sm btn-danger"),l(t,"class","alert alert-light"),l(t,"role","alert")},m(a,p){O(a,t,p),c(t,n),c(t,s),c(t,i),o||(u=Y(i,"click",_e(e[41])),o=!0)},p:Se,d(a){a&&T(t),o=!1,u()}}}function si(e){let t,n,s=e[0].id,i,o,u,a,p,k,g,m,_,v,d,b=[],q=new Map,I,H=[],B=new Map,R,P,W,F,ee,M,A=e[2]&&st(e),E=ot(e),C=!e[13]&&e[0].type==="mc"&&at(),te=ye(e[0].images);const ne=h=>h[49].id;for(let h=0;h<te.length;h+=1){let w=it(e,te,h),S=ne(w);q.set(S,b[h]=rt(S,w))}let G=ye(e[0].answers);const se=h=>h[46].id;for(let h=0;h<G.length;h+=1){let w=tt(e,G,h),S=se(w);B.set(S,H[h]=ut(S,w))}let Q=(e[0].type==="mc"||e[0].answers.length===0)&&ft(e),J=e[4]&&pt(e);return{c(){t=r("form"),A&&A.c(),n=y(),E.c(),i=y(),o=r("div"),u=r("label"),u.textContent="Add image",a=y(),p=r("input"),g=y(),m=r("div"),m.textContent="Supported formats are JPEG, PNG, and WebP.",_=y(),C&&C.c(),v=y(),d=r("div");for(let h=0;h<b.length;h+=1)b[h].c();I=y();for(let h=0;h<H.length;h+=1)H[h].c();R=y(),Q&&Q.c(),P=y(),J&&J.c(),W=yt(),l(u,"for","image"),l(u,"class","form-label"),l(p,"class","form-control"),l(p,"type","file"),l(p,"accept","image/jpeg, image/png, image/webp"),l(p,"id",k="imageInput"+e[0].id),l(p,"name","image"),l(m,"id","imageHelp"),l(m,"class","form-text"),l(o,"class","mb-3"),l(t,"action","#"),l(t,"class","mt-3"),l(d,"class","row row-cols-1 row-cols-lg-3 g4")},m(h,w){O(h,t,w),A&&A.m(t,null),c(t,n),E.m(t,null),c(t,i),c(t,o),c(o,u),c(o,a),c(o,p),c(o,g),c(o,m),O(h,_,w),C&&C.m(h,w),O(h,v,w),O(h,d,w);for(let S=0;S<b.length;S+=1)b[S]&&b[S].m(d,null);O(h,I,w);for(let S=0;S<H.length;S+=1)H[S]&&H[S].m(h,w);O(h,R,w),Q&&Q.m(h,w),O(h,P,w),J&&J.m(h,w),O(h,W,w),F=!0,ee||(M=[Y(p,"input",e[16]),Y(t,"submit",_e(e[15]))],ee=!0)},p(h,w){h[2]?A?A.p(h,w):(A=st(h),A.c(),A.m(t,n)):A&&(A.d(1),A=null),w[0]&1&&ze(s,s=h[0].id)?(E.d(1),E=ot(h),E.c(),E.m(t,i)):E.p(h,w),(!F||w[0]&1&&k!==(k="imageInput"+h[0].id))&&l(p,"id",k),!h[13]&&h[0].type==="mc"?C||(C=at(),C.c(),C.m(v.parentNode,v)):C&&(C.d(1),C=null),w[0]&131073&&(te=ye(h[0].images),b=Ze(b,w,ne,1,h,te,q,d,Pt,rt,null,it)),w[0]&548865&&(G=ye(h[0].answers),Ot(),H=Ze(H,w,se,1,h,G,B,R.parentNode,Nt,ut,R,tt),Kt()),h[0].type==="mc"||h[0].answers.length===0?Q?Q.p(h,w):(Q=ft(h),Q.c(),Q.m(P.parentNode,P)):Q&&(Q.d(1),Q=null),h[4]?J?J.p(h,w):(J=pt(h),J.c(),J.m(W.parentNode,W)):J&&(J.d(1),J=null)},i(h){if(!F){for(let w=0;w<G.length;w+=1)vt(H[w]);F=!0}},o(h){for(let w=0;w<H.length;w+=1)wt(H[w]);F=!1},d(h){h&&(T(t),T(_),T(v),T(d),T(I),T(R),T(P),T(W)),A&&A.d(),E.d(h),C&&C.d(h);for(let w=0;w<b.length;w+=1)b[w].d();for(let w=0;w<H.length;w+=1)H[w].d(h);Q&&Q.d(h),J&&J.d(h),ee=!1,Oe(M)}}}const li=1e3;function oi(e,t,n){let s,{question:i}=t,{cases:o}=t,{toggleEditor:u}=t,{handleQuestionRemove:a}=t,{showConfigEditor:p=!1}=t,{showCaseSelector:k=!1}=t,g,m,_,v,d=0,b,q,I,H="";gt(()=>{ce.filter=function(){return!0},ce("alt+A",function(V){V.preventDefault();const $=Date.now();$-d>li&&(M(),d=$)});const f=document.getElementById("collapseQuestionHint");f&&f.addEventListener("shown.bs.collapse",()=>{_&&_.focus()});const L=document.getElementById("collapseQuestionComment");L&&L.addEventListener("shown.bs.collapse",()=>{m&&m.focus()})});function B(f){f.addEventListener("trix-change",function(){n(0,i.text=document.getElementById("questionText").value,i),n(0,i.comment=document.getElementById("questionComment").value,i),n(0,i.hint=document.getElementById("questionHint").value,i),n(12,H='<p class="text-end">Saving ...</p>'),W()})}function R(f){f!==i.correct_answer_id&&(n(0,i.correct_answer_id=f,i),axios.put("/api/questions/"+i.id,i).then(function(L){}).catch(function(L){alert(L)}))}var P;function W(){P&&P.cancel(),P=Ct(()=>{axios.put("/api/questions/"+i.id,i).then(function(f){n(12,H='<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(f){n(12,H='<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(f)})},500,{maxWait:2e3}),P()}function F(){var f=new FormData,L=document.getElementById("imageInput"+i.id);f.set("image",L.files[0]),axios.post("/api/questions/"+i.id+"/images",f,{headers:{"Content-Type":"multipart/form-data"}}).then(function(V){L.value="";var $=V.data;n(0,i.images=[...i.images,$],i)}).catch(function(V){L.value="",alert(V)})}function ee(f){axios.delete("/api/images/"+f).then(function(L){n(0,i.images=i.images.filter(V=>V.id!==f),i)}).catch(function(L){alert(L)})}function M(){axios.post("/api/questions/"+i.id+"/answers",{}).then(function(f){n(0,i.answers=[...i.answers,f.data],i),Mt().then(()=>{const L=document.getElementById("editor-answer"+f.data.id);L&&L.focus()})}).catch(function(f){alert(f)})}function A(f){axios.delete("/api/answers/"+f).then(function(L){n(0,i.answers=i.answers.filter(V=>V.id!==f),i)}).catch(function(L){alert(L)})}function E(){axios.put("/api/questions/"+i.id,{type:i.type==="mc"?"mc":"card"}).then(function(f){n(0,i.type=f.data.type,i)}).catch(function(f){alert(f)})}function C(){axios.put("/api/questions/"+i.id,{case_id:v}).then(function(f){n(0,i.case_id=f.data.case_id,i);const L=o.find(V=>V.id===f.data.case_id);n(0,i.case=L,i),L.questions||(L.questions=[]),L.questions.push({id:i.id,case_id:L.id})}).catch(function(f){alert(f)})}function te(){axios.put("/api/questions/"+i.id,{case_id:null}).then(function(f){n(0,i.case_id=null,i),n(0,i.case=null,i),o.map(L=>{L.questions=L.questions.filter(V=>V.id!==i.id)})}).catch(function(f){alert(f)})}function ne(){axios.put("/api/questions/"+i.id,{is_invalid:!i.is_invalid}).then(function(f){n(0,i.is_invalid=!i.is_invalid,i)}).catch(function(f){alert(f)})}function G(){axios.put("/api/questions/"+i.id,{needs_review:!i.needs_review}).then(function(f){n(0,i.needs_review=!i.needs_review,i)}).catch(function(f){alert(f)})}const se=f=>f.id===i.case_id;function Q(){v=Xe(this),n(9,v),n(0,i),n(1,o)}function J(){i.text=this.value,n(0,i)}function h(f){ke[f?"unshift":"push"](()=>{g=f,n(6,g)})}function w(){i.hint=this.value,n(0,i)}function S(f){ke[f?"unshift":"push"](()=>{_=f,n(8,_)})}function de(){i.comment=this.value,n(0,i)}function Z(f){ke[f?"unshift":"push"](()=>{m=f,n(7,m)})}function le(){i.is_invalid=this.checked,n(0,i)}function ue(){i.needs_review=this.checked,n(0,i)}const ae=f=>{confirm("Are you sure you want to delete this image?")&&ee(f.id)};function be(f,L,V,$){V[$]=f,n(0,i)}const fe=f=>{R(f.id)},D=f=>{confirm("Are you sure you want to delete this answer?")&&A(f.id)};function j(){i.type=Xe(this),n(0,i)}const ge=()=>{confirm("Are you sure you want to delete this question?")&&a(i.id)};return e.$$set=f=>{"question"in f&&n(0,i=f.question),"cases"in f&&n(1,o=f.cases),"toggleEditor"in f&&n(2,u=f.toggleEditor),"handleQuestionRemove"in f&&n(3,a=f.handleQuestionRemove),"showConfigEditor"in f&&n(4,p=f.showConfigEditor),"showCaseSelector"in f&&n(5,k=f.showCaseSelector)},e.$$.update=()=>{e.$$.dirty[0]&1&&n(13,s=i.correct_answer_id),e.$$.dirty[0]&64&&g&&B(g),e.$$.dirty[0]&128&&m&&B(m),e.$$.dirty[0]&256&&_&&B(_),e.$$.dirty[0]&1&&(i.case?n(9,v=i.case.id):n(9,v="")),e.$$.dirty[0]&33554433&&i.id!==I&&(n(25,I=i.id),n(10,b=!!i.hint),n(11,q=!!i.comment))},[i,o,u,a,p,k,g,m,_,v,b,q,H,s,R,W,F,ee,M,A,E,C,te,ne,G,I,se,Q,J,h,w,S,de,Z,le,ue,ae,be,fe,D,j,ge]}class ui extends _t{constructor(t){super(),bt(this,t,oi,si,ze,{question:0,cases:1,toggleEditor:2,handleQuestionRemove:3,showConfigEditor:4,showCaseSelector:5},null,[-1,-1])}}export{ui as Q,ce as h};
