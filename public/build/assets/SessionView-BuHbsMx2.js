import{S as ge,i as pe,s as me,e as Qe,b as A,n as B,d as P,c as k,f as m,I as Ae,h as b,l as j,a as z,t as Y,q as _e,p as re,k as D,E as We,m as Je,H as Ke,C as Ee,o as I,y as G,z as x,x as Q,F as Xe,r as W,u as ee,v as se,w as J,A as ne,D as $,J as Ye,G as Ce,B as Ze}from"./index-BBxbQYOu.js";import{p as Pe,d as je}from"./purify.es-DfBF0len.js";import{M as xe}from"./Messages-cZuW1hV5.js";import{C as $e}from"./auto-B1JLC99t.js";import{S as es}from"./SessionProgressBar-CBjUMqqW.js";import{e as Me}from"./each-DRTt0YH0.js";import{h as Ie,S as ss}from"./SessionQuestionView-CMV0o1x-.js";import{s as ns}from"./StatsHelper-B91isISU.js";import{U as we}from"./UserSettingsStore-bJDZU8Jx.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./parseISO-Ds5nI7_t.js";import"./lodash-D0JQdfhu.js";import"./QuestionForm-DL-Tikwj.js";function Se(s){let n,e,i,r,u;return{c(){n=k("div"),e=k("img"),m(e,"class","img-fluid"),Ae(e.src,i="/"+s[0])||m(e,"src",i),m(e,"alt","Magic GIF"),m(n,"class","img-fullscreen d-flex justify-content-center align-items-center svelte-k1osqd")},m(t,a){A(t,n,a),b(n,e),r||(u=j(n,"click",s[2]),r=!0)},p(t,a){a&1&&!Ae(e.src,i="/"+t[0])&&m(e,"src",i)},d(t){t&&P(n),r=!1,u()}}}function is(s){let n,e=s[0]&&s[1]&&Se(s);return{c(){e&&e.c(),n=Qe()},m(i,r){e&&e.m(i,r),A(i,n,r)},p(i,[r]){i[0]&&i[1]?e?e.p(i,r):(e=Se(i),e.c(),e.m(n.parentNode,n)):e&&(e.d(1),e=null)},i:B,o:B,d(i){i&&P(n),e&&e.d(i)}}}function ts(s,n,e){let{magicGIFPath:i=""}=n;var r=!0;function u(){e(1,r=!r)}return s.$$set=t=>{"magicGIFPath"in t&&e(0,i=t.magicGIFPath)},[i,r,u]}class os extends ge{constructor(n){super(),pe(this,n,ts,is,me,{magicGIFPath:0})}}function Te(s){let n,e,i;return{c(){n=k("button"),n.innerHTML='<i class="bi bi-repeat"></i> Repeat incorrect',m(n,"class","btn btn-sm btn-outline-secondary"),m(n,"type","button")},m(r,u){A(r,n,u),e||(i=j(n,"click",re(s[5])),e=!0)},p:B,d(r){r&&P(n),e=!1,i()}}}function rs(s){let n,e,i,r,u,t,a,l=s[0].correct+"",o,c,w,M,q,V,C,y,T,g=s[0].incorrect>0&&Te(s);return{c(){n=k("div"),e=k("div"),i=k("canvas"),r=z(),u=k("div"),t=k("p"),a=k("span"),o=Y(l),c=Y("%"),w=Y(" correct"),M=z(),q=k("div"),V=k("a"),V.innerHTML='<i class="bi bi-rocket-takeoff"></i> New session',C=z(),g&&g.c(),y=z(),T=k("a"),T.textContent="Home",m(e,"class","col-md"),m(a,"class","fs-4 font-monospace"),m(t,"class","mt-3 text-dark"),m(V,"href","/sessions/create"),m(V,"class","btn btn-sm btn-primary"),m(T,"href","/"),m(T,"class","btn btn-sm btn-outline-secondary"),m(q,"class","d-grid gap-2"),m(u,"class","col-md"),m(n,"class","row mb-5")},m(p,h){A(p,n,h),b(n,e),b(e,i),s[4](i),b(n,r),b(n,u),b(u,t),b(t,a),b(a,o),b(a,c),b(t,w),b(u,M),b(u,q),b(q,V),b(q,C),g&&g.m(q,null),b(q,y),b(q,T)},p(p,[h]){h&1&&l!==(l=p[0].correct+"")&&_e(o,l),p[0].incorrect>0?g?g.p(p,h):(g=Te(p),g.c(),g.m(q,y)):g&&(g.d(1),g=null)},i:B,o:B,d(p){p&&P(n),s[4](null),g&&g.d()}}}function us(s){axios.post("/api/sessions/"+s+"/newfromincorrect").then(function(n){window.location.href="/sessions/"+n.data.id}).catch(function(n){alert(n)})}function ls(s,n,e){let{progressPercentage:i}=n,{sessionId:r}=n,u,t;function a(o){D[o?"unshift":"push"](()=>{u=o,e(2,u)})}const l=()=>us(r);return s.$$set=o=>{"progressPercentage"in o&&e(0,i=o.progressPercentage),"sessionId"in o&&e(1,r=o.sessionId)},s.$$.update=()=>{s.$$.dirty&13&&u&&(()=>{if(t)return;const o={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect"],datasets:[{label:"%",data:[i.correct,i.correctWithHelp,i.incorrect],backgroundColor:["#d4edda","#fff3cd","#f8d7da"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};t&&t.destroy();var c=u.getContext("2d");e(3,t=new $e(c,o))})()},[i,r,u,t,a,l]}class fs extends ge{constructor(n){super(),pe(this,n,ls,rs,me,{progressPercentage:0,sessionId:1})}}function Fe(s,n,e){const i=s.slice();return i[5]=n[e],i[7]=e,i}function Ge(s){let n;return{c(){n=k("li"),n.textContent="Loading ...",m(n,"class","svelte-za7w49")},m(e,i){A(e,n,i)},p:B,d(e){e&&P(n)}}}function cs(s){let n,e=s[7]+1+"",i;return{c(){n=Y("Question Nr. "),i=Y(e)},m(r,u){A(r,n,u),A(r,i,u)},p:B,d(r){r&&(P(n),P(i))}}}function as(s){let n=Pe.sanitize(s[5].text).replace(/<\/?[^>]+(>|$)/g,"")+"",e;return{c(){e=Y(n)},m(i,r){A(i,e,r)},p(i,r){r&1&&n!==(n=Pe.sanitize(i[5].text).replace(/<\/?[^>]+(>|$)/g,"")+"")&&_e(e,n)},d(i){i&&P(e)}}}function ye(s){let n,e,i,r=s[1](s[5])+"",u,t,a,l,o,c;function w(C,y){return C[5].text?as:cs}let M=w(s),q=M(s);function V(){return s[4](s[5])}return{c(){n=k("li"),e=k("small"),i=new Ke(!1),u=z(),q.c(),t=z(),i.a=u,m(n,"class",a="list-group-item list-group-item-action text-overflow "+(s[5].id===s[0].session.current_question_id?"list-group-item-dark":"list-group-item-light")+" svelte-za7w49"),m(n,"id",l="question"+s[5].id)},m(C,y){A(C,n,y),b(n,e),i.m(r,e),b(e,u),q.m(e,null),b(n,t),o||(c=j(n,"click",V),o=!0)},p(C,y){s=C,y&3&&r!==(r=s[1](s[5])+"")&&i.p(r),M===(M=w(s))&&q?q.p(s,y):(q.d(1),q=M(s),q&&(q.c(),q.m(e,null))),y&1&&a!==(a="list-group-item list-group-item-action text-overflow "+(s[5].id===s[0].session.current_question_id?"list-group-item-dark":"list-group-item-light")+" svelte-za7w49")&&m(n,"class",a),y&1&&l!==(l="question"+s[5].id)&&m(n,"id",l)},d(C){C&&P(n),q.d(),o=!1,c()}}}function ds(s){let n,e,i=Me(s[0].deck.questions),r=[];for(let t=0;t<i.length;t+=1)r[t]=ye(Fe(s,i,t));let u=null;return i.length||(u=Ge()),{c(){n=k("div"),e=k("ul");for(let t=0;t<r.length;t+=1)r[t].c();u&&u.c(),m(e,"class","list-group"),m(n,"class","overflow-scroll"),We(n,"max-height","85vh")},m(t,a){A(t,n,a),b(n,e);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(e,null);u&&u.m(e,null)},p(t,[a]){if(a&3){i=Me(t[0].deck.questions);let l;for(l=0;l<i.length;l+=1){const o=Fe(t,i,l);r[l]?r[l].p(o,a):(r[l]=ye(o),r[l].c(),r[l].m(e,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length,!i.length&&u?u.p(t,a):i.length?u&&(u.d(1),u=null):(u=Ge(),u.c(),u.m(e,null))}},i:B,o:B,d(t){t&&P(n),Je(r,t),u&&u.d()}}}function _s(s,n,e){let i,r,{data:u}=n,{examMode:t}=n;const a=l=>e(0,u.session.current_question_id=l.id,u);return s.$$set=l=>{"data"in l&&e(0,u=l.data),"examMode"in l&&e(2,t=l.examMode)},s.$$.update=()=>{s.$$.dirty&1&&e(3,i=u.session.current_question_id),s.$$.dirty&8&&(()=>{var l=document.getElementById("question"+i);l&&l.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})})(),s.$$.dirty&5&&e(1,r=function(l){var o=u.session.answer_choices.find(c=>c.question_id===l.id);return o?t?'<span class="text-dark fw-bold">&check;</span>':o.is_correct?o.help_used?'<span class="text-warning-dark fw-bold">&check;</span>':'<span class="text-success-dark fw-bold">&check;</span>':'<span class="text-danger-dark fw-bold">&cross;</span>':'<span class="text-dark fw-bold">&rightarrow;</span>'})},[u,r,t,i,a]}class gs extends ge{constructor(n){super(),pe(this,n,_s,ds,me,{data:0,examMode:2})}}function ps(s){let n;return{c(){n=k("div"),n.innerHTML="",m(n,"class","col-6")},m(e,i){A(e,n,i)},p:B,d(e){e&&P(n)}}}function ms(s){let n,e,i,r;return{c(){n=k("div"),e=k("button"),e.innerHTML='<span class="fw-bold">←</span> Previous',m(e,"class","btn btn-sm btn-light w-100"),m(n,"class","col-6")},m(u,t){A(u,n,t),b(n,e),i||(r=j(e,"click",re(s[2])),i=!0)},p:B,d(u){u&&P(n),i=!1,r()}}}function bs(s){let n;return{c(){n=k("div"),n.innerHTML="",m(n,"class","col-6")},m(e,i){A(e,n,i)},p:B,d(e){e&&P(n)}}}function hs(s){let n,e,i,r;return{c(){n=k("div"),e=k("button"),e.innerHTML='Next <span class="fw-bold">→</span>',m(e,"class","btn btn-sm w-100"),I(e,"btn-warning",s[1].isAnswered),I(e,"btn-light",!s[1].isAnswered),m(n,"class","col-6")},m(u,t){A(u,n,t),b(n,e),i||(r=j(e,"click",re(s[3])),i=!0)},p(u,t){t&2&&I(e,"btn-warning",u[1].isAnswered),t&2&&I(e,"btn-light",!u[1].isAnswered)},d(u){u&&P(n),i=!1,r()}}}function ws(s){let n,e;function i(o,c){return o[0].session.current_question_id&&o[0].session.current_question_id!=o[0].deck.questions[0].id?ms:ps}let r=i(s),u=r(s);function t(o,c){return o[0].session.current_question_id!=o[0].deck.questions[o[0].deck.questions.length-1].id?hs:bs}let a=t(s),l=a(s);return{c(){n=k("div"),u.c(),e=z(),l.c(),m(n,"class","row mb-3 pt-1 pb-1 sticky-top bg-white")},m(o,c){A(o,n,c),u.m(n,null),b(n,e),l.m(n,null)},p(o,[c]){r===(r=i(o))&&u?u.p(o,c):(u.d(1),u=r(o),u&&(u.c(),u.m(n,e))),a===(a=t(o))&&l?l.p(o,c):(l.d(1),l=a(o),l&&(l.c(),l.m(n,null)))},i:B,o:B,d(o){o&&P(n),u.d(),l.d()}}}function ks(s,n,e){let{data:i}=n,{currentQuestionId:r}=n,{currentQuestionContext:u}=n;Ee(()=>{Ie("left","questions",function(o,c){a()}),Ie("right","questions",function(o,c){l()}),Ie.setScope("questions")});function t(o){return i.deck.questions.findIndex(c=>c.id===o)}function a(){var o=t(r),c=i.deck.questions[o-1];c&&e(0,i.session.current_question_id=c.id,i)}function l(){var o=t(r),c=i.deck.questions[o+1];c&&e(0,i.session.current_question_id=c.id,i)}return s.$$set=o=>{"data"in o&&e(0,i=o.data),"currentQuestionId"in o&&e(4,r=o.currentQuestionId),"currentQuestionContext"in o&&e(1,u=o.currentQuestionContext)},[i,u,a,l,r]}class qs extends ge{constructor(n){super(),pe(this,n,ks,ws,me,{data:0,currentQuestionId:4,currentQuestionContext:1})}}function vs(s){let n;return{c(){n=k("p"),n.textContent="Loading ..."},m(e,i){A(e,n,i)},p:B,i:B,o:B,d(e){e&&P(n)}}}function Cs(s){let n,e,i,r,u,t,a,l,o,c,w,M,q,V,C,y,T=s[0].deck.name+"",g,p,h,d,K,Z,ie,E,ue,O,R,le,fe,ce,be,S,ae,he,H=!s[11]&&(!s[3]||!s[8].isAnswered)&&He(s),L=s[3]&&s[8].isAnswered&&Le(s),U=s[6]&&Ue(s);function ke(_){s[30](_)}function qe(_){s[31](_)}function ve(_){s[32](_)}let te={};s[0]!==void 0&&(te.data=s[0]),s[0].session.current_question_id!==void 0&&(te.currentQuestionId=s[0].session.current_question_id),s[8]!==void 0&&(te.currentQuestionContext=s[8]),R=new qs({props:te}),D.push(()=>W(R,"data",ke)),D.push(()=>W(R,"currentQuestionId",qe)),D.push(()=>W(R,"currentQuestionContext",ve));let N=s[12]&&Ne(s);return{c(){n=k("div"),e=k("div"),i=k("p"),r=k("button"),r.innerHTML='<i class="bi bi-layout-sidebar"></i>',u=z(),t=k("button"),t.innerHTML='<i class="bi bi-shuffle"></i>',a=z(),l=k("button"),l.innerHTML='<i class="bi bi-exclamation-square"></i>',o=z(),c=k("span"),w=Y(s[13]),M=Y("/"),q=Y(s[14]),V=z(),C=k("a"),y=k("strong"),g=Y(T),h=z(),d=k("div"),K=k("div"),H&&H.c(),Z=z(),L&&L.c(),ie=z(),E=k("div"),U&&U.c(),ue=z(),O=k("div"),ee(R.$$.fragment),be=z(),N&&N.c(),m(r,"class","btn btn-sm d-none d-sm-none d-md-none d-lg-inline"),m(r,"title","Toggle sidebar"),I(r,"bg-light",!s[6]),I(r,"bg-dark-subtle",s[6]),m(t,"class","btn btn-sm"),m(t,"title","Toggle answer shuffling"),I(t,"bg-light",!s[4]),I(t,"bg-dark-subtle",s[4]),m(l,"class","btn btn-sm"),m(l,"title","Toggle exam mode"),I(l,"bg-light",!s[5]),I(l,"bg-dark-subtle",s[5]),m(c,"class","ms-1 float-end fw-bold font-monospace badge text-dark"),I(c,"text-bg-light",!s[1]||s[11]),I(c,"bg-success",!s[11]&&!s[12].is_invalid&&s[1]&&s[1].is_correct),I(c,"bg-danger",!s[11]&&!s[12].is_invalid&&s[1]&&!s[1].is_correct),m(C,"href",p="/decks/"+s[0].deck.id),m(C,"class","text-reset text-decoration-none"),m(i,"class","text-overflow svelte-1gfmo48"),m(e,"class","col mb-1"),m(n,"class","row"),m(K,"class","col mb-1"),m(d,"class","row"),m(O,"class","col-md-12"),I(O,"col-lg-9",s[6]),I(O,"col-lg-10",!s[6]),I(O,"offset-lg-1",!s[6]),m(E,"class","row mt-3")},m(_,v){A(_,n,v),b(n,e),b(e,i),b(i,r),b(i,u),b(i,t),b(i,a),b(i,l),b(i,o),b(i,c),b(c,w),b(c,M),b(c,q),b(i,V),b(i,C),b(C,y),b(y,g),A(_,h,v),A(_,d,v),b(d,K),H&&H.m(K,null),b(K,Z),L&&L.m(K,null),A(_,ie,v),A(_,E,v),U&&U.m(E,null),b(E,ue),b(E,O),se(R,O,null),b(O,be),N&&N.m(O,null),S=!0,ae||(he=[j(r,"click",re(s[23])),j(t,"click",re(s[24])),j(l,"click",re(s[25]))],ae=!0)},p(_,v){(!S||v[0]&64)&&I(r,"bg-light",!_[6]),(!S||v[0]&64)&&I(r,"bg-dark-subtle",_[6]),(!S||v[0]&16)&&I(t,"bg-light",!_[4]),(!S||v[0]&16)&&I(t,"bg-dark-subtle",_[4]),(!S||v[0]&32)&&I(l,"bg-light",!_[5]),(!S||v[0]&32)&&I(l,"bg-dark-subtle",_[5]),(!S||v[0]&8192)&&_e(w,_[13]),(!S||v[0]&16384)&&_e(q,_[14]),(!S||v[0]&2050)&&I(c,"text-bg-light",!_[1]||_[11]),(!S||v[0]&6146)&&I(c,"bg-success",!_[11]&&!_[12].is_invalid&&_[1]&&_[1].is_correct),(!S||v[0]&6146)&&I(c,"bg-danger",!_[11]&&!_[12].is_invalid&&_[1]&&!_[1].is_correct),(!S||v[0]&1)&&T!==(T=_[0].deck.name+"")&&_e(g,T),(!S||v[0]&1&&p!==(p="/decks/"+_[0].deck.id))&&m(C,"href",p),!_[11]&&(!_[3]||!_[8].isAnswered)?H?(H.p(_,v),v[0]&2312&&Q(H,1)):(H=He(_),H.c(),Q(H,1),H.m(K,Z)):H&&($(),G(H,1,1,()=>{H=null}),x()),_[3]&&_[8].isAnswered?L?(L.p(_,v),v[0]&264&&Q(L,1)):(L=Le(_),L.c(),Q(L,1),L.m(K,null)):L&&($(),G(L,1,1,()=>{L=null}),x()),_[6]?U?(U.p(_,v),v[0]&64&&Q(U,1)):(U=Ue(_),U.c(),Q(U,1),U.m(E,ue)):U&&($(),G(U,1,1,()=>{U=null}),x());const oe={};!le&&v[0]&1&&(le=!0,oe.data=_[0],J(()=>le=!1)),!fe&&v[0]&1&&(fe=!0,oe.currentQuestionId=_[0].session.current_question_id,J(()=>fe=!1)),!ce&&v[0]&256&&(ce=!0,oe.currentQuestionContext=_[8],J(()=>ce=!1)),R.$set(oe),_[12]?N?(N.p(_,v),v[0]&4096&&Q(N,1)):(N=Ne(_),N.c(),Q(N,1),N.m(O,null)):N&&($(),G(N,1,1,()=>{N=null}),x()),(!S||v[0]&64)&&I(O,"col-lg-9",_[6]),(!S||v[0]&64)&&I(O,"col-lg-10",!_[6]),(!S||v[0]&64)&&I(O,"offset-lg-1",!_[6])},i(_){S||(Q(H),Q(L),Q(U),Q(R.$$.fragment,_),Q(N),S=!0)},o(_){G(H),G(L),G(U),G(R.$$.fragment,_),G(N),S=!1},d(_){_&&(P(n),P(h),P(d),P(ie),P(E)),H&&H.d(),L&&L.d(),U&&U.d(),ne(R),N&&N.d(),ae=!1,Ze(he)}}}function He(s){let n,e,i;function r(t){s[26](t)}let u={};return s[2]!==void 0&&(u.progressPercentage=s[2]),n=new es({props:u}),D.push(()=>W(n,"progressPercentage",r)),{c(){ee(n.$$.fragment)},m(t,a){se(n,t,a),i=!0},p(t,a){const l={};!e&&a[0]&4&&(e=!0,l.progressPercentage=t[2],J(()=>e=!1)),n.$set(l)},i(t){i||(Q(n.$$.fragment,t),i=!0)},o(t){G(n.$$.fragment,t),i=!1},d(t){ne(n,t)}}}function Le(s){let n,e,i;function r(t){s[27](t)}let u={sessionId:s[0].session.id};return s[2]!==void 0&&(u.progressPercentage=s[2]),n=new fs({props:u}),D.push(()=>W(n,"progressPercentage",r)),{c(){ee(n.$$.fragment)},m(t,a){se(n,t,a),i=!0},p(t,a){const l={};a[0]&1&&(l.sessionId=t[0].session.id),!e&&a[0]&4&&(e=!0,l.progressPercentage=t[2],J(()=>e=!1)),n.$set(l)},i(t){i||(Q(n.$$.fragment,t),i=!0)},o(t){G(n.$$.fragment,t),i=!1},d(t){ne(n,t)}}}function Ue(s){let n,e,i,r,u;function t(o){s[28](o)}function a(o){s[29](o)}let l={};return s[0]!==void 0&&(l.data=s[0]),s[11]!==void 0&&(l.examMode=s[11]),e=new gs({props:l}),D.push(()=>W(e,"data",t)),D.push(()=>W(e,"examMode",a)),{c(){n=k("div"),ee(e.$$.fragment),m(n,"class","col-lg-3 d-none d-lg-block")},m(o,c){A(o,n,c),se(e,n,null),u=!0},p(o,c){const w={};!i&&c[0]&1&&(i=!0,w.data=o[0],J(()=>i=!1)),!r&&c[0]&2048&&(r=!0,w.examMode=o[11],J(()=>r=!1)),e.$set(w)},i(o){u||(Q(e.$$.fragment,o),u=!0)},o(o){G(e.$$.fragment,o),u=!1},d(o){o&&P(n),ne(e)}}}function Ne(s){let n,e,i,r,u,t,a,l,o,c;function w(p){s[33](p)}function M(p){s[34](p)}function q(p){s[35](p)}function V(p){s[36](p)}function C(p){s[37](p)}function y(p){s[38](p)}let T={deckId:s[0].deck.id,submitAnswer:s[16],deleteAnswer:s[17],updateCurrentQuestionData:s[15]};s[12]!==void 0&&(T.question=s[12]),s[8]!==void 0&&(T.questionContext=s[8]),s[9]!==void 0&&(T.helpUsed=s[9]),s[1]!==void 0&&(T.answerChoice=s[1]),s[11]!==void 0&&(T.examMode=s[11]),s[4]!==void 0&&(T.settingsShuffleAnswers=s[4]),n=new ss({props:T}),D.push(()=>W(n,"question",w)),D.push(()=>W(n,"questionContext",M)),D.push(()=>W(n,"helpUsed",q)),D.push(()=>W(n,"answerChoice",V)),D.push(()=>W(n,"examMode",C)),D.push(()=>W(n,"settingsShuffleAnswers",y));let g=!s[11]&&s[8].isAnswered&&Ve(s);return{c(){ee(n.$$.fragment),l=z(),g&&g.c(),o=Qe()},m(p,h){se(n,p,h),A(p,l,h),g&&g.m(p,h),A(p,o,h),c=!0},p(p,h){const d={};h[0]&1&&(d.deckId=p[0].deck.id),!e&&h[0]&4096&&(e=!0,d.question=p[12],J(()=>e=!1)),!i&&h[0]&256&&(i=!0,d.questionContext=p[8],J(()=>i=!1)),!r&&h[0]&512&&(r=!0,d.helpUsed=p[9],J(()=>r=!1)),!u&&h[0]&2&&(u=!0,d.answerChoice=p[1],J(()=>u=!1)),!t&&h[0]&2048&&(t=!0,d.examMode=p[11],J(()=>t=!1)),!a&&h[0]&16&&(a=!0,d.settingsShuffleAnswers=p[4],J(()=>a=!1)),n.$set(d),!p[11]&&p[8].isAnswered?g?(g.p(p,h),h[0]&2304&&Q(g,1)):(g=Ve(p),g.c(),Q(g,1),g.m(o.parentNode,o)):g&&($(),G(g,1,1,()=>{g=null}),x())},i(p){c||(Q(n.$$.fragment,p),Q(g),c=!0)},o(p){G(n.$$.fragment,p),G(g),c=!1},d(p){p&&(P(l),P(o)),ne(n,p),g&&g.d(p)}}}function Ve(s){let n,e,i;function r(t){s[39](t)}let u={};return s[12].id!==void 0&&(u.questionId=s[12].id),n=new xe({props:u}),D.push(()=>W(n,"questionId",r)),{c(){ee(n.$$.fragment)},m(t,a){se(n,t,a),i=!0},p(t,a){const l={};!e&&a[0]&4096&&(e=!0,l.questionId=t[12].id,J(()=>e=!1)),n.$set(l)},i(t){i||(Q(n.$$.fragment,t),i=!0)},o(t){G(n.$$.fragment,t),i=!1},d(t){ne(n,t)}}}function ze(s){let n,e,i;function r(t){s[40](t)}let u={};return s[10]!==void 0&&(u.magicGIFPath=s[10]),n=new os({props:u}),D.push(()=>W(n,"magicGIFPath",r)),{c(){ee(n.$$.fragment)},m(t,a){se(n,t,a),i=!0},p(t,a){const l={};!e&&a[0]&1024&&(e=!0,l.magicGIFPath=t[10],J(()=>e=!1)),n.$set(l)},i(t){i||(Q(n.$$.fragment,t),i=!0)},o(t){G(n.$$.fragment,t),i=!1},d(t){ne(n,t)}}}function Is(s){let n,e,i,r,u;const t=[Cs,vs],a=[];function l(c,w){return c[0]?0:1}n=l(s),e=a[n]=t[n](s);let o=!s[11]&&ze(s);return{c(){e.c(),i=z(),o&&o.c(),r=Qe()},m(c,w){a[n].m(c,w),A(c,i,w),o&&o.m(c,w),A(c,r,w),u=!0},p(c,w){let M=n;n=l(c),n===M?a[n].p(c,w):($(),G(a[M],1,1,()=>{a[M]=null}),x(),e=a[n],e?e.p(c,w):(e=a[n]=t[n](c),e.c()),Q(e,1),e.m(i.parentNode,i)),c[11]?o&&($(),G(o,1,1,()=>{o=null}),x()):o?(o.p(c,w),w[0]&2048&&Q(o,1)):(o=ze(c),o.c(),Q(o,1),o.m(r.parentNode,r))},i(c){u||(Q(e),Q(o),u=!0)},o(c){G(e),G(o),u=!1},d(c){c&&(P(i),P(r)),a[n].d(c),o&&o.d(c)}}}function Qs(s,n,e){let i,r,u,t,a,l,o,c,w,M,q,V,C,y,T,g;Xe(s,we,f=>e(7,g=f));let{id:p}=n;var h,d,K=!1,Z="";function ie(){return{isAnswered:!!V,answerContext:w.answers.reduce((F,X)=>(F[X.id]={isCorrectAnswer:X.id===w.correct_answer_id,isSubmittedAnswer:o?X.id===o.answer_id:!1,isSelectedAnswer:o?X.id===o.answer_id:!1},F),{})}}var E=-1;Ee(()=>{axios.get("/api/sessions/"+p).then(function(f){e(0,d=f.data)}).catch(function(f){alert(f)})});function ue(){return axios.get("/api/questions/"+w.id).then(function(f){var F=d.deck.questions.findIndex(de=>de.id===w.id),X=f.data;e(0,d.deck.questions[F]=X,d),O(X)}).catch(function(f){alert(f)})}function O(f){if(f.type!=="card"){var F=d.session.answer_choices.findIndex(X=>X.question_id===f.id);F!==-1&&e(0,d.session.answer_choices[F].is_correct=d.session.answer_choices[F].answer_id===f.correct_answer_id,d)}}var R;function le(){R&&R.cancel(),R=je(()=>{axios.put("/api/sessions/"+d.session.id,d.session).then(function(f){}).catch(function(f){alert(f)})},1e3,{maxWait:2e3}),R()}function fe(f){if(f&&f!==-1?e(8,h.answerContext[f].isSelectedAnswer=!0,h):e(8,h.isAnswered=!0,h),V&&f&&f===w.correct_answer_id){e(8,h.isAnswered=!0,h);return}else if(V)return;var F=!1;w.type==="card"?(F=!!f,f===-1&&(f=null)):F=w.correct_answer_id===f,(F||i||!a)&&e(8,h.isAnswered=!0,h),f&&f!==-1&&(e(8,h.answerContext[f].isSubmittedAnswer=!0,h),e(8,h.answerContext[f].isCorrectAnswer=F,h));var X={question_id:q,answer_id:f,is_correct:F,help_used:K};axios.post("/api/sessions/"+p+"/answerchoices",X).then(function(de){e(0,d.session.answer_choices=[...d.session.answer_choices,de.data],d)}).catch(function(de){alert(de)})}function ce(){V&&(e(1,o=d.session.answer_choices.find(f=>f.question_id===q)),o&&axios.delete("/api/sessions/"+p+"/answerchoices/"+o.id).then(function(f){e(0,d.session.answer_choices=[...d.session.answer_choices.filter(F=>F.question_id!==q)],d),Ye().then(()=>{e(8,h=ie())})}).catch(function(f){alert(f)}))}const be=()=>{Ce(we,g.session_show_sidebar=!g.session_show_sidebar,g)},S=()=>{Ce(we,g.session_shuffle_answers=!g.session_shuffle_answers,g)},ae=()=>{Ce(we,g.session_exam_mode=!g.session_exam_mode,g)};function he(f){C=f,e(2,C),e(0,d),e(22,l),e(21,c)}function H(f){C=f,e(2,C),e(0,d),e(22,l),e(21,c)}function L(f){d=f,e(0,d)}function U(f){i=f,e(11,i),e(3,M),e(7,g),e(0,d),e(22,l),e(21,c)}function ke(f){d=f,e(0,d)}function qe(f){s.$$.not_equal(d.session.current_question_id,f)&&(d.session.current_question_id=f,e(0,d))}function ve(f){h=f,e(8,h),e(20,q),e(0,d)}function te(f){w=f,e(12,w),e(0,d)}function N(f){h=f,e(8,h),e(20,q),e(0,d)}function _(f){K=f,e(9,K)}function v(f){o=f,e(1,o),e(0,d),e(20,q)}function oe(f){i=f,e(11,i),e(3,M),e(7,g),e(0,d),e(22,l),e(21,c)}function De(f){t=f,e(4,t),e(7,g)}function Oe(f){s.$$.not_equal(w.id,f)&&(w.id=f,e(12,w),e(0,d))}function Re(f){Z=f,e(10,Z),e(2,C),e(19,E),e(0,d),e(22,l),e(21,c)}return s.$$set=f=>{"id"in f&&e(18,p=f.id)},s.$$.update=()=>{s.$$.dirty[0]&1&&e(22,l=d?d.deck.questions.filter(f=>!f.is_invalid):null),s.$$.dirty[0]&4194305&&e(21,c=d?d.session.answer_choices.filter(f=>l.some(({id:F})=>F===f.question_id)):null),s.$$.dirty[0]&6291457&&e(3,M=d?l.length===c.length:!1),s.$$.dirty[0]&136&&e(11,i=M?!1:g.session_exam_mode),s.$$.dirty[0]&128&&e(6,r=g.session_show_sidebar),s.$$.dirty[0]&128&&e(5,u=g.session_exam_mode),s.$$.dirty[0]&128&&e(4,t=g.session_shuffle_answers),s.$$.dirty[0]&128&&(a=g.session_multiple_answer_tries),s.$$.dirty[0]&64&&axios.put("/api/users/me/settings",{session_show_sidebar:r}).then(function(f){}).catch(function(f){alert(f)}),s.$$.dirty[0]&32&&axios.put("/api/users/me/settings",{session_exam_mode:u}).then(function(f){}).catch(function(f){alert(f)}),s.$$.dirty[0]&16&&axios.put("/api/users/me/settings",{session_shuffle_answers:t}).then(function(f){}).catch(function(f){alert(f)}),s.$$.dirty[0]&1&&e(20,q=d?d.session.current_question_id:null),s.$$.dirty[0]&1048577&&e(1,o=d?d.session.answer_choices.find(f=>f.question_id===q):null),s.$$.dirty[0]&1&&e(12,w=d?d.deck.questions.find(f=>f.id===d.session.current_question_id):null),s.$$.dirty[0]&8&&M&&e(11,i=!1),s.$$.dirty[0]&1048576&&le(),s.$$.dirty[0]&3&&(V=d?!!o:!1),s.$$.dirty[0]&1048576&&q&&e(8,h=ie()),s.$$.dirty[0]&6291457&&e(2,C=d?ns(l.length,c):null),s.$$.dirty[0]&1&&e(14,y=d?d.deck.questions.length:0),s.$$.dirty[0]&1&&e(13,T=d?d.deck.questions.findIndex(f=>f.id==d.session.current_question_id)+1:null),s.$$.dirty[0]&524292&&(()=>{if(C){var f=C.correct;if(f<60){e(19,E=f);return}if(E===-1){e(19,E=f);return}E<60&&(e(19,E=f),axios.get("/api/magic-gif").then(function(F){e(10,Z="magic-gifs/"+F.data.id)}).catch(function(F){}))}})()},[d,o,C,M,t,u,r,g,h,K,Z,i,w,T,y,ue,fe,ce,p,E,q,c,l,be,S,ae,he,H,L,U,ke,qe,ve,te,N,_,v,oe,De,Oe,Re]}class As extends ge{constructor(n){super(),pe(this,n,Qs,Is,me,{id:18},null,[-1,-1])}}const Be=document.getElementById("SessionView");new As({target:Be,props:{id:Be.dataset.sessionId}});
