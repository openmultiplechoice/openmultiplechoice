import{S as ae,i as oe,s as le,k as ce,r as fe,d as H,u as ue,w as P,x as v,y as de,q as C,g,o as F,a as Y,B as me,c as d,f as _,C as ge,b as L,t as S,E as O,n as N,l as Me,p as De,A as _e,e as he,D as we,m as ye,z as be}from"./index-C5hKwDc9.js";import{e as Z}from"./each-JoEH9o9l.js";import{S as ke}from"./SessionProgressBar-D35tF687.js";import{s as ve}from"./StatsHelper-B91isISU.js";import{t as I,n as R,g as $,a as Ie,e as Se,m as x,b as q,p as ee,f as Oe}from"./parseISO-nqt9u7wd.js";function B(s,e){const n=+I(s)-+I(e);return n<0?-1:n>0?1:n}function Pe(s,e,n){const[a,t]=R(n==null?void 0:n.in,s,e),c=a.getFullYear()-t.getFullYear(),i=a.getMonth()-t.getMonth();return c*12+i}function He(s){return e=>{const n=Math.trunc,a=n(e);return a===0?0:a}}function Ye(s,e){return+I(s)-+I(e)}function Le(s,e){const n=I(s,e==null?void 0:e.in);return n.setHours(23,59,59,999),n}function Ne(s,e){const n=I(s,e==null?void 0:e.in),a=n.getMonth();return n.setFullYear(n.getFullYear(),a+1,0),n.setHours(23,59,59,999),n}function Xe(s,e){const n=I(s,e==null?void 0:e.in);return+Le(n,e)==+Ne(n,e)}function ze(s,e,n){const[a,t,c]=R(n==null?void 0:n.in,s,s,e),i=B(t,c),r=Math.abs(Pe(t,c));if(r<1)return 0;t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-i*r);let o=B(t,c)===-i;Xe(a)&&r===1&&B(a,c)===1&&(o=!1);const l=i*(r-+o);return l===0?0:l}function Te(s,e,n){const a=Ye(s,e)/1e3;return He()(a)}function Ae(s,e,n){const a=Ie(),t=(n==null?void 0:n.locale)??a.locale??Se,c=2520,i=B(s,e);if(isNaN(i))throw new RangeError("Invalid time value");const r=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:i}),[o,l]=R(n==null?void 0:n.in,...i>0?[e,s]:[s,e]),m=Te(l,o),b=($(l)-$(o))/1e3,f=Math.round((m-b)/60);let w;if(f<2)return f===0?t.formatDistance("lessThanXMinutes",1,r):t.formatDistance("xMinutes",f,r);if(f<45)return t.formatDistance("xMinutes",f,r);if(f<90)return t.formatDistance("aboutXHours",1,r);if(f<x){const p=Math.round(f/60);return t.formatDistance("aboutXHours",p,r)}else{if(f<c)return t.formatDistance("xDays",1,r);if(f<q){const p=Math.round(f/x);return t.formatDistance("xDays",p,r)}else if(f<q*2)return w=Math.round(f/q),t.formatDistance("aboutXMonths",w,r)}if(w=ze(l,o),w<12){const p=Math.round(f/q);return t.formatDistance("xMonths",p,r)}else{const p=w%12,y=Math.trunc(w/12);return p<3?t.formatDistance("aboutXYears",y,r):p<9?t.formatDistance("overXYears",y,r):t.formatDistance("almostXYears",y+1,r)}}function ne(s){let e,n,a;return{c(){e=_("button"),e.innerHTML='<i class="bi bi-repeat"></i> Repeat incorrect',g(e,"class","btn btn-sm btn-outline-secondary"),O(e,"--bs-btn-padding-y",".25rem"),O(e,"--bs-btn-padding-x",".5rem"),O(e,"--bs-btn-font-size",".75rem"),g(e,"type","button")},m(t,c){Y(t,e,c),n||(a=Me(e,"click",De(s[6])),n=!0)},p:N,d(t){t&&H(e),n=!1,a()}}}function Fe(s){let e,n,a,t,c,i,r,o=s[0].name+"",l,m,b,f,w,p,y,j,Q,k,X,z,E,U,G,T,A,V,J,M;function pe(u){s[5](u)}let K={};s[1]!==void 0&&(K.progressPercentage=s[1]),n=new ke({props:K}),ce.push(()=>fe(n,"progressPercentage",pe));let h=s[1].unanswered===0&&s[1].incorrect>0&&ne(s);return{c(){e=_("div"),ge(n.$$.fragment),t=L(),c=_("div"),i=_("div"),r=_("strong"),l=S(o),m=L(),b=_("div"),f=_("a"),w=_("i"),p=S(" Open"),j=L(),h&&h.c(),Q=L(),k=_("div"),X=_("span"),z=_("small"),E=S(s[3]),U=S(" ago"),G=L(),T=_("span"),A=_("small"),V=S(s[3]),J=S(" ago"),g(i,"class","col-md-4"),g(w,"class","bi bi-rocket-takeoff"),g(f,"href",y="/sessions/"+s[0].id),g(f,"class","btn btn-sm"),O(f,"--bs-btn-padding-y",".25rem"),O(f,"--bs-btn-padding-x",".5rem"),O(f,"--bs-btn-font-size",".75rem"),F(f,"btn-primary",s[1].unanswered),F(f,"btn-outline-secondary",!s[1].unanswered),g(b,"class","col-md-4"),g(X,"class","float-end d-none d-sm-none d-md-inline"),g(T,"class","d-inline d-sm-inline d-md-none"),g(k,"class","col-md-4"),g(k,"title",s[2]),g(c,"class","row mt-1"),g(e,"class","mt-3 mb-3")},m(u,D){Y(u,e,D),me(n,e,null),d(e,t),d(e,c),d(c,i),d(i,r),d(r,l),d(c,m),d(c,b),d(b,f),d(f,w),d(f,p),d(b,j),h&&h.m(b,null),d(c,Q),d(c,k),d(k,X),d(X,z),d(z,E),d(z,U),d(k,G),d(k,T),d(T,A),d(A,V),d(A,J),M=!0},p(u,[D]){const W={};!a&&D&2&&(a=!0,W.progressPercentage=u[1],de(()=>a=!1)),n.$set(W),(!M||D&1)&&o!==(o=u[0].name+"")&&C(l,o),(!M||D&1&&y!==(y="/sessions/"+u[0].id))&&g(f,"href",y),(!M||D&2)&&F(f,"btn-primary",u[1].unanswered),(!M||D&2)&&F(f,"btn-outline-secondary",!u[1].unanswered),u[1].unanswered===0&&u[1].incorrect>0?h?h.p(u,D):(h=ne(u),h.c(),h.m(b,null)):h&&(h.d(1),h=null),(!M||D&8)&&C(E,u[3]),(!M||D&8)&&C(V,u[3]),(!M||D&4)&&g(k,"title",u[2])},i(u){M||(v(n.$$.fragment,u),M=!0)},o(u){P(n.$$.fragment,u),M=!1},d(u){u&&H(e),ue(n),h&&h.d()}}}function qe(s){axios.post("/api/sessions/"+s+"/newfromincorrect").then(function(e){window.location.href="/sessions/"+e.data.id}).catch(function(e){alert(e)})}function Be(s,e,n){let a,t,c,i,{session:r}=e;function o(m){i=m,n(1,i),n(0,r),n(4,c)}const l=()=>qe(r.id);return s.$$set=m=>{"session"in m&&n(0,r=m.session)},s.$$.update=()=>{s.$$.dirty&1&&n(3,a=Ae(ee(r.created_at),new Date)),s.$$.dirty&1&&n(2,t=Oe(ee(r.created_at),"dd.MM.yyyy HH:mm")),s.$$.dirty&1&&n(4,c=r?r.deck.questions.filter(m=>!m.is_invalid):null),s.$$.dirty&17&&n(1,i=r?ve(c.length,r.answerchoices.filter(m=>c.some(({id:b})=>b===m.question_id))):null)},[r,i,t,a,c,o,l]}class Ee extends ae{constructor(e){super(),oe(this,e,Be,Fe,le,{session:0})}}function se(s,e,n){const a=s.slice();return a[3]=e[n],a[4]=e,a[5]=n,a}function Ve(s){let e;return{c(){e=_("div"),e.innerHTML='<div class="spinner-border text-secondary" role="status"><span class="visually-hidden">Loading sessions ...</span></div>',g(e,"class","d-flex justify-content-center")},m(n,a){Y(n,e,a)},p:N,i:N,o:N,d(n){n&&H(e)}}}function Ce(s){let e,n,a=Z(s[0]),t=[];for(let r=0;r<a.length;r+=1)t[r]=re(se(s,a,r));const c=r=>P(t[r],1,1,()=>{t[r]=null});let i=null;return a.length||(i=te()),{c(){for(let r=0;r<t.length;r+=1)t[r].c();e=he(),i&&i.c()},m(r,o){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(r,o);Y(r,e,o),i&&i.m(r,o),n=!0},p(r,o){if(o&1){a=Z(r[0]);let l;for(l=0;l<a.length;l+=1){const m=se(r,a,l);t[l]?(t[l].p(m,o),v(t[l],1)):(t[l]=re(m),t[l].c(),v(t[l],1),t[l].m(e.parentNode,e))}for(be(),l=a.length;l<t.length;l+=1)c(l);_e(),!a.length&&i?i.p(r,o):a.length?i&&(i.d(1),i=null):(i=te(),i.c(),i.m(e.parentNode,e))}},i(r){if(!n){for(let o=0;o<a.length;o+=1)v(t[o]);n=!0}},o(r){t=t.filter(Boolean);for(let o=0;o<t.length;o+=1)P(t[o]);n=!1},d(r){r&&H(e),ye(t,r),i&&i.d(r)}}}function te(s){let e;return{c(){e=_("div"),e.innerHTML='No sessions yet <i class="bi bi-rocket"></i> ',g(e,"class","alert alert-light text-center"),g(e,"role","alert")},m(n,a){Y(n,e,a)},p:N,d(n){n&&H(e)}}}function re(s){let e,n,a;function t(i){s[2](i,s[3],s[4],s[5])}let c={};return s[3]!==void 0&&(c.session=s[3]),e=new Ee({props:c}),ce.push(()=>fe(e,"session",t)),{c(){ge(e.$$.fragment)},m(i,r){me(e,i,r),a=!0},p(i,r){s=i;const o={};!n&&r&1&&(n=!0,o.session=s[3],de(()=>n=!1)),e.$set(o)},i(i){a||(v(e.$$.fragment,i),a=!0)},o(i){P(e.$$.fragment,i),a=!1},d(i){ue(e,i)}}}function Re(s){let e,n,a,t;const c=[Ce,Ve],i=[];function r(o,l){return o[0]?0:1}return e=r(s),n=i[e]=c[e](s),{c(){n.c(),a=he()},m(o,l){i[e].m(o,l),Y(o,a,l),t=!0},p(o,[l]){let m=e;e=r(o),e===m?i[e].p(o,l):(be(),P(i[m],1,1,()=>{i[m]=null}),_e(),n=i[e],n?n.p(o,l):(n=i[e]=c[e](o),n.c()),v(n,1),n.m(a.parentNode,a))},i(o){t||(v(n),t=!0)},o(o){P(n),t=!1},d(o){o&&H(a),i[e].d(o)}}}function je(s,e,n){let{userId:a}=e;var t=void 0;we(()=>{axios.get("/api/sessions?take=15&user-id="+a).then(function(i){n(0,t=i.data)}).catch(function(i){alert(i)})});function c(i,r,o,l){o[l]=i,n(0,t)}return s.$$set=i=>{"userId"in i&&n(1,a=i.userId)},[t,a,c]}class Qe extends ae{constructor(e){super(),oe(this,e,je,Re,le,{userId:1})}}const ie=document.getElementById("IndexSessionView");new Qe({target:ie,props:{userId:ie.dataset.userId}});
