import{d as X,p as Z,g as e,s as W,a as A,f as C,b as Y,c as _,e as m,h as $,i as n,t as h,u as L,j as et,k as lt,l as U,m as G,n as ut,o as it,q as vt}from"./render-CYeZSKAW.js";import{o as mt}from"./index-client-Dbvf6pRw.js";import{i as S}from"./if-CpEGQhVh.js";import{s as at,a as K}from"./attributes-BHpBkK0Q.js";import{k as _t,Q as ft}from"./QuestionForm-DPzeLodB.js";import{h as bt}from"./html-DxqZuNW-.js";import{s as J}from"./class-BfJg_ovI.js";import{b as pt}from"./input-B1KW1ttA.js";import{b as gt}from"./this-YKSURJA9.js";import{p as ht,e as st,i as nt}from"./event-modifiers-Bgjah3RO.js";import{p as ct}from"./props-Cr_568BV.js";import{r as xt}from"./legacy-client-DCyKqh61.js";import{d as qt,p as rt,K as ot}from"./hotkeys-js-Bzouew-W.js";import{s as yt}from"./style-BtOSwUPa.js";import{s as dt}from"./utils-CsCDY5_e.js";import"./select-BXowa35n.js";import"./lodash-d8dSvcKh.js";import"./_commonjsHelpers-CE1G-McA.js";var kt=C('<form action="#" class="mt-3"><div class="mb-3"><label class="form-label">Case text</label> <input type="hidden"/> <trix-editor></trix-editor> <!></div></form>',2),wt=C(`<div class="alert alert-light mt-5" role="alert"><p><strong>Delete case?</strong> A case can only be deleted if it's not associated with any question.</p> <button type="button" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i> Delete case</button></div>`),Et=C("<!> <!>",1);function Ct(O,r){Z(r,!0);let t=ct(r,"kase",15),f=W(void 0),x=W("");xt(()=>{e(f)&&I(e(f))});function I(s){s.addEventListener("trix-change",function(){t(t().text=document.getElementById("caseText"+t().id).value,!0),A(x,'<p class="text-end">Saving ...</p>'),F()}),s.toolbarElement.style.display="none",s.addEventListener("trix-focus",function(o){o.target.toolbarElement.style.display="block"}),s.addEventListener("trix-blur",function(o){o.target.toolbarElement.contains(document.activeElement)||(o.target.toolbarElement.style.display="none")})}var p;function F(){p&&p.cancel(),p=qt(()=>{axios.put("/api/cases/"+t().id,t()).then(function(s){A(x,'<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(s){A(x,'<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(s)})},500,{maxWait:2e3}),p()}var Q=Et(),N=Y(Q);_t(N,()=>t().id,s=>{var o=kt(),D=n(o),q=n(D),c=_(q,2),l=_(c,2);h(()=>at(l,"id",`editor-case${t().id??""}`)),J(l,1,"bg-light trix-content"),h(()=>at(l,"input",`caseText${t().id??""}`)),gt(l,y=>A(f,y),()=>e(f));var u=_(l,2);bt(u,()=>e(x)),h(()=>{K(q,"for",`caseText${t().id??""}`),K(c,"id",`caseText${t().id??""}`)}),pt(c,()=>t().text,y=>t(t().text=y,!0)),m(s,o)});var P=_(N,2);{var d=s=>{var o=wt(),D=_(n(o),2),q=L(()=>ht(()=>{confirm("Are you sure you want to delete this case?")&&r.handleCaseRemove(t().id)}));D.__click=function(...c){e(q)?.apply(this,c)},h(c=>D.disabled=c,[()=>r.cases.some(c=>c.questions?c.questions.some(l=>l.case_id===t().id):!1)]),m(s,o)};S(P,s=>{r.handleCaseRemove&&s(d)})}m(O,Q),$()}X(["click"]);var It=C('<button type="button" aria-current="true"><small><!></small></button>'),Qt=C('<button type="button" aria-current="true"><small><i class="bi bi-clipboard2-pulse"></i> <!></small></button>'),Dt=C('<div class="overflow-scroll mt-2" style="max-height: 25vh;"><div class="list-group"></div></div>'),Tt=C('<div class="overflow-scroll"><div class="list-group"></div></div> <!>',1),At=C("<p>Loading ...</p>");function Bt(O,r){Z(r,!0);let t=ct(r,"data",15),f=L(()=>t()?t().questions.find(d=>d.id===t().current_question_id):null),x=L(()=>t()?t().current_question_id:null),I=L(()=>t()?t().current_case_id:null),p=L(()=>t()&&t().cases&&t().cases.length>0);et(()=>{if(!e(x))return;let d=document.getElementById("editor-question"+e(x));dt(d)}),et(()=>{if(!e(I))return;let d=document.getElementById("editor-case-item"+e(I));dt(d)});var F=lt(),Q=Y(F);{var N=d=>{var s=Tt(),o=Y(s),D=n(o);st(D,21,()=>t().questions,nt,(l,u,y)=>{var k=It();k.__click=()=>{t(t().current_question_id=e(u).id,!0),t(t().current_case_id=null,!0)};let v;var R=n(k),w=n(R);{var z=g=>{var E=U();h(H=>G(E,H),[()=>rt.sanitize(e(u).text).replace(/<\/?[^>]+(>|$)/g,"")]),m(g,E)},M=g=>{var E=U();E.nodeValue=`Question Nr. ${y+1}`,m(g,E)};S(w,g=>{e(u).text?g(z):g(M,!1)})}h(()=>{K(k,"id",`editor-question${e(u).id??""}`),v=J(k,1,"list-group-item list-group-item-action text-truncate",null,v,{"list-group-item-dark":e(u).id===t().current_question_id,"list-group-item-light":e(u).id!==t().current_question_id,"bg-warning-subtle":t().current_case_id&&e(u).case_id===t().current_case_id})}),m(l,k)});var q=_(o,2);{var c=l=>{var u=Dt(),y=n(u);st(y,21,()=>t().cases,nt,(k,v,R)=>{var w=Qt();w.__click=()=>{t(t().current_case_id=e(v).id,!0),t(t().current_question_id=null,!0)};let z;var M=n(w),g=_(n(M),2);{var E=T=>{var B=U();h(j=>G(B,j),[()=>rt.sanitize(e(v).text).replace(/<\/?[^>]+(>|$)/g,"")]),m(T,B)},H=T=>{var B=U();B.nodeValue=`Case Nr. ${R+1}`,m(T,B)};S(g,T=>{e(v).text?T(E):T(H,!1)})}h(()=>{K(w,"id",`editor-case-item${e(v).id??""}`),z=J(w,1,"list-group-item list-group-item-action text-truncate",null,z,{"list-group-item-dark":e(v).id===t().current_case_id,"list-group-item-info":e(v).id!==t().current_case_id&&!(e(f)&&e(f).case_id===e(v).id),"list-group-item-warning":e(f)&&e(f).case_id===e(v).id})}),m(k,w)}),m(l,u)};S(q,l=>{e(p)&&l(c)})}h(()=>yt(o,`max-height: ${e(p)?"50vh":"75vh"};`)),m(d,s)},P=d=>{var s=At();m(d,s)};S(Q,d=>{t()?d(N):d(P,!1)})}m(O,F),$()}X(["click"]);var Lt=C('<div class="row"><div class="col"><h4 class="text-truncate"><a class="text-reset text-decoration-none"> </a></h4></div></div> <div class="sticky-top bg-white mb-3" style="z-index: 20;"><div class="row"><div class="col d-grid d-sm-block gap-2 py-3"><button type="button" class="btn btn-sm btn-primary" title="Add a new MC question (Shortcut: Alt+Q)">Add MC question</button> <button type="button" class="btn btn-sm btn-primary">Add card question</button> <button type="button" class="btn btn-sm btn-light"><i class="bi bi-clipboard2-pulse"></i> Add case</button></div></div> <div class="row"><div class="col"><div class="border-dark" style="border-bottom: dotted; border-width: 1px;"></div></div></div></div> <div class="row"><div class="col-md-4"><!></div> <div class="col-md-8"><!> <!></div></div>',1);function St(O,r){Z(r,!0);let t=W(ut({cases:[],questions:[]})),f=0;const x=1e3;let I=L(()=>e(t)?e(t).questions.find(a=>a.id===e(t).current_question_id):null),p=L(()=>e(t)?e(t).cases.find(a=>a.id===e(t).current_case_id):null);mt(()=>{ot.filter=function(){return!0},ot("alt+Q",function(a){a.preventDefault();const i=Date.now();i-f>x&&(Q("mc"),f=i)}),axios.get("/api/decks/"+r.id).then(function(a){A(t,a.data,!0);const i=F();i&&e(t).questions.some(b=>b.id===parseInt(i))?e(t).current_question_id=parseInt(i):e(t).questions.length>0&&(e(t).current_question_id=e(t).questions[e(t).questions.length-1].id)}).catch(function(a){alert(a)})});function F(){return new URLSearchParams(window.location.search).get("question_id")}function Q(a){var i={id:null,text:"",type:a||"mc",correct_answer_id:null,images:[],answers:[]};axios.post("/api/decks/"+r.id+"/questions",i).then(function(b){i.id=b.data.id,e(t).questions=[...e(t).questions,i],e(t).current_question_id=i.id,it().then(()=>{const tt=document.getElementById("editor-questionText");tt&&tt.focus()})}).catch(function(b){alert(b)}),window.scrollTo({top:0,behavior:"smooth"})}function N(){var a={deck_id:r.id};axios.post("/api/cases",a).then(function(i){e(t).cases=[...e(t).cases,i.data],e(t).current_case_id=i.data.id,e(t).current_question_id=null,it().then(()=>{const b=document.getElementById("editor-case"+i.data.id);b&&b.focus()})}).catch(function(i){alert(i)}),window.scrollTo({top:0,behavior:"smooth"})}function P(a){axios.delete("/api/decks/"+r.id+"/questions/"+a).then(function(i){e(t).questions=e(t).questions.filter(b=>b.id!==a),e(t).questions.length>0&&(e(t).current_question_id=e(t).questions[e(t).questions.length-1].id)}).catch(function(i){alert(i)})}function d(a){axios.delete("/api/decks/"+r.id+"/cases/"+a).then(function(i){e(t).cases=e(t).cases.filter(b=>b.id!==a),e(t).questions.length>0&&(e(t).current_question_id=e(t).questions[e(t).questions.length-1].id)}).catch(function(i){alert(i)})}var s=Lt(),o=Y(s),D=n(o),q=n(D),c=n(q),l=n(c),u=_(o,2),y=n(u),k=n(y),v=n(k);v.__click=()=>{Q("mc")};var R=_(v,2);R.__click=()=>{Q("card")};var w=_(R,2);w.__click=N;var z=_(u,2),M=n(z),g=n(M);Bt(g,{get data(){return e(t)},set data(a){A(t,a,!0)}});var E=_(M,2),H=n(E);{var T=a=>{ft(a,{showConfigEditor:"true",showCaseSelector:"true",handleQuestionRemove:P,get question(){return e(I)},set question(i){A(I,i)},get cases(){return e(t).cases},set cases(i){e(t).cases=i}})};S(H,a=>{e(I)&&a(T)})}var B=_(H,2);{var j=a=>{Ct(a,{handleCaseRemove:d,get kase(){return e(p)},set kase(i){A(p,i)},get cases(){return e(t).cases},set cases(i){e(t).cases=i}})};S(B,a=>{e(p)&&a(j)})}h(()=>{K(q,"title",r.name),K(c,"href",`/decks/${r.id??""}`),G(l,r.name)}),m(O,s),$()}X(["click"]);const V=document.getElementById("DeckForm");vt(St,{target:V,props:{id:V.dataset.deckId,name:V.dataset.deckName,moduleId:V.dataset.moduleId}});
