import{S as ge,i as pe,s as me,e as Ae,b as Q,n as R,d as P,c as q,f as m,I as Ie,h,l as $,a as D,t as Z,q as _e,p as le,k as O,E as Xe,m as Ye,H as Ze,C as Ee,o as S,y as U,z as ee,x as A,F as je,r as W,u as ne,v as ie,w as J,A as te,D as se,J as xe,G as Ce,B as $e}from"./index-BBxbQYOu.js";import{p as Qe,d as es}from"./purify.es-DfBF0len.js";import{M as ss}from"./Messages-uAckiryG.js";import{C as ns}from"./auto-De2ec26M.js";import{S as is}from"./SessionProgressBar-CBjUMqqW.js";import{e as Pe}from"./each-DRTt0YH0.js";import{h as Se,S as ts}from"./SessionQuestionView-DLx87LHn.js";import{s as os}from"./StatsHelper-B91isISU.js";import{U as we}from"./UserSettingsStore-bJDZU8Jx.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./parseISO-Ds5nI7_t.js";import"./lodash-D0JQdfhu.js";import"./QuestionForm-DL-Tikwj.js";function Me(s){let n,e,i,o,r;return{c(){n=q("div"),e=q("img"),m(e,"class","img-fluid"),Ie(e.src,i="/"+s[0])||m(e,"src",i),m(e,"alt","Magic GIF"),m(n,"class","img-fullscreen d-flex justify-content-center align-items-center svelte-k1osqd")},m(t,a){Q(t,n,a),h(n,e),o||(r=$(n,"click",s[2]),o=!0)},p(t,a){a&1&&!Ie(e.src,i="/"+t[0])&&m(e,"src",i)},d(t){t&&P(n),o=!1,r()}}}function rs(s){let n,e=s[0]&&s[1]&&Me(s);return{c(){e&&e.c(),n=Ae()},m(i,o){e&&e.m(i,o),Q(i,n,o)},p(i,[o]){i[0]&&i[1]?e?e.p(i,o):(e=Me(i),e.c(),e.m(n.parentNode,n)):e&&(e.d(1),e=null)},i:R,o:R,d(i){i&&P(n),e&&e.d(i)}}}function us(s,n,e){let{magicGIFPath:i=""}=n;var o=!0;function r(){e(1,o=!o)}return s.$$set=t=>{"magicGIFPath"in t&&e(0,i=t.magicGIFPath)},[i,o,r]}class ls extends ge{constructor(n){super(),pe(this,n,us,rs,me,{magicGIFPath:0})}}function Te(s){let n,e,i;return{c(){n=q("button"),n.innerHTML='<i class="bi bi-repeat"></i> Repeat incorrect',m(n,"class","btn btn-sm btn-outline-secondary"),m(n,"type","button")},m(o,r){Q(o,n,r),e||(i=$(n,"click",le(s[5])),e=!0)},p:R,d(o){o&&P(n),e=!1,i()}}}function fs(s){let n,e,i,o,r,t,a,f=s[0].correct+"",u,c,w,I,k,E,C,T,F,y=s[0].incorrect>0&&Te(s);return{c(){n=q("div"),e=q("div"),i=q("canvas"),o=D(),r=q("div"),t=q("p"),a=q("span"),u=Z(f),c=Z("%"),w=Z(" correct"),I=D(),k=q("div"),E=q("a"),E.innerHTML='<i class="bi bi-rocket-takeoff"></i> New session',C=D(),y&&y.c(),T=D(),F=q("a"),F.textContent="Home",m(e,"class","col-md"),m(a,"class","fs-4 font-monospace"),m(t,"class","mt-3 text-dark"),m(E,"href","/sessions/create"),m(E,"class","btn btn-sm btn-primary"),m(F,"href","/"),m(F,"class","btn btn-sm btn-outline-secondary"),m(k,"class","d-grid gap-2"),m(r,"class","col-md"),m(n,"class","row mb-5")},m(M,p){Q(M,n,p),h(n,e),h(e,i),s[4](i),h(n,o),h(n,r),h(r,t),h(t,a),h(a,u),h(a,c),h(t,w),h(r,I),h(r,k),h(k,E),h(k,C),y&&y.m(k,null),h(k,T),h(k,F)},p(M,[p]){p&1&&f!==(f=M[0].correct+"")&&_e(u,f),M[0].incorrect>0?y?y.p(M,p):(y=Te(M),y.c(),y.m(k,T)):y&&(y.d(1),y=null)},i:R,o:R,d(M){M&&P(n),s[4](null),y&&y.d()}}}function cs(s){axios.post("/api/sessions/"+s+"/newfromincorrect").then(function(n){window.location.href="/sessions/"+n.data.id}).catch(function(n){alert(n)})}function as(s,n,e){let{progressPercentage:i}=n,{sessionId:o}=n,r,t;function a(u){O[u?"unshift":"push"](()=>{r=u,e(2,r)})}const f=()=>cs(o);return s.$$set=u=>{"progressPercentage"in u&&e(0,i=u.progressPercentage),"sessionId"in u&&e(1,o=u.sessionId)},s.$$.update=()=>{s.$$.dirty&13&&r&&(()=>{if(t)return;const u={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect"],datasets:[{label:"%",data:[i.correct,i.correctWithHelp,i.incorrect],backgroundColor:["#d4edda","#fff3cd","#f8d7da"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};t&&t.destroy();var c=r.getContext("2d");e(3,t=new ns(c,u))})()},[i,o,r,t,a,f]}class ds extends ge{constructor(n){super(),pe(this,n,as,fs,me,{progressPercentage:0,sessionId:1})}}function ye(s,n,e){const i=s.slice();return i[5]=n[e],i[7]=e,i}function Fe(s){let n;return{c(){n=q("li"),n.textContent="Loading ...",m(n,"class","svelte-za7w49")},m(e,i){Q(e,n,i)},p:R,d(e){e&&P(n)}}}function _s(s){let n,e=s[7]+1+"",i;return{c(){n=Z("Question Nr. "),i=Z(e)},m(o,r){Q(o,n,r),Q(o,i,r)},p:R,d(o){o&&(P(n),P(i))}}}function gs(s){let n=Qe.sanitize(s[5].text).replace(/<\/?[^>]+(>|$)/g,"")+"",e;return{c(){e=Z(n)},m(i,o){Q(i,e,o)},p(i,o){o&1&&n!==(n=Qe.sanitize(i[5].text).replace(/<\/?[^>]+(>|$)/g,"")+"")&&_e(e,n)},d(i){i&&P(e)}}}function Ge(s){let n,e,i,o=s[1](s[5])+"",r,t,a,f,u,c;function w(C,T){return C[5].text?gs:_s}let I=w(s),k=I(s);function E(){return s[4](s[5])}return{c(){n=q("li"),e=q("small"),i=new Ze(!1),r=D(),k.c(),t=D(),i.a=r,m(n,"class",a="list-group-item list-group-item-action text-overflow "+(s[5].id===s[0].session.current_question_id?"list-group-item-dark":"list-group-item-light")+" svelte-za7w49"),m(n,"id",f="question"+s[5].id)},m(C,T){Q(C,n,T),h(n,e),i.m(o,e),h(e,r),k.m(e,null),h(n,t),u||(c=$(n,"click",E),u=!0)},p(C,T){s=C,T&3&&o!==(o=s[1](s[5])+"")&&i.p(o),I===(I=w(s))&&k?k.p(s,T):(k.d(1),k=I(s),k&&(k.c(),k.m(e,null))),T&1&&a!==(a="list-group-item list-group-item-action text-overflow "+(s[5].id===s[0].session.current_question_id?"list-group-item-dark":"list-group-item-light")+" svelte-za7w49")&&m(n,"class",a),T&1&&f!==(f="question"+s[5].id)&&m(n,"id",f)},d(C){C&&P(n),k.d(),u=!1,c()}}}function ps(s){let n,e,i=Pe(s[0].deck.questions),o=[];for(let t=0;t<i.length;t+=1)o[t]=Ge(ye(s,i,t));let r=null;return i.length||(r=Fe()),{c(){n=q("div"),e=q("ul");for(let t=0;t<o.length;t+=1)o[t].c();r&&r.c(),m(e,"class","list-group"),m(n,"class","overflow-scroll"),Xe(n,"max-height","85vh")},m(t,a){Q(t,n,a),h(n,e);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(e,null);r&&r.m(e,null)},p(t,[a]){if(a&3){i=Pe(t[0].deck.questions);let f;for(f=0;f<i.length;f+=1){const u=ye(t,i,f);o[f]?o[f].p(u,a):(o[f]=Ge(u),o[f].c(),o[f].m(e,null))}for(;f<o.length;f+=1)o[f].d(1);o.length=i.length,!i.length&&r?r.p(t,a):i.length?r&&(r.d(1),r=null):(r=Fe(),r.c(),r.m(e,null))}},i:R,o:R,d(t){t&&P(n),Ye(o,t),r&&r.d()}}}function ms(s,n,e){let i,o,{data:r}=n,{examMode:t}=n;const a=f=>e(0,r.session.current_question_id=f.id,r);return s.$$set=f=>{"data"in f&&e(0,r=f.data),"examMode"in f&&e(2,t=f.examMode)},s.$$.update=()=>{s.$$.dirty&1&&e(3,i=r.session.current_question_id),s.$$.dirty&8&&(()=>{var f=document.getElementById("question"+i);f&&f.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})})(),s.$$.dirty&5&&e(1,o=function(f){var u=r.session.answer_choices.find(c=>c.question_id===f.id);return u?t?'<span class="text-dark fw-bold">&check;</span>':u.is_correct?u.help_used?'<span class="text-warning-dark fw-bold">&check;</span>':'<span class="text-success-dark fw-bold">&check;</span>':'<span class="text-danger-dark fw-bold">&cross;</span>':'<span class="text-dark fw-bold">&rightarrow;</span>'})},[r,o,t,i,a]}class bs extends ge{constructor(n){super(),pe(this,n,ms,ps,me,{data:0,examMode:2})}}function hs(s){let n;return{c(){n=q("div"),n.innerHTML="",m(n,"class","col-6")},m(e,i){Q(e,n,i)},p:R,d(e){e&&P(n)}}}function ws(s){let n,e,i,o;return{c(){n=q("div"),e=q("button"),e.innerHTML='<span class="fw-bold">←</span> Previous',m(e,"class","btn btn-sm btn-light w-100"),m(n,"class","col-6")},m(r,t){Q(r,n,t),h(n,e),i||(o=$(e,"click",le(s[2])),i=!0)},p:R,d(r){r&&P(n),i=!1,o()}}}function ks(s){let n;return{c(){n=q("div"),n.innerHTML="",m(n,"class","col-6")},m(e,i){Q(e,n,i)},p:R,d(e){e&&P(n)}}}function qs(s){let n,e,i,o;return{c(){n=q("div"),e=q("button"),e.innerHTML='Next <span class="fw-bold">→</span>',m(e,"class","btn btn-sm w-100"),S(e,"btn-warning",s[1].isAnswered),S(e,"btn-light",!s[1].isAnswered),m(n,"class","col-6")},m(r,t){Q(r,n,t),h(n,e),i||(o=$(e,"click",le(s[3])),i=!0)},p(r,t){t&2&&S(e,"btn-warning",r[1].isAnswered),t&2&&S(e,"btn-light",!r[1].isAnswered)},d(r){r&&P(n),i=!1,o()}}}function vs(s){let n,e;function i(u,c){return u[0].session.current_question_id&&u[0].session.current_question_id!=u[0].deck.questions[0].id?ws:hs}let o=i(s),r=o(s);function t(u,c){return u[0].session.current_question_id!=u[0].deck.questions[u[0].deck.questions.length-1].id?qs:ks}let a=t(s),f=a(s);return{c(){n=q("div"),r.c(),e=D(),f.c(),m(n,"class","row mb-3 pt-1 pb-1 sticky-top bg-white")},m(u,c){Q(u,n,c),r.m(n,null),h(n,e),f.m(n,null)},p(u,[c]){o===(o=i(u))&&r?r.p(u,c):(r.d(1),r=o(u),r&&(r.c(),r.m(n,e))),a===(a=t(u))&&f?f.p(u,c):(f.d(1),f=a(u),f&&(f.c(),f.m(n,null)))},i:R,o:R,d(u){u&&P(n),r.d(),f.d()}}}function Cs(s,n,e){let{data:i}=n,{currentQuestionId:o}=n,{currentQuestionContext:r}=n;Ee(()=>{Se("left","questions",function(u,c){a()}),Se("right","questions",function(u,c){f()}),Se.setScope("questions")});function t(u){return i.deck.questions.findIndex(c=>c.id===u)}function a(){var u=t(o),c=i.deck.questions[u-1];c&&e(0,i.session.current_question_id=c.id,i)}function f(){var u=t(o),c=i.deck.questions[u+1];c&&e(0,i.session.current_question_id=c.id,i)}return s.$$set=u=>{"data"in u&&e(0,i=u.data),"currentQuestionId"in u&&e(4,o=u.currentQuestionId),"currentQuestionContext"in u&&e(1,r=u.currentQuestionContext)},[i,r,a,f,o]}class Ss extends ge{constructor(n){super(),pe(this,n,Cs,vs,me,{data:0,currentQuestionId:4,currentQuestionContext:1})}}function As(s){let n;return{c(){n=q("p"),n.textContent="Loading ..."},m(e,i){Q(e,n,i)},p:R,i:R,o:R,d(e){e&&P(n)}}}function Is(s){let n,e,i,o,r,t,a,f,u,c,w,I,k,E,C,T,F=s[0].deck.name+"",y,M,p,g,b,d,j,K,oe,H,X,fe,x,ce,be,G,ae,he,N=!s[11]&&s[15]&&(!s[3]||!s[8].isAnswered)&&He(s),V=s[3]&&s[8].isAnswered&&Le(s),z=s[6]&&Ue(s);function ke(_){s[32](_)}function qe(_){s[33](_)}function ve(_){s[34](_)}let re={};s[0]!==void 0&&(re.data=s[0]),s[0].session.current_question_id!==void 0&&(re.currentQuestionId=s[0].session.current_question_id),s[8]!==void 0&&(re.currentQuestionContext=s[8]),X=new Ss({props:re}),O.push(()=>W(X,"data",ke)),O.push(()=>W(X,"currentQuestionId",qe)),O.push(()=>W(X,"currentQuestionContext",ve));let B=s[12]&&Ne(s);return{c(){n=q("div"),e=q("div"),i=q("p"),o=q("button"),o.innerHTML='<i class="bi bi-layout-sidebar"></i>',r=D(),t=q("button"),t.innerHTML='<i class="bi bi-shuffle"></i>',a=D(),f=q("button"),f.innerHTML='<i class="bi bi-exclamation-square"></i>',u=D(),c=q("span"),w=Z(s[13]),I=Z("/"),k=Z(s[14]),E=D(),C=q("a"),T=q("strong"),y=Z(F),p=D(),g=q("div"),b=q("div"),N&&N.c(),d=D(),V&&V.c(),j=D(),K=q("div"),z&&z.c(),oe=D(),H=q("div"),ne(X.$$.fragment),be=D(),B&&B.c(),m(o,"class","btn btn-sm d-none d-sm-none d-md-none d-lg-inline"),m(o,"title","Toggle sidebar"),S(o,"bg-light",!s[6]),S(o,"bg-dark-subtle",s[6]),m(t,"class","btn btn-sm"),m(t,"title","Toggle answer shuffling"),S(t,"bg-light",!s[4]),S(t,"bg-dark-subtle",s[4]),m(f,"class","btn btn-sm"),m(f,"title","Toggle exam mode"),S(f,"bg-light",!s[5]),S(f,"bg-dark-subtle",s[5]),m(c,"class","ms-1 float-end fw-bold font-monospace badge text-dark"),S(c,"text-bg-light",!s[1]||s[11]),S(c,"bg-success",!s[11]&&!s[12].is_invalid&&s[1]&&s[1].is_correct),S(c,"bg-danger",!s[11]&&!s[12].is_invalid&&s[1]&&!s[1].is_correct),m(C,"href",M="/decks/"+s[0].deck.id),m(C,"class","text-reset text-decoration-none"),m(i,"class","text-overflow svelte-1gfmo48"),m(e,"class","col mb-1"),m(n,"class","row"),m(b,"class","col mb-1"),m(g,"class","row"),m(H,"class","col-md-12"),S(H,"col-lg-9",s[6]),S(H,"col-lg-10",!s[6]),S(H,"offset-lg-1",!s[6]),m(K,"class","row mt-3")},m(_,v){Q(_,n,v),h(n,e),h(e,i),h(i,o),h(i,r),h(i,t),h(i,a),h(i,f),h(i,u),h(i,c),h(c,w),h(c,I),h(c,k),h(i,E),h(i,C),h(C,T),h(T,y),Q(_,p,v),Q(_,g,v),h(g,b),N&&N.m(b,null),h(b,d),V&&V.m(b,null),Q(_,j,v),Q(_,K,v),z&&z.m(K,null),h(K,oe),h(K,H),ie(X,H,null),h(H,be),B&&B.m(H,null),G=!0,ae||(he=[$(o,"click",le(s[25])),$(t,"click",le(s[26])),$(f,"click",le(s[27]))],ae=!0)},p(_,v){(!G||v[0]&64)&&S(o,"bg-light",!_[6]),(!G||v[0]&64)&&S(o,"bg-dark-subtle",_[6]),(!G||v[0]&16)&&S(t,"bg-light",!_[4]),(!G||v[0]&16)&&S(t,"bg-dark-subtle",_[4]),(!G||v[0]&32)&&S(f,"bg-light",!_[5]),(!G||v[0]&32)&&S(f,"bg-dark-subtle",_[5]),(!G||v[0]&8192)&&_e(w,_[13]),(!G||v[0]&16384)&&_e(k,_[14]),(!G||v[0]&2050)&&S(c,"text-bg-light",!_[1]||_[11]),(!G||v[0]&6146)&&S(c,"bg-success",!_[11]&&!_[12].is_invalid&&_[1]&&_[1].is_correct),(!G||v[0]&6146)&&S(c,"bg-danger",!_[11]&&!_[12].is_invalid&&_[1]&&!_[1].is_correct),(!G||v[0]&1)&&F!==(F=_[0].deck.name+"")&&_e(y,F),(!G||v[0]&1&&M!==(M="/decks/"+_[0].deck.id))&&m(C,"href",M),!_[11]&&_[15]&&(!_[3]||!_[8].isAnswered)?N?(N.p(_,v),v[0]&35080&&A(N,1)):(N=He(_),N.c(),A(N,1),N.m(b,d)):N&&(se(),U(N,1,1,()=>{N=null}),ee()),_[3]&&_[8].isAnswered?V?(V.p(_,v),v[0]&264&&A(V,1)):(V=Le(_),V.c(),A(V,1),V.m(b,null)):V&&(se(),U(V,1,1,()=>{V=null}),ee()),_[6]?z?(z.p(_,v),v[0]&64&&A(z,1)):(z=Ue(_),z.c(),A(z,1),z.m(K,oe)):z&&(se(),U(z,1,1,()=>{z=null}),ee());const ue={};!fe&&v[0]&1&&(fe=!0,ue.data=_[0],J(()=>fe=!1)),!x&&v[0]&1&&(x=!0,ue.currentQuestionId=_[0].session.current_question_id,J(()=>x=!1)),!ce&&v[0]&256&&(ce=!0,ue.currentQuestionContext=_[8],J(()=>ce=!1)),X.$set(ue),_[12]?B?(B.p(_,v),v[0]&4096&&A(B,1)):(B=Ne(_),B.c(),A(B,1),B.m(H,null)):B&&(se(),U(B,1,1,()=>{B=null}),ee()),(!G||v[0]&64)&&S(H,"col-lg-9",_[6]),(!G||v[0]&64)&&S(H,"col-lg-10",!_[6]),(!G||v[0]&64)&&S(H,"offset-lg-1",!_[6])},i(_){G||(A(N),A(V),A(z),A(X.$$.fragment,_),A(B),G=!0)},o(_){U(N),U(V),U(z),U(X.$$.fragment,_),U(B),G=!1},d(_){_&&(P(n),P(p),P(g),P(j),P(K)),N&&N.d(),V&&V.d(),z&&z.d(),te(X),B&&B.d(),ae=!1,$e(he)}}}function He(s){let n,e,i;function o(t){s[28](t)}let r={};return s[2]!==void 0&&(r.progressPercentage=s[2]),n=new is({props:r}),O.push(()=>W(n,"progressPercentage",o)),{c(){ne(n.$$.fragment)},m(t,a){ie(n,t,a),i=!0},p(t,a){const f={};!e&&a[0]&4&&(e=!0,f.progressPercentage=t[2],J(()=>e=!1)),n.$set(f)},i(t){i||(A(n.$$.fragment,t),i=!0)},o(t){U(n.$$.fragment,t),i=!1},d(t){te(n,t)}}}function Le(s){let n,e,i;function o(t){s[29](t)}let r={sessionId:s[0].session.id};return s[2]!==void 0&&(r.progressPercentage=s[2]),n=new ds({props:r}),O.push(()=>W(n,"progressPercentage",o)),{c(){ne(n.$$.fragment)},m(t,a){ie(n,t,a),i=!0},p(t,a){const f={};a[0]&1&&(f.sessionId=t[0].session.id),!e&&a[0]&4&&(e=!0,f.progressPercentage=t[2],J(()=>e=!1)),n.$set(f)},i(t){i||(A(n.$$.fragment,t),i=!0)},o(t){U(n.$$.fragment,t),i=!1},d(t){te(n,t)}}}function Ue(s){let n,e,i,o,r;function t(u){s[30](u)}function a(u){s[31](u)}let f={};return s[0]!==void 0&&(f.data=s[0]),s[11]!==void 0&&(f.examMode=s[11]),e=new bs({props:f}),O.push(()=>W(e,"data",t)),O.push(()=>W(e,"examMode",a)),{c(){n=q("div"),ne(e.$$.fragment),m(n,"class","col-lg-3 d-none d-lg-block")},m(u,c){Q(u,n,c),ie(e,n,null),r=!0},p(u,c){const w={};!i&&c[0]&1&&(i=!0,w.data=u[0],J(()=>i=!1)),!o&&c[0]&2048&&(o=!0,w.examMode=u[11],J(()=>o=!1)),e.$set(w)},i(u){r||(A(e.$$.fragment,u),r=!0)},o(u){U(e.$$.fragment,u),r=!1},d(u){u&&P(n),te(e)}}}function Ne(s){let n,e,i,o,r,t,a,f,u,c,w;function I(g){s[35](g)}function k(g){s[36](g)}function E(g){s[37](g)}function C(g){s[38](g)}function T(g){s[39](g)}function F(g){s[40](g)}function y(g){s[41](g)}let M={deckId:s[0].deck.id,submitAnswer:s[18],deleteAnswer:s[19],updateCurrentQuestionData:s[17]};s[12]!==void 0&&(M.question=s[12]),s[8]!==void 0&&(M.questionContext=s[8]),s[9]!==void 0&&(M.helpUsed=s[9]),s[1]!==void 0&&(M.answerChoice=s[1]),s[11]!==void 0&&(M.examMode=s[11]),s[4]!==void 0&&(M.settingsShuffleAnswers=s[4]),s[16]!==void 0&&(M.settingsShowAnswerStats=s[16]),n=new ts({props:M}),O.push(()=>W(n,"question",I)),O.push(()=>W(n,"questionContext",k)),O.push(()=>W(n,"helpUsed",E)),O.push(()=>W(n,"answerChoice",C)),O.push(()=>W(n,"examMode",T)),O.push(()=>W(n,"settingsShuffleAnswers",F)),O.push(()=>W(n,"settingsShowAnswerStats",y));let p=!s[11]&&s[8].isAnswered&&Ve(s);return{c(){ne(n.$$.fragment),u=D(),p&&p.c(),c=Ae()},m(g,b){ie(n,g,b),Q(g,u,b),p&&p.m(g,b),Q(g,c,b),w=!0},p(g,b){const d={};b[0]&1&&(d.deckId=g[0].deck.id),!e&&b[0]&4096&&(e=!0,d.question=g[12],J(()=>e=!1)),!i&&b[0]&256&&(i=!0,d.questionContext=g[8],J(()=>i=!1)),!o&&b[0]&512&&(o=!0,d.helpUsed=g[9],J(()=>o=!1)),!r&&b[0]&2&&(r=!0,d.answerChoice=g[1],J(()=>r=!1)),!t&&b[0]&2048&&(t=!0,d.examMode=g[11],J(()=>t=!1)),!a&&b[0]&16&&(a=!0,d.settingsShuffleAnswers=g[4],J(()=>a=!1)),!f&&b[0]&65536&&(f=!0,d.settingsShowAnswerStats=g[16],J(()=>f=!1)),n.$set(d),!g[11]&&g[8].isAnswered?p?(p.p(g,b),b[0]&2304&&A(p,1)):(p=Ve(g),p.c(),A(p,1),p.m(c.parentNode,c)):p&&(se(),U(p,1,1,()=>{p=null}),ee())},i(g){w||(A(n.$$.fragment,g),A(p),w=!0)},o(g){U(n.$$.fragment,g),U(p),w=!1},d(g){g&&(P(u),P(c)),te(n,g),p&&p.d(g)}}}function Ve(s){let n,e,i;function o(t){s[42](t)}let r={};return s[12].id!==void 0&&(r.questionId=s[12].id),n=new ss({props:r}),O.push(()=>W(n,"questionId",o)),{c(){ne(n.$$.fragment)},m(t,a){ie(n,t,a),i=!0},p(t,a){const f={};!e&&a[0]&4096&&(e=!0,f.questionId=t[12].id,J(()=>e=!1)),n.$set(f)},i(t){i||(A(n.$$.fragment,t),i=!0)},o(t){U(n.$$.fragment,t),i=!1},d(t){te(n,t)}}}function ze(s){let n,e,i;function o(t){s[43](t)}let r={};return s[10]!==void 0&&(r.magicGIFPath=s[10]),n=new ls({props:r}),O.push(()=>W(n,"magicGIFPath",o)),{c(){ne(n.$$.fragment)},m(t,a){ie(n,t,a),i=!0},p(t,a){const f={};!e&&a[0]&1024&&(e=!0,f.magicGIFPath=t[10],J(()=>e=!1)),n.$set(f)},i(t){i||(A(n.$$.fragment,t),i=!0)},o(t){U(n.$$.fragment,t),i=!1},d(t){te(n,t)}}}function Qs(s){let n,e,i,o,r;const t=[Is,As],a=[];function f(c,w){return c[0]?0:1}n=f(s),e=a[n]=t[n](s);let u=!s[11]&&ze(s);return{c(){e.c(),i=D(),u&&u.c(),o=Ae()},m(c,w){a[n].m(c,w),Q(c,i,w),u&&u.m(c,w),Q(c,o,w),r=!0},p(c,w){let I=n;n=f(c),n===I?a[n].p(c,w):(se(),U(a[I],1,1,()=>{a[I]=null}),ee(),e=a[n],e?e.p(c,w):(e=a[n]=t[n](c),e.c()),A(e,1),e.m(i.parentNode,i)),c[11]?u&&(se(),U(u,1,1,()=>{u=null}),ee()):u?(u.p(c,w),w[0]&2048&&A(u,1)):(u=ze(c),u.c(),A(u,1),u.m(o.parentNode,o))},i(c){r||(A(e),A(u),r=!0)},o(c){U(e),U(u),r=!1},d(c){c&&(P(i),P(o)),a[n].d(c),u&&u.d(c)}}}function Ps(s,n,e){let i,o,r,t,a,f,u,c,w,I,k,E,C,T,F,y,M,p;je(s,we,l=>e(7,p=l));let{id:g}=n;var b,d,j=!1,K="";function oe(){return{isAnswered:!!T,answerContext:k.answers.reduce((L,Y)=>(L[Y.id]={isCorrectAnswer:Y.id===k.correct_answer_id,isSubmittedAnswer:w?Y.id===w.answer_id:!1,isSelectedAnswer:w?Y.id===w.answer_id:!1},L),{})}}var H=-1;Ee(()=>{axios.get("/api/sessions/"+g).then(function(l){e(0,d=l.data)}).catch(function(l){alert(l)})});function X(){return axios.get("/api/questions/"+k.id).then(function(l){var L=d.deck.questions.findIndex(de=>de.id===k.id),Y=l.data;e(0,d.deck.questions[L]=Y,d),fe(Y)}).catch(function(l){alert(l)})}function fe(l){if(l.type!=="card"){var L=d.session.answer_choices.findIndex(Y=>Y.question_id===l.id);L!==-1&&e(0,d.session.answer_choices[L].is_correct=d.session.answer_choices[L].answer_id===l.correct_answer_id,d)}}var x;function ce(){x&&x.cancel(),x=es(()=>{axios.put("/api/sessions/"+d.session.id,d.session).then(function(l){}).catch(function(l){alert(l)})},1e3,{maxWait:2e3}),x()}function be(l){if(l&&l!==-1?e(8,b.answerContext[l].isSelectedAnswer=!0,b):e(8,b.isAnswered=!0,b),T&&l&&l===k.correct_answer_id){e(8,b.isAnswered=!0,b);return}else if(T)return;var L=!1;k.type==="card"?(L=!!l,l===-1&&(l=null)):L=k.correct_answer_id===l,(L||i||!a)&&e(8,b.isAnswered=!0,b),l&&l!==-1&&(e(8,b.answerContext[l].isSubmittedAnswer=!0,b),e(8,b.answerContext[l].isCorrectAnswer=L,b));var Y={question_id:C,answer_id:l,is_correct:L,help_used:j};axios.post("/api/sessions/"+g+"/answerchoices",Y).then(function(de){e(0,d.session.answer_choices=[...d.session.answer_choices,de.data],d)}).catch(function(de){alert(de)})}function G(){T&&(e(1,w=d.session.answer_choices.find(l=>l.question_id===C)),w&&axios.delete("/api/sessions/"+g+"/answerchoices/"+w.id).then(function(l){e(0,d.session.answer_choices=[...d.session.answer_choices.filter(L=>L.question_id!==C)],d),xe().then(()=>{e(8,b=oe())})}).catch(function(l){alert(l)}))}const ae=()=>{Ce(we,p.session_show_sidebar=!p.session_show_sidebar,p)},he=()=>{Ce(we,p.session_shuffle_answers=!p.session_shuffle_answers,p)},N=()=>{Ce(we,p.session_exam_mode=!p.session_exam_mode,p)};function V(l){F=l,e(2,F),e(0,d),e(24,c),e(23,I)}function z(l){F=l,e(2,F),e(0,d),e(24,c),e(23,I)}function ke(l){d=l,e(0,d)}function qe(l){i=l,e(11,i),e(3,E),e(7,p),e(0,d),e(24,c),e(23,I)}function ve(l){d=l,e(0,d)}function re(l){s.$$.not_equal(d.session.current_question_id,l)&&(d.session.current_question_id=l,e(0,d))}function B(l){b=l,e(8,b),e(22,C),e(0,d)}function _(l){k=l,e(12,k),e(0,d)}function v(l){b=l,e(8,b),e(22,C),e(0,d)}function ue(l){j=l,e(9,j)}function De(l){w=l,e(1,w),e(0,d),e(22,C)}function Oe(l){i=l,e(11,i),e(3,E),e(7,p),e(0,d),e(24,c),e(23,I)}function Re(l){t=l,e(4,t),e(7,p)}function We(l){f=l,e(16,f),e(7,p)}function Je(l){s.$$.not_equal(k.id,l)&&(k.id=l,e(12,k),e(0,d))}function Ke(l){K=l,e(10,K),e(2,F),e(21,H),e(0,d),e(24,c),e(23,I)}return s.$$set=l=>{"id"in l&&e(20,g=l.id)},s.$$.update=()=>{s.$$.dirty[0]&1&&e(24,c=d?d.deck.questions.filter(l=>!l.is_invalid):null),s.$$.dirty[0]&16777217&&e(23,I=d?d.session.answer_choices.filter(l=>c.some(({id:L})=>L===l.question_id)):null),s.$$.dirty[0]&25165825&&e(3,E=d?c.length===I.length:!1),s.$$.dirty[0]&136&&e(11,i=E?!1:p.session_exam_mode),s.$$.dirty[0]&128&&e(6,o=p.session_show_sidebar),s.$$.dirty[0]&128&&e(5,r=p.session_exam_mode),s.$$.dirty[0]&128&&e(4,t=p.session_shuffle_answers),s.$$.dirty[0]&128&&(a=p.session_multiple_answer_tries),s.$$.dirty[0]&128&&e(16,f=p.session_show_answer_stats),s.$$.dirty[0]&128&&e(15,u=p.session_show_progress_bar),s.$$.dirty[0]&64&&axios.put("/api/users/me/settings",{session_show_sidebar:o}).then(function(l){}).catch(function(l){alert(l)}),s.$$.dirty[0]&32&&axios.put("/api/users/me/settings",{session_exam_mode:r}).then(function(l){}).catch(function(l){alert(l)}),s.$$.dirty[0]&16&&axios.put("/api/users/me/settings",{session_shuffle_answers:t}).then(function(l){}).catch(function(l){alert(l)}),s.$$.dirty[0]&1&&e(22,C=d?d.session.current_question_id:null),s.$$.dirty[0]&4194305&&e(1,w=d?d.session.answer_choices.find(l=>l.question_id===C):null),s.$$.dirty[0]&1&&e(12,k=d?d.deck.questions.find(l=>l.id===d.session.current_question_id):null),s.$$.dirty[0]&8&&E&&e(11,i=!1),s.$$.dirty[0]&4194304&&ce(),s.$$.dirty[0]&3&&(T=d?!!w:!1),s.$$.dirty[0]&4194304&&C&&e(8,b=oe()),s.$$.dirty[0]&25165825&&e(2,F=d?os(c.length,I):null),s.$$.dirty[0]&1&&e(14,y=d?d.deck.questions.length:0),s.$$.dirty[0]&1&&e(13,M=d?d.deck.questions.findIndex(l=>l.id==d.session.current_question_id)+1:null),s.$$.dirty[0]&2097156&&(()=>{if(F){var l=F.correct;if(l<60){e(21,H=l);return}if(H===-1){e(21,H=l);return}H<60&&(e(21,H=l),axios.get("/api/magic-gif").then(function(L){e(10,K="magic-gifs/"+L.data.id)}).catch(function(L){}))}})()},[d,w,F,E,t,r,o,p,b,j,K,i,k,M,y,u,f,X,be,G,g,H,C,I,c,ae,he,N,V,z,ke,qe,ve,re,B,_,v,ue,De,Oe,Re,We,Je,Ke]}class Ms extends ge{constructor(n){super(),pe(this,n,Ps,Qs,me,{id:20},null,[-1,-1])}}const Be=document.getElementById("SessionView");new Ms({target:Be,props:{id:Be.dataset.sessionId}});
