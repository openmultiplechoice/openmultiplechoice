import{d as Y,p as j,g as e,s as O,a as E,f as C,b as M,c as f,e as _,h as K,i as l,t as y,u as T,j as ct,k as R,l as P,m as lt,n as X,o as ut}from"./render-wDF33Nt9.js";import{o as vt}from"./index-client-B5oBGgzC.js";import{i as A}from"./if-bo9VvZzx.js";import{s as Z,a as H}from"./attributes-B-utWOYn.js";import{k as mt,Q as _t}from"./QuestionForm-Dn5OO1fV.js";import{h as ft}from"./html-D-buyqeJ.js";import{s as U}from"./class-BfJg_ovI.js";import{b as pt}from"./input-14QhjNA4.js";import{b as bt}from"./this-D9aRRuzb.js";import{p as V,e as $,i as tt}from"./event-modifiers-C_oJkXcz.js";import{p as it}from"./props-BKJLc1dz.js";import{r as ht}from"./legacy-client-BEOB7oQD.js";import{d as gt,p as et,h as at}from"./hotkeys.esm-BpJec7O2.js";import"./style-BtOSwUPa.js";import"./select-B10t5kDh.js";import"./lodash-d8dSvcKh.js";import"./_commonjsHelpers-CE1G-McA.js";var xt=C('<form action="#" class="mt-3"><div class="mb-3"><label class="form-label">Case text</label> <input type="hidden"/> <trix-editor></trix-editor> <!></div></form>',2),qt=C(`<div class="alert alert-light mt-5" role="alert"><p><strong>Delete case?</strong> A case can only be deleted if it's not associated with any question.</p> <button type="button" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i> Delete case</button></div>`),kt=C("<!> <!>",1);function yt(L,o){j(o,!0);let t=it(o,"kase",15),p=O(void 0),x=O("");ht(()=>{e(p)&&I(e(p))});function I(n){n.addEventListener("trix-change",function(){t(t().text=document.getElementById("caseText"+t().id).value,!0),E(x,'<p class="text-end">Saving ...</p>'),S()}),n.toolbarElement.style.display="none",n.addEventListener("trix-focus",function(s){s.target.toolbarElement.style.display="block"}),n.addEventListener("trix-blur",function(s){s.target.toolbarElement.contains(document.activeElement)||(s.target.toolbarElement.style.display="none")})}var h;function S(){h&&h.cancel(),h=gt(()=>{axios.put("/api/cases/"+t().id,t()).then(function(n){E(x,'<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(n){E(x,'<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(n)})},500,{maxWait:2e3}),h()}var u=kt(),q=M(u);mt(q,()=>t().id,n=>{var s=xt(),g=l(s),d=l(g),c=f(d,2),v=f(c,2);y(()=>Z(v,"id",`editor-case${t().id??""}`)),U(v,1,"bg-light trix-content"),y(()=>Z(v,"input",`caseText${t().id??""}`)),bt(v,k=>E(p,k),()=>e(p));var w=f(v,2);ft(w,()=>e(x)),y(()=>{H(d,"for",`caseText${t().id??""}`),H(c,"id",`caseText${t().id??""}`)}),pt(c,()=>t().text,k=>t(t().text=k,!0)),_(n,s)});var Q=f(q,2);{var F=n=>{var s=qt(),g=f(l(s),2),d=T(()=>V(()=>{confirm("Are you sure you want to delete this case?")&&o.handleCaseRemove(t().id)}));g.__click=function(...c){e(d)?.apply(this,c)},y(c=>g.disabled=c,[()=>o.cases.some(c=>c.questions?c.questions.some(v=>v.case_id===t().id):!1)]),_(n,s)};A(Q,n=>{o.handleCaseRemove&&n(F)})}_(L,u),K()}Y(["click"]);var wt=C('<button type="button" aria-current="true"><small><!></small></button>'),Et=C('<button type="button" aria-current="true"><small><i class="bi bi-clipboard2-pulse"></i> <!></small></button>'),Ct=C('<div class="list-group"></div> <div class="list-group mt-2"></div>',1),It=C("<p>Loading ...</p>");function Qt(L,o){j(o,!0);let t=it(o,"data",15),p=T(()=>t()?t().questions.find(u=>u.id===t().current_question_id):null);var x=ct(),I=M(x);{var h=u=>{var q=Ct(),Q=M(q);$(Q,21,()=>t().questions,tt,(n,s,g)=>{var d=wt(),c=T(()=>V(()=>{t(t().current_question_id=e(s).id,!0),t(t().current_case_id=null,!0)}));d.__click=function(...r){e(c)?.apply(this,r)};let v;var w=l(d),k=l(w);{var N=r=>{var m=R();y(B=>P(m,B),[()=>et.sanitize(e(s).text).replace(/<\/?[^>]+(>|$)/g,"")]),_(r,m)},D=r=>{var m=R();m.nodeValue=`Question Nr. ${g+1}`,_(r,m)};A(k,r=>{e(s).text?r(N):r(D,!1)})}y(()=>v=U(d,1,"list-group-item list-group-item-action text-truncate",null,v,{"list-group-item-dark":e(s).id===t().current_question_id,"list-group-item-light":e(s).id!==t().current_question_id,"bg-warning-subtle":t().current_case_id&&e(s).case_id===t().current_case_id})),_(n,d)});var F=f(Q,2);$(F,21,()=>t().cases,tt,(n,s,g)=>{var d=Et(),c=T(()=>V(()=>{t(t().current_case_id=e(s).id,!0),t(t().current_question_id=null,!0)}));d.__click=function(...r){e(c)?.apply(this,r)};let v;var w=l(d),k=f(l(w),2);{var N=r=>{var m=R();y(B=>P(m,B),[()=>et.sanitize(e(s).text).replace(/<\/?[^>]+(>|$)/g,"")]),_(r,m)},D=r=>{var m=R();m.nodeValue=`Case Nr. ${g+1}`,_(r,m)};A(k,r=>{e(s).text?r(N):r(D,!1)})}y(()=>v=U(d,1,"list-group-item list-group-item-action text-truncate",null,v,{"list-group-item-dark":e(s).id===t().current_case_id,"list-group-item-info":e(s).id!==t().current_case_id&&!(e(p)&&e(p).case_id===e(s).id),"list-group-item-warning":e(p)&&e(p).case_id===e(s).id})),_(n,d)}),_(u,q)},S=u=>{var q=It();_(u,q)};A(I,u=>{t()?u(h):u(S,!1)})}_(L,x),K()}Y(["click"]);var Dt=C('<div class="row"><div class="col"><h4 class="text-truncate"><a class="text-reset text-decoration-none"> </a></h4></div></div> <div class="sticky-top bg-white mb-3" style="z-index: 20;"><div class="row"><div class="col d-grid d-sm-block gap-2 py-3"><button type="button" class="btn btn-sm btn-primary" title="Add a new MC question (Shortcut: Alt+Q)">Add MC question</button> <button type="button" class="btn btn-sm btn-primary">Add card question</button> <button type="button" class="btn btn-sm btn-light"><i class="bi bi-clipboard2-pulse"></i> Add case</button></div></div> <div class="row"><div class="col"><div class="border-dark" style="border-bottom: dotted; border-width: 1px;"></div></div></div></div> <div class="row"><div class="col-md-4"><!></div> <div class="col-md-8"><!> <!></div></div>',1);function Tt(L,o){j(o,!0);let t=O(lt({cases:[],questions:[]})),p=0;const x=1e3;let I=T(()=>e(t)?e(t).questions.find(i=>i.id===e(t).current_question_id):null),h=T(()=>e(t)?e(t).cases.find(i=>i.id===e(t).current_case_id):null);vt(()=>{at.filter=function(){return!0},at("alt+Q",function(i){i.preventDefault();const a=Date.now();a-p>x&&(u("mc"),p=a)}),axios.get("/api/decks/"+o.id).then(function(i){E(t,i.data,!0);const a=S();a&&e(t).questions.some(b=>b.id===parseInt(a))?e(t).current_question_id=parseInt(a):e(t).questions.length>0&&(e(t).current_question_id=e(t).questions[e(t).questions.length-1].id)}).catch(function(i){alert(i)})});function S(){return new URLSearchParams(window.location.search).get("question_id")}function u(i){var a={id:null,text:"",type:i||"mc",correct_answer_id:null,images:[],answers:[]};axios.post("/api/decks/"+o.id+"/questions",a).then(function(b){a.id=b.data.id,e(t).questions=[...e(t).questions,a],e(t).current_question_id=a.id,X().then(()=>{const J=document.getElementById("editor-questionText");J&&J.focus()})}).catch(function(b){alert(b)}),window.scrollTo({top:0,behavior:"smooth"})}function q(){var i={deck_id:o.id};axios.post("/api/cases",i).then(function(a){e(t).cases=[...e(t).cases,a.data],e(t).current_case_id=a.data.id,e(t).current_question_id=null,X().then(()=>{const b=document.getElementById("editor-case"+a.data.id);b&&b.focus()})}).catch(function(a){alert(a)}),window.scrollTo({top:0,behavior:"smooth"})}function Q(i){axios.delete("/api/decks/"+o.id+"/questions/"+i).then(function(a){e(t).questions=e(t).questions.filter(b=>b.id!==i),e(t).questions.length>0&&(e(t).current_question_id=e(t).questions[e(t).questions.length-1].id)}).catch(function(a){alert(a)})}function F(i){axios.delete("/api/decks/"+o.id+"/cases/"+i).then(function(a){e(t).cases=e(t).cases.filter(b=>b.id!==i),e(t).questions.length>0&&(e(t).current_question_id=e(t).questions[e(t).questions.length-1].id)}).catch(function(a){alert(a)})}var n=Dt(),s=M(n),g=l(s),d=l(g),c=l(d),v=l(c),w=f(s,2),k=l(w),N=l(k),D=l(N);D.__click=()=>{u("mc")};var r=f(D,2);r.__click=()=>{u("card")};var m=f(r,2);m.__click=q;var B=f(w,2),W=l(B),st=l(W);Qt(st,{get data(){return e(t)},set data(i){E(t,i,!0)}});var nt=f(W,2),G=l(nt);{var rt=i=>{_t(i,{showConfigEditor:"true",showCaseSelector:"true",handleQuestionRemove:Q,get question(){return e(I)},set question(a){E(I,a)},get cases(){return e(t).cases},set cases(a){e(t).cases=a}})};A(G,i=>{e(I)&&i(rt)})}var ot=f(G,2);{var dt=i=>{yt(i,{handleCaseRemove:F,get kase(){return e(h)},set kase(a){E(h,a)},get cases(){return e(t).cases},set cases(a){e(t).cases=a}})};A(ot,i=>{e(h)&&i(dt)})}y(()=>{H(d,"title",o.name),H(c,"href",`/decks/${o.id??""}`),P(v,o.name)}),_(L,n),K()}Y(["click"]);const z=document.getElementById("DeckForm");ut(Tt,{target:z,props:{id:z.dataset.deckId,name:z.dataset.deckName,moduleId:z.dataset.moduleId}});
