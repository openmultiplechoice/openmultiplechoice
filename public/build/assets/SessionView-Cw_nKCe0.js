import{p as ne,a as d,s as z,k as Oe,b as se,i as V,g as e,e as h,h as ie,f as C,t as L,d as re,r as s,j as g,c as Q,m as ve,u as _,l as ze,x as dt,w as E,o as ut,q as vt}from"./if-BKKSZk4S.js";import{o as Ae}from"./index-client-D4bTxURC.js";import{e as He,i as Le,a as Qe,p as $}from"./event-modifiers-Dk_SUsNJ.js";import{s as H}from"./class-BfJg_ovI.js";import{p as x,a as ft,s as _t,b as ye}from"./props-CpDAvbNA.js";import{r as N}from"./legacy-client-DxtlDGnO.js";import{p as gt,d as mt}from"./purify.es-Dnvgf1Dd.js";import{s as Ee}from"./style-BtOSwUPa.js";import{M as ht}from"./Messages-ZzJ26aH4.js";import{b as pt}from"./this-Dh2OgrC7.js";import{C as bt}from"./auto-g150VQ4A.js";import{S as wt}from"./SessionProgressBar-DwTJ0nDA.js";import{h as xt}from"./html-KMz9BxYn.js";import{h as Se}from"./QuestionForm-DKpxFnZj.js";import{S as kt}from"./SessionQuestionView-DW0Cmet1.js";import{s as Ct}from"./StatsHelper-B91isISU.js";import{U as ue}from"./UserSettingsStore-BJuQnOZD.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./parseISO-BGu1X6cY.js";import"./formatDistance-C5pjvq49.js";import"./input-5B9WpH3T.js";import"./select-CJpiZo3f.js";import"./lodash-DjGC5Q8M.js";var qt=C('<div class="confetti svelte-rtt661"></div>'),yt=C("<div></div>");function St(B,i){ne(i,!0);const r=x(i,"size",3,10),q=x(i,"x",19,()=>[-.5,.5]),M=x(i,"y",19,()=>[.25,1]),a=x(i,"duration",3,2e3),n=x(i,"infinite",3,!1),f=x(i,"delay",19,()=>[0,50]),v=x(i,"colorRange",19,()=>[0,360]),S=x(i,"colorArray",19,()=>[]),U=x(i,"amount",3,50),p=x(i,"iterationCount",3,1),k=x(i,"fallDistance",3,"100px"),o=x(i,"rounded",3,!1),c=x(i,"cone",3,!1),b=x(i,"noGravity",3,!1),m=x(i,"xSpread",3,.15),P=x(i,"destroyOnComplete",3,!0),D=x(i,"disableForReducedMotion",3,!1);let y=z(!1);Ae(()=>{!P()||n()||typeof p()=="string"||setTimeout(()=>d(y,!0),(a()+f()[1])*p())});function F(T,G){return Math.random()*(G-T)+T}function w(){return S().length?S()[Math.round(Math.random()*(S().length-1))]:`hsl(${Math.round(F(v()[0],v()[1]))}, 75%, 50%)`}var W=Oe(),O=se(W);{var X=T=>{var G=yt();let ee;He(G,21,()=>({length:U()}),Le,(te,j)=>{var ae=qt();L((fe,oe,Y,_e,ge,me,ce,le,he,pe,de)=>Ee(ae,`
        --color: ${fe??""};
        --skew: ${oe??""}deg,${Y??""}deg;
        --rotation-xyz: ${_e??""}, ${ge??""}, ${me??""};
        --rotation-deg: ${ce??""}deg;
        --translate-y-multiplier: ${le??""};
        --translate-x-multiplier: ${he??""};
        --scale: ${pe??""};
        --transition-delay: ${de??""}ms;
        --transition-duration: ${n()?`calc(${a()}ms * var(--scale))`:`${a()}ms`};`),[w,()=>F(-45,45),()=>F(-45,45),()=>F(-10,10),()=>F(-10,10),()=>F(-10,10),()=>F(0,360),()=>F(M()[0],M()[1]),()=>F(q()[0],q()[1]),()=>.1*F(2,10),()=>F(f()[0],f()[1])]),h(te,ae)}),L(te=>{ee=H(G,1,"confetti-holder svelte-rtt661",null,ee,te),Ee(G,`
    --fall-distance: ${k()??""};
    --size: ${r()??""}px;
    --x-spread: ${1-m()};
    --transition-iteration-count: ${(n()?"infinite":p())??""};`)},[()=>({rounded:o(),cone:c(),"no-gravity":b(),"reduced-motion":D()})]),h(T,G)};V(O,T=>{e(y)||T(X)})}h(B,W),ie()}function At(B,i){d(i,!s(i))}var Qt=C('<div class="img-fullscreen d-flex justify-content-center align-items-center svelte-1ibqgr8"><img class="img-fluid svelte-1ibqgr8" alt="Magic GIF"/></div>');function Pt(B,i){let r=x(i,"magicGIFPath",3,"");var q=z(!0),M=Oe(),a=se(M);{var n=f=>{var v=Qt();v.__click=[At,q];var S=g(v);L(()=>Qe(S,"src",`/${r()??""}`)),h(f,v)};V(a,f=>{r()&&s(q)&&f(n)})}h(B,M)}re(["click"]);var It=C('<button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> Repeat incorrect</button>'),Mt=C('<div class="row mb-5"><div class="col-md"><canvas></canvas></div> <div class="col-md"><p class="mt-3 text-dark"><span class="fs-4 font-monospace"> </span> correct</p> <div class="d-grid gap-2"><a href="/sessions/create" class="btn btn-sm btn-primary"><i class="bi bi-rocket-takeoff"></i> New session</a> <!> <a href="/" class="btn btn-sm btn-outline-secondary">Home</a></div></div></div>');function Ft(B,i){ne(i,!0);let r=z(void 0),q=z(void 0);N(()=>{e(r)&&(()=>{if(e(q))return;const b={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect"],datasets:[{label:"%",data:[i.progressPercentage.correct,i.progressPercentage.correctWithHelp,i.progressPercentage.incorrect],backgroundColor:["#198754","#ffc107","#dc3545"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};e(q)&&e(q).destroy();var m=e(r).getContext("2d");d(q,new bt(m,b),!0)})()});function M(b){axios.post("/api/sessions/"+b+"/newfromincorrect").then(function(m){window.location.href="/sessions/"+m.data.id}).catch(function(m){alert(m)})}var a=Mt(),n=g(a),f=g(n);pt(f,b=>d(r,b),()=>e(r));var v=Q(n,2),S=g(v),U=g(S),p=g(U),k=Q(S,2),o=Q(g(k),2);{var c=b=>{var m=It(),P=_(()=>$(()=>M(i.sessionId)));m.__click=function(...D){e(P)?.apply(this,D)},h(b,m)};V(o,b=>{i.progressPercentage.incorrect>0&&b(c)})}L(()=>ve(p,`${i.progressPercentage.correct??""}%`)),h(B,a),ie()}re(["click"]);var Gt=(B,i,r)=>i(i().session.current_question_id=e(r).id,!0),Vt=C("<li><small><!> <!></small></li>"),Bt=C('<li class="svelte-ns1rbt">Loading ...</li>'),Ut=C('<div class="overflow-scroll" style="max-height: 85vh;"><ul class="list-group"></ul></div>');function Dt(B,i){ne(i,!0);let r=x(i,"data",15),q=_(()=>r().session.current_question_id);N(()=>{e(q),(()=>{var f=document.getElementById("question"+e(q));f&&f.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})})()});let M=_(()=>function(f){var v=r().session.answer_choices.find(S=>S.question_id===f.id);return v?i.examMode?'<span class="text-dark fw-bold">&check;</span>':v.is_correct?v.help_used?'<span class="text-warning-dark fw-bold">&check;</span>':'<span class="text-success-dark fw-bold">&check;</span>':'<span class="text-danger-dark fw-bold">&cross;</span>':'<span class="text-dark fw-bold">&rightarrow;</span>'});var a=Ut(),n=g(a);He(n,21,()=>r().deck.questions,Le,(f,v,S)=>{var U=Vt();U.__click=[Gt,r,v];var p=g(U),k=g(p);xt(k,()=>e(M)(e(v)));var o=Q(k,2);{var c=m=>{var P=ze();L(D=>ve(P,D),[()=>gt.sanitize(e(v).text).replace(/<\/?[^>]+(>|$)/g,"")]),h(m,P)},b=m=>{var P=ze();P.nodeValue=`Question Nr. ${S+1}`,h(m,P)};V(o,m=>{e(v).text?m(c):m(b,!1)})}L(()=>{H(U,1,`list-group-item list-group-item-action text-truncate ${e(v).id===r().session.current_question_id?"list-group-item-dark":"list-group-item-light"}`,"svelte-ns1rbt"),Qe(U,"id",`question${e(v).id??""}`)}),h(f,U)},f=>{var v=Bt();h(f,v)}),h(B,a),ie()}re(["click"]);var Rt=C('<div class="col-6"><button class="btn btn-sm btn-light w-100"><span class="fw-bold">&leftarrow;</span> Previous</button></div>'),Tt=C('<div class="col-6"></div>'),zt=C('<div class="col-6"><button>Next <span class="fw-bold">&rightarrow;</span></button></div>'),Et=C('<div class="col-6"></div>'),Nt=C('<div class="row mb-3 pt-1 pb-1 sticky-top bg-white"><!> <!></div>');function Ot(B,i){ne(i,!0);let r=x(i,"data",15);Ae(()=>{Se("left","questions",function(o,c){M()}),Se("right","questions",function(o,c){a()}),Se.setScope("questions")});function q(o){return r().deck.questions.findIndex(c=>c.id===o)}function M(){var o=q(i.currentQuestionId),c=r().deck.questions[o-1];c&&r(r().session.current_question_id=c.id,!0)}function a(){var o=q(i.currentQuestionId),c=r().deck.questions[o+1];c&&r(r().session.current_question_id=c.id,!0)}var n=Nt(),f=g(n);{var v=o=>{var c=Rt(),b=g(c),m=_(()=>$(M));b.__click=function(...P){e(m)?.apply(this,P)},h(o,c)},S=o=>{var c=Tt();h(o,c)};V(f,o=>{r().session.current_question_id&&r().session.current_question_id!=r().deck.questions[0].id?o(v):o(S,!1)})}var U=Q(f,2);{var p=o=>{var c=zt(),b=g(c),m=_(()=>$(a));b.__click=function(...D){e(m)?.apply(this,D)};let P;L(D=>P=H(b,1,"btn btn-sm w-100",null,P,D),[()=>({"btn-warning":i.currentQuestionContext.isAnswered,"btn-light":!i.currentQuestionContext.isAnswered})]),h(o,c)},k=o=>{var c=Et();h(o,c)};V(U,o=>{r().session.current_question_id!=r().deck.questions[r().deck.questions.length-1].id?o(p):o(k,!1)})}h(B,n),ie()}re(["click"]);var Ht=C('<div class="col-lg-3 d-none d-lg-block"><!></div>'),Lt=C("<!> <!>",1),Wt=C('<div class="row"><div class="col mb-1"><p class="text-truncate"><button title="Toggle sidebar"><i class="bi bi-layout-sidebar"></i></button> <button title="Toggle answer shuffling"><i class="bi bi-shuffle"></i></button> <button title="Toggle exam mode"><i class="bi bi-exclamation-square"></i></button> <span> </span> <a class="text-reset text-decoration-none"><strong> </strong></a></p></div></div> <div class="row"><div class="col mb-1"><!> <!></div></div> <div class="row mt-3"><!> <div><!> <!></div></div>',1),jt=C("<p>Loading ...</p>"),Jt=C(`<div style="
            position: fixed;
            top: -50px;
            left: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            overflow: hidden;
            pointer-events: none;"><!></div>`),Kt=C("<!> <!> <!>",1);function Xt(B,i){ne(i,!0);const r=()=>_t(ue,"$UserSettings",q),[q,M]=ft();var a=z(void 0),n=z(void 0),f=z(!1),v=z(""),S=z(0);const U=document.getElementById("appconfig").dataset;let p=_(()=>e(W)?!1:r().session_exam_mode),k=_(()=>r().session_show_sidebar),o=_(()=>r().session_exam_mode),c=_(()=>r().session_shuffle_answers),b=_(()=>r().session_multiple_answer_tries),m=_(()=>r().session_show_answer_stats),P=_(()=>r().session_show_progress_bar);N(()=>{e(k),axios.put("/api/users/me/settings",{session_show_sidebar:e(k)}).then(function(t){}).catch(function(t){alert(t)})}),N(()=>{e(o),axios.put("/api/users/me/settings",{session_exam_mode:e(o)}).then(function(t){}).catch(function(t){alert(t)})}),N(()=>{e(c),axios.put("/api/users/me/settings",{session_shuffle_answers:e(c)}).then(function(t){}).catch(function(t){alert(t)})});let D=_(()=>s(n)?s(n).deck.questions.filter(t=>!t.is_invalid):null),y=_(()=>s(n)?s(n).session.answer_choices.find(t=>t.question_id===e(O)):null),F=_(()=>s(n)?s(n).session.answer_choices.filter(t=>e(D).some(({id:l})=>l===t.question_id)):null),w=_(()=>s(n)?s(n).deck.questions.find(t=>t.id===s(n).session.current_question_id):null),W=_(()=>s(n)?e(D).length===e(F).length:!1);N(()=>{e(W)&&d(p,!1)});let O=_(()=>s(n)?s(n).session.current_question_id:null);N(()=>{e(O),_e()});let X=_(()=>s(n)?!!e(y):!1);N(()=>{e(O)&&d(a,E(()=>T()),!0)});function T(){return{isAnswered:!!e(X),answerContext:e(w).answers.reduce((l,I)=>(l[I.id]={isCorrectAnswer:I.id===e(w).correct_answer_id,isSubmittedAnswer:e(y)?I.id===e(y).answer_id:!1,isSelectedAnswer:e(y)?I.id===e(y).answer_id:!1},l),{})}}let G=_(()=>s(n)?Ct(e(D).length,e(F)):null),ee=_(()=>s(n)?s(n).deck.questions.length:0),te=_(()=>s(n)?s(n).deck.questions.findIndex(t=>t.id==s(n).session.current_question_id)+1:null);var j=z(-1);N(()=>{e(G),(()=>{if(e(G)){var t=e(G).correct;if(t<60){d(j,t,!0);return}if(s(j)===-1){d(j,t,!0);return}s(j)<60&&(d(j,t,!0),axios.get("/api/magic-gif").then(function(l){d(v,"magic-gifs/"+l.data.id)}).catch(function(l){})),U.magic==="1"&&t===100&&s(j)<100&&e(ee)>=10&&s(n).session.parent_session_id===null&&d(S,1)}})()}),Ae(()=>{axios.get("/api/sessions/"+i.id).then(function(t){d(n,t.data,!0)}).catch(function(t){alert(t)})});function ae(){return axios.get("/api/questions/"+e(w).id).then(function(t){var l=s(n).deck.questions.findIndex(J=>J.id===e(w).id),I=t.data;s(n).deck.questions[l]=I,oe(I)}).catch(function(t){alert(t)})}dt(()=>{e(w)&&e(w).correct_answer_id&&(E(()=>fe()),d(a,E(()=>T()),!0))});function fe(){e(w)&&oe(e(w))}function oe(t){if(t.type!=="card"){var l=s(n).session.answer_choices.findIndex(I=>I.question_id===t.id);l!==-1&&(s(n).session.answer_choices[l].is_correct=s(n).session.answer_choices[l].answer_id===t.correct_answer_id)}}var Y;function _e(){Y&&Y.cancel(),Y=mt(()=>{axios.put("/api/sessions/"+s(n).session.id,s(n).session).then(function(t){}).catch(function(t){alert(t)})},1e3,{maxWait:2e3}),Y()}function ge(t){if(t&&t!==-1?s(a).answerContext[t].isSelectedAnswer=!0:s(a).isAnswered=!0,e(X)&&t&&t===e(w).correct_answer_id){s(a).isAnswered=!0;return}else if(e(X))return;var l=!1;e(w).type==="card"?(l=!!t,t===-1&&(t=null)):l=e(w).correct_answer_id===t,(l||e(p)||!e(b))&&(s(a).isAnswered=!0),t&&t!==-1&&(s(a).answerContext[t].isSubmittedAnswer=!0,s(a).answerContext[t].isCorrectAnswer=l);var I={question_id:e(O),answer_id:t,is_correct:l,help_used:s(f)};axios.post("/api/sessions/"+i.id+"/answerchoices",I).then(function(J){s(n).session.answer_choices=[...s(n).session.answer_choices,J.data]}).catch(function(J){alert(J)})}function me(){e(X)&&(d(y,s(n).session.answer_choices.find(t=>t.question_id===e(O))),e(y)&&axios.delete("/api/sessions/"+i.id+"/answerchoices/"+e(y).id).then(function(t){s(n).session.answer_choices=[...s(n).session.answer_choices.filter(l=>l.question_id!==e(O))],ut().then(()=>{d(a,T(),!0)})}).catch(function(t){alert(t)}))}var ce=Kt(),le=se(ce);{var he=t=>{var l=Wt(),I=se(l),J=g(I),Ke=g(J),be=g(Ke);let Pe;var Xe=_(()=>$(()=>{ye(ue,E(r).session_show_sidebar=!r().session_show_sidebar,E(r))}));be.__click=function(...u){e(Xe)?.apply(this,u)};var we=Q(be,2);let Ie;var Ye=_(()=>$(()=>{ye(ue,E(r).session_shuffle_answers=!r().session_shuffle_answers,E(r))}));we.__click=function(...u){e(Ye)?.apply(this,u)};var xe=Q(we,2);let Me;var Ze=_(()=>$(()=>{ye(ue,E(r).session_exam_mode=!r().session_exam_mode,E(r))}));xe.__click=function(...u){e(Ze)?.apply(this,u)};var ke=Q(xe,2);let Fe;var $e=g(ke),Ge=Q(ke,2),et=g(Ge),tt=g(et),Ve=Q(I,2),st=g(Ve),Be=g(st);{var nt=u=>{wt(u,{get progressPercentage(){return e(G)},set progressPercentage(R){d(G,R)}})};V(Be,u=>{!e(p)&&e(P)&&(!e(W)||!s(a).isAnswered)&&u(nt)})}var it=Q(Be,2);{var rt=u=>{Ft(u,{get sessionId(){return s(n).session.id},get progressPercentage(){return e(G)},set progressPercentage(R){d(G,R)}})};V(it,u=>{e(W)&&s(a).isAnswered&&u(rt)})}var at=Q(Ve,2),Ue=g(at);{var ot=u=>{var R=Ht(),Z=g(R);Dt(Z,{get data(){return s(n)},set data(K){d(n,K,!0)},get examMode(){return e(p)},set examMode(K){d(p,K)}}),h(u,R)};V(Ue,u=>{e(k)&&u(ot)})}var De=Q(Ue,2);let Re;var Te=g(De);Ot(Te,{get data(){return s(n)},set data(u){d(n,u,!0)},get currentQuestionId(){return s(n).session.current_question_id},set currentQuestionId(u){s(n).session.current_question_id=u},get currentQuestionContext(){return s(a)},set currentQuestionContext(u){d(a,u,!0)}});var ct=Q(Te,2);{var lt=u=>{var R=Lt(),Z=se(R);kt(Z,{get deckId(){return s(n).deck.id},submitAnswer:ge,deleteAnswer:me,updateCurrentQuestionData:ae,get question(){return e(w)},set question(A){d(w,A)},get questionContext(){return s(a)},set questionContext(A){d(a,A,!0)},get helpUsed(){return s(f)},set helpUsed(A){d(f,A,!0)},get answerChoice(){return e(y)},set answerChoice(A){d(y,A)},get examMode(){return e(p)},set examMode(A){d(p,A)},get settingsShuffleAnswers(){return e(c)},set settingsShuffleAnswers(A){d(c,A)},get settingsShowAnswerStats(){return e(m)},set settingsShowAnswerStats(A){d(m,A)}});var K=Q(Z,2);{var Ce=A=>{ht(A,{get questionId(){return e(w).id},set questionId(qe){e(w).id=qe},get questionContext(){return s(a)},set questionContext(qe){d(a,qe,!0)}})};V(K,A=>{e(p)||A(Ce)})}h(u,R)};V(ct,u=>{e(w)&&u(lt)})}L((u,R,Z,K,Ce)=>{Pe=H(be,1,"btn btn-sm d-none d-sm-none d-md-none d-lg-inline",null,Pe,u),Ie=H(we,1,"btn btn-sm",null,Ie,R),Me=H(xe,1,"btn btn-sm",null,Me,Z),Fe=H(ke,1,"ms-1 float-end fw-bold font-monospace badge",null,Fe,K),ve($e,`${e(te)??""}/${e(ee)??""}`),Qe(Ge,"href",`/sessions/${s(n).session.id??""}/edit`),ve(tt,s(n).session.name),Re=H(De,1,"col-md-12 col-xl-8 col-xxl-6",null,Re,Ce)},[()=>({"bg-light":!e(k),"bg-dark-subtle":e(k)}),()=>({"bg-light":!e(c),"bg-dark-subtle":e(c)}),()=>({"bg-light":!e(o),"bg-dark-subtle":e(o)}),()=>({"text-bg-light":!e(y)||e(p),"bg-success":!e(p)&&!e(w).is_invalid&&e(y)&&e(y).is_correct,"bg-danger":!e(p)&&!e(w).is_invalid&&e(y)&&!e(y).is_correct}),()=>({"col-lg-9":e(k),"col-lg-10":!e(k),"offset-lg-1":!e(k),"offset-xl-2":!e(k),"offset-xxl-3":!e(k)})]),h(t,l)},pe=t=>{var l=jt();h(t,l)};V(le,t=>{s(n)?t(he):t(pe,!1)})}var de=Q(le,2);{var We=t=>{Pt(t,{get magicGIFPath(){return s(v)},set magicGIFPath(l){d(v,l,!0)}})};V(de,t=>{e(p)||t(We)})}var je=Q(de,2);{var Je=t=>{var l=Jt(),I=g(l);St(I,{x:[-5,5],y:[0,.1],delay:[100,3e3],infinite:!0,duration:"5000",amount:"200",fallDistance:"100vh"}),h(t,l)};V(je,t=>{s(S)&&t(Je)})}h(B,ce),ie(),M()}re(["click"]);const Ne=document.getElementById("SessionView");vt(Xt,{target:Ne,props:{id:Ne.dataset.sessionId}});
