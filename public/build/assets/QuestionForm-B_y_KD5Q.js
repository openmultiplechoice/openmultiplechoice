import{S as fe,i as me,s as Z,b as p,t as X,g as w,c as a,I as L,a as Q,h as d,D as V,l as J,n as Y,d as B,r as x,H as P,k as K,p as N,B as be,y as ge,w as pe,x as _e,J as we,G as ee,q as ke,m as ve,e as ye,o as Ee,u as qe,v as He,z as Te,j as Ce}from"./index-DgDIGCFR.js";import{e as U,u as te,d as Ie,o as Ae}from"./each-CvUUWvvD.js";import{d as he}from"./purify.es-D7xAjEaZ.js";function Le(n){let e,t,s,i,c,f,m,_,k,b,q,H,y,r,v,h,g,G,I,R,M,D,A,E,T,j,O,S,W,o;return{c(){e=p("form"),t=p("div"),s=p("label"),i=X("Answer text"),f=w(),m=p("input"),k=w(),b=p("trix-editor"),y=w(),r=new P(!1),v=w(),h=p("div"),g=p("label"),G=X("Answer hint (optional)"),R=w(),M=p("input"),A=w(),E=p("trix-editor"),O=w(),S=new P(!1),a(s,"for",c="answerText"+n[0].id),a(s,"class","form-label"),a(m,"id",_="answerText"+n[0].id),a(m,"type","hidden"),L(b,"id",q="editor-answer"+n[0].id),L(b,"class","bg-light"),L(b,"input",H="answerText"+n[0].id),r.a=null,a(t,"class","mb-3"),a(g,"for",I="answerHint"+n[0].id+"t"),a(g,"class","form-label"),a(M,"id",D="answerHint"+n[0].id),a(M,"type","hidden"),L(E,"id",T="editor-answerHint"+n[0].id),L(E,"class","bg-light"),L(E,"input",j="answerHint"+n[0].id),S.a=null,a(h,"class","mb-3"),a(e,"action","#"),a(e,"class","mt-3")},m(l,u){Q(l,e,u),d(e,t),d(t,s),d(s,i),d(t,f),d(t,m),V(m,n[0].text),d(t,k),d(t,b),n[5](b),d(t,y),r.m(n[3],t),d(e,v),d(e,h),d(h,g),d(g,G),d(h,R),d(h,M),V(M,n[0].hint),d(h,A),d(h,E),n[7](E),d(h,O),S.m(n[3],h),W||(o=[J(m,"input",n[4]),J(M,"input",n[6])],W=!0)},p(l,[u]){u&1&&c!==(c="answerText"+l[0].id)&&a(s,"for",c),u&1&&_!==(_="answerText"+l[0].id)&&a(m,"id",_),u&1&&V(m,l[0].text),u&1&&q!==(q="editor-answer"+l[0].id)&&L(b,"id",q),u&1&&H!==(H="answerText"+l[0].id)&&L(b,"input",H),u&8&&r.p(l[3]),u&1&&I!==(I="answerHint"+l[0].id+"t")&&a(g,"for",I),u&1&&D!==(D="answerHint"+l[0].id)&&a(M,"id",D),u&1&&V(M,l[0].hint),u&1&&T!==(T="editor-answerHint"+l[0].id)&&L(E,"id",T),u&1&&j!==(j="answerHint"+l[0].id)&&L(E,"input",j),u&8&&S.p(l[3])},i:Y,o:Y,d(l){l&&B(e),n[5](null),n[7](null),W=!1,x(o)}}}function Se(n,e,t){let{answer:s}=e,i,c,f="";function m(r){r.addEventListener("trix-change",function(){t(0,s.text=document.getElementById("answerText"+s.id).value,s),t(0,s.hint=document.getElementById("answerHint"+s.id).value,s),t(3,f='<p class="text-end">Saving ...</p>'),k()}),r.toolbarElement.style.display="none",r.addEventListener("trix-focus",function(v){v.target.toolbarElement.style.display="block"}),r.addEventListener("trix-blur",function(v){v.target.toolbarElement.contains(document.activeElement)||(v.target.toolbarElement.style.display="none")})}var _;function k(){_&&_.cancel(),_=he(()=>{axios.put("/api/answers/"+s.id,s).then(function(r){t(3,f='<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(r){t(3,f='<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(r)})},500,{maxWait:2e3}),_()}function b(){s.text=this.value,t(0,s)}function q(r){K[r?"unshift":"push"](()=>{i=r,t(1,i)})}function H(){s.hint=this.value,t(0,s)}function y(r){K[r?"unshift":"push"](()=>{c=r,t(2,c)})}return n.$$set=r=>{"answer"in r&&t(0,s=r.answer)},n.$$.update=()=>{n.$$.dirty&2&&i&&m(i),n.$$.dirty&4&&c&&m(c)},[s,i,c,f,b,q,H,y]}class Qe extends fe{constructor(e){super(),me(this,e,Se,Le,Z,{answer:0})}}function ne(n,e,t){const s=n.slice();return s[27]=e[t],s[28]=e,s[29]=t,s}function ie(n,e,t){const s=n.slice();return s[30]=e[t],s}function le(n){let e,t,s;return{c(){e=p("button"),e.textContent="Close editor",a(e,"type","button"),a(e,"class","btn btn-outline-secondary btn-sm")},m(i,c){Q(i,e,c),t||(s=J(e,"click",N(function(){we(n[1])&&n[1].apply(this,arguments)})),t=!0)},p(i,c){n=i},d(i){i&&B(e),t=!1,s()}}}function se(n){let e,t,s,i,c,f,m,_,k,b,q,H,y,r,v,h,g,G,I,R,M,D,A,E,T,j,O,S,W,o,l,u,C,$;return{c(){e=p("div"),t=p("label"),t.textContent="Question text",s=w(),i=p("input"),c=w(),f=p("trix-editor"),m=w(),_=new P(!1),k=w(),b=p("div"),q=p("label"),q.textContent="Question hint (optional)",H=w(),y=p("input"),r=w(),v=p("trix-editor"),h=w(),g=new P(!1),G=w(),I=p("div"),R=p("label"),R.textContent="Question comment (optional)",M=w(),D=p("input"),A=w(),E=p("trix-editor"),T=w(),j=new P(!1),O=w(),S=p("div"),W=p("div"),o=p("input"),l=w(),u=p("label"),u.innerHTML='<i class="bi bi-cone-striped"></i> <strong>Invalid question</strong> - Is the answer unknown or disputed? Invalid questions remain in deck but are not counted into results.',a(t,"for","questionText"),a(t,"class","form-label"),a(i,"id","questionText"),a(i,"type","hidden"),L(f,"id","editor-questionText"),L(f,"class","bg-light"),L(f,"input","questionText"),_.a=null,a(e,"class","mt-3 mb-3"),a(q,"for","questionHint"),a(q,"class","form-label"),a(y,"id","questionHint"),a(y,"type","hidden"),L(v,"id","editor-questionHint"),L(v,"class","bg-light"),L(v,"input","questionHint"),g.a=null,a(b,"class","mt-3 mb-3"),a(R,"for","questionComment"),a(R,"class","form-label"),a(D,"id","questionComment"),a(D,"type","hidden"),L(E,"id","editor-questionComment"),L(E,"class","bg-light"),L(E,"input","questionComment"),j.a=null,a(I,"class","mt-3 mb-3"),a(o,"type","checkbox"),a(o,"class","form-check-input"),a(o,"id","checkInvalidQuestion"),a(u,"class","form-check-label"),a(u,"for","checkInvalidQuestion"),a(W,"class","form-check"),a(S,"class","mb-3")},m(F,z){Q(F,e,z),d(e,t),d(e,s),d(e,i),V(i,n[0].text),d(e,c),d(e,f),n[15](f),d(e,m),_.m(n[5],e),Q(F,k,z),Q(F,b,z),d(b,q),d(b,H),d(b,y),V(y,n[0].hint),d(b,r),d(b,v),n[17](v),d(b,h),g.m(n[5],b),Q(F,G,z),Q(F,I,z),d(I,R),d(I,M),d(I,D),V(D,n[0].comment),d(I,A),d(I,E),n[19](E),d(I,T),j.m(n[5],I),Q(F,O,z),Q(F,S,z),d(S,W),d(W,o),o.checked=n[0].is_invalid,d(W,l),d(W,u),C||($=[J(i,"input",n[14]),J(y,"input",n[16]),J(D,"input",n[18]),J(o,"change",n[20]),J(o,"click",N(n[13]))],C=!0)},p(F,z){z[0]&1&&V(i,F[0].text),z[0]&32&&_.p(F[5]),z[0]&1&&V(y,F[0].hint),z[0]&32&&g.p(F[5]),z[0]&1&&V(D,F[0].comment),z[0]&32&&j.p(F[5]),z[0]&1&&(o.checked=F[0].is_invalid)},d(F){F&&(B(e),B(k),B(b),B(G),B(I),B(O),B(S)),n[15](null),n[17](null),n[19](null),C=!1,x($)}}}function oe(n){let e;return{c(){e=p("div"),e.innerHTML='<div class="alert alert-secondary" role="alert">Don&#39;t forget to set the correct answer!</div>',a(e,"class","col")},m(t,s){Q(t,e,s)},d(t){t&&B(e)}}}function ae(n){let e,t,s=n[30].comment+"",i;return{c(){e=p("div"),t=p("p"),i=X(s),a(t,"class","card-text"),a(e,"class","card-body")},m(c,f){Q(c,e,f),d(e,t),d(t,i)},p(c,f){f[0]&1&&s!==(s=c[30].comment+"")&&Ce(i,s)},d(c){c&&B(e)}}}function re(n,e){let t,s,i,c,f,m,_,k,b,q,H;function y(){return e[21](e[30])}let r=e[30].comment&&ae(e);return{key:n,first:null,c(){t=p("div"),s=p("div"),i=p("div"),c=p("button"),c.innerHTML='<i class="bi bi-trash"></i>',f=w(),m=p("img"),k=w(),r&&r.c(),b=w(),a(c,"type","button"),a(c,"class","btn btn-sm btn-light"),a(i,"class","card-header bg-transparent"),ee(m.src,_="/"+e[30].path)||a(m,"src",_),a(m,"class","card-img-top"),a(m,"alt",""),a(s,"class","card"),ke(s,"width","18rem"),a(t,"class","col"),this.first=t},m(v,h){Q(v,t,h),d(t,s),d(s,i),d(i,c),d(s,f),d(s,m),d(s,k),r&&r.m(s,null),d(t,b),q||(H=J(c,"click",N(y)),q=!0)},p(v,h){e=v,h[0]&1&&!ee(m.src,_="/"+e[30].path)&&a(m,"src",_),e[30].comment?r?r.p(e,h):(r=ae(e),r.c(),r.m(s,null)):r&&(r.d(1),r=null)},d(v){v&&B(t),r&&r.d(),q=!1,H()}}}function ue(n){let e,t,s,i,c;function f(){return n[23](n[27])}return{c(){e=p("button"),t=p("i"),a(t,"class","bi bi-check-lg"),a(e,"type","button"),a(e,"class",s="btn btn-sm "+(n[6]===n[27].id?"btn-success":"btn-light")),a(e,"title","Set as correct answer")},m(m,_){Q(m,e,_),d(e,t),i||(c=J(e,"click",N(f)),i=!0)},p(m,_){n=m,_[0]&65&&s!==(s="btn btn-sm "+(n[6]===n[27].id?"btn-success":"btn-light"))&&a(e,"class",s)},d(m){m&&B(e),i=!1,c()}}}function de(n,e){let t,s,i,c,f,m,_,k,b,q;function H(h){e[22](h,e[27],e[28],e[29])}let y={};e[27]!==void 0&&(y.answer=e[27]),s=new Qe({props:y}),K.push(()=>ve(s,"answer",H));let r=e[0].type==="mc"&&ue(e);function v(){return e[24](e[27])}return{key:n,first:null,c(){t=ye(),Ee(s.$$.fragment),c=w(),f=p("div"),r&&r.c(),m=w(),_=p("button"),_.innerHTML='<i class="bi bi-trash"></i>',a(_,"type","button"),a(_,"class","btn btn-sm btn-light"),a(_,"title","Remove answer"),a(f,"class","text-end mb-2"),this.first=t},m(h,g){Q(h,t,g),qe(s,h,g),Q(h,c,g),Q(h,f,g),r&&r.m(f,null),d(f,m),d(f,_),k=!0,b||(q=J(_,"click",N(v)),b=!0)},p(h,g){e=h;const G={};!i&&g[0]&1&&(i=!0,G.answer=e[27],He(()=>i=!1)),s.$set(G),e[0].type==="mc"?r?r.p(e,g):(r=ue(e),r.c(),r.m(f,m)):r&&(r.d(1),r=null)},i(h){k||(pe(s.$$.fragment,h),k=!0)},o(h){_e(s.$$.fragment,h),k=!1},d(h){h&&(B(t),B(c),B(f)),Te(s,h),r&&r.d(),b=!1,q()}}}function ce(n){let e,t,s;return{c(){e=p("button"),e.textContent="Add answer",a(e,"class","btn btn-sm btn-primary")},m(i,c){Q(i,e,c),t||(s=J(e,"click",n[11]),t=!0)},p:Y,d(i){i&&B(e),t=!1,s()}}}function Be(n){let e,t,s,i=n[0].id,c,f,m,_,k,b,q,H,y,r=[],v=new Map,h,g=[],G=new Map,I,R,M,D,A=n[1]&&le(n),E=se(n),T=!n[6]&&n[0].type==="mc"&&oe(),j=U(n[0].images);const O=l=>l[30].id;for(let l=0;l<j.length;l+=1){let u=ie(n,j,l),C=O(u);v.set(C,r[l]=re(C,u))}let S=U(n[0].answers);const W=l=>l[27].id;for(let l=0;l<S.length;l+=1){let u=ne(n,S,l),C=W(u);G.set(C,g[l]=de(C,u))}let o=(n[0].type==="mc"||n[0].answers.length===0)&&ce(n);return{c(){e=p("div"),t=p("form"),A&&A.c(),s=w(),E.c(),c=w(),f=p("div"),m=p("label"),m.textContent="Add image",_=w(),k=p("input"),q=w(),T&&T.c(),H=w(),y=p("div");for(let l=0;l<r.length;l+=1)r[l].c();h=w();for(let l=0;l<g.length;l+=1)g[l].c();I=w(),o&&o.c(),a(m,"for","image"),a(m,"class","form-label"),a(k,"class","form-control"),a(k,"type","file"),a(k,"id",b="imageInput"+n[0].id),a(k,"name","image"),a(f,"class","mb-3"),a(t,"action","#"),a(t,"class","mt-3"),a(y,"class","row row-cols-1 row-cols-lg-3 g4"),a(e,"class","mt-1 mb-1")},m(l,u){Q(l,e,u),d(e,t),A&&A.m(t,null),d(t,s),E.m(t,null),d(t,c),d(t,f),d(f,m),d(f,_),d(f,k),d(e,q),T&&T.m(e,null),d(e,H),d(e,y);for(let C=0;C<r.length;C+=1)r[C]&&r[C].m(y,null);d(e,h);for(let C=0;C<g.length;C+=1)g[C]&&g[C].m(e,null);d(e,I),o&&o.m(e,null),R=!0,M||(D=[J(k,"input",n[9]),J(t,"submit",N(n[8]))],M=!0)},p(l,u){l[1]?A?A.p(l,u):(A=le(l),A.c(),A.m(t,s)):A&&(A.d(1),A=null),u[0]&1&&Z(i,i=l[0].id)?(E.d(1),E=se(l),E.c(),E.m(t,c)):E.p(l,u),(!R||u[0]&1&&b!==(b="imageInput"+l[0].id))&&a(k,"id",b),!l[6]&&l[0].type==="mc"?T||(T=oe(),T.c(),T.m(e,H)):T&&(T.d(1),T=null),u[0]&1025&&(j=U(l[0].images),r=te(r,u,O,1,l,j,v,y,Ie,re,null,ie)),u[0]&4289&&(S=U(l[0].answers),be(),g=te(g,u,W,1,l,S,G,e,Ae,de,I,ne),ge()),l[0].type==="mc"||l[0].answers.length===0?o?o.p(l,u):(o=ce(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(l){if(!R){for(let u=0;u<S.length;u+=1)pe(g[u]);R=!0}},o(l){for(let u=0;u<g.length;u+=1)_e(g[u]);R=!1},d(l){l&&B(e),A&&A.d(),E.d(l),T&&T.d();for(let u=0;u<r.length;u+=1)r[u].d();for(let u=0;u<g.length;u+=1)g[u].d();o&&o.d(),M=!1,x(D)}}}function Me(){return{id:null,text:""}}function De(n,e,t){let s,{question:i}=e,{toggleEditor:c}=e,f,m,_,k="";function b(o){o.addEventListener("trix-change",function(){t(0,i.text=document.getElementById("questionText").value,i),t(0,i.comment=document.getElementById("questionComment").value,i),t(0,i.hint=document.getElementById("questionHint").value,i),t(5,k='<p class="text-end">Saving ...</p>'),y()}),o.toolbarElement.style.display="none",o.addEventListener("trix-focus",function(l){l.target.toolbarElement.style.display="block"}),o.addEventListener("trix-blur",function(l){l.target.toolbarElement.contains(document.activeElement)||(l.target.toolbarElement.style.display="none")})}function q(o){o!==i.correct_answer_id&&(t(0,i.correct_answer_id=o,i),axios.put("/api/questions/"+i.id,i).then(function(l){}).catch(function(l){alert(l)}))}var H;function y(){H&&H.cancel(),H=he(()=>{axios.put("/api/questions/"+i.id,i).then(function(o){t(5,k='<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(o){t(5,k='<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(o)})},500,{maxWait:2e3}),H()}function r(){var o=new FormData,l=document.getElementById("imageInput"+i.id);o.set("image",l.files[0]),axios.post("/api/questions/"+i.id+"/images",o,{headers:{"Content-Type":"multipart/form-data"}}).then(function(u){l.value="";var C=u.data;t(0,i.images=[...i.images,C],i)}).catch(function(u){l.value="",alert(u)})}function v(o){axios.delete("/api/images/"+o).then(function(l){t(0,i.images=i.images.filter(u=>u.id!==o),i)}).catch(function(l){alert(l)})}function h(){var o=Me();axios.post("/api/questions/"+i.id+"/answers",o).then(function(l){o.id=l.data.id,t(0,i.answers=[...i.answers,o],i)}).catch(function(l){alert(l)})}function g(o){axios.delete("/api/answers/"+o).then(function(l){t(0,i.answers=i.answers.filter(u=>u.id!==o),i)}).catch(function(l){alert(l)})}function G(){axios.put("/api/questions/"+i.id,{is_invalid:!i.is_invalid}).then(function(o){t(0,i.is_invalid=!i.is_invalid,i)}).catch(function(o){alert(o)})}function I(){i.text=this.value,t(0,i)}function R(o){K[o?"unshift":"push"](()=>{f=o,t(2,f)})}function M(){i.hint=this.value,t(0,i)}function D(o){K[o?"unshift":"push"](()=>{_=o,t(4,_)})}function A(){i.comment=this.value,t(0,i)}function E(o){K[o?"unshift":"push"](()=>{m=o,t(3,m)})}function T(){i.is_invalid=this.checked,t(0,i)}const j=o=>{v(o.id)};function O(o,l,u,C){u[C]=o,t(0,i)}const S=o=>{q(o.id)},W=o=>{g(o.id)};return n.$$set=o=>{"question"in o&&t(0,i=o.question),"toggleEditor"in o&&t(1,c=o.toggleEditor)},n.$$.update=()=>{n.$$.dirty[0]&1&&t(6,s=i.correct_answer_id),n.$$.dirty[0]&4&&f&&b(f),n.$$.dirty[0]&8&&m&&b(m),n.$$.dirty[0]&16&&_&&b(_)},[i,c,f,m,_,k,s,q,y,r,v,h,g,G,I,R,M,D,A,E,T,j,O,S,W]}class We extends fe{constructor(e){super(),me(this,e,De,Be,Z,{question:0,toggleEditor:1},null,[-1,-1])}}export{We as Q};
