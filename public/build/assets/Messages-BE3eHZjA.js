import{S as Re,i as Ne,s as je,d as I,w as z,x as B,z as x,A as $,a as q,e as ee,L as Ye,o as S,c,f as m,b as w,g as r,v as te,l as P,t as Z,j as J,D as ue,m as Qe,n as V,q as ie,u as Oe,B as Pe,C as ze,H as Ve,k as pe,r as he,y as ge,p as We}from"./index-CTA786D7.js";import{e as se,u as Fe,o as Je}from"./each-KlFnVOXz.js";import{p as ke,d as Ke}from"./purify.es-CzHI0FGf.js";import{U as Xe}from"./UserSettingsStore-vIMzuXmW.js";import{f as ye}from"./formatDistance-U_v5DbzH.js";import{p as F,f as oe}from"./parseISO-DDcmzaBF.js";function ve(s,e,t){const n=s.slice();return n[21]=e[t],n}function we(s){let e,t,n,l;function u(d,b){return d[9]&&!d[7]?$e:d[0].is_deleted?xe:Ze}let o=u(s),i=o(s),a=s[6]&&He(s),f=s[0].childs&&Ae(s);return{c(){e=m("div"),i.c(),t=w(),a&&a.c(),n=w(),f&&f.c(),r(e,"class","border-start border-2"),S(e,"ms-2",s[1]>0),S(e,"mb-3",!s[1])},m(d,b){q(d,e,b),i.m(e,null),c(e,t),a&&a.m(e,null),c(e,n),f&&f.m(e,null),l=!0},p(d,b){o===(o=u(d))&&i?i.p(d,b):(i.d(1),i=o(d),i&&(i.c(),i.m(e,t))),d[6]?a?a.p(d,b):(a=He(d),a.c(),a.m(e,n)):a&&(a.d(1),a=null),d[0].childs?f?(f.p(d,b),b&1&&B(f,1)):(f=Ae(d),f.c(),B(f,1),f.m(e,null)):f&&(x(),z(f,1,1,()=>{f=null}),$()),(!l||b&2)&&S(e,"ms-2",d[1]>0),(!l||b&2)&&S(e,"mb-3",!d[1])},i(d){l||(B(f),l=!0)},o(d){z(f),l=!1},d(d){d&&I(e),i.d(),a&&a.d(),f&&f.d()}}}function Ze(s){let e,t,n,l,u,o,i=s[0].thumbs_up_count-s[0].thumbs_down_count+"",a,f,d,b,_,p,h,C,D,T,v,E,M,L=ye(F(s[0].created_at),new Date,{addSuffix:!0})+"",U,Q,g,k,H,Y,ne,ae,ce,O=s[1]>0&&Me();function fe(y,A){if(y[0].is_anonymous)return tt;if(y[0].author)return et}let W=fe(s),R=W&&W(s),N=s[0].updated_at!==s[0].created_at&&Ie(s);function me(y,A){return y[5]?nt:lt}let le=me(s),G=le(s),j=!s[5]&&Ce(s);return{c(){var y,A,K,X;e=m("div"),t=m("div"),n=m("button"),l=m("i"),u=w(),o=m("span"),a=Z(i),f=w(),d=m("button"),b=m("i"),_=w(),p=m("div"),h=m("div"),O&&O.c(),C=w(),D=m("span"),R&&R.c(),T=w(),v=m("span"),v.textContent="•",E=w(),M=m("span"),U=Z(L),Q=w(),N&&N.c(),k=w(),H=m("div"),G.c(),Y=w(),j&&j.c(),r(l,"class","bi"),S(l,"bi-hand-thumbs-up-fill",((y=s[8])==null?void 0:y.type)==="up"),S(l,"bi-hand-thumbs-up",((A=s[8])==null?void 0:A.type)!=="up"),r(n,"class","btn btn-link p-0 text-muted text-decoration-none"),S(n,"disabled",s[0].is_deleted),r(o,"class","text-center text-muted small"),r(b,"class","bi"),S(b,"bi-hand-thumbs-down-fill",((K=s[8])==null?void 0:K.type)==="down"),S(b,"bi-hand-thumbs-down",((X=s[8])==null?void 0:X.type)!=="down"),r(d,"class","btn btn-link p-0 text-muted text-decoration-none"),S(d,"disabled",s[0].is_deleted),r(t,"class","d-flex flex-column gap-1"),ue(t,"min-width","2rem"),r(M,"title",g=oe(F(s[0].created_at),"dd.MM.yyyy HH:mm")),r(h,"class","d-flex gap-2 text-muted small"),r(H,"class","mt-1"),r(p,"class","flex-grow-1"),r(e,"class",ne="d-flex gap-1 mb-2 message-content "+(s[10]?"bg-light rounded-end-3 shadow-sm py-2 ps-1 pe-2 ms-1":"py-1 rounded-end-3"))},m(y,A){q(y,e,A),c(e,t),c(t,n),c(n,l),c(t,u),c(t,o),c(o,a),c(t,f),c(t,d),c(d,b),c(e,_),c(e,p),c(p,h),O&&O.m(h,null),c(h,C),c(h,D),R&&R.m(D,null),c(h,T),c(h,v),c(h,E),c(h,M),c(M,U),c(M,Q),N&&N.m(M,null),c(p,k),c(p,H),G.m(H,null),c(e,Y),j&&j.m(e,null),ae||(ce=[P(n,"click",s[19]),P(d,"click",s[20])],ae=!0)},p(y,A){var K,X,_e,be;A&256&&S(l,"bi-hand-thumbs-up-fill",((K=y[8])==null?void 0:K.type)==="up"),A&256&&S(l,"bi-hand-thumbs-up",((X=y[8])==null?void 0:X.type)!=="up"),A&1&&S(n,"disabled",y[0].is_deleted),A&1&&i!==(i=y[0].thumbs_up_count-y[0].thumbs_down_count+"")&&ie(a,i),A&256&&S(b,"bi-hand-thumbs-down-fill",((_e=y[8])==null?void 0:_e.type)==="down"),A&256&&S(b,"bi-hand-thumbs-down",((be=y[8])==null?void 0:be.type)!=="down"),A&1&&S(d,"disabled",y[0].is_deleted),y[1]>0?O||(O=Me(),O.c(),O.m(h,C)):O&&(O.d(1),O=null),W===(W=fe(y))&&R?R.p(y,A):(R&&R.d(1),R=W&&W(y),R&&(R.c(),R.m(D,null))),A&1&&L!==(L=ye(F(y[0].created_at),new Date,{addSuffix:!0})+"")&&ie(U,L),y[0].updated_at!==y[0].created_at?N?N.p(y,A):(N=Ie(y),N.c(),N.m(M,null)):N&&(N.d(1),N=null),A&1&&g!==(g=oe(F(y[0].created_at),"dd.MM.yyyy HH:mm"))&&r(M,"title",g),le===(le=me(y))&&G?G.p(y,A):(G.d(1),G=le(y),G&&(G.c(),G.m(H,null))),y[5]?j&&(j.d(1),j=null):j?j.p(y,A):(j=Ce(y),j.c(),j.m(e,null)),A&1024&&ne!==(ne="d-flex gap-1 mb-2 message-content "+(y[10]?"bg-light rounded-end-3 shadow-sm py-2 ps-1 pe-2 ms-1":"py-1 rounded-end-3"))&&r(e,"class",ne)},d(y){y&&I(e),O&&O.d(),R&&R.d(),N&&N.d(),G.d(),j&&j.d(),ae=!1,te(ce)}}}function xe(s){let e;return{c(){e=m("div"),e.innerHTML='<span class="text-muted small"><i class="bi bi-trash me-1"></i>This comment has been deleted.</span>',r(e,"class","p-2")},m(t,n){q(t,e,n)},p:V,d(t){t&&I(e)}}}function $e(s){let e,t,n,l;return{c(){e=m("div"),t=m("button"),t.innerHTML='<i class="bi bi-eye-slash me-1"></i>Comment hidden due to low rating. Click to show.',r(t,"class","btn btn-link btn-sm text-muted p-0"),r(e,"class","p-2")},m(u,o){q(u,e,o),c(e,t),n||(l=P(t,"click",s[14]),n=!0)},p:V,d(u){u&&I(e),n=!1,l()}}}function Me(s){let e,t,n;return{c(){e=m("i"),t=w(),n=m("span"),n.textContent="•",r(e,"class","bi bi-arrow-return-right"),r(e,"title","Answer")},m(l,u){q(l,e,u),q(l,t,u),q(l,n,u)},d(l){l&&(I(e),I(t),I(n))}}}function et(s){let e=(s[0].author.public_name||s[0].author.name)+"",t;return{c(){t=Z(e)},m(n,l){q(n,t,l)},p(n,l){l&1&&e!==(e=(n[0].author.public_name||n[0].author.name)+"")&&ie(t,e)},d(n){n&&I(t)}}}function tt(s){let e;return{c(){e=m("i"),r(e,"class","bi bi-incognito"),r(e,"title","Anonymous")},m(t,n){q(t,e,n)},p:V,d(t){t&&I(e)}}}function Ie(s){let e,t;return{c(){e=m("i"),r(e,"class","bi bi-pencil ms-1"),r(e,"title",t="Edited "+oe(F(s[0].updated_at),"dd.MM.yyyy HH:mm"))},m(n,l){q(n,e,l)},p(n,l){l&1&&t!==(t="Edited "+oe(F(n[0].updated_at),"dd.MM.yyyy HH:mm"))&&r(e,"title",t)},d(n){n&&I(e)}}}function nt(s){let e,t,n,l,u,o,i,a,f,d,b,_,p,h,C,D,T,v,E;return{c(){e=m("div"),t=m("input"),l=w(),u=m("trix-editor"),o=w(),i=m("div"),a=m("div"),f=m("input"),b=w(),_=m("label"),_.textContent="Anonymous",p=w(),h=m("div"),C=m("button"),C.textContent="Cancel",D=w(),T=m("button"),T.textContent="Save",r(t,"id","message"),r(t,"type","hidden"),r(t,"name","message"),t.value=n=s[0].text,J(u,"input","message"),J(u,"class","trix-content form-control mb-2"),ue(u,"min-height","4rem"),r(f,"type","checkbox"),r(f,"class","form-check-input"),r(f,"id","anonymous"),f.checked=d=s[0].is_anonymous,r(_,"class","form-check-label small"),r(_,"for","anonymous"),r(a,"class","form-check"),r(C,"class","btn btn-link btn-sm text-muted text-decoration-none p-0"),r(T,"class","btn btn-primary btn-sm py-0"),r(h,"class","d-flex gap-2"),r(i,"class","d-flex justify-content-between pb-1"),r(e,"class","pe-2")},m(M,L){q(M,e,L),c(e,t),c(e,l),c(e,u),c(e,o),c(e,i),c(i,a),c(a,f),c(a,b),c(a,_),c(i,p),c(i,h),c(h,C),c(h,D),c(h,T),v||(E=[P(C,"click",s[12]),P(T,"click",s[15])],v=!0)},p(M,L){L&1&&n!==(n=M[0].text)&&(t.value=n),L&1&&d!==(d=M[0].is_anonymous)&&(f.checked=d)},d(M){M&&I(e),v=!1,te(E)}}}function lt(s){let e,t=s[0].text&&qe(s);return{c(){e=m("div"),t&&t.c(),r(e,"class","trix-content pe-4")},m(n,l){q(n,e,l),t&&t.m(e,null)},p(n,l){n[0].text?t?t.p(n,l):(t=qe(n),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},d(n){n&&I(e),t&&t.d()}}}function qe(s){let e,t=ke.sanitize(s[0].text)+"",n;return{c(){e=new Ve(!1),n=ee(),e.a=n},m(l,u){e.m(t,l,u),q(l,n,u)},p(l,u){u&1&&t!==(t=ke.sanitize(l[0].text)+"")&&e.p(t)},d(l){l&&(I(n),e.d())}}}function Ce(s){let e,t,n,l,u,o=s[11].id===s[0].author_id&&Ee(s);return{c(){e=m("div"),t=m("button"),t.innerHTML='<i class="bi bi-reply"></i>',n=w(),o&&o.c(),r(t,"class","btn btn-link p-0 text-muted me-1"),r(t,"title","Reply"),S(t,"disabled",s[6]),r(e,"class","d-flex align-items-end gap-2 pe-1")},m(i,a){q(i,e,a),c(e,t),c(e,n),o&&o.m(e,null),l||(u=P(t,"click",s[13]),l=!0)},p(i,a){a&64&&S(t,"disabled",i[6]),i[11].id===i[0].author_id?o?o.p(i,a):(o=Ee(i),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(i){i&&I(e),o&&o.d(),l=!1,u()}}}function Ee(s){let e,t,n,l,u,o,i,a,f,d,b;return{c(){e=m("div"),t=m("button"),t.innerHTML='<i class="bi bi-three-dots-vertical"></i>',n=w(),l=m("ul"),u=m("li"),o=m("button"),o.innerHTML='<i class="bi bi-pencil me-2"></i>Edit',i=w(),a=m("li"),f=m("button"),f.innerHTML='<i class="bi bi-trash me-2"></i>Delete',r(t,"class","btn btn-link p-0 text-muted me-1"),r(t,"data-bs-toggle","dropdown"),r(t,"aria-expanded","false"),r(o,"class","dropdown-item"),r(f,"class","dropdown-item"),r(l,"class","dropdown-menu dropdown-menu-end"),r(e,"class","dropdown")},m(_,p){q(_,e,p),c(e,t),c(e,n),c(e,l),c(l,u),c(u,o),c(l,i),c(l,a),c(a,f),d||(b=[P(o,"click",s[12]),P(f,"click",s[17])],d=!0)},p:V,d(_){_&&I(e),d=!1,te(b)}}}function He(s){let e,t,n,l,u,o,i,a,f,d,b,_,p,h,C,D,T,v,E,M,L,U;function Q(H,Y){if(H[0].is_anonymous)return st;if(H[0].author)return it}let g=Q(s),k=g&&g(s);return{c(){e=m("div"),t=m("div"),n=m("i"),l=Z(`
                    Replying to
                    `),k&&k.c(),u=w(),o=m("div"),i=m("input"),a=w(),f=m("input"),b=w(),_=m("trix-editor"),p=w(),h=m("div"),C=m("div"),C.innerHTML='<input type="checkbox" class="form-check-input" id="replyAnonymous" checked=""/> <label class="form-check-label small" for="replyAnonymous">Anonymous</label>',D=w(),T=m("div"),v=m("button"),v.textContent="Cancel",E=w(),M=m("button"),M.textContent="Reply",r(n,"class","bi bi-arrow-return-right"),r(n,"title","Answer"),r(t,"class","d-flex gap-2 text-muted small mb-2"),r(i,"id","replyMessage"),r(i,"type","hidden"),r(i,"name","replyMessage"),r(f,"id","parentMessageId"),r(f,"type","hidden"),r(f,"name","parentMessageId"),f.value=d=s[0].id,J(_,"input","replyMessage"),J(_,"class","trix-content form-control mb-2"),ue(_,"min-height","4rem"),r(C,"class","form-check"),r(v,"class","btn btn-link btn-sm text-muted text-decoration-none p-0"),r(M,"class","btn btn-primary btn-sm py-0"),r(T,"class","d-flex gap-2"),r(h,"class","d-flex justify-content-between"),r(e,"class","border-start border-2 my-2 ms-2 ps-2")},m(H,Y){q(H,e,Y),c(e,t),c(t,n),c(t,l),k&&k.m(t,null),c(e,u),c(e,o),c(o,i),c(o,a),c(o,f),c(o,b),c(o,_),c(o,p),c(o,h),c(h,C),c(h,D),c(h,T),c(T,v),c(T,E),c(T,M),L||(U=[P(v,"click",s[13]),P(M,"click",s[16])],L=!0)},p(H,Y){g===(g=Q(H))&&k?k.p(H,Y):(k&&k.d(1),k=g&&g(H),k&&(k.c(),k.m(t,null))),Y&1&&d!==(d=H[0].id)&&(f.value=d)},d(H){H&&I(e),k&&k.d(),L=!1,te(U)}}}function it(s){let e=(s[0].author.public_name||s[0].author.name)+"",t;return{c(){t=Z(e)},m(n,l){q(n,t,l)},p(n,l){l&1&&e!==(e=(n[0].author.public_name||n[0].author.name)+"")&&ie(t,e)},d(n){n&&I(t)}}}function st(s){let e;return{c(){e=m("i"),r(e,"class","bi bi-incognito"),r(e,"title","Anonymous")},m(t,n){q(t,e,n)},p:V,d(t){t&&I(e)}}}function Ae(s){let e,t,n=se(s[0].childs),l=[];for(let o=0;o<n.length;o+=1)l[o]=Te(ve(s,n,o));const u=o=>z(l[o],1,1,()=>{l[o]=null});return{c(){for(let o=0;o<l.length;o+=1)l[o].c();e=ee()},m(o,i){for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(o,i);q(o,e,i),t=!0},p(o,i){if(i&31){n=se(o[0].childs);let a;for(a=0;a<n.length;a+=1){const f=ve(o,n,a);l[a]?(l[a].p(f,i),B(l[a],1)):(l[a]=Te(f),l[a].c(),B(l[a],1),l[a].m(e.parentNode,e))}for(x(),a=n.length;a<l.length;a+=1)u(a);$()}},i(o){if(!t){for(let i=0;i<n.length;i+=1)B(l[i]);t=!0}},o(o){l=l.filter(Boolean);for(let i=0;i<l.length;i+=1)z(l[i]);t=!1},d(o){o&&I(e),Qe(l,o)}}}function Te(s){let e,t;return e=new Ge({props:{message:s[21],indent:s[1]+1,addMessage:s[2],updateMessage:s[3],questionId:s[4]}}),{c(){ze(e.$$.fragment)},m(n,l){Pe(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.message=n[21]),l&2&&(u.indent=n[1]+1),l&4&&(u.addMessage=n[2]),l&8&&(u.updateMessage=n[3]),l&16&&(u.questionId=n[4]),e.$set(u)},i(n){t||(B(e.$$.fragment,n),t=!0)},o(n){z(e.$$.fragment,n),t=!1},d(n){Oe(e,n)}}}function ot(s){let e=!s[0].is_deleted||re(s[0]),t,n,l=e&&we(s);return{c(){l&&l.c(),t=ee()},m(u,o){l&&l.m(u,o),q(u,t,o),n=!0},p(u,[o]){o&1&&(e=!u[0].is_deleted||re(u[0])),e?l?(l.p(u,o),o&1&&B(l,1)):(l=we(u),l.c(),B(l,1),l.m(t.parentNode,t)):l&&(x(),z(l,1,1,()=>{l=null}),$())},i(u){n||(B(l),n=!0)},o(u){z(l),n=!1},d(u){u&&I(t),l&&l.d(u)}}}function re(s){return Array.isArray(s.childs)?s.childs.some(e=>!e.is_deleted||re(e)):!1}function ut(s,e,t){let n,l,u,o;Ye(s,Xe,g=>t(11,o=g));let{message:i}=e,{indent:a}=e,{addMessage:f}=e,{updateMessage:d}=e,{questionId:b}=e;var _=!1,p=!1,h=!1;function C(){t(5,_=!_)}function D(){t(6,p=!p)}function T(){t(7,h=!h)}function v(){var g={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.put("/api/messages/"+i.id,g).then(function(k){C(),t(0,i.text=k.data.text,i),t(0,i.is_anonymous=k.data.is_anonymous,i),t(0,i.updated_at=k.data.updated_at,i),d(i)}).catch(function(k){alert(k)})}function E(){var g={text:document.getElementById("replyMessage").value,parent_message_id:document.getElementById("parentMessageId").value,is_anonymous:document.getElementById("replyAnonymous").checked};axios.post("/api/questions/"+b+"/messages",g).then(function(k){D(),f(k.data)}).catch(function(k){alert(k)})}function M(){confirm("Are you sure you want to delete this message?")&&axios.delete("/api/messages/"+i.id).then(function(g){t(0,i.text="",i),t(0,i.is_deleted=!0,i),d(i)}).catch(function(g){alert(g)})}function L(g){n!==null?n.type===g?axios.delete("/api/messages/"+i.id+"/thumbs/"+n.id).then(function(k){t(0,i.thumbs=i.thumbs.filter(H=>H.user_id===void 0),i),g==="up"?t(0,i.thumbs_up_count-=1,i):t(0,i.thumbs_down_count-=1,i),d(i)}).catch(function(k){alert(k)}):axios.put("/api/messages/"+i.id+"/thumbs/"+n.id,{type:g}).then(function(k){i.thumbs.find(H=>H.user_id!==void 0).type=g,g==="up"?(t(0,i.thumbs_up_count+=1,i),t(0,i.thumbs_down_count-=1,i)):(t(0,i.thumbs_down_count+=1,i),t(0,i.thumbs_up_count-=1,i)),d(i)}).catch(function(k){alert(k)}):axios.post("/api/messages/"+i.id+"/thumbs",{type:g}).then(function(k){i.thumbs.push({type:k.data.type,user_id:k.data.user_id,id:k.data.id}),g==="up"?t(0,i.thumbs_up_count+=1,i):t(0,i.thumbs_down_count+=1,i),d(i)}).catch(function(k){alert(k)})}const U=()=>L("up"),Q=()=>L("down");return s.$$set=g=>{"message"in g&&t(0,i=g.message),"indent"in g&&t(1,a=g.indent),"addMessage"in g&&t(2,f=g.addMessage),"updateMessage"in g&&t(3,d=g.updateMessage),"questionId"in g&&t(4,b=g.questionId)},s.$$.update=()=>{s.$$.dirty&1&&t(8,n=i.thumbs.find(g=>g.user_id!==void 0)??null),s.$$.dirty&1&&t(10,l=i.thumbs_up_count-i.thumbs_down_count>4),s.$$.dirty&1&&t(9,u=i.thumbs_up_count-i.thumbs_down_count<-2)},[i,a,f,d,b,_,p,h,n,u,l,o,C,D,T,v,E,M,L,U,Q]}class Ge extends Re{constructor(e){super(),Ne(this,e,ut,ot,je,{message:0,indent:1,addMessage:2,updateMessage:3,questionId:4})}}function Le(s,e,t){const n=s.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function Se(s){let e,t=[],n=new Map,l,u,o=se(s[3]);const i=_=>_[15].id;for(let _=0;_<o.length;_+=1){let p=Le(s,o,_),h=i(p);n.set(h,t[_]=Be(h,p))}let a=null;o.length||(a=De(s));function f(_,p){return _[2]?ct:rt}let d=f(s),b=d(s);return{c(){e=m("div");for(let _=0;_<t.length;_+=1)t[_].c();a&&a.c(),l=w(),b.c(),r(e,"class","mt-4 mb-3 px-2 py-2 border rounded-3 shadow-sm bg-white")},m(_,p){q(_,e,p);for(let h=0;h<t.length;h+=1)t[h]&&t[h].m(e,null);a&&a.m(e,null),c(e,l),b.m(e,null),u=!0},p(_,p){p&249&&(o=se(_[3]),x(),t=Fe(t,p,i,1,_,o,n,e,Je,Be,l,Le),$(),!o.length&&a?a.p(_,p):o.length?a&&(a.d(1),a=null):(a=De(_),a.c(),a.m(e,l))),d===(d=f(_))&&b?b.p(_,p):(b.d(1),b=d(_),b&&(b.c(),b.m(e,null)))},i(_){if(!u){for(let p=0;p<o.length;p+=1)B(t[p]);u=!0}},o(_){for(let p=0;p<t.length;p+=1)z(t[p]);u=!1},d(_){_&&I(e);for(let p=0;p<t.length;p+=1)t[p].d();a&&a.d(),b.d()}}}function De(s){let e;function t(u,o){if(u[4]===u[5].LOADING)return dt;if(u[4]===u[5].EMPTY)return at}let n=t(s),l=n&&n(s);return{c(){e=m("div"),l&&l.c(),r(e,"class","mb-3 d-flex justify-content-center")},m(u,o){q(u,e,o),l&&l.m(e,null)},p(u,o){n!==(n=t(u))&&(l&&l.d(1),l=n&&n(u),l&&(l.c(),l.m(e,null)))},d(u){u&&I(e),l&&l.d()}}}function at(s){let e;return{c(){e=m("div"),e.textContent="No comments yet. Be the first to leave a comment!",r(e,"class","text-muted")},m(t,n){q(t,e,n)},d(t){t&&I(e)}}}function dt(s){let e;return{c(){e=m("div"),e.innerHTML='<span class="visually-hidden">Loading messages ...</span>',r(e,"class","spinner-border text-secondary"),r(e,"role","status")},m(t,n){q(t,e,n)},d(t){t&&I(e)}}}function Be(s,e){let t,n,l,u,o;function i(d){e[10](d,e[15],e[16],e[17])}function a(d){e[11](d)}let f={indent:0,addMessage:e[6],updateMessage:e[7]};return e[15]!==void 0&&(f.message=e[15]),e[0]!==void 0&&(f.questionId=e[0]),n=new Ge({props:f}),pe.push(()=>he(n,"message",i)),pe.push(()=>he(n,"questionId",a)),{key:s,first:null,c(){t=ee(),ze(n.$$.fragment),this.first=t},m(d,b){q(d,t,b),Pe(n,d,b),o=!0},p(d,b){e=d;const _={};!l&&b&8&&(l=!0,_.message=e[15],ge(()=>l=!1)),!u&&b&1&&(u=!0,_.questionId=e[0],ge(()=>u=!1)),n.$set(_)},i(d){o||(B(n.$$.fragment,d),o=!0)},o(d){z(n.$$.fragment,d),o=!1},d(d){d&&I(t),Oe(n,d)}}}function rt(s){let e,t,n;return{c(){e=m("button"),e.innerHTML='<i class="bi bi-chat-square-text"></i> Add comment',r(e,"class","btn btn-sm btn-outline-secondary")},m(l,u){q(l,e,u),t||(n=P(e,"click",We(s[9])),t=!0)},p:V,d(l){l&&I(e),t=!1,n()}}}function ct(s){let e,t,n,l,u,o,i,a,f,d,b,_,p,h;return{c(){e=m("div"),t=m("input"),n=w(),l=m("trix-editor"),u=w(),o=m("div"),i=m("div"),i.innerHTML='<input type="checkbox" class="form-check-input" id="anonymous" checked=""/> <label class="form-check-label small" for="anonymous">Anonymous</label>',a=w(),f=m("div"),d=m("button"),d.textContent="Cancel",b=w(),_=m("button"),_.textContent="Save",r(t,"id","message"),r(t,"type","hidden"),r(t,"name","message"),t.value="",J(l,"input","message"),J(l,"class","trix-content form-control mb-2"),ue(l,"min-height","4rem"),r(i,"class","form-check"),r(d,"class","btn btn-link btn-sm text-muted text-decoration-none p-0"),r(_,"class","btn btn-primary btn-sm py-0"),r(f,"class","d-flex gap-2"),r(o,"class","d-flex justify-content-between pb-1"),r(e,"class","mt-3 border-top border-2 pt-3")},m(C,D){q(C,e,D),c(e,t),c(e,n),c(e,l),c(e,u),c(e,o),c(o,i),c(o,a),c(o,f),c(f,d),c(f,b),c(f,_),p||(h=[P(d,"click",s[9]),P(_,"click",s[8])],p=!0)},p:V,d(C){C&&I(e),p=!1,te(h)}}}function ft(s){let e,t,n=s[1].isAnswered&&Se(s);return{c(){n&&n.c(),e=ee()},m(l,u){n&&n.m(l,u),q(l,e,u),t=!0},p(l,[u]){l[1].isAnswered?n?(n.p(l,u),u&2&&B(n,1)):(n=Se(l),n.c(),B(n,1),n.m(e.parentNode,e)):n&&(x(),z(n,1,1,()=>{n=null}),$())},i(l){t||(B(n),t=!0)},o(l){z(n),t=!1},d(l){l&&I(e),n&&n.d(l)}}}function de(s){var e=structuredClone(s),t={},n=[];e.forEach(u=>{if(!u.parent_message_id&&!u.legacy_parent_message_id){n.push(u);return}var o=u.parent_message_id;if(!o){const i=e.find(a=>a.legacy_message_id===u.legacy_parent_message_id);i?o=i.id:console.error("Parent message not found for message",u)}t[o]||(t[o]=[]),t[o].push(u)}),Object.values(t).forEach(u=>{u.sort((o,i)=>i.thumbs_up_count-i.thumbs_down_count-(o.thumbs_up_count-o.thumbs_down_count))}),n.sort((u,o)=>o.thumbs_up_count-o.thumbs_down_count-(u.thumbs_up_count-u.thumbs_down_count));function l(u){var o=u.id;t[o]&&(u.childs=t[o],u.childs.forEach(i=>{l(i)}))}return n.forEach(u=>{l(u)}),n}function Ue(s,e){return s.map(t=>t.id===e.id?{...e,childs:t.childs}:t.childs?{...t,childs:Ue(t.childs,e)}:t)}function mt(s,e,t){let{questionId:n}=e,{questionContext:l}=e;var u=!1,o=[],i=[],a;const f={LOADING:"loading",EMPTY:"empty"};var d;function b(){o=[],t(4,a=f.LOADING),d&&d.cancel();const v=n;d=Ke(()=>{axios.get("/api/questions/"+n+"/messages").then(function(E){if(v===n){if(o=E.data,o.filter(M=>!M.is_deleted).length===0){t(3,i=[]),t(4,a=f.EMPTY);return}t(3,i=de(o))}}).catch(function(E){alert(E)})},1e3,{maxWait:2e3}),d()}function _(v){o.push(v),t(3,i=de(o))}function p(v){const E=o.findIndex(M=>M.id===v.id);o[E]=v,t(3,i=Ue(i,v))}function h(){var v={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.post("/api/questions/"+n+"/messages",v).then(function(E){C(),o.push(E.data),t(3,i=de(o))}).catch(function(E){alert(E)})}function C(){t(2,u=!u)}function D(v,E,M,L){M[L]=v,t(3,i),t(0,n)}function T(v){n=v,t(0,n)}return s.$$set=v=>{"questionId"in v&&t(0,n=v.questionId),"questionContext"in v&&t(1,l=v.questionContext)},s.$$.update=()=>{s.$$.dirty&1&&(t(3,i=[]),t(2,u=!1),b())},[n,l,u,i,a,f,_,p,h,C,D,T]}class yt extends Re{constructor(e){super(),Ne(this,e,mt,ft,je,{questionId:0,questionContext:1})}}export{yt as M};
