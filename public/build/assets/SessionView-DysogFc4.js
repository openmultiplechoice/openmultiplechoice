import{S as de,i as _e,s as ge,e as Ce,a as A,n as E,d as P,b as k,c as b,G as Ie,h,l as j,g as B,t as X,j as ae,p as re,k as D,q as We,f as Je,H as Ke,A as ze,C,x as G,y as x,w as I,E as Xe,m as O,o as ee,u as se,v as R,z as ne,B as $,I as Ye,F as qe,r as Ze}from"./index-QDwHr63R.js";import{p as Qe,d as je}from"./purify.es-FL75tu_8.js";import{M as xe}from"./Messages-CaZkhzxr.js";import{C as $e}from"./auto-BMMVTEYX.js";import{S as es}from"./SessionProgressBar-E33GXL2C.js";import{e as Ae}from"./each-Co9F6xS6.js";import{h as ve,S as ss}from"./SessionQuestionView-DgKzI6Lx.js";import{s as ns}from"./StatsHelper-B91isISU.js";import{U as be}from"./UserSettingsStore-krxhNGvx.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./parseISO-Ds5nI7_t.js";import"./lodash-D0JQdfhu.js";import"./QuestionForm-Z2RjiLFA.js";function Pe(s){let n,e,i,o,u;return{c(){n=k("div"),e=k("img"),b(e,"class","img-fluid"),Ie(e.src,i="/"+s[0])||b(e,"src",i),b(e,"alt","Magic GIF"),b(n,"class","img-fullscreen d-flex justify-content-center align-items-center svelte-k1osqd")},m(t,c){A(t,n,c),h(n,e),o||(u=j(n,"click",s[2]),o=!0)},p(t,c){c&1&&!Ie(e.src,i="/"+t[0])&&b(e,"src",i)},d(t){t&&P(n),o=!1,u()}}}function is(s){let n,e=s[0]&&s[1]&&Pe(s);return{c(){e&&e.c(),n=Ce()},m(i,o){e&&e.m(i,o),A(i,n,o)},p(i,[o]){i[0]&&i[1]?e?e.p(i,o):(e=Pe(i),e.c(),e.m(n.parentNode,n)):e&&(e.d(1),e=null)},i:E,o:E,d(i){i&&P(n),e&&e.d(i)}}}function ts(s,n,e){let{magicGIFPath:i=""}=n;var o=!0;function u(){e(1,o=!o)}return s.$$set=t=>{"magicGIFPath"in t&&e(0,i=t.magicGIFPath)},[i,o,u]}class os extends de{constructor(n){super(),_e(this,n,ts,is,ge,{magicGIFPath:0})}}function Me(s){let n,e,i;return{c(){n=k("button"),n.innerHTML='<i class="bi bi-repeat"></i> Repeat incorrect',b(n,"class","btn btn-sm btn-outline-secondary"),b(n,"type","button")},m(o,u){A(o,n,u),e||(i=j(n,"click",re(s[5])),e=!0)},p:E,d(o){o&&P(n),e=!1,i()}}}function rs(s){let n,e,i,o,u,t,c,l=s[0].correct+"",r,a,w,M,q,z,Q,S,H,g=s[0].incorrect>0&&Me(s);return{c(){n=k("div"),e=k("div"),i=k("canvas"),o=B(),u=k("div"),t=k("p"),c=k("span"),r=X(l),a=X("%"),w=X(" correct"),M=B(),q=k("div"),z=k("a"),z.innerHTML='<i class="bi bi-rocket-takeoff"></i> New session',Q=B(),g&&g.c(),S=B(),H=k("a"),H.textContent="Home",b(e,"class","col-md"),b(c,"class","fs-4 font-monospace"),b(t,"class","mt-3 text-dark"),b(z,"href","/sessions/create"),b(z,"class","btn btn-sm btn-primary"),b(H,"href","/"),b(H,"class","btn btn-sm btn-outline-secondary"),b(q,"class","d-grid gap-2"),b(u,"class","col-md"),b(n,"class","row mb-5")},m(p,m){A(p,n,m),h(n,e),h(e,i),s[4](i),h(n,o),h(n,u),h(u,t),h(t,c),h(c,r),h(c,a),h(t,w),h(u,M),h(u,q),h(q,z),h(q,Q),g&&g.m(q,null),h(q,S),h(q,H)},p(p,[m]){m&1&&l!==(l=p[0].correct+"")&&ae(r,l),p[0].incorrect>0?g?g.p(p,m):(g=Me(p),g.c(),g.m(q,S)):g&&(g.d(1),g=null)},i:E,o:E,d(p){p&&P(n),s[4](null),g&&g.d()}}}function us(s){axios.post("/api/sessions/"+s+"/newfromincorrect").then(function(n){window.location.href="/sessions/"+n.data.id}).catch(function(n){alert(n)})}function ls(s,n,e){let{progressPercentage:i}=n,{sessionId:o}=n,u,t;function c(r){D[r?"unshift":"push"](()=>{u=r,e(2,u)})}const l=()=>us(o);return s.$$set=r=>{"progressPercentage"in r&&e(0,i=r.progressPercentage),"sessionId"in r&&e(1,o=r.sessionId)},s.$$.update=()=>{s.$$.dirty&13&&u&&(()=>{if(t)return;const r={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect"],datasets:[{label:"%",data:[i.correct,i.correctWithHelp,i.incorrect],backgroundColor:["#d4edda","#fff3cd","#f8d7da"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};t&&t.destroy();var a=u.getContext("2d");e(3,t=new $e(a,r))})()},[i,o,u,t,c,l]}class fs extends de{constructor(n){super(),_e(this,n,ls,rs,ge,{progressPercentage:0,sessionId:1})}}function Se(s,n,e){const i=s.slice();return i[4]=n[e],i[6]=e,i}function Te(s){let n;return{c(){n=k("li"),n.textContent="Loading ...",b(n,"class","svelte-za7w49")},m(e,i){A(e,n,i)},p:E,d(e){e&&P(n)}}}function cs(s){let n,e=s[6]+1+"",i;return{c(){n=X("Question Nr. "),i=X(e)},m(o,u){A(o,n,u),A(o,i,u)},p:E,d(o){o&&(P(n),P(i))}}}function as(s){let n=Qe.sanitize(s[4].text).replace(/<\/?[^>]+(>|$)/g,"")+"",e;return{c(){e=X(n)},m(i,o){A(i,e,o)},p(i,o){o&1&&n!==(n=Qe.sanitize(i[4].text).replace(/<\/?[^>]+(>|$)/g,"")+"")&&ae(e,n)},d(i){i&&P(e)}}}function ye(s){let n,e,i,o=s[1](s[4])+"",u,t,c,l,r,a;function w(Q,S){return Q[4].text?as:cs}let M=w(s),q=M(s);function z(){return s[3](s[4])}return{c(){n=k("li"),e=k("small"),i=new Ke(!1),u=B(),q.c(),t=B(),i.a=u,b(n,"class",c="list-group-item list-group-item-action text-overflow "+(s[4].id===s[0].session.current_question_id?"list-group-item-dark":"list-group-item-light")+" svelte-za7w49"),b(n,"id",l="question"+s[4].id)},m(Q,S){A(Q,n,S),h(n,e),i.m(o,e),h(e,u),q.m(e,null),h(n,t),r||(a=j(n,"click",z),r=!0)},p(Q,S){s=Q,S&3&&o!==(o=s[1](s[4])+"")&&i.p(o),M===(M=w(s))&&q?q.p(s,S):(q.d(1),q=M(s),q&&(q.c(),q.m(e,null))),S&1&&c!==(c="list-group-item list-group-item-action text-overflow "+(s[4].id===s[0].session.current_question_id?"list-group-item-dark":"list-group-item-light")+" svelte-za7w49")&&b(n,"class",c),S&1&&l!==(l="question"+s[4].id)&&b(n,"id",l)},d(Q){Q&&P(n),q.d(),r=!1,a()}}}function ds(s){let n,e,i=Ae(s[0].deck.questions),o=[];for(let t=0;t<i.length;t+=1)o[t]=ye(Se(s,i,t));let u=null;return i.length||(u=Te()),{c(){n=k("div"),e=k("ul");for(let t=0;t<o.length;t+=1)o[t].c();u&&u.c(),b(e,"class","list-group"),b(n,"class","overflow-scroll"),We(n,"max-height","85vh")},m(t,c){A(t,n,c),h(n,e);for(let l=0;l<o.length;l+=1)o[l]&&o[l].m(e,null);u&&u.m(e,null)},p(t,[c]){if(c&3){i=Ae(t[0].deck.questions);let l;for(l=0;l<i.length;l+=1){const r=Se(t,i,l);o[l]?o[l].p(r,c):(o[l]=ye(r),o[l].c(),o[l].m(e,null))}for(;l<o.length;l+=1)o[l].d(1);o.length=i.length,!i.length&&u?u.p(t,c):i.length?u&&(u.d(1),u=null):(u=Te(),u.c(),u.m(e,null))}},i:E,o:E,d(t){t&&P(n),Je(o,t),u&&u.d()}}}function _s(s,n,e){let i,{data:o}=n,{examMode:u}=n;const t=c=>e(0,o.session.current_question_id=c.id,o);return s.$$set=c=>{"data"in c&&e(0,o=c.data),"examMode"in c&&e(2,u=c.examMode)},s.$$.update=()=>{s.$$.dirty&1&&(o.session.current_question_id,(()=>{var c=document.getElementById("question"+o.session.current_question_id);c&&c.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})})()),s.$$.dirty&5&&e(1,i=function(c){var l=o.session.answer_choices.find(r=>r.question_id===c.id);return l?u?'<span class="text-dark fw-bold">&check;</span>':l.is_correct?l.help_used?'<span class="text-warning-dark fw-bold">&check;</span>':'<span class="text-success-dark fw-bold">&check;</span>':'<span class="text-danger-dark fw-bold">&cross;</span>':'<span class="text-dark fw-bold">&rightarrow;</span>'})},[o,i,u,t]}class gs extends de{constructor(n){super(),_e(this,n,_s,ds,ge,{data:0,examMode:2})}}function ps(s){let n;return{c(){n=k("div"),n.innerHTML="",b(n,"class","col-6")},m(e,i){A(e,n,i)},p:E,d(e){e&&P(n)}}}function ms(s){let n,e,i,o;return{c(){n=k("div"),e=k("button"),e.innerHTML='<span class="fw-bold">←</span> Previous',b(e,"class","btn btn-sm btn-light w-100"),b(n,"class","col-6")},m(u,t){A(u,n,t),h(n,e),i||(o=j(e,"click",re(s[2])),i=!0)},p:E,d(u){u&&P(n),i=!1,o()}}}function bs(s){let n;return{c(){n=k("div"),n.innerHTML="",b(n,"class","col-6")},m(e,i){A(e,n,i)},p:E,d(e){e&&P(n)}}}function hs(s){let n,e,i,o;return{c(){n=k("div"),e=k("button"),e.innerHTML='Next <span class="fw-bold">→</span>',b(e,"class","btn btn-sm w-100"),C(e,"btn-warning",s[1].isAnswered),C(e,"btn-light",!s[1].isAnswered),b(n,"class","col-6")},m(u,t){A(u,n,t),h(n,e),i||(o=j(e,"click",re(s[3])),i=!0)},p(u,t){t&2&&C(e,"btn-warning",u[1].isAnswered),t&2&&C(e,"btn-light",!u[1].isAnswered)},d(u){u&&P(n),i=!1,o()}}}function ws(s){let n,e;function i(r,a){return r[0].session.current_question_id&&r[0].session.current_question_id!=r[0].deck.questions[0].id?ms:ps}let o=i(s),u=o(s);function t(r,a){return r[0].session.current_question_id!=r[0].deck.questions[r[0].deck.questions.length-1].id?hs:bs}let c=t(s),l=c(s);return{c(){n=k("div"),u.c(),e=B(),l.c(),b(n,"class","row mb-3 pt-1 pb-1 sticky-top bg-white")},m(r,a){A(r,n,a),u.m(n,null),h(n,e),l.m(n,null)},p(r,[a]){o===(o=i(r))&&u?u.p(r,a):(u.d(1),u=o(r),u&&(u.c(),u.m(n,e))),c===(c=t(r))&&l?l.p(r,a):(l.d(1),l=c(r),l&&(l.c(),l.m(n,null)))},i:E,o:E,d(r){r&&P(n),u.d(),l.d()}}}function ks(s,n,e){let{data:i}=n,{currentQuestionId:o}=n,{currentQuestionContext:u}=n;ze(()=>{ve("left","questions",function(r,a){c()}),ve("right","questions",function(r,a){l()}),ve.setScope("questions")});function t(r){return i.deck.questions.findIndex(a=>a.id===r)}function c(){var r=t(o),a=i.deck.questions[r-1];a&&e(0,i.session.current_question_id=a.id,i)}function l(){var r=t(o),a=i.deck.questions[r+1];a&&e(0,i.session.current_question_id=a.id,i)}return s.$$set=r=>{"data"in r&&e(0,i=r.data),"currentQuestionId"in r&&e(4,o=r.currentQuestionId),"currentQuestionContext"in r&&e(1,u=r.currentQuestionContext)},[i,u,c,l,o]}class qs extends de{constructor(n){super(),_e(this,n,ks,ws,ge,{data:0,currentQuestionId:4,currentQuestionContext:1})}}function vs(s){let n;return{c(){n=k("p"),n.textContent="Loading ..."},m(e,i){A(e,n,i)},p:E,i:E,o:E,d(e){e&&P(n)}}}function Cs(s){let n,e,i,o,u,t,c,l,r,a,w,M,q,z,Q,S=s[0].deck.name+"",H,g,p,m,d,Y,W,ie,T,J,ue,Z,le,pe,y,fe,me,L=!s[11]&&(!s[3]||!s[8].isAnswered)&&Fe(s),U=s[3]&&s[8].isAnswered&&Ge(s),N=s[6]&&He(s);function he(_){s[30](_)}function we(_){s[31](_)}function ke(_){s[32](_)}let te={};s[0]!==void 0&&(te.data=s[0]),s[0].session.current_question_id!==void 0&&(te.currentQuestionId=s[0].session.current_question_id),s[8]!==void 0&&(te.currentQuestionContext=s[8]),J=new qs({props:te}),D.push(()=>O(J,"data",he)),D.push(()=>O(J,"currentQuestionId",we)),D.push(()=>O(J,"currentQuestionContext",ke));let V=s[12]&&Le(s);return{c(){n=k("div"),e=k("div"),i=k("p"),o=k("button"),o.innerHTML='<i class="bi bi-layout-sidebar"></i>',u=B(),t=k("button"),t.innerHTML='<i class="bi bi-shuffle"></i>',c=B(),l=k("button"),l.innerHTML='<i class="bi bi-exclamation-square"></i>',r=B(),a=k("span"),w=X(s[13]),M=X("/"),q=X(s[14]),z=B(),Q=k("strong"),H=X(S),g=B(),p=k("div"),m=k("div"),L&&L.c(),d=B(),U&&U.c(),Y=B(),W=k("div"),N&&N.c(),ie=B(),T=k("div"),ee(J.$$.fragment),pe=B(),V&&V.c(),b(o,"class","btn btn-sm d-none d-sm-none d-md-none d-lg-inline"),b(o,"title","Toggle sidebar"),C(o,"bg-light",!s[6]),C(o,"bg-dark-subtle",s[6]),b(t,"class","btn btn-sm"),b(t,"title","Toggle answer shuffling"),C(t,"bg-light",!s[4]),C(t,"bg-dark-subtle",s[4]),b(l,"class","btn btn-sm"),b(l,"title","Toggle exam mode"),C(l,"bg-light",!s[5]),C(l,"bg-dark-subtle",s[5]),b(a,"class","ms-1 float-end fw-bold font-monospace badge text-dark"),C(a,"text-bg-light",!s[1]||s[11]),C(a,"bg-success",!s[11]&&!s[12].is_invalid&&s[1]&&s[1].is_correct),C(a,"bg-danger",!s[11]&&!s[12].is_invalid&&s[1]&&!s[1].is_correct),b(i,"class","text-overflow svelte-1gfmo48"),b(e,"class","col mb-1"),b(n,"class","row"),b(m,"class","col mb-1"),b(p,"class","row"),b(T,"class","col-md-12"),C(T,"col-lg-9",s[6]),C(T,"col-lg-10",!s[6]),C(T,"offset-lg-1",!s[6]),b(W,"class","row mt-3")},m(_,v){A(_,n,v),h(n,e),h(e,i),h(i,o),h(i,u),h(i,t),h(i,c),h(i,l),h(i,r),h(i,a),h(a,w),h(a,M),h(a,q),h(i,z),h(i,Q),h(Q,H),A(_,g,v),A(_,p,v),h(p,m),L&&L.m(m,null),h(m,d),U&&U.m(m,null),A(_,Y,v),A(_,W,v),N&&N.m(W,null),h(W,ie),h(W,T),se(J,T,null),h(T,pe),V&&V.m(T,null),y=!0,fe||(me=[j(o,"click",re(s[23])),j(t,"click",re(s[24])),j(l,"click",re(s[25]))],fe=!0)},p(_,v){(!y||v[0]&64)&&C(o,"bg-light",!_[6]),(!y||v[0]&64)&&C(o,"bg-dark-subtle",_[6]),(!y||v[0]&16)&&C(t,"bg-light",!_[4]),(!y||v[0]&16)&&C(t,"bg-dark-subtle",_[4]),(!y||v[0]&32)&&C(l,"bg-light",!_[5]),(!y||v[0]&32)&&C(l,"bg-dark-subtle",_[5]),(!y||v[0]&8192)&&ae(w,_[13]),(!y||v[0]&16384)&&ae(q,_[14]),(!y||v[0]&2050)&&C(a,"text-bg-light",!_[1]||_[11]),(!y||v[0]&6146)&&C(a,"bg-success",!_[11]&&!_[12].is_invalid&&_[1]&&_[1].is_correct),(!y||v[0]&6146)&&C(a,"bg-danger",!_[11]&&!_[12].is_invalid&&_[1]&&!_[1].is_correct),(!y||v[0]&1)&&S!==(S=_[0].deck.name+"")&&ae(H,S),!_[11]&&(!_[3]||!_[8].isAnswered)?L?(L.p(_,v),v[0]&2312&&I(L,1)):(L=Fe(_),L.c(),I(L,1),L.m(m,d)):L&&($(),G(L,1,1,()=>{L=null}),x()),_[3]&&_[8].isAnswered?U?(U.p(_,v),v[0]&264&&I(U,1)):(U=Ge(_),U.c(),I(U,1),U.m(m,null)):U&&($(),G(U,1,1,()=>{U=null}),x()),_[6]?N?(N.p(_,v),v[0]&64&&I(N,1)):(N=He(_),N.c(),I(N,1),N.m(W,ie)):N&&($(),G(N,1,1,()=>{N=null}),x());const oe={};!ue&&v[0]&1&&(ue=!0,oe.data=_[0],R(()=>ue=!1)),!Z&&v[0]&1&&(Z=!0,oe.currentQuestionId=_[0].session.current_question_id,R(()=>Z=!1)),!le&&v[0]&256&&(le=!0,oe.currentQuestionContext=_[8],R(()=>le=!1)),J.$set(oe),_[12]?V?(V.p(_,v),v[0]&4096&&I(V,1)):(V=Le(_),V.c(),I(V,1),V.m(T,null)):V&&($(),G(V,1,1,()=>{V=null}),x()),(!y||v[0]&64)&&C(T,"col-lg-9",_[6]),(!y||v[0]&64)&&C(T,"col-lg-10",!_[6]),(!y||v[0]&64)&&C(T,"offset-lg-1",!_[6])},i(_){y||(I(L),I(U),I(N),I(J.$$.fragment,_),I(V),y=!0)},o(_){G(L),G(U),G(N),G(J.$$.fragment,_),G(V),y=!1},d(_){_&&(P(n),P(g),P(p),P(Y),P(W)),L&&L.d(),U&&U.d(),N&&N.d(),ne(J),V&&V.d(),fe=!1,Ze(me)}}}function Fe(s){let n,e,i;function o(t){s[26](t)}let u={};return s[2]!==void 0&&(u.progressPercentage=s[2]),n=new es({props:u}),D.push(()=>O(n,"progressPercentage",o)),{c(){ee(n.$$.fragment)},m(t,c){se(n,t,c),i=!0},p(t,c){const l={};!e&&c[0]&4&&(e=!0,l.progressPercentage=t[2],R(()=>e=!1)),n.$set(l)},i(t){i||(I(n.$$.fragment,t),i=!0)},o(t){G(n.$$.fragment,t),i=!1},d(t){ne(n,t)}}}function Ge(s){let n,e,i;function o(t){s[27](t)}let u={sessionId:s[0].session.id};return s[2]!==void 0&&(u.progressPercentage=s[2]),n=new fs({props:u}),D.push(()=>O(n,"progressPercentage",o)),{c(){ee(n.$$.fragment)},m(t,c){se(n,t,c),i=!0},p(t,c){const l={};c[0]&1&&(l.sessionId=t[0].session.id),!e&&c[0]&4&&(e=!0,l.progressPercentage=t[2],R(()=>e=!1)),n.$set(l)},i(t){i||(I(n.$$.fragment,t),i=!0)},o(t){G(n.$$.fragment,t),i=!1},d(t){ne(n,t)}}}function He(s){let n,e,i,o,u;function t(r){s[28](r)}function c(r){s[29](r)}let l={};return s[0]!==void 0&&(l.data=s[0]),s[11]!==void 0&&(l.examMode=s[11]),e=new gs({props:l}),D.push(()=>O(e,"data",t)),D.push(()=>O(e,"examMode",c)),{c(){n=k("div"),ee(e.$$.fragment),b(n,"class","col-lg-3 d-none d-lg-block")},m(r,a){A(r,n,a),se(e,n,null),u=!0},p(r,a){const w={};!i&&a[0]&1&&(i=!0,w.data=r[0],R(()=>i=!1)),!o&&a[0]&2048&&(o=!0,w.examMode=r[11],R(()=>o=!1)),e.$set(w)},i(r){u||(I(e.$$.fragment,r),u=!0)},o(r){G(e.$$.fragment,r),u=!1},d(r){r&&P(n),ne(e)}}}function Le(s){let n,e,i,o,u,t,c,l,r,a;function w(p){s[33](p)}function M(p){s[34](p)}function q(p){s[35](p)}function z(p){s[36](p)}function Q(p){s[37](p)}function S(p){s[38](p)}let H={submitAnswer:s[16],deleteAnswer:s[17],updateCurrentQuestionData:s[15]};s[12]!==void 0&&(H.question=s[12]),s[8]!==void 0&&(H.questionContext=s[8]),s[9]!==void 0&&(H.helpUsed=s[9]),s[1]!==void 0&&(H.answerChoice=s[1]),s[11]!==void 0&&(H.examMode=s[11]),s[4]!==void 0&&(H.settingsShuffleAnswers=s[4]),n=new ss({props:H}),D.push(()=>O(n,"question",w)),D.push(()=>O(n,"questionContext",M)),D.push(()=>O(n,"helpUsed",q)),D.push(()=>O(n,"answerChoice",z)),D.push(()=>O(n,"examMode",Q)),D.push(()=>O(n,"settingsShuffleAnswers",S));let g=!s[11]&&s[8].isAnswered&&Ue(s);return{c(){ee(n.$$.fragment),l=B(),g&&g.c(),r=Ce()},m(p,m){se(n,p,m),A(p,l,m),g&&g.m(p,m),A(p,r,m),a=!0},p(p,m){const d={};!e&&m[0]&4096&&(e=!0,d.question=p[12],R(()=>e=!1)),!i&&m[0]&256&&(i=!0,d.questionContext=p[8],R(()=>i=!1)),!o&&m[0]&512&&(o=!0,d.helpUsed=p[9],R(()=>o=!1)),!u&&m[0]&2&&(u=!0,d.answerChoice=p[1],R(()=>u=!1)),!t&&m[0]&2048&&(t=!0,d.examMode=p[11],R(()=>t=!1)),!c&&m[0]&16&&(c=!0,d.settingsShuffleAnswers=p[4],R(()=>c=!1)),n.$set(d),!p[11]&&p[8].isAnswered?g?(g.p(p,m),m[0]&2304&&I(g,1)):(g=Ue(p),g.c(),I(g,1),g.m(r.parentNode,r)):g&&($(),G(g,1,1,()=>{g=null}),x())},i(p){a||(I(n.$$.fragment,p),I(g),a=!0)},o(p){G(n.$$.fragment,p),G(g),a=!1},d(p){p&&(P(l),P(r)),ne(n,p),g&&g.d(p)}}}function Ue(s){let n,e,i;function o(t){s[39](t)}let u={};return s[12].id!==void 0&&(u.questionId=s[12].id),n=new xe({props:u}),D.push(()=>O(n,"questionId",o)),{c(){ee(n.$$.fragment)},m(t,c){se(n,t,c),i=!0},p(t,c){const l={};!e&&c[0]&4096&&(e=!0,l.questionId=t[12].id,R(()=>e=!1)),n.$set(l)},i(t){i||(I(n.$$.fragment,t),i=!0)},o(t){G(n.$$.fragment,t),i=!1},d(t){ne(n,t)}}}function Ne(s){let n,e,i;function o(t){s[40](t)}let u={};return s[10]!==void 0&&(u.magicGIFPath=s[10]),n=new os({props:u}),D.push(()=>O(n,"magicGIFPath",o)),{c(){ee(n.$$.fragment)},m(t,c){se(n,t,c),i=!0},p(t,c){const l={};!e&&c[0]&1024&&(e=!0,l.magicGIFPath=t[10],R(()=>e=!1)),n.$set(l)},i(t){i||(I(n.$$.fragment,t),i=!0)},o(t){G(n.$$.fragment,t),i=!1},d(t){ne(n,t)}}}function Is(s){let n,e,i,o,u;const t=[Cs,vs],c=[];function l(a,w){return a[0]?0:1}n=l(s),e=c[n]=t[n](s);let r=!s[11]&&Ne(s);return{c(){e.c(),i=B(),r&&r.c(),o=Ce()},m(a,w){c[n].m(a,w),A(a,i,w),r&&r.m(a,w),A(a,o,w),u=!0},p(a,w){let M=n;n=l(a),n===M?c[n].p(a,w):($(),G(c[M],1,1,()=>{c[M]=null}),x(),e=c[n],e?e.p(a,w):(e=c[n]=t[n](a),e.c()),I(e,1),e.m(i.parentNode,i)),a[11]?r&&($(),G(r,1,1,()=>{r=null}),x()):r?(r.p(a,w),w[0]&2048&&I(r,1)):(r=Ne(a),r.c(),I(r,1),r.m(o.parentNode,o))},i(a){u||(I(e),I(r),u=!0)},o(a){G(e),G(r),u=!1},d(a){a&&(P(i),P(o)),c[n].d(a),r&&r.d(a)}}}function Qs(s,n,e){let i,o,u,t,c,l,r,a,w,M,q,z,Q,S,H,g;Xe(s,be,f=>e(7,g=f));let{id:p}=n;var m,d,Y=!1,W="";function ie(){return{isAnswered:!!z,answerContext:w.answers.reduce((F,K)=>(F[K.id]={isCorrectAnswer:K.id===w.correct_answer_id,isSubmittedAnswer:r?K.id===r.answer_id:!1,isSelectedAnswer:r?K.id===r.answer_id:!1},F),{})}}var T=-1;ze(()=>{axios.get("/api/sessions/"+p).then(function(f){e(0,d=f.data)}).catch(function(f){alert(f)})});function J(){return axios.get("/api/questions/"+w.id).then(function(f){var F=d.deck.questions.findIndex(ce=>ce.id===w.id),K=f.data;e(0,d.deck.questions[F]=K,d),ue(K)}).catch(function(f){alert(f)})}function ue(f){if(f.type!=="card"){var F=d.session.answer_choices.findIndex(K=>K.question_id===f.id);F!==-1&&e(0,d.session.answer_choices[F].is_correct=d.session.answer_choices[F].answer_id===f.correct_answer_id,d)}}var Z;function le(){Z&&Z.cancel(),Z=je(()=>{axios.put("/api/sessions/"+d.session.id,d.session).then(function(f){}).catch(function(f){alert(f)})},1e3,{maxWait:2e3}),Z()}function pe(f){if(f?e(8,m.answerContext[f].isSelectedAnswer=!0,m):e(8,m.isAnswered=!0,m),z&&f&&f===w.correct_answer_id){e(8,m.isAnswered=!0,m);return}else if(z)return;var F=!1;w.type==="card"?F=!!f:F=w.correct_answer_id===f;var K={question_id:q,answer_id:f,is_correct:F,help_used:Y};axios.post("/api/sessions/"+p+"/answerchoices",K).then(function(ce){e(0,d.session.answer_choices=[...d.session.answer_choices,ce.data],d),(F||i||!c)&&e(8,m.isAnswered=!0,m),f&&(e(8,m.answerContext[f].isSubmittedAnswer=!0,m),e(8,m.answerContext[f].isCorrectAnswer=F,m))}).catch(function(ce){alert(ce)})}function y(){z&&(e(1,r=d.session.answer_choices.find(f=>f.question_id===q)),r&&axios.delete("/api/sessions/"+p+"/answerchoices/"+r.id).then(function(f){e(0,d.session.answer_choices=[...d.session.answer_choices.filter(F=>F.question_id!==q)],d),Ye().then(()=>{e(8,m=ie())})}).catch(function(f){alert(f)}))}const fe=()=>{qe(be,g.session_show_sidebar=!g.session_show_sidebar,g)},me=()=>{qe(be,g.session_shuffle_answers=!g.session_shuffle_answers,g)},L=()=>{qe(be,g.session_exam_mode=!g.session_exam_mode,g)};function U(f){Q=f,e(2,Q),e(0,d),e(22,l),e(21,a)}function N(f){Q=f,e(2,Q),e(0,d),e(22,l),e(21,a)}function he(f){d=f,e(0,d)}function we(f){i=f,e(11,i),e(3,M),e(7,g),e(0,d),e(22,l),e(21,a)}function ke(f){d=f,e(0,d)}function te(f){s.$$.not_equal(d.session.current_question_id,f)&&(d.session.current_question_id=f,e(0,d))}function V(f){m=f,e(8,m),e(20,q),e(0,d)}function _(f){w=f,e(12,w),e(0,d)}function v(f){m=f,e(8,m),e(20,q),e(0,d)}function oe(f){Y=f,e(9,Y)}function Be(f){r=f,e(1,r),e(0,d),e(20,q)}function Ee(f){i=f,e(11,i),e(3,M),e(7,g),e(0,d),e(22,l),e(21,a)}function De(f){t=f,e(4,t),e(7,g)}function Oe(f){s.$$.not_equal(w.id,f)&&(w.id=f,e(12,w),e(0,d))}function Re(f){W=f,e(10,W),e(2,Q),e(19,T),e(0,d),e(22,l),e(21,a)}return s.$$set=f=>{"id"in f&&e(18,p=f.id)},s.$$.update=()=>{s.$$.dirty[0]&1&&e(22,l=d?d.deck.questions.filter(f=>!f.is_invalid):null),s.$$.dirty[0]&4194305&&e(21,a=d?d.session.answer_choices.filter(f=>l.some(({id:F})=>F===f.question_id)):null),s.$$.dirty[0]&6291457&&e(3,M=d?l.length===a.length:!1),s.$$.dirty[0]&136&&e(11,i=M?!1:g.session_exam_mode),s.$$.dirty[0]&128&&e(6,o=g.session_show_sidebar),s.$$.dirty[0]&128&&e(5,u=g.session_exam_mode),s.$$.dirty[0]&128&&e(4,t=g.session_shuffle_answers),s.$$.dirty[0]&128&&(c=g.session_multiple_answer_tries),s.$$.dirty[0]&64&&axios.put("/api/users/me/settings",{session_show_sidebar:o}).then(function(f){}).catch(function(f){alert(f)}),s.$$.dirty[0]&32&&axios.put("/api/users/me/settings",{session_exam_mode:u}).then(function(f){}).catch(function(f){alert(f)}),s.$$.dirty[0]&16&&axios.put("/api/users/me/settings",{session_shuffle_answers:t}).then(function(f){}).catch(function(f){alert(f)}),s.$$.dirty[0]&1&&e(20,q=d?d.session.current_question_id:null),s.$$.dirty[0]&1048577&&e(1,r=d?d.session.answer_choices.find(f=>f.question_id===q):null),s.$$.dirty[0]&1&&e(12,w=d?d.deck.questions.find(f=>f.id===d.session.current_question_id):null),s.$$.dirty[0]&8&&M&&e(11,i=!1),s.$$.dirty[0]&1048576&&le(),s.$$.dirty[0]&3&&(z=d?!!r:!1),s.$$.dirty[0]&1048576&&q&&e(8,m=ie()),s.$$.dirty[0]&6291457&&e(2,Q=d?ns(l.length,a):null),s.$$.dirty[0]&1&&e(14,S=d?d.deck.questions.length:0),s.$$.dirty[0]&1&&e(13,H=d?d.deck.questions.findIndex(f=>f.id==d.session.current_question_id)+1:null),s.$$.dirty[0]&524292&&(()=>{if(Q){var f=Q.correct;if(f<60){e(19,T=f);return}if(T===-1){e(19,T=f);return}T<60&&(e(19,T=f),axios.get("/api/magic-gif").then(function(F){e(10,W="magic-gifs/"+F.data.id)}).catch(function(F){}))}})()},[d,r,Q,M,t,u,o,g,m,Y,W,i,w,H,S,J,pe,y,p,T,q,a,l,fe,me,L,U,N,he,we,ke,te,V,_,v,oe,Be,Ee,De,Oe,Re]}class As extends de{constructor(n){super(),_e(this,n,Qs,Is,ge,{id:18},null,[-1,-1])}}const Ve=document.getElementById("SessionView");new As({target:Ve,props:{id:Ve.dataset.sessionId}});
