import{S as de,i as _e,s as ge,e as Se,b as Q,n as E,d as P,C as Pe,c as C,f as k,o as S,m as Xe,E as I,M as ye,h as q,l as ie,a as V,t as $,q as we,p as ce,k as O,H as tn,y as H,z as ne,x as M,K as on,r as W,u as te,v as oe,w as K,A as re,D as se,N as rn,L as Me,B as un}from"./index-CW_84yAU.js";import{p as Fe,d as ln}from"./purify.es-BMHaTOf2.js";import{e as Ce}from"./each-23V_io8F.js";import{M as fn}from"./Messages-C4nte6_W.js";import{C as an}from"./auto-TbvzFur0.js";import{S as cn}from"./SessionProgressBar-BE59Qe1D.js";import{h as Qe,S as dn}from"./SessionQuestionView-F9UU6K02.js";import{s as _n}from"./StatsHelper-B91isISU.js";import{U as qe}from"./UserSettingsStore-D7Gisc9d.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./parseISO-JEmvXouO.js";import"./lodash-DBMh2b1a.js";import"./QuestionForm-Cg9WuGt-.js";function Ge(s,n,e){const i=s.slice();return i[19]=n[e],i}function Te(s){let n,e=Ce({length:s[6]}),i=[];for(let o=0;o<e.length;o+=1)i[o]=ze(Ge(s,e,o));return{c(){n=C("div");for(let o=0;o<i.length;o+=1)i[o].c();k(n,"class","confetti-holder svelte-15ksp55"),S(n,"rounded",s[9]),S(n,"cone",s[10]),S(n,"no-gravity",s[11]),S(n,"reduced-motion",s[13])},m(o,r){Q(o,n,r);for(let t=0;t<i.length;t+=1)i[t]&&i[t].m(n,null)},p(o,r){if(r&37375){e=Ce({length:o[6]});let t;for(t=0;t<e.length;t+=1){const d=Ge(o,e,t);i[t]?i[t].p(d,r):(i[t]=ze(d),i[t].c(),i[t].m(n,null))}for(;t<i.length;t+=1)i[t].d(1);i.length=e.length}r&512&&S(n,"rounded",o[9]),r&1024&&S(n,"cone",o[10]),r&2048&&S(n,"no-gravity",o[11]),r&8192&&S(n,"reduced-motion",o[13])},d(o){o&&P(n),Xe(i,o)}}}function ze(s){let n;return{c(){n=C("div"),k(n,"class","confetti svelte-15ksp55"),I(n,"--fall-distance",s[8]),I(n,"--size",s[0]+"px"),I(n,"--color",s[15]()),I(n,"--skew",X(-45,45)+"deg,"+X(-45,45)+"deg"),I(n,"--rotation-xyz",X(-10,10)+", "+X(-10,10)+", "+X(-10,10)),I(n,"--rotation-deg",X(0,360)+"deg"),I(n,"--translate-y-multiplier",X(s[2][0],s[2][1])),I(n,"--translate-x-multiplier",X(s[1][0],s[1][1])),I(n,"--scale",.1*X(2,10)),I(n,"--transition-duration",s[4]?`calc(${s[3]}ms * var(--scale))`:`${s[3]}ms`),I(n,"--transition-delay",X(s[5][0],s[5][1])+"ms"),I(n,"--transition-iteration-count",s[4]?"infinite":s[7]),I(n,"--x-spread",1-s[12])},m(e,i){Q(e,n,i)},p(e,i){i&256&&I(n,"--fall-distance",e[8]),i&1&&I(n,"--size",e[0]+"px"),i&4&&I(n,"--translate-y-multiplier",X(e[2][0],e[2][1])),i&2&&I(n,"--translate-x-multiplier",X(e[1][0],e[1][1])),i&24&&I(n,"--transition-duration",e[4]?`calc(${e[3]}ms * var(--scale))`:`${e[3]}ms`),i&32&&I(n,"--transition-delay",X(e[5][0],e[5][1])+"ms"),i&144&&I(n,"--transition-iteration-count",e[4]?"infinite":e[7]),i&4096&&I(n,"--x-spread",1-e[12])},d(e){e&&P(n)}}}function gn(s){let n,e=!s[14]&&Te(s);return{c(){e&&e.c(),n=Se()},m(i,o){e&&e.m(i,o),Q(i,n,o)},p(i,[o]){i[14]?e&&(e.d(1),e=null):e?e.p(i,o):(e=Te(i),e.c(),e.m(n.parentNode,n))},i:E,o:E,d(i){i&&P(n),e&&e.d(i)}}}function X(s,n){return Math.random()*(n-s)+s}function mn(s,n,e){let{size:i=10}=n,{x:o=[-.5,.5]}=n,{y:r=[.25,1]}=n,{duration:t=2e3}=n,{infinite:d=!1}=n,{delay:u=[0,50]}=n,{colorRange:f=[0,360]}=n,{colorArray:a=[]}=n,{amount:p=50}=n,{iterationCount:w=1}=n,{fallDistance:m="100px"}=n,{rounded:G=!1}=n,{cone:v=!1}=n,{noGravity:T=!1}=n,{xSpread:z=.15}=n,{destroyOnComplete:y=!0}=n,{disableForReducedMotion:F=!1}=n,h=!1;Pe(()=>{!y||d||w=="infinite"||setTimeout(()=>e(14,h=!0),(t+u[1])*w)});function b(){return a.length?a[Math.round(Math.random()*(a.length-1))]:`hsl(${Math.round(X(f[0],f[1]))}, 75%, 50%)`}return s.$$set=c=>{"size"in c&&e(0,i=c.size),"x"in c&&e(1,o=c.x),"y"in c&&e(2,r=c.y),"duration"in c&&e(3,t=c.duration),"infinite"in c&&e(4,d=c.infinite),"delay"in c&&e(5,u=c.delay),"colorRange"in c&&e(16,f=c.colorRange),"colorArray"in c&&e(17,a=c.colorArray),"amount"in c&&e(6,p=c.amount),"iterationCount"in c&&e(7,w=c.iterationCount),"fallDistance"in c&&e(8,m=c.fallDistance),"rounded"in c&&e(9,G=c.rounded),"cone"in c&&e(10,v=c.cone),"noGravity"in c&&e(11,T=c.noGravity),"xSpread"in c&&e(12,z=c.xSpread),"destroyOnComplete"in c&&e(18,y=c.destroyOnComplete),"disableForReducedMotion"in c&&e(13,F=c.disableForReducedMotion)},[i,o,r,t,d,u,p,w,m,G,v,T,z,F,h,b,f,a,y]}class hn extends de{constructor(n){super(),_e(this,n,mn,gn,ge,{size:0,x:1,y:2,duration:3,infinite:4,delay:5,colorRange:16,colorArray:17,amount:6,iterationCount:7,fallDistance:8,rounded:9,cone:10,noGravity:11,xSpread:12,destroyOnComplete:18,disableForReducedMotion:13})}}function He(s){let n,e,i,o,r;return{c(){n=C("div"),e=C("img"),k(e,"class","img-fluid"),ye(e.src,i="/"+s[0])||k(e,"src",i),k(e,"alt","Magic GIF"),k(n,"class","img-fullscreen d-flex justify-content-center align-items-center svelte-k1osqd")},m(t,d){Q(t,n,d),q(n,e),o||(r=ie(n,"click",s[2]),o=!0)},p(t,d){d&1&&!ye(e.src,i="/"+t[0])&&k(e,"src",i)},d(t){t&&P(n),o=!1,r()}}}function bn(s){let n,e=s[0]&&s[1]&&He(s);return{c(){e&&e.c(),n=Se()},m(i,o){e&&e.m(i,o),Q(i,n,o)},p(i,[o]){i[0]&&i[1]?e?e.p(i,o):(e=He(i),e.c(),e.m(n.parentNode,n)):e&&(e.d(1),e=null)},i:E,o:E,d(i){i&&P(n),e&&e.d(i)}}}function pn(s,n,e){let{magicGIFPath:i=""}=n;var o=!0;function r(){e(1,o=!o)}return s.$$set=t=>{"magicGIFPath"in t&&e(0,i=t.magicGIFPath)},[i,o,r]}class wn extends de{constructor(n){super(),_e(this,n,pn,bn,ge,{magicGIFPath:0})}}function Le(s){let n,e,i;return{c(){n=C("button"),n.innerHTML='<i class="bi bi-repeat"></i> Repeat incorrect',k(n,"class","btn btn-sm btn-outline-secondary"),k(n,"type","button")},m(o,r){Q(o,n,r),e||(i=ie(n,"click",ce(s[5])),e=!0)},p:E,d(o){o&&P(n),e=!1,i()}}}function kn(s){let n,e,i,o,r,t,d,u=s[0].correct+"",f,a,p,w,m,G,v,T,z,y=s[0].incorrect>0&&Le(s);return{c(){n=C("div"),e=C("div"),i=C("canvas"),o=V(),r=C("div"),t=C("p"),d=C("span"),f=$(u),a=$("%"),p=$(" correct"),w=V(),m=C("div"),G=C("a"),G.innerHTML='<i class="bi bi-rocket-takeoff"></i> New session',v=V(),y&&y.c(),T=V(),z=C("a"),z.textContent="Home",k(e,"class","col-md"),k(d,"class","fs-4 font-monospace"),k(t,"class","mt-3 text-dark"),k(G,"href","/sessions/create"),k(G,"class","btn btn-sm btn-primary"),k(z,"href","/"),k(z,"class","btn btn-sm btn-outline-secondary"),k(m,"class","d-grid gap-2"),k(r,"class","col-md"),k(n,"class","row mb-5")},m(F,h){Q(F,n,h),q(n,e),q(e,i),s[4](i),q(n,o),q(n,r),q(r,t),q(t,d),q(d,f),q(d,a),q(t,p),q(r,w),q(r,m),q(m,G),q(m,v),y&&y.m(m,null),q(m,T),q(m,z)},p(F,[h]){h&1&&u!==(u=F[0].correct+"")&&we(f,u),F[0].incorrect>0?y?y.p(F,h):(y=Le(F),y.c(),y.m(m,T)):y&&(y.d(1),y=null)},i:E,o:E,d(F){F&&P(n),s[4](null),y&&y.d()}}}function qn(s){axios.post("/api/sessions/"+s+"/newfromincorrect").then(function(n){window.location.href="/sessions/"+n.data.id}).catch(function(n){alert(n)})}function Cn(s,n,e){let{progressPercentage:i}=n,{sessionId:o}=n,r,t;function d(f){O[f?"unshift":"push"](()=>{r=f,e(2,r)})}const u=()=>qn(o);return s.$$set=f=>{"progressPercentage"in f&&e(0,i=f.progressPercentage),"sessionId"in f&&e(1,o=f.sessionId)},s.$$.update=()=>{s.$$.dirty&13&&r&&(()=>{if(t)return;const f={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect"],datasets:[{label:"%",data:[i.correct,i.correctWithHelp,i.incorrect],backgroundColor:["#d4edda","#fff3cd","#f8d7da"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};t&&t.destroy();var a=r.getContext("2d");e(3,t=new an(a,f))})()},[i,o,r,t,d,u]}class Sn extends de{constructor(n){super(),_e(this,n,Cn,kn,ge,{progressPercentage:0,sessionId:1})}}function Ne(s,n,e){const i=s.slice();return i[5]=n[e],i[7]=e,i}function Re(s){let n;return{c(){n=C("li"),n.textContent="Loading ...",k(n,"class","svelte-za7w49")},m(e,i){Q(e,n,i)},p:E,d(e){e&&P(n)}}}function An(s){let n,e=s[7]+1+"",i;return{c(){n=$("Question Nr. "),i=$(e)},m(o,r){Q(o,n,r),Q(o,i,r)},p:E,d(o){o&&(P(n),P(i))}}}function vn(s){let n=Fe.sanitize(s[5].text).replace(/<\/?[^>]+(>|$)/g,"")+"",e;return{c(){e=$(n)},m(i,o){Q(i,e,o)},p(i,o){o&1&&n!==(n=Fe.sanitize(i[5].text).replace(/<\/?[^>]+(>|$)/g,"")+"")&&we(e,n)},d(i){i&&P(e)}}}function Ue(s){let n,e,i,o=s[1](s[5])+"",r,t,d,u,f,a;function p(v,T){return v[5].text?vn:An}let w=p(s),m=w(s);function G(){return s[4](s[5])}return{c(){n=C("li"),e=C("small"),i=new tn(!1),r=V(),m.c(),t=V(),i.a=r,k(n,"class",d="list-group-item list-group-item-action text-overflow "+(s[5].id===s[0].session.current_question_id?"list-group-item-dark":"list-group-item-light")+" svelte-za7w49"),k(n,"id",u="question"+s[5].id)},m(v,T){Q(v,n,T),q(n,e),i.m(o,e),q(e,r),m.m(e,null),q(n,t),f||(a=ie(n,"click",G),f=!0)},p(v,T){s=v,T&3&&o!==(o=s[1](s[5])+"")&&i.p(o),w===(w=p(s))&&m?m.p(s,T):(m.d(1),m=w(s),m&&(m.c(),m.m(e,null))),T&1&&d!==(d="list-group-item list-group-item-action text-overflow "+(s[5].id===s[0].session.current_question_id?"list-group-item-dark":"list-group-item-light")+" svelte-za7w49")&&k(n,"class",d),T&1&&u!==(u="question"+s[5].id)&&k(n,"id",u)},d(v){v&&P(n),m.d(),f=!1,a()}}}function In(s){let n,e,i=Ce(s[0].deck.questions),o=[];for(let t=0;t<i.length;t+=1)o[t]=Ue(Ne(s,i,t));let r=null;return i.length||(r=Re()),{c(){n=C("div"),e=C("ul");for(let t=0;t<o.length;t+=1)o[t].c();r&&r.c(),k(e,"class","list-group"),k(n,"class","overflow-scroll"),I(n,"max-height","85vh")},m(t,d){Q(t,n,d),q(n,e);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(e,null);r&&r.m(e,null)},p(t,[d]){if(d&3){i=Ce(t[0].deck.questions);let u;for(u=0;u<i.length;u+=1){const f=Ne(t,i,u);o[u]?o[u].p(f,d):(o[u]=Ue(f),o[u].c(),o[u].m(e,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=i.length,!i.length&&r?r.p(t,d):i.length?r&&(r.d(1),r=null):(r=Re(),r.c(),r.m(e,null))}},i:E,o:E,d(t){t&&P(n),Xe(o,t),r&&r.d()}}}function Mn(s,n,e){let i,o,{data:r}=n,{examMode:t}=n;const d=u=>e(0,r.session.current_question_id=u.id,r);return s.$$set=u=>{"data"in u&&e(0,r=u.data),"examMode"in u&&e(2,t=u.examMode)},s.$$.update=()=>{s.$$.dirty&1&&e(3,i=r.session.current_question_id),s.$$.dirty&8&&(()=>{var u=document.getElementById("question"+i);u&&u.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})})(),s.$$.dirty&5&&e(1,o=function(u){var f=r.session.answer_choices.find(a=>a.question_id===u.id);return f?t?'<span class="text-dark fw-bold">&check;</span>':f.is_correct?f.help_used?'<span class="text-warning-dark fw-bold">&check;</span>':'<span class="text-success-dark fw-bold">&check;</span>':'<span class="text-danger-dark fw-bold">&cross;</span>':'<span class="text-dark fw-bold">&rightarrow;</span>'})},[r,o,t,i,d]}class Qn extends de{constructor(n){super(),_e(this,n,Mn,In,ge,{data:0,examMode:2})}}function Pn(s){let n;return{c(){n=C("div"),n.innerHTML="",k(n,"class","col-6")},m(e,i){Q(e,n,i)},p:E,d(e){e&&P(n)}}}function yn(s){let n,e,i,o;return{c(){n=C("div"),e=C("button"),e.innerHTML='<span class="fw-bold">←</span> Previous',k(e,"class","btn btn-sm btn-light w-100"),k(n,"class","col-6")},m(r,t){Q(r,n,t),q(n,e),i||(o=ie(e,"click",ce(s[2])),i=!0)},p:E,d(r){r&&P(n),i=!1,o()}}}function Fn(s){let n;return{c(){n=C("div"),n.innerHTML="",k(n,"class","col-6")},m(e,i){Q(e,n,i)},p:E,d(e){e&&P(n)}}}function Gn(s){let n,e,i,o;return{c(){n=C("div"),e=C("button"),e.innerHTML='Next <span class="fw-bold">→</span>',k(e,"class","btn btn-sm w-100"),S(e,"btn-warning",s[1].isAnswered),S(e,"btn-light",!s[1].isAnswered),k(n,"class","col-6")},m(r,t){Q(r,n,t),q(n,e),i||(o=ie(e,"click",ce(s[3])),i=!0)},p(r,t){t&2&&S(e,"btn-warning",r[1].isAnswered),t&2&&S(e,"btn-light",!r[1].isAnswered)},d(r){r&&P(n),i=!1,o()}}}function Tn(s){let n,e;function i(f,a){return f[0].session.current_question_id&&f[0].session.current_question_id!=f[0].deck.questions[0].id?yn:Pn}let o=i(s),r=o(s);function t(f,a){return f[0].session.current_question_id!=f[0].deck.questions[f[0].deck.questions.length-1].id?Gn:Fn}let d=t(s),u=d(s);return{c(){n=C("div"),r.c(),e=V(),u.c(),k(n,"class","row mb-3 pt-1 pb-1 sticky-top bg-white")},m(f,a){Q(f,n,a),r.m(n,null),q(n,e),u.m(n,null)},p(f,[a]){o===(o=i(f))&&r?r.p(f,a):(r.d(1),r=o(f),r&&(r.c(),r.m(n,e))),d===(d=t(f))&&u?u.p(f,a):(u.d(1),u=d(f),u&&(u.c(),u.m(n,null)))},i:E,o:E,d(f){f&&P(n),r.d(),u.d()}}}function zn(s,n,e){let{data:i}=n,{currentQuestionId:o}=n,{currentQuestionContext:r}=n;Pe(()=>{Qe("left","questions",function(f,a){d()}),Qe("right","questions",function(f,a){u()}),Qe.setScope("questions")});function t(f){return i.deck.questions.findIndex(a=>a.id===f)}function d(){var f=t(o),a=i.deck.questions[f-1];a&&e(0,i.session.current_question_id=a.id,i)}function u(){var f=t(o),a=i.deck.questions[f+1];a&&e(0,i.session.current_question_id=a.id,i)}return s.$$set=f=>{"data"in f&&e(0,i=f.data),"currentQuestionId"in f&&e(4,o=f.currentQuestionId),"currentQuestionContext"in f&&e(1,r=f.currentQuestionContext)},[i,r,d,u,o]}class Hn extends de{constructor(n){super(),_e(this,n,zn,Tn,ge,{data:0,currentQuestionId:4,currentQuestionContext:1})}}function Ln(s){let n;return{c(){n=C("p"),n.textContent="Loading ..."},m(e,i){Q(e,n,i)},p:E,i:E,o:E,d(e){e&&P(n)}}}function Nn(s){let n,e,i,o,r,t,d,u,f,a,p,w,m,G,v,T,z=s[0].deck.name+"",y,F,h,b,c,_,ee,Y,le,J,Z,j,me,he,ue,L,be,ke,R=!s[13]&&s[16]&&(!s[4]||!s[9].isAnswered)&&De(s),U=s[4]&&s[9].isAnswered&&Be(s),D=s[7]&&Ve(s);function Ae(g){s[33](g)}function ve(g){s[34](g)}function Ie(g){s[35](g)}let fe={};s[0]!==void 0&&(fe.data=s[0]),s[0].session.current_question_id!==void 0&&(fe.currentQuestionId=s[0].session.current_question_id),s[9]!==void 0&&(fe.currentQuestionContext=s[9]),Z=new Hn({props:fe}),O.push(()=>W(Z,"data",Ae)),O.push(()=>W(Z,"currentQuestionId",ve)),O.push(()=>W(Z,"currentQuestionContext",Ie));let B=s[14]&&Ee(s);return{c(){n=C("div"),e=C("div"),i=C("p"),o=C("button"),o.innerHTML='<i class="bi bi-layout-sidebar"></i>',r=V(),t=C("button"),t.innerHTML='<i class="bi bi-shuffle"></i>',d=V(),u=C("button"),u.innerHTML='<i class="bi bi-exclamation-square"></i>',f=V(),a=C("span"),p=$(s[15]),w=$("/"),m=$(s[2]),G=V(),v=C("a"),T=C("strong"),y=$(z),h=V(),b=C("div"),c=C("div"),R&&R.c(),_=V(),U&&U.c(),ee=V(),Y=C("div"),D&&D.c(),le=V(),J=C("div"),te(Z.$$.fragment),ue=V(),B&&B.c(),k(o,"class","btn btn-sm d-none d-sm-none d-md-none d-lg-inline"),k(o,"title","Toggle sidebar"),S(o,"bg-light",!s[7]),S(o,"bg-dark-subtle",s[7]),k(t,"class","btn btn-sm"),k(t,"title","Toggle answer shuffling"),S(t,"bg-light",!s[5]),S(t,"bg-dark-subtle",s[5]),k(u,"class","btn btn-sm"),k(u,"title","Toggle exam mode"),S(u,"bg-light",!s[6]),S(u,"bg-dark-subtle",s[6]),k(a,"class","ms-1 float-end fw-bold font-monospace badge text-dark"),S(a,"text-bg-light",!s[1]||s[13]),S(a,"bg-success",!s[13]&&!s[14].is_invalid&&s[1]&&s[1].is_correct),S(a,"bg-danger",!s[13]&&!s[14].is_invalid&&s[1]&&!s[1].is_correct),k(v,"href",F="/decks/"+s[0].deck.id),k(v,"class","text-reset text-decoration-none"),k(i,"class","text-overflow svelte-1gfmo48"),k(e,"class","col mb-1"),k(n,"class","row"),k(c,"class","col mb-1"),k(b,"class","row"),k(J,"class","col-md-12"),S(J,"col-lg-9",s[7]),S(J,"col-lg-10",!s[7]),S(J,"offset-lg-1",!s[7]),k(Y,"class","row mt-3")},m(g,A){Q(g,n,A),q(n,e),q(e,i),q(i,o),q(i,r),q(i,t),q(i,d),q(i,u),q(i,f),q(i,a),q(a,p),q(a,w),q(a,m),q(i,G),q(i,v),q(v,T),q(T,y),Q(g,h,A),Q(g,b,A),q(b,c),R&&R.m(c,null),q(c,_),U&&U.m(c,null),Q(g,ee,A),Q(g,Y,A),D&&D.m(Y,null),q(Y,le),q(Y,J),oe(Z,J,null),q(J,ue),B&&B.m(J,null),L=!0,be||(ke=[ie(o,"click",ce(s[26])),ie(t,"click",ce(s[27])),ie(u,"click",ce(s[28]))],be=!0)},p(g,A){(!L||A[0]&128)&&S(o,"bg-light",!g[7]),(!L||A[0]&128)&&S(o,"bg-dark-subtle",g[7]),(!L||A[0]&32)&&S(t,"bg-light",!g[5]),(!L||A[0]&32)&&S(t,"bg-dark-subtle",g[5]),(!L||A[0]&64)&&S(u,"bg-light",!g[6]),(!L||A[0]&64)&&S(u,"bg-dark-subtle",g[6]),(!L||A[0]&32768)&&we(p,g[15]),(!L||A[0]&4)&&we(m,g[2]),(!L||A[0]&8194)&&S(a,"text-bg-light",!g[1]||g[13]),(!L||A[0]&24578)&&S(a,"bg-success",!g[13]&&!g[14].is_invalid&&g[1]&&g[1].is_correct),(!L||A[0]&24578)&&S(a,"bg-danger",!g[13]&&!g[14].is_invalid&&g[1]&&!g[1].is_correct),(!L||A[0]&1)&&z!==(z=g[0].deck.name+"")&&we(y,z),(!L||A[0]&1&&F!==(F="/decks/"+g[0].deck.id))&&k(v,"href",F),!g[13]&&g[16]&&(!g[4]||!g[9].isAnswered)?R?(R.p(g,A),A[0]&74256&&M(R,1)):(R=De(g),R.c(),M(R,1),R.m(c,_)):R&&(se(),H(R,1,1,()=>{R=null}),ne()),g[4]&&g[9].isAnswered?U?(U.p(g,A),A[0]&528&&M(U,1)):(U=Be(g),U.c(),M(U,1),U.m(c,null)):U&&(se(),H(U,1,1,()=>{U=null}),ne()),g[7]?D?(D.p(g,A),A[0]&128&&M(D,1)):(D=Ve(g),D.c(),M(D,1),D.m(Y,le)):D&&(se(),H(D,1,1,()=>{D=null}),ne());const ae={};!j&&A[0]&1&&(j=!0,ae.data=g[0],K(()=>j=!1)),!me&&A[0]&1&&(me=!0,ae.currentQuestionId=g[0].session.current_question_id,K(()=>me=!1)),!he&&A[0]&512&&(he=!0,ae.currentQuestionContext=g[9],K(()=>he=!1)),Z.$set(ae),g[14]?B?(B.p(g,A),A[0]&16384&&M(B,1)):(B=Ee(g),B.c(),M(B,1),B.m(J,null)):B&&(se(),H(B,1,1,()=>{B=null}),ne()),(!L||A[0]&128)&&S(J,"col-lg-9",g[7]),(!L||A[0]&128)&&S(J,"col-lg-10",!g[7]),(!L||A[0]&128)&&S(J,"offset-lg-1",!g[7])},i(g){L||(M(R),M(U),M(D),M(Z.$$.fragment,g),M(B),L=!0)},o(g){H(R),H(U),H(D),H(Z.$$.fragment,g),H(B),L=!1},d(g){g&&(P(n),P(h),P(b),P(ee),P(Y)),R&&R.d(),U&&U.d(),D&&D.d(),re(Z),B&&B.d(),be=!1,un(ke)}}}function De(s){let n,e,i;function o(t){s[29](t)}let r={};return s[3]!==void 0&&(r.progressPercentage=s[3]),n=new cn({props:r}),O.push(()=>W(n,"progressPercentage",o)),{c(){te(n.$$.fragment)},m(t,d){oe(n,t,d),i=!0},p(t,d){const u={};!e&&d[0]&8&&(e=!0,u.progressPercentage=t[3],K(()=>e=!1)),n.$set(u)},i(t){i||(M(n.$$.fragment,t),i=!0)},o(t){H(n.$$.fragment,t),i=!1},d(t){re(n,t)}}}function Be(s){let n,e,i;function o(t){s[30](t)}let r={sessionId:s[0].session.id};return s[3]!==void 0&&(r.progressPercentage=s[3]),n=new Sn({props:r}),O.push(()=>W(n,"progressPercentage",o)),{c(){te(n.$$.fragment)},m(t,d){oe(n,t,d),i=!0},p(t,d){const u={};d[0]&1&&(u.sessionId=t[0].session.id),!e&&d[0]&8&&(e=!0,u.progressPercentage=t[3],K(()=>e=!1)),n.$set(u)},i(t){i||(M(n.$$.fragment,t),i=!0)},o(t){H(n.$$.fragment,t),i=!1},d(t){re(n,t)}}}function Ve(s){let n,e,i,o,r;function t(f){s[31](f)}function d(f){s[32](f)}let u={};return s[0]!==void 0&&(u.data=s[0]),s[13]!==void 0&&(u.examMode=s[13]),e=new Qn({props:u}),O.push(()=>W(e,"data",t)),O.push(()=>W(e,"examMode",d)),{c(){n=C("div"),te(e.$$.fragment),k(n,"class","col-lg-3 d-none d-lg-block")},m(f,a){Q(f,n,a),oe(e,n,null),r=!0},p(f,a){const p={};!i&&a[0]&1&&(i=!0,p.data=f[0],K(()=>i=!1)),!o&&a[0]&8192&&(o=!0,p.examMode=f[13],K(()=>o=!1)),e.$set(p)},i(f){r||(M(e.$$.fragment,f),r=!0)},o(f){H(e.$$.fragment,f),r=!1},d(f){f&&P(n),re(e)}}}function Ee(s){let n,e,i,o,r,t,d,u,f,a,p;function w(b){s[36](b)}function m(b){s[37](b)}function G(b){s[38](b)}function v(b){s[39](b)}function T(b){s[40](b)}function z(b){s[41](b)}function y(b){s[42](b)}let F={deckId:s[0].deck.id,submitAnswer:s[19],deleteAnswer:s[20],updateCurrentQuestionData:s[18]};s[14]!==void 0&&(F.question=s[14]),s[9]!==void 0&&(F.questionContext=s[9]),s[10]!==void 0&&(F.helpUsed=s[10]),s[1]!==void 0&&(F.answerChoice=s[1]),s[13]!==void 0&&(F.examMode=s[13]),s[5]!==void 0&&(F.settingsShuffleAnswers=s[5]),s[17]!==void 0&&(F.settingsShowAnswerStats=s[17]),n=new dn({props:F}),O.push(()=>W(n,"question",w)),O.push(()=>W(n,"questionContext",m)),O.push(()=>W(n,"helpUsed",G)),O.push(()=>W(n,"answerChoice",v)),O.push(()=>W(n,"examMode",T)),O.push(()=>W(n,"settingsShuffleAnswers",z)),O.push(()=>W(n,"settingsShowAnswerStats",y));let h=!s[13]&&s[9].isAnswered&&Oe(s);return{c(){te(n.$$.fragment),f=V(),h&&h.c(),a=Se()},m(b,c){oe(n,b,c),Q(b,f,c),h&&h.m(b,c),Q(b,a,c),p=!0},p(b,c){const _={};c[0]&1&&(_.deckId=b[0].deck.id),!e&&c[0]&16384&&(e=!0,_.question=b[14],K(()=>e=!1)),!i&&c[0]&512&&(i=!0,_.questionContext=b[9],K(()=>i=!1)),!o&&c[0]&1024&&(o=!0,_.helpUsed=b[10],K(()=>o=!1)),!r&&c[0]&2&&(r=!0,_.answerChoice=b[1],K(()=>r=!1)),!t&&c[0]&8192&&(t=!0,_.examMode=b[13],K(()=>t=!1)),!d&&c[0]&32&&(d=!0,_.settingsShuffleAnswers=b[5],K(()=>d=!1)),!u&&c[0]&131072&&(u=!0,_.settingsShowAnswerStats=b[17],K(()=>u=!1)),n.$set(_),!b[13]&&b[9].isAnswered?h?(h.p(b,c),c[0]&8704&&M(h,1)):(h=Oe(b),h.c(),M(h,1),h.m(a.parentNode,a)):h&&(se(),H(h,1,1,()=>{h=null}),ne())},i(b){p||(M(n.$$.fragment,b),M(h),p=!0)},o(b){H(n.$$.fragment,b),H(h),p=!1},d(b){b&&(P(f),P(a)),re(n,b),h&&h.d(b)}}}function Oe(s){let n,e,i;function o(t){s[43](t)}let r={};return s[14].id!==void 0&&(r.questionId=s[14].id),n=new fn({props:r}),O.push(()=>W(n,"questionId",o)),{c(){te(n.$$.fragment)},m(t,d){oe(n,t,d),i=!0},p(t,d){const u={};!e&&d[0]&16384&&(e=!0,u.questionId=t[14].id,K(()=>e=!1)),n.$set(u)},i(t){i||(M(n.$$.fragment,t),i=!0)},o(t){H(n.$$.fragment,t),i=!1},d(t){re(n,t)}}}function We(s){let n,e,i;function o(t){s[44](t)}let r={};return s[11]!==void 0&&(r.magicGIFPath=s[11]),n=new wn({props:r}),O.push(()=>W(n,"magicGIFPath",o)),{c(){te(n.$$.fragment)},m(t,d){oe(n,t,d),i=!0},p(t,d){const u={};!e&&d[0]&2048&&(e=!0,u.magicGIFPath=t[11],K(()=>e=!1)),n.$set(u)},i(t){i||(M(n.$$.fragment,t),i=!0)},o(t){H(n.$$.fragment,t),i=!1},d(t){re(n,t)}}}function Ke(s){let n,e,i;return e=new hn({props:{x:[-5,5],y:[0,.1],delay:[100,3e3],infinite:!0,duration:"5000",amount:"200",fallDistance:"100vh"}}),{c(){n=C("div"),te(e.$$.fragment),I(n,"position","fixed"),I(n,"top","-50px"),I(n,"left","0"),I(n,"height","100vh"),I(n,"width","100vw"),I(n,"display","flex"),I(n,"justify-content","center"),I(n,"overflow","hidden"),I(n,"pointer-events","none")},m(o,r){Q(o,n,r),oe(e,n,null),i=!0},i(o){i||(M(e.$$.fragment,o),i=!0)},o(o){H(e.$$.fragment,o),i=!1},d(o){o&&P(n),re(e)}}}function Rn(s){let n,e,i,o,r,t;const d=[Nn,Ln],u=[];function f(w,m){return w[0]?0:1}n=f(s),e=u[n]=d[n](s);let a=!s[13]&&We(s),p=s[12]&&Ke();return{c(){e.c(),i=V(),a&&a.c(),o=V(),p&&p.c(),r=Se()},m(w,m){u[n].m(w,m),Q(w,i,m),a&&a.m(w,m),Q(w,o,m),p&&p.m(w,m),Q(w,r,m),t=!0},p(w,m){let G=n;n=f(w),n===G?u[n].p(w,m):(se(),H(u[G],1,1,()=>{u[G]=null}),ne(),e=u[n],e?e.p(w,m):(e=u[n]=d[n](w),e.c()),M(e,1),e.m(i.parentNode,i)),w[13]?a&&(se(),H(a,1,1,()=>{a=null}),ne()):a?(a.p(w,m),m[0]&8192&&M(a,1)):(a=We(w),a.c(),M(a,1),a.m(o.parentNode,o)),w[12]?p?m[0]&4096&&M(p,1):(p=Ke(),p.c(),M(p,1),p.m(r.parentNode,r)):p&&(se(),H(p,1,1,()=>{p=null}),ne())},i(w){t||(M(e),M(a),M(p),t=!0)},o(w){H(e),H(a),H(p),t=!1},d(w){w&&(P(i),P(o),P(r)),u[n].d(w),a&&a.d(w),p&&p.d(w)}}}function Un(s,n,e){let i,o,r,t,d,u,f,a,p,w,m,G,v,T,z,y,F,h;on(s,qe,l=>e(8,h=l));let{id:b}=n;var c,_,ee=!1,Y="",le=0;const J=document.getElementById("appconfig").dataset;function Z(){return{isAnswered:!!T,answerContext:m.answers.reduce((N,x)=>(N[x.id]={isCorrectAnswer:x.id===m.correct_answer_id,isSubmittedAnswer:p?x.id===p.answer_id:!1,isSelectedAnswer:p?x.id===p.answer_id:!1},N),{})}}var j=-1;Pe(()=>{axios.get("/api/sessions/"+b).then(function(l){e(0,_=l.data)}).catch(function(l){alert(l)})});function me(){return axios.get("/api/questions/"+m.id).then(function(l){var N=_.deck.questions.findIndex(pe=>pe.id===m.id),x=l.data;e(0,_.deck.questions[N]=x,_),he(x)}).catch(function(l){alert(l)})}function he(l){if(l.type!=="card"){var N=_.session.answer_choices.findIndex(x=>x.question_id===l.id);N!==-1&&e(0,_.session.answer_choices[N].is_correct=_.session.answer_choices[N].answer_id===l.correct_answer_id,_)}}var ue;function L(){ue&&ue.cancel(),ue=ln(()=>{axios.put("/api/sessions/"+_.session.id,_.session).then(function(l){}).catch(function(l){alert(l)})},1e3,{maxWait:2e3}),ue()}function be(l){if(l&&l!==-1?e(9,c.answerContext[l].isSelectedAnswer=!0,c):e(9,c.isAnswered=!0,c),T&&l&&l===m.correct_answer_id){e(9,c.isAnswered=!0,c);return}else if(T)return;var N=!1;m.type==="card"?(N=!!l,l===-1&&(l=null)):N=m.correct_answer_id===l,(N||i||!d)&&e(9,c.isAnswered=!0,c),l&&l!==-1&&(e(9,c.answerContext[l].isSubmittedAnswer=!0,c),e(9,c.answerContext[l].isCorrectAnswer=N,c));var x={question_id:v,answer_id:l,is_correct:N,help_used:ee};axios.post("/api/sessions/"+b+"/answerchoices",x).then(function(pe){e(0,_.session.answer_choices=[..._.session.answer_choices,pe.data],_)}).catch(function(pe){alert(pe)})}function ke(){T&&(e(1,p=_.session.answer_choices.find(l=>l.question_id===v)),p&&axios.delete("/api/sessions/"+b+"/answerchoices/"+p.id).then(function(l){e(0,_.session.answer_choices=[..._.session.answer_choices.filter(N=>N.question_id!==v)],_),rn().then(()=>{e(9,c=Z())})}).catch(function(l){alert(l)}))}const R=()=>{Me(qe,h.session_show_sidebar=!h.session_show_sidebar,h)},U=()=>{Me(qe,h.session_shuffle_answers=!h.session_shuffle_answers,h)},D=()=>{Me(qe,h.session_exam_mode=!h.session_exam_mode,h)};function Ae(l){z=l,e(3,z),e(0,_),e(25,a),e(24,w)}function ve(l){z=l,e(3,z),e(0,_),e(25,a),e(24,w)}function Ie(l){_=l,e(0,_)}function fe(l){i=l,e(13,i),e(4,G),e(8,h),e(0,_),e(25,a),e(24,w)}function B(l){_=l,e(0,_)}function g(l){s.$$.not_equal(_.session.current_question_id,l)&&(_.session.current_question_id=l,e(0,_))}function A(l){c=l,e(9,c),e(23,v),e(0,_)}function ae(l){m=l,e(14,m),e(0,_)}function Ye(l){c=l,e(9,c),e(23,v),e(0,_)}function Ze(l){ee=l,e(10,ee)}function je(l){p=l,e(1,p),e(0,_),e(23,v)}function xe(l){i=l,e(13,i),e(4,G),e(8,h),e(0,_),e(25,a),e(24,w)}function $e(l){t=l,e(5,t),e(8,h)}function en(l){u=l,e(17,u),e(8,h)}function nn(l){s.$$.not_equal(m.id,l)&&(m.id=l,e(14,m),e(0,_))}function sn(l){Y=l,e(11,Y),e(3,z),e(22,j),e(2,y),e(0,_),e(25,a),e(24,w)}return s.$$set=l=>{"id"in l&&e(21,b=l.id)},s.$$.update=()=>{s.$$.dirty[0]&1&&e(25,a=_?_.deck.questions.filter(l=>!l.is_invalid):null),s.$$.dirty[0]&33554433&&e(24,w=_?_.session.answer_choices.filter(l=>a.some(({id:N})=>N===l.question_id)):null),s.$$.dirty[0]&50331649&&e(4,G=_?a.length===w.length:!1),s.$$.dirty[0]&272&&e(13,i=G?!1:h.session_exam_mode),s.$$.dirty[0]&256&&e(7,o=h.session_show_sidebar),s.$$.dirty[0]&256&&e(6,r=h.session_exam_mode),s.$$.dirty[0]&256&&e(5,t=h.session_shuffle_answers),s.$$.dirty[0]&256&&(d=h.session_multiple_answer_tries),s.$$.dirty[0]&256&&e(17,u=h.session_show_answer_stats),s.$$.dirty[0]&256&&e(16,f=h.session_show_progress_bar),s.$$.dirty[0]&128&&axios.put("/api/users/me/settings",{session_show_sidebar:o}).then(function(l){}).catch(function(l){alert(l)}),s.$$.dirty[0]&64&&axios.put("/api/users/me/settings",{session_exam_mode:r}).then(function(l){}).catch(function(l){alert(l)}),s.$$.dirty[0]&32&&axios.put("/api/users/me/settings",{session_shuffle_answers:t}).then(function(l){}).catch(function(l){alert(l)}),s.$$.dirty[0]&1&&e(23,v=_?_.session.current_question_id:null),s.$$.dirty[0]&8388609&&e(1,p=_?_.session.answer_choices.find(l=>l.question_id===v):null),s.$$.dirty[0]&1&&e(14,m=_?_.deck.questions.find(l=>l.id===_.session.current_question_id):null),s.$$.dirty[0]&16&&G&&e(13,i=!1),s.$$.dirty[0]&8388608&&L(),s.$$.dirty[0]&3&&(T=_?!!p:!1),s.$$.dirty[0]&8388608&&v&&e(9,c=Z()),s.$$.dirty[0]&50331649&&e(3,z=_?_n(a.length,w):null),s.$$.dirty[0]&1&&e(2,y=_?_.deck.questions.length:0),s.$$.dirty[0]&1&&e(15,F=_?_.deck.questions.findIndex(l=>l.id==_.session.current_question_id)+1:null),s.$$.dirty[0]&4194317&&(()=>{if(z){var l=z.correct;if(l<60){e(22,j=l);return}if(j===-1){e(22,j=l);return}j<60&&(e(22,j=l),axios.get("/api/magic-gif").then(function(N){e(11,Y="magic-gifs/"+N.data.id)}).catch(function(N){})),J.magic==="1"&&l===100&&j<100&&y>=10&&_.session.parent_session_id===null&&e(12,le=1)}})()},[_,p,y,z,G,t,r,o,h,c,ee,Y,le,i,m,F,f,u,me,be,ke,b,j,v,w,a,R,U,D,Ae,ve,Ie,fe,B,g,A,ae,Ye,Ze,je,xe,$e,en,nn,sn]}class Dn extends de{constructor(n){super(),_e(this,n,Un,Rn,ge,{id:21},null,[-1,-1])}}const Je=document.getElementById("SessionView");new Dn({target:Je,props:{id:Je.dataset.sessionId}});
