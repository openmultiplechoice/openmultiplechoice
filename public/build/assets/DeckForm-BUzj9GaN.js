import{S as x,i as $,s as V,n as O,d as k,a as q,b as Q,e as we,c as m,l as M,p as ee,f as g,t as F,g as d,h as ue,j as Y,H as Ce,k as P,m as re,o as A,q as te,r as j,u as ne,v as Ee,w as B,x as S,y as K,z as ce,A as de,B as se,C as ie,D as Te,E as Qe,F as fe}from"./index-CTA786D7.js";import{d as Ie,p as J}from"./purify.es-CzHI0FGf.js";import{h as _e,Q as De}from"./QuestionForm-C_NMvz6G.js";import{e as W}from"./each-KlFnVOXz.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./lodash-DBMh2b1a.js";function me(e){let t,s,l,i,u,r,n,o,c,a,_,w,v,N,p,I;return{c(){t=g("form"),s=g("div"),l=g("label"),i=F("Case text"),r=Q(),n=g("input"),c=Q(),a=g("trix-editor"),v=Q(),N=new Ce(!1),d(l,"for",u="caseText"+e[0].id),d(l,"class","form-label"),d(n,"id",o="caseText"+e[0].id),d(n,"type","hidden"),Y(a,"id",_="editor-case"+e[0].id),Y(a,"class","bg-light trix-content"),Y(a,"input",w="caseText"+e[0].id),N.a=null,d(s,"class","mb-3"),d(t,"action","#"),d(t,"class","mt-3")},m(E,D){q(E,t,D),m(t,s),m(s,l),m(l,i),m(s,r),m(s,n),ue(n,e[0].text),m(s,c),m(s,a),e[6](a),m(s,v),N.m(e[4],s),p||(I=M(n,"input",e[5]),p=!0)},p(E,D){D&1&&u!==(u="caseText"+E[0].id)&&d(l,"for",u),D&1&&o!==(o="caseText"+E[0].id)&&d(n,"id",o),D&1&&ue(n,E[0].text),D&1&&_!==(_="editor-case"+E[0].id)&&Y(a,"id",_),D&1&&w!==(w="caseText"+E[0].id)&&Y(a,"input",w),D&16&&N.p(E[4])},d(E){E&&k(t),e[6](null),p=!1,I()}}}function pe(e){let t,s,l,i,u,r,n,o,c;return{c(){t=g("div"),s=g("p"),s.innerHTML="<strong>Delete case?</strong> A case can only be deleted if it&#39;s not associated with any question.",l=Q(),i=g("button"),u=g("i"),r=F(" Delete case"),d(u,"class","bi bi-trash"),d(i,"type","button"),d(i,"class","btn btn-sm btn-danger"),i.disabled=n=e[1].some(e[7]),d(t,"class","alert alert-light mt-5"),d(t,"role","alert")},m(a,_){q(a,t,_),m(t,s),m(t,l),m(t,i),m(i,u),m(i,r),o||(c=M(i,"click",ee(e[8])),o=!0)},p(a,_){_&3&&n!==(n=a[1].some(a[7]))&&(i.disabled=n)},d(a){a&&k(t),o=!1,c()}}}function Le(e){let t=e[0].id,s,l,i=me(e),u=e[2]&&pe(e);return{c(){i.c(),s=Q(),u&&u.c(),l=we()},m(r,n){i.m(r,n),q(r,s,n),u&&u.m(r,n),q(r,l,n)},p(r,[n]){n&1&&V(t,t=r[0].id)?(i.d(1),i=me(r),i.c(),i.m(s.parentNode,s)):i.p(r,n),r[2]?u?u.p(r,n):(u=pe(r),u.c(),u.m(l.parentNode,l)):u&&(u.d(1),u=null)},i:O,o:O,d(r){r&&(k(s),k(l)),i.d(r),u&&u.d(r)}}}function Ae(e,t,s){let{kase:l}=t,{cases:i}=t,{handleCaseRemove:u}=t,r,n="";function o(p){p.addEventListener("trix-change",function(){s(0,l.text=document.getElementById("caseText"+l.id).value,l),s(4,n='<p class="text-end">Saving ...</p>'),a()}),p.toolbarElement.style.display="none",p.addEventListener("trix-focus",function(I){I.target.toolbarElement.style.display="block"}),p.addEventListener("trix-blur",function(I){I.target.toolbarElement.contains(document.activeElement)||(I.target.toolbarElement.style.display="none")})}var c;function a(){c&&c.cancel(),c=Ie(()=>{axios.put("/api/cases/"+l.id,l).then(function(p){s(4,n='<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(p){s(4,n='<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(p)})},500,{maxWait:2e3}),c()}function _(){l.text=this.value,s(0,l)}function w(p){P[p?"unshift":"push"](()=>{r=p,s(3,r)})}const v=p=>p.questions?p.questions.some(I=>I.case_id===l.id):!1,N=()=>{confirm("Are you sure you want to delete this case?")&&u(l.id)};return e.$$set=p=>{"kase"in p&&s(0,l=p.kase),"cases"in p&&s(1,i=p.cases),"handleCaseRemove"in p&&s(2,u=p.handleCaseRemove)},e.$$.update=()=>{e.$$.dirty&8&&r&&o(r)},[l,i,u,r,n,_,w,v,N]}class Ne extends x{constructor(t){super(),$(this,t,Ae,Le,V,{kase:0,cases:1,handleCaseRemove:2})}}function be(e,t,s){const l=e.slice();return l[4]=t[s],l[6]=s,l}function ge(e,t,s){const l=e.slice();return l[7]=t[s],l[6]=s,l}function Re(e){let t;return{c(){t=g("p"),t.textContent="Loading ..."},m(s,l){q(s,t,l)},p:O,d(s){s&&k(t)}}}function Se(e){let t,s,l,i=W(e[0].questions),u=[];for(let o=0;o<i.length;o+=1)u[o]=he(ge(e,i,o));let r=W(e[0].cases),n=[];for(let o=0;o<r.length;o+=1)n[o]=ke(be(e,r,o));return{c(){t=g("div");for(let o=0;o<u.length;o+=1)u[o].c();s=Q(),l=g("div");for(let o=0;o<n.length;o+=1)n[o].c();d(t,"class","list-group"),d(l,"class","list-group mt-2")},m(o,c){q(o,t,c);for(let a=0;a<u.length;a+=1)u[a]&&u[a].m(t,null);q(o,s,c),q(o,l,c);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(l,null)},p(o,c){if(c&1){i=W(o[0].questions);let a;for(a=0;a<i.length;a+=1){const _=ge(o,i,a);u[a]?u[a].p(_,c):(u[a]=he(_),u[a].c(),u[a].m(t,null))}for(;a<u.length;a+=1)u[a].d(1);u.length=i.length}if(c&3){r=W(o[0].cases);let a;for(a=0;a<r.length;a+=1){const _=be(o,r,a);n[a]?n[a].p(_,c):(n[a]=ke(_),n[a].c(),n[a].m(l,null))}for(;a<n.length;a+=1)n[a].d(1);n.length=r.length}},d(o){o&&(k(t),k(s),k(l)),re(u,o),re(n,o)}}}function Fe(e){let t,s=e[6]+1+"",l;return{c(){t=F("Question Nr. "),l=F(s)},m(i,u){q(i,t,u),q(i,l,u)},p:O,d(i){i&&(k(t),k(l))}}}function He(e){let t=J.sanitize(e[7].text).replace(/<\/?[^>]+(>|$)/g,"")+"",s;return{c(){s=F(t)},m(l,i){q(l,s,i)},p(l,i){i&1&&t!==(t=J.sanitize(l[7].text).replace(/<\/?[^>]+(>|$)/g,"")+"")&&te(s,t)},d(l){l&&k(s)}}}function he(e){let t,s,l,i,u;function r(a,_){return a[7].text?He:Fe}let n=r(e),o=n(e);function c(){return e[2](e[7])}return{c(){t=g("button"),s=g("small"),o.c(),l=Q(),d(t,"type","button"),d(t,"class","list-group-item list-group-item-action text-truncate"),d(t,"aria-current","true"),A(t,"list-group-item-dark",e[7].id===e[0].current_question_id),A(t,"list-group-item-light",e[7].id!==e[0].current_question_id),A(t,"bg-warning-subtle",e[0].current_case_id&&e[7].case_id===e[0].current_case_id)},m(a,_){q(a,t,_),m(t,s),o.m(s,null),m(t,l),i||(u=M(t,"click",ee(c)),i=!0)},p(a,_){e=a,n===(n=r(e))&&o?o.p(e,_):(o.d(1),o=n(e),o&&(o.c(),o.m(s,null))),_&1&&A(t,"list-group-item-dark",e[7].id===e[0].current_question_id),_&1&&A(t,"list-group-item-light",e[7].id!==e[0].current_question_id),_&1&&A(t,"bg-warning-subtle",e[0].current_case_id&&e[7].case_id===e[0].current_case_id)},d(a){a&&k(t),o.d(),i=!1,u()}}}function ze(e){let t,s=e[6]+1+"",l;return{c(){t=F("Case Nr. "),l=F(s)},m(i,u){q(i,t,u),q(i,l,u)},p:O,d(i){i&&(k(t),k(l))}}}function Be(e){let t=J.sanitize(e[4].text).replace(/<\/?[^>]+(>|$)/g,"")+"",s;return{c(){s=F(t)},m(l,i){q(l,s,i)},p(l,i){i&1&&t!==(t=J.sanitize(l[4].text).replace(/<\/?[^>]+(>|$)/g,"")+"")&&te(s,t)},d(l){l&&k(s)}}}function ke(e){let t,s,l,i,u,r,n;function o(w,v){return w[4].text?Be:ze}let c=o(e),a=c(e);function _(){return e[3](e[4])}return{c(){t=g("button"),s=g("small"),l=g("i"),i=Q(),a.c(),u=Q(),d(l,"class","bi bi-clipboard2-pulse"),d(t,"type","button"),d(t,"class","list-group-item list-group-item-action text-truncate"),d(t,"aria-current","true"),A(t,"list-group-item-dark",e[4].id===e[0].current_case_id),A(t,"list-group-item-info",e[4].id!==e[0].current_case_id&&!(e[1]&&e[1].case_id===e[4].id)),A(t,"list-group-item-warning",e[1]&&e[1].case_id===e[4].id)},m(w,v){q(w,t,v),m(t,s),m(s,l),m(s,i),a.m(s,null),m(t,u),r||(n=M(t,"click",ee(_)),r=!0)},p(w,v){e=w,c===(c=o(e))&&a?a.p(e,v):(a.d(1),a=c(e),a&&(a.c(),a.m(s,null))),v&1&&A(t,"list-group-item-dark",e[4].id===e[0].current_case_id),v&3&&A(t,"list-group-item-info",e[4].id!==e[0].current_case_id&&!(e[1]&&e[1].case_id===e[4].id)),v&3&&A(t,"list-group-item-warning",e[1]&&e[1].case_id===e[4].id)},d(w){w&&k(t),a.d(),r=!1,n()}}}function Me(e){let t;function s(u,r){return u[0]?Se:Re}let l=s(e),i=l(e);return{c(){i.c(),t=we()},m(u,r){i.m(u,r),q(u,t,r)},p(u,[r]){l===(l=s(u))&&i?i.p(u,r):(i.d(1),i=l(u),i&&(i.c(),i.m(t.parentNode,t)))},i:O,o:O,d(u){u&&k(t),i.d(u)}}}function Oe(e,t,s){let l,{data:i}=t;const u=n=>{s(0,i.current_question_id=n.id,i),s(0,i.current_case_id=null,i)},r=n=>{s(0,i.current_case_id=n.id,i),s(0,i.current_question_id=null,i)};return e.$$set=n=>{"data"in n&&s(0,i=n.data)},e.$$.update=()=>{e.$$.dirty&1&&s(1,l=i?i.questions.find(n=>n.id===i.current_question_id):null)},[i,l,u,r]}class Pe extends x{constructor(t){super(),$(this,t,Oe,Me,V,{data:0})}}function qe(e){let t,s,l,i;function u(o){e[12](o)}function r(o){e[13](o)}let n={showConfigEditor:"true",showCaseSelector:"true",handleQuestionRemove:e[7]};return e[4]!==void 0&&(n.question=e[4]),e[2].cases!==void 0&&(n.cases=e[2].cases),t=new De({props:n}),P.push(()=>j(t,"question",u)),P.push(()=>j(t,"cases",r)),{c(){ie(t.$$.fragment)},m(o,c){se(t,o,c),i=!0},p(o,c){const a={};!s&&c&16&&(s=!0,a.question=o[4],K(()=>s=!1)),!l&&c&4&&(l=!0,a.cases=o[2].cases,K(()=>l=!1)),t.$set(a)},i(o){i||(S(t.$$.fragment,o),i=!0)},o(o){B(t.$$.fragment,o),i=!1},d(o){ne(t,o)}}}function ve(e){let t,s,l,i;function u(o){e[14](o)}function r(o){e[15](o)}let n={handleCaseRemove:e[8]};return e[3]!==void 0&&(n.kase=e[3]),e[2].cases!==void 0&&(n.cases=e[2].cases),t=new Ne({props:n}),P.push(()=>j(t,"kase",u)),P.push(()=>j(t,"cases",r)),{c(){ie(t.$$.fragment)},m(o,c){se(t,o,c),i=!0},p(o,c){const a={};!s&&c&8&&(s=!0,a.kase=o[3],K(()=>s=!1)),!l&&c&4&&(l=!0,a.cases=o[2].cases,K(()=>l=!1)),t.$set(a)},i(o){i||(S(t.$$.fragment,o),i=!0)},o(o){B(t.$$.fragment,o),i=!1},d(o){ne(t,o)}}}function Ue(e){let t,s,l,i,u,r,n,o,c,a,_,w,v,N,p,I,E,D,R,f,b,T,U,H,X,z,Z,le;function ye(h){e[11](h)}let oe={};e[2]!==void 0&&(oe.data=e[2]),b=new Pe({props:oe}),P.push(()=>j(b,"data",ye));let y=e[4]&&qe(e),C=e[3]&&ve(e);return{c(){t=g("div"),s=g("div"),l=g("h4"),i=g("a"),u=F(e[1]),n=Q(),o=g("div"),c=g("div"),a=g("div"),_=g("button"),_.textContent="Add MC question",w=Q(),v=g("button"),v.textContent="Add card question",N=Q(),p=g("button"),p.innerHTML='<i class="bi bi-clipboard2-pulse"></i> Add case',I=Q(),E=g("div"),E.innerHTML='<div class="col"><div class="border-dark" style="border-bottom: dotted; border-width: 1px;"></div></div>',D=Q(),R=g("div"),f=g("div"),ie(b.$$.fragment),U=Q(),H=g("div"),y&&y.c(),X=Q(),C&&C.c(),d(i,"href",r="/decks/"+e[0]),d(i,"class","text-reset text-decoration-none"),d(l,"class","text-truncate"),d(l,"title",e[1]),d(s,"class","col"),d(t,"class","row"),d(_,"type","button"),d(_,"class","btn btn-sm btn-primary"),d(_,"title","Add a new MC question (Shortcut: Alt+Q)"),d(v,"type","button"),d(v,"class","btn btn-sm btn-primary"),d(p,"type","button"),d(p,"class","btn btn-sm btn-light"),d(a,"class","col d-grid d-sm-block gap-2 py-3"),d(c,"class","row"),d(E,"class","row"),d(o,"class","sticky-top bg-white mb-3"),Te(o,"z-index","20"),d(f,"class","col-md-4"),d(H,"class","col-md-8"),d(R,"class","row")},m(h,L){q(h,t,L),m(t,s),m(s,l),m(l,i),m(i,u),q(h,n,L),q(h,o,L),m(o,c),m(c,a),m(a,_),m(a,w),m(a,v),m(a,N),m(a,p),m(o,I),m(o,E),q(h,D,L),q(h,R,L),m(R,f),se(b,f,null),m(R,U),m(R,H),y&&y.m(H,null),m(H,X),C&&C.m(H,null),z=!0,Z||(le=[M(_,"click",e[9]),M(v,"click",e[10]),M(p,"click",e[6])],Z=!0)},p(h,[L]){(!z||L&2)&&te(u,h[1]),(!z||L&1&&r!==(r="/decks/"+h[0]))&&d(i,"href",r),(!z||L&2)&&d(l,"title",h[1]);const ae={};!T&&L&4&&(T=!0,ae.data=h[2],K(()=>T=!1)),b.$set(ae),h[4]?y?(y.p(h,L),L&16&&S(y,1)):(y=qe(h),y.c(),S(y,1),y.m(H,X)):y&&(ce(),B(y,1,1,()=>{y=null}),de()),h[3]?C?(C.p(h,L),L&8&&S(C,1)):(C=ve(h),C.c(),S(C,1),C.m(H,null)):C&&(ce(),B(C,1,1,()=>{C=null}),de())},i(h){z||(S(b.$$.fragment,h),S(y),S(C),z=!0)},o(h){B(b.$$.fragment,h),B(y),B(C),z=!1},d(h){h&&(k(t),k(n),k(o),k(D),k(R)),ne(b),y&&y.d(),C&&C.d(),Z=!1,Ee(le)}}}const Ye=1e3;function je(){return new URLSearchParams(window.location.search).get("question_id")}function Ke(e,t,s){let l,i,{id:u}=t,{name:r}=t,n={cases:[],questions:[]},o=0;Qe(()=>{_e.filter=function(){return!0},_e("alt+Q",function(f){f.preventDefault();const b=Date.now();b-o>Ye&&(c("mc"),o=b)}),axios.get("/api/decks/"+u).then(function(f){s(2,n=f.data);const b=je();b&&n.questions.some(T=>T.id===parseInt(b))?s(2,n.current_question_id=parseInt(b),n):n.questions.length>0&&s(2,n.current_question_id=n.questions[n.questions.length-1].id,n)}).catch(function(f){alert(f)})});function c(f){var b={id:null,text:"",type:f||"mc",correct_answer_id:null,images:[],answers:[]};axios.post("/api/decks/"+u+"/questions",b).then(function(T){b.id=T.data.id,s(2,n.questions=[...n.questions,b],n),s(2,n.current_question_id=b.id,n),fe().then(()=>{const U=document.getElementById("editor-questionText");U&&U.focus()})}).catch(function(T){alert(T)}),window.scrollTo({top:0,behavior:"smooth"})}function a(){var f={deck_id:u};axios.post("/api/cases",f).then(function(b){s(2,n.cases=[...n.cases,b.data],n),s(2,n.current_case_id=b.data.id,n),s(2,n.current_question_id=null,n),fe().then(()=>{const T=document.getElementById("editor-case"+b.data.id);T&&T.focus()})}).catch(function(b){alert(b)}),window.scrollTo({top:0,behavior:"smooth"})}function _(f){axios.delete("/api/decks/"+u+"/questions/"+f).then(function(b){s(2,n.questions=n.questions.filter(T=>T.id!==f),n),n.questions.length>0&&s(2,n.current_question_id=n.questions[n.questions.length-1].id,n)}).catch(function(b){alert(b)})}function w(f){axios.delete("/api/decks/"+u+"/cases/"+f).then(function(b){s(2,n.cases=n.cases.filter(T=>T.id!==f),n),n.questions.length>0&&s(2,n.current_question_id=n.questions[n.questions.length-1].id,n)}).catch(function(b){alert(b)})}const v=()=>{c("mc")},N=()=>{c("card")};function p(f){n=f,s(2,n)}function I(f){l=f,s(4,l),s(2,n)}function E(f){e.$$.not_equal(n.cases,f)&&(n.cases=f,s(2,n))}function D(f){i=f,s(3,i),s(2,n)}function R(f){e.$$.not_equal(n.cases,f)&&(n.cases=f,s(2,n))}return e.$$set=f=>{"id"in f&&s(0,u=f.id),"name"in f&&s(1,r=f.name)},e.$$.update=()=>{e.$$.dirty&4&&s(4,l=n?n.questions.find(f=>f.id===n.current_question_id):null),e.$$.dirty&4&&s(3,i=n?n.cases.find(f=>f.id===n.current_case_id):null)},[u,r,n,i,l,c,a,_,w,v,N,p,I,E,D,R]}class We extends x{constructor(t){super(),$(this,t,Ke,Ue,V,{id:0,name:1})}}const G=document.getElementById("DeckForm");new We({target:G,props:{id:G.dataset.deckId,name:G.dataset.deckName,moduleId:G.dataset.moduleId}});
