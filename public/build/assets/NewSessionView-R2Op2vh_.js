import{S as je,i as Le,s as Ne,e as Ge,a as L,n as $,d as N,k as ge,b as m,g as I,t as h,c as _,h as n,j as y,l as X,p as oe,r as at,A as Be,H as dt,m as Ie,o as He,u as Te,v as Ce,w as ie,B as ut,y as rt,x as fe,z as Ee,f as Oe,D as Fe,E as ft,F as Ve}from"./index-CovtvcR3.js";import{e as ye}from"./each-CtuGQY9F.js";import{C as _t}from"./auto-DTdYmgno.js";import{s as mt}from"./StatsHelper-B91isISU.js";import{c as pt}from"./NewSessionHelper-Ba9jtPTo.js";import{f as Ae,p as Qe}from"./parseISO-Ds5nI7_t.js";import{U as Ue}from"./UserSettingsStore-B1GYynLG.js";function gt(t){let e,l,s,i,o,c,r,p,f,g,a,b,k,d,u,v,w,S,j,B,M,q=Math.round(100*t[5]/t[6]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"",U,D,E,H,Y,A,O,x,G,R=Math.round(100*t[1]/t[6]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"",Q,C,F,ee,ke,te,W,he,_e,ce=Math.round(100*t[4]/t[5]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"",be,me,ve,ae,we,Z,se,ue,De,pe=Math.round(100*t[3]/t[5]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"",re,Se,qe,de,ne,Me,le,z,V,P=Math.round(100*t[2]/t[5]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"",Re,Pe,ze,J=t[2]>0&&We(t);return{c(){e=m("div"),l=m("div"),s=m("canvas"),i=I(),o=m("div"),c=m("table"),r=m("thead"),p=I(),f=m("tbody"),g=m("tr"),a=m("td"),a.textContent="Questions",b=I(),k=m("td"),d=h(t[6]),u=I(),v=m("tr"),w=m("td"),w.textContent="Answered",S=I(),j=m("td"),B=h(t[5]),M=h(`
                            (`),U=h(q),D=h("%)"),E=I(),H=m("tr"),Y=m("td"),Y.textContent="Unanswered",A=I(),O=m("td"),x=h(t[1]),G=h(`
                            (`),Q=h(R),C=h("%)"),F=I(),ee=m("tr"),ke=m("td"),ke.textContent="Correct",te=I(),W=m("td"),he=h(t[4]),_e=h(`
                            (`),be=h(ce),me=h("%)"),ve=I(),ae=m("tr"),we=m("td"),we.textContent="Correct with help",Z=I(),se=m("td"),ue=h(t[3]),De=h(`
                            (`),re=h(pe),Se=h("%)"),qe=I(),de=m("tr"),ne=m("td"),ne.textContent="Incorrect",Me=I(),le=m("td"),z=h(t[2]),V=h(`
                            (`),Re=h(P),Pe=h("%)"),ze=I(),J&&J.c(),_(l,"class","col-md-5"),_(k,"class","font-monospace text-end"),_(j,"class","font-monospace text-end"),_(O,"class","font-monospace text-end"),_(W,"class","font-monospace text-end"),_(se,"class","font-monospace text-end"),_(le,"class","font-monospace text-end"),_(c,"class","table"),_(o,"class","col-md-7 mt-3"),_(e,"class","row mb-5")},m(T,K){L(T,e,K),n(e,l),n(l,s),t[14](s),n(e,i),n(e,o),n(o,c),n(c,r),n(c,p),n(c,f),n(f,g),n(g,a),n(g,b),n(g,k),n(k,d),n(f,u),n(f,v),n(v,w),n(v,S),n(v,j),n(j,B),n(j,M),n(j,U),n(j,D),n(f,E),n(f,H),n(H,Y),n(H,A),n(H,O),n(O,x),n(O,G),n(O,Q),n(O,C),n(f,F),n(f,ee),n(ee,ke),n(ee,te),n(ee,W),n(W,he),n(W,_e),n(W,be),n(W,me),n(f,ve),n(f,ae),n(ae,we),n(ae,Z),n(ae,se),n(se,ue),n(se,De),n(se,re),n(se,Se),n(f,qe),n(f,de),n(de,ne),n(de,Me),n(de,le),n(le,z),n(le,V),n(le,Re),n(le,Pe),n(o,ze),J&&J.m(o,null)},p(T,K){K&64&&y(d,T[6]),K&32&&y(B,T[5]),K&96&&q!==(q=Math.round(100*T[5]/T[6]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"")&&y(U,q),K&2&&y(x,T[1]),K&66&&R!==(R=Math.round(100*T[1]/T[6]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"")&&y(Q,R),K&16&&y(he,T[4]),K&48&&ce!==(ce=Math.round(100*T[4]/T[5]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"")&&y(be,ce),K&8&&y(ue,T[3]),K&40&&pe!==(pe=Math.round(100*T[3]/T[5]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"")&&y(re,pe),K&4&&y(z,T[2]),K&36&&P!==(P=Math.round(100*T[2]/T[5]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"")&&y(Re,P),T[2]>0?J?J.p(T,K):(J=We(T),J.c(),J.m(o,null)):J&&(J.d(1),J=null)},d(T){T&&N(e),t[14](null),J&&J.d()}}}function kt(t){let e,l,s,i,o,c,r,p;return{c(){e=m("div"),l=m("div"),s=m("p"),i=h("Number of questions in this module (duplicates included): "),o=m("span"),c=m("i"),r=I(),p=h(t[6]),_(c,"class","bi bi-collection"),_(o,"class","badge text-bg-light"),_(l,"class","col-md"),_(e,"class","row")},m(f,g){L(f,e,g),n(e,l),n(l,s),n(s,i),n(s,o),n(o,c),n(o,r),n(o,p)},p(f,g){g&64&&y(p,f[6])},d(f){f&&N(e)}}}function We(t){let e,l,s,i,o,c,r,p,f,g,a=t[2]>=40&&Ye(t),b=t[2]>=70&&Je(t);return{c(){e=m("div"),a&&a.c(),l=I(),b&&b.c(),s=I(),i=m("button"),o=m("i"),c=h(" Repeat "),r=h(t[2]),p=h(" incorrect"),_(o,"class","bi bi-repeat"),_(i,"class","btn btn-sm btn-outline-secondary"),_(i,"type","button"),_(e,"class","d-grid gap-2")},m(k,d){L(k,e,d),a&&a.m(e,null),n(e,l),b&&b.m(e,null),n(e,s),n(e,i),n(i,o),n(i,c),n(i,r),n(i,p),f||(g=X(i,"click",oe(t[17])),f=!0)},p(k,d){k[2]>=40?a?a.p(k,d):(a=Ye(k),a.c(),a.m(e,l)):a&&(a.d(1),a=null),k[2]>=70?b?b.p(k,d):(b=Je(k),b.c(),b.m(e,s)):b&&(b.d(1),b=null),d&4&&y(r,k[2])},d(k){k&&N(e),a&&a.d(),b&&b.d(),f=!1,g()}}}function Ye(t){let e,l,s;return{c(){e=m("button"),e.innerHTML='<i class="bi bi-repeat"></i> Repeat 30 incorrect',_(e,"class","btn btn-sm btn-outline-secondary"),_(e,"type","button")},m(i,o){L(i,e,o),l||(s=X(e,"click",oe(t[15])),l=!0)},p:$,d(i){i&&N(e),l=!1,s()}}}function Je(t){let e,l,s;return{c(){e=m("button"),e.innerHTML='<i class="bi bi-repeat"></i> Repeat 60 incorrect',_(e,"class","btn btn-sm btn-outline-secondary"),_(e,"type","button")},m(i,o){L(i,e,o),l||(s=X(e,"click",oe(t[16])),l=!0)},p:$,d(i){i&&N(e),l=!1,s()}}}function ht(t){let e;function l(o,c){return o[6]===o[1]?kt:gt}let s=l(t),i=s(t);return{c(){i.c(),e=Ge()},m(o,c){i.m(o,c),L(o,e,c)},p(o,[c]){s===(s=l(o))&&i?i.p(o,c):(i.d(1),i=s(o),i&&(i.c(),i.m(e.parentNode,e)))},i:$,o:$,d(o){o&&N(e),i.d(o)}}}function bt(t,e,l){let s,i,o,c,r,p,f,{decks:g}=e,{moduleId:a}=e,b=[],k=[],d,u;function v(M){const q={module_id:a,question_ids:M};axios.post("/api/sessions/newfromquestionids",q).then(function(U){window.location.href="/sessions/"+U.data.id}).catch(function(U){alert(U)})}function w(M){ge[M?"unshift":"push"](()=>{u=M,l(0,u)})}const S=()=>v(f.slice(0,30)),j=()=>v(f.slice(0,60)),B=()=>v(f);return t.$$set=M=>{"decks"in M&&l(9,g=M.decks),"moduleId"in M&&l(10,a=M.moduleId)},t.$$.update=()=>{t.$$.dirty&2560&&(()=>{const M=g.map(U=>U.questions).flat();l(11,b=M.filter(U=>!U.is_invalid));const q=[];for(const U of g){const D=U.sessions.sort((H,Y)=>Y.id-H.id);if(D.length===0)continue;const E=D[0];q.push(...E.answer_choices)}l(12,k=q.filter(U=>b.some(({id:D})=>D===U.question_id)))})(),t.$$.dirty&2048&&l(6,s=b.length),t.$$.dirty&4096&&l(5,i=k.length),t.$$.dirty&96&&l(1,o=s-i),t.$$.dirty&4096&&l(4,c=k.filter(M=>M.is_correct&&!M.help_used).length),t.$$.dirty&4096&&l(3,r=k.filter(M=>M.is_correct&&M.help_used).length),t.$$.dirty&4096&&l(2,p=k.filter(M=>!M.is_correct).length),t.$$.dirty&4096&&l(7,f=k.filter(M=>!M.is_correct).map(M=>M.question_id)),t.$$.dirty&8223&&u&&(()=>{const M={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect","Unanswered"],datasets:[{label:"n",data:[c,r,p,o],backgroundColor:["#d4edda","#fff3cd","#f8d7da","#bbbbbb"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};d&&d.destroy();var q=u.getContext("2d");l(13,d=new _t(q,M))})()},[u,o,p,r,c,i,s,f,v,g,a,b,k,d,w,S,j,B]}class vt extends je{constructor(e){super(),Le(this,e,bt,ht,Ne,{decks:9,moduleId:10})}}function wt(t){let e,l=Ae(Qe(t[0].created_at),"dd.MM.yyyy")+"",s;return{c(){e=m("span"),s=h(l),_(e,"class","badge text-bg-light")},m(i,o){L(i,e,o),n(e,s)},p(i,o){o&1&&l!==(l=Ae(Qe(i[0].created_at),"dd.MM.yyyy")+"")&&y(s,l)},d(i){i&&N(e)}}}function Dt(t){let e,l=Ae(Qe(t[0].exam_at),"dd.MM.yyyy")+"",s;return{c(){e=m("span"),s=h(l),_(e,"class","badge text-bg-light")},m(i,o){L(i,e,o),n(e,s)},p(i,o){o&1&&l!==(l=Ae(Qe(i[0].exam_at),"dd.MM.yyyy")+"")&&y(s,l)},d(i){i&&N(e)}}}function Ke(t){let e,l,s,i=t[0].sessions.length+"",o;return{c(){e=m("span"),l=m("i"),s=I(),o=h(i),_(l,"class","bi bi-rocket"),_(e,"class","badge text-bg-light"),_(e,"title","Number of sessions")},m(c,r){L(c,e,r),n(e,l),n(e,s),n(e,o)},p(c,r){r&1&&i!==(i=c[0].sessions.length+"")&&y(o,i)},d(c){c&&N(e)}}}function Xe(t){let e,l;return{c(){e=new dt(!1),l=Ge(),e.a=l},m(s,i){e.m(t[3],s,i),L(s,l,i)},p(s,i){i&8&&e.p(s[3])},d(s){s&&(N(l),e.d())}}}function St(t){let e,l,s,i,o,c,r,p=t[0].questions.length+"",f,g,a,b,k,d,u,v,w,S,j=t[0].name+"",B,M,q,U,D,E,H,Y,A;function O(C,F){return C[0].exam_at?Dt:wt}let x=O(t),G=x(t),R=t[0].sessions&&Ke(t),Q=t[3]&&Xe(t);return{c(){e=m("div"),l=m("div"),s=m("div"),G.c(),i=I(),o=m("span"),c=m("i"),r=I(),f=h(p),g=I(),R&&R.c(),a=I(),Q&&Q.c(),b=I(),k=m("input"),v=I(),w=m("div"),S=m("h6"),B=h(j),M=I(),q=m("button"),q.innerHTML='<i class="bi bi-rocket-takeoff"></i> New session',U=I(),D=m("a"),E=h("Browse deck"),_(c,"class","bi bi-collection"),_(o,"class","badge text-bg-light"),_(o,"title","Number of questions"),_(k,"type","checkbox"),_(k,"class","form-check-input float-end"),k.value="",_(k,"id",d="selected"+t[0].id),k.checked=u=t[2].has(t[0].id),_(s,"class","card-header"),_(S,"class","card-title"),_(q,"type","button"),_(q,"class","btn btn-sm btn-primary"),_(D,"href",H="/decks/"+t[0].id),_(D,"class","card-link"),_(w,"class","card-body"),_(l,"class","card"),_(e,"class","col-lg-6 mb-1")},m(C,F){L(C,e,F),n(e,l),n(l,s),G.m(s,null),n(s,i),n(s,o),n(o,c),n(o,r),n(o,f),n(s,g),R&&R.m(s,null),n(s,a),Q&&Q.m(s,null),n(s,b),n(s,k),n(l,v),n(l,w),n(w,S),n(S,B),n(w,M),n(w,q),n(w,U),n(w,D),n(D,E),Y||(A=[X(k,"click",t[4]),X(q,"click",oe(t[5]))],Y=!0)},p(C,[F]){x===(x=O(C))&&G?G.p(C,F):(G.d(1),G=x(C),G&&(G.c(),G.m(s,i))),F&1&&p!==(p=C[0].questions.length+"")&&y(f,p),C[0].sessions?R?R.p(C,F):(R=Ke(C),R.c(),R.m(s,a)):R&&(R.d(1),R=null),C[3]?Q?Q.p(C,F):(Q=Xe(C),Q.c(),Q.m(s,b)):Q&&(Q.d(1),Q=null),F&1&&d!==(d="selected"+C[0].id)&&_(k,"id",d),F&5&&u!==(u=C[2].has(C[0].id))&&(k.checked=u),F&1&&j!==(j=C[0].name+"")&&y(B,j),F&1&&H!==(H="/decks/"+C[0].id)&&_(D,"href",H)},i:$,o:$,d(C){C&&N(e),G.d(),R&&R.d(),Q&&Q.d(),Y=!1,at(A)}}}function Mt(t,e,l){let{deck:s}=e,{selectDeck:i}=e,{selectedDecks:o}=e,c;Be(()=>{const f=s.questions.filter(d=>!d.is_invalid),g=s.sessions.sort((d,u)=>u.id-d.id);if(g.length===0)return;const b=g[0].answer_choices.filter(d=>f.some(({id:u})=>u===d.question_id)),k=mt(f.length,b);k.correct>=60?l(3,c='<span style="color: #155724; background-color: #d4edda;" class="badge" title="Correct answers in percent">'+k.correct+" %</span>"):l(3,c='<span style="color: #721c24; background-color: #f8d7da;" class="badge" title="Correct answers in percent">'+k.correct+" %</span>")});const r=()=>i(s.id),p=()=>pt(s.id);return t.$$set=f=>{"deck"in f&&l(0,s=f.deck),"selectDeck"in f&&l(1,i=f.selectDeck),"selectedDecks"in f&&l(2,o=f.selectedDecks)},[s,i,o,c,r,p]}class It extends je{constructor(e){super(),Le(this,e,Mt,St,Ne,{deck:0,selectDeck:1,selectedDecks:2})}}function Ze(t,e,l){const s=t.slice();return s[8]=e[l],s[9]=e,s[10]=l,s}function $e(t){let e;return{c(){e=m("p"),e.textContent="Loading ..."},m(l,s){L(l,e,s)},p:$,d(l){l&&N(e)}}}function xe(t){let e,l,s,i;function o(p){t[6](p,t[8],t[9],t[10])}function c(p){t[7](p)}let r={selectDeck:t[2]};return t[8]!==void 0&&(r.deck=t[8]),t[1]!==void 0&&(r.selectedDecks=t[1]),e=new It({props:r}),ge.push(()=>Ie(e,"deck",o)),ge.push(()=>Ie(e,"selectedDecks",c)),{c(){He(e.$$.fragment)},m(p,f){Te(e,p,f),i=!0},p(p,f){t=p;const g={};f&4&&(g.selectDeck=t[2]),!l&&f&8&&(l=!0,g.deck=t[8],Ce(()=>l=!1)),!s&&f&2&&(s=!0,g.selectedDecks=t[1],Ce(()=>s=!1)),e.$set(g)},i(p){i||(ie(e.$$.fragment,p),i=!0)},o(p){fe(e.$$.fragment,p),i=!1},d(p){Ee(e,p)}}}function Ct(t){let e,l,s,i,o,c;function r(d){t[4](d)}function p(d){t[5](d)}let f={};t[3]!==void 0&&(f.decks=t[3]),t[0]!==void 0&&(f.moduleId=t[0]),e=new vt({props:f}),ge.push(()=>Ie(e,"decks",r)),ge.push(()=>Ie(e,"moduleId",p));let g=ye(t[3]),a=[];for(let d=0;d<g.length;d+=1)a[d]=xe(Ze(t,g,d));const b=d=>fe(a[d],1,1,()=>{a[d]=null});let k=null;return g.length||(k=$e()),{c(){He(e.$$.fragment),i=I(),o=m("div");for(let d=0;d<a.length;d+=1)a[d].c();k&&k.c(),_(o,"class","row")},m(d,u){Te(e,d,u),L(d,i,u),L(d,o,u);for(let v=0;v<a.length;v+=1)a[v]&&a[v].m(o,null);k&&k.m(o,null),c=!0},p(d,[u]){const v={};if(!l&&u&8&&(l=!0,v.decks=d[3],Ce(()=>l=!1)),!s&&u&1&&(s=!0,v.moduleId=d[0],Ce(()=>s=!1)),e.$set(v),u&14){g=ye(d[3]);let w;for(w=0;w<g.length;w+=1){const S=Ze(d,g,w);a[w]?(a[w].p(S,u),ie(a[w],1)):(a[w]=xe(S),a[w].c(),ie(a[w],1),a[w].m(o,null))}for(ut(),w=g.length;w<a.length;w+=1)b(w);rt(),!g.length&&k?k.p(d,u):g.length?k&&(k.d(1),k=null):(k=$e(),k.c(),k.m(o,null))}},i(d){if(!c){ie(e.$$.fragment,d);for(let u=0;u<g.length;u+=1)ie(a[u]);c=!0}},o(d){fe(e.$$.fragment,d),a=a.filter(Boolean);for(let u=0;u<a.length;u+=1)fe(a[u]);c=!1},d(d){d&&(N(i),N(o)),Ee(e,d),Oe(a,d),k&&k.d()}}}function yt(t,e,l){let{moduleId:s}=e,{selectDeck:i}=e,{selectedDecks:o}=e,c=[];Be(()=>{if(!s){l(3,c=[]);return}axios.get("/api/decks?module="+s).then(function(a){l(3,c=a.data),c.sort(function(b,k){return b.exam_at===null?1:k.exam_at===null?-1:b.exam_at<k.exam_at?1:b.exam_at>k.exam_at?-1:0})}).catch(function(a){alert(a)})});function r(a){c=a,l(3,c)}function p(a){s=a,l(0,s)}function f(a,b,k,d){k[d]=a,l(3,c)}function g(a){o=a,l(1,o)}return t.$$set=a=>{"moduleId"in a&&l(0,s=a.moduleId),"selectDeck"in a&&l(2,i=a.selectDeck),"selectedDecks"in a&&l(1,o=a.selectedDecks)},[s,o,i,c,r,p,f,g]}class qt extends je{constructor(e){super(),Le(this,e,yt,Ct,Ne,{moduleId:0,selectDeck:2,selectedDecks:1})}}function et(t){let e,l,s,i,o,c,r,p,f,g=t[1].length+"",a,b,k=t[1].length>1?"s":"",d,u,v,w=t[3].length+"",S,j,B=t[3].length>1?"s":"",M,q,U,D=t[2]?"excluded":"included",E,H,Y,A,O,x,G,R,Q,C,F,ee,ke,te,W,he,_e=t[3].length+"",ce,be,me=t[3].length>1?"s":"",ve,ae,we,Z,se,ue=t[5].length+"",De,pe,re=t[5].length>1?"s":"",Se,qe,de,ne,Me,le,z=t[5].length>0&&tt(t);return{c(){e=m("div"),l=m("div"),s=m("div"),i=m("p"),i.textContent="Create your own super deck:",o=I(),c=m("p"),r=h("You have "),p=m("strong"),f=h("selected "),a=h(g),b=h(" deck"),d=h(k),u=h(`
                    with `),v=m("strong"),S=h(w),j=h(" question"),M=h(B),q=I(),z&&z.c(),U=h(`
                    (duplicates `),E=h(D),H=h(")"),Y=I(),A=m("div"),O=m("label"),O.textContent="Deck Name",x=I(),G=m("input"),R=I(),Q=m("div"),C=m("input"),F=I(),ee=m("label"),ee.textContent="Filter out duplicates",ke=I(),te=m("div"),W=m("button"),he=h("Create deck ("),ce=h(_e),be=h(" question"),ve=h(me),ae=h(")"),we=I(),Z=m("button"),se=h("Create deck ("),De=h(ue),pe=h(" image question"),Se=h(re),qe=h(")"),de=I(),ne=m("button"),ne.textContent="Cancel",_(O,"for","name"),_(O,"class","form-label"),_(G,"type","text"),_(G,"class","form-control"),_(G,"id","name"),_(A,"class","mb-3"),_(C,"type","checkbox"),_(C,"class","form-check-input"),_(C,"id","checkboxRemoveDuplicates"),_(ee,"class","form-check-label"),_(ee,"for","checkboxRemoveDuplicates"),_(Q,"class","mb-3 form-check"),_(W,"class","btn btn-sm btn-primary"),_(Z,"class","btn btn-sm btn-primary"),_(ne,"class","btn btn-sm btn-link"),_(te,"class","d-grid gap-2 d-md-block"),_(s,"class","alert alert-light"),_(s,"role","alert"),_(l,"class","col-md"),_(e,"class","row")},m(V,P){L(V,e,P),n(e,l),n(l,s),n(s,i),n(s,o),n(s,c),n(c,r),n(c,p),n(p,f),n(p,a),n(p,b),n(p,d),n(c,u),n(c,v),n(v,S),n(v,j),n(v,M),n(c,q),z&&z.m(c,null),n(c,U),n(c,E),n(c,H),n(s,Y),n(s,A),n(A,O),n(A,x),n(A,G),Fe(G,t[4]),n(s,R),n(s,Q),n(Q,C),C.checked=t[2],n(Q,F),n(Q,ee),n(s,ke),n(s,te),n(te,W),n(W,he),n(W,ce),n(W,be),n(W,ve),n(W,ae),n(te,we),n(te,Z),n(Z,se),n(Z,De),n(Z,pe),n(Z,Se),n(Z,qe),n(te,de),n(te,ne),Me||(le=[X(G,"input",t[6]),X(G,"focus",Lt),X(C,"change",t[7]),X(W,"click",oe(t[8])),X(Z,"click",oe(t[9])),X(ne,"click",oe(t[10]))],Me=!0)},p(V,P){P&2&&g!==(g=V[1].length+"")&&y(a,g),P&2&&k!==(k=V[1].length>1?"s":"")&&y(d,k),P&8&&w!==(w=V[3].length+"")&&y(S,w),P&8&&B!==(B=V[3].length>1?"s":"")&&y(M,B),V[5].length>0?z?z.p(V,P):(z=tt(V),z.c(),z.m(c,U)):z&&(z.d(1),z=null),P&4&&D!==(D=V[2]?"excluded":"included")&&y(E,D),P&16&&G.value!==V[4]&&Fe(G,V[4]),P&4&&(C.checked=V[2]),P&8&&_e!==(_e=V[3].length+"")&&y(ce,_e),P&8&&me!==(me=V[3].length>1?"s":"")&&y(ve,me),P&32&&ue!==(ue=V[5].length+"")&&y(De,ue),P&32&&re!==(re=V[5].length>1?"s":"")&&y(Se,re)},d(V){V&&N(e),z&&z.d(),Me=!1,at(le)}}}function tt(t){let e,l,s=t[5].length+"",i,o,c=t[5].length>1?"s":"",r,p;return{c(){e=h("/ "),l=m("strong"),i=h(s),o=h(" question"),r=h(c),p=h(" with images")},m(f,g){L(f,e,g),L(f,l,g),n(l,i),n(l,o),n(l,r),n(l,p)},p(f,g){g&32&&s!==(s=f[5].length+"")&&y(i,s),g&32&&c!==(c=f[5].length>1?"s":"")&&y(r,c)},d(f){f&&(N(e),N(l))}}}function jt(t){let e,l=t[1].length>0&&et(t);return{c(){l&&l.c(),e=Ge()},m(s,i){l&&l.m(s,i),L(s,e,i)},p(s,[i]){s[1].length>0?l?l.p(s,i):(l=et(s),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null)},i:$,o:$,d(s){s&&N(e),l&&l.d(s)}}}function st(t,e){var l={name:t,question_ids:e};axios.post("/api/decks",l).then(function(s){window.location.href="/decks/"+s.data.id}).catch(function(s){alert(s)})}const Lt=t=>t.target.select();function Nt(t,e,l){let s,i,{selectedDecks:o}=e,c=[],r="My new super deck",p=!0;function f(){if(o.size===0){l(1,c=[]);return}const u=[...o].map(v=>"decks[]="+v);axios.get("/api/decks?"+u.join("&")).then(function(v){l(1,c=v.data)}).catch(function(v){alert(v)})}function g(){r=this.value,l(4,r)}function a(){p=this.checked,l(2,p)}const b=()=>st(r,s.map(u=>u.id)),k=()=>st(r,i.map(u=>u.id)),d=()=>l(0,o=new Set);return t.$$set=u=>{"selectedDecks"in u&&l(0,o=u.selectedDecks)},t.$$.update=()=>{t.$$.dirty&1&&f(),t.$$.dirty&6&&l(3,s=(()=>{var u=[];return c.forEach(v=>u.push(...v.questions)),p?[...new Map(u.map(v=>[v.id,v])).values()]:u})()),t.$$.dirty&6&&l(5,i=(()=>{var u=[];return c.forEach(v=>{v.questions.forEach(w=>{w.images.length>0&&u.push(w)})}),p?[...new Map(u.map(v=>[v.id,v])).values()]:u})())},[o,c,p,s,r,i,g,a,b,k,d]}class Ut extends je{constructor(e){super(),Le(this,e,Nt,jt,Ne,{selectedDecks:0})}}function lt(t,e,l){const s=t.slice();return s[12]=e[l],s}function nt(t,e,l){const s=t.slice();return s[15]=e[l],s}function it(t){let e,l,s=ye(t[2]),i=[];for(let o=0;o<s.length;o+=1)i[o]=ot(nt(t,s,o));return{c(){e=m("ul");for(let o=0;o<i.length;o+=1)i[o].c();l=I(),_(e,"class","list-group m-2 me-0")},m(o,c){L(o,e,c);for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(e,null);n(e,l)},p(o,c){if(c&37){s=ye(o[2]);let r;for(r=0;r<s.length;r+=1){const p=nt(o,s,r);i[r]?i[r].p(p,c):(i[r]=ot(p),i[r].c(),i[r].m(e,l))}for(;r<i.length;r+=1)i[r].d(1);i.length=s.length}},d(o){o&&N(e),Oe(i,o)}}}function ot(t){let e,l=t[15].name+"",s,i,o,c;function r(){return t[9](t[15])}return{c(){e=m("button"),s=h(l),_(e,"data-bs-target","#offcanvasModuleSelection"),_(e,"data-bs-dismiss","offcanvas"),_(e,"class",i="list-group-item list-group-item-action "+(t[0].last_module_id===t[15].id?"list-group-item-secondary":"list-group-item-light"))},m(p,f){L(p,e,f),n(e,s),o||(c=X(e,"click",oe(r)),o=!0)},p(p,f){t=p,f&4&&l!==(l=t[15].name+"")&&y(s,l),f&5&&i!==(i="list-group-item list-group-item-action "+(t[0].last_module_id===t[15].id?"list-group-item-secondary":"list-group-item-light"))&&_(e,"class",i)},d(p){p&&N(e),o=!1,c()}}}function ct(t){let e,l=t[12].name+"",s,i,o,c,r,p;function f(){return t[8](t[12])}let g=t[0].last_subject_id===t[12].id&&it(t);return{c(){e=m("button"),s=h(l),o=I(),g&&g.c(),c=Ge(),_(e,"class",i="list-group-item list-group-item-action "+(t[0].last_subject_id===t[12].id?"list-group-item-dark":"list-group-item-light"))},m(a,b){L(a,e,b),n(e,s),L(a,o,b),g&&g.m(a,b),L(a,c,b),r||(p=X(e,"click",oe(f)),r=!0)},p(a,b){t=a,b&2&&l!==(l=t[12].name+"")&&y(s,l),b&3&&i!==(i="list-group-item list-group-item-action "+(t[0].last_subject_id===t[12].id?"list-group-item-dark":"list-group-item-light"))&&_(e,"class",i),t[0].last_subject_id===t[12].id?g?g.p(t,b):(g=it(t),g.c(),g.m(c.parentNode,c)):g&&(g.d(1),g=null)},d(a){a&&(N(e),N(o),N(c)),g&&g.d(a),r=!1,p()}}}function At(t){let e;return{c(){e=m("p"),e.textContent="No module selected."},m(l,s){L(l,e,s)},p:$,i:$,o:$,d(l){l&&N(e)}}}function Qt(t){let e,l,s;function i(c){t[11](c)}let o={moduleId:t[0].last_module_id,selectDeck:t[6]};return t[3]!==void 0&&(o.selectedDecks=t[3]),e=new qt({props:o}),ge.push(()=>Ie(e,"selectedDecks",i)),{c(){He(e.$$.fragment)},m(c,r){Te(e,c,r),s=!0},p(c,r){const p={};r&1&&(p.moduleId=c[0].last_module_id),!l&&r&8&&(l=!0,p.selectedDecks=c[3],Ce(()=>l=!1)),e.$set(p)},i(c){s||(ie(e.$$.fragment,c),s=!0)},o(c){fe(e.$$.fragment,c),s=!1},d(c){Ee(e,c)}}}function Gt(t){let e,l,s,i,o,c,r,p,f,g,a,b,k,d,u,v,w=ye(t[1]),S=[];for(let D=0;D<w.length;D+=1)S[D]=ct(lt(t,w,D));function j(D){t[10](D)}let B={};t[3]!==void 0&&(B.selectedDecks=t[3]),a=new Ut({props:B}),ge.push(()=>Ie(a,"selectedDecks",j));const M=[Qt,At],q=[];function U(D,E){return D[0].last_module_id?0:1}return d=U(t),u=q[d]=M[d](t),{c(){e=m("div"),e.innerHTML='<div class="col-12 d-grid mb-3"><button type="button" class="btn btn-sm btn-primary d-lg-none my-2" data-bs-toggle="offcanvas" data-bs-target="#offcanvasModuleSelection" aria-controls="offcanvasModuleSelection">Switch module</button></div>',l=I(),s=m("div"),i=m("div"),o=m("div"),o.innerHTML='<h5 id="offcanvasAddToDeckLabel">Choose subject and module</h5> <button type="button" class="btn-close text-reset" data-bs-target="#offcanvasModuleSelection" data-bs-dismiss="offcanvas" aria-label="Close"></button>',c=I(),r=m("div"),p=m("ul");for(let D=0;D<S.length;D+=1)S[D].c();f=I(),g=m("div"),He(a.$$.fragment),k=I(),u.c(),_(e,"class","row"),_(o,"class","offcanvas-header"),_(p,"class","list-group w-100"),_(r,"class","offcanvas-body"),_(i,"class","col-lg-4 offcanvas-lg offcanvas-start"),_(i,"tabindex","-1"),_(i,"id","offcanvasModuleSelection"),_(g,"class","col-12 col-lg-8"),_(s,"class","row")},m(D,E){L(D,e,E),L(D,l,E),L(D,s,E),n(s,i),n(i,o),n(i,c),n(i,r),n(r,p);for(let H=0;H<S.length;H+=1)S[H]&&S[H].m(p,null);n(s,f),n(s,g),Te(a,g,null),n(g,k),q[d].m(g,null),v=!0},p(D,[E]){if(E&55){w=ye(D[1]);let A;for(A=0;A<w.length;A+=1){const O=lt(D,w,A);S[A]?S[A].p(O,E):(S[A]=ct(O),S[A].c(),S[A].m(p,null))}for(;A<S.length;A+=1)S[A].d(1);S.length=w.length}const H={};!b&&E&8&&(b=!0,H.selectedDecks=D[3],Ce(()=>b=!1)),a.$set(H);let Y=d;d=U(D),d===Y?q[d].p(D,E):(ut(),fe(q[Y],1,1,()=>{q[Y]=null}),rt(),u=q[d],u?u.p(D,E):(u=q[d]=M[d](D),u.c()),ie(u,1),u.m(g,null))},i(D){v||(ie(a.$$.fragment,D),ie(u),v=!0)},o(D){fe(a.$$.fragment,D),fe(u),v=!1},d(D){D&&(N(e),N(l),N(s)),Oe(S,D),Ee(a),q[d].d()}}}function Ht(t,e,l){let s;ft(t,Ue,u=>l(0,s=u));let i=[],o=[],c=[],r=new Set;Be(()=>{axios.get("/api/modules").then(function(u){var v=u.data;l(7,i=v.filter((S,j,B)=>j===B.findIndex(M=>M.id===S.id)).sort(function(S,j){return S.name>j.name?1:S.name<j.name?-1:0}));var w=i.map(S=>S.subject).filter(S=>!!S);l(1,o=w.filter((S,j,B)=>j===B.findIndex(M=>M.id===S.id)).sort(function(S,j){return S.name>j.name?1:S.name<j.name?-1:0}))}).catch(function(u){alert(u)})});function p(u){var v={last_subject_id:u,last_module_id:0};axios.put("/api/users/me/settings",v).then(function(w){Ve(Ue,s.last_subject_id=u,s),Ve(Ue,s.last_module_id=0,s)}).catch(function(w){alert(w)})}function f(u){var v={last_module_id:u};axios.put("/api/users/me/settings",v).then(function(w){Ve(Ue,s.last_module_id=u,s)}).catch(function(w){alert(w)})}function g(u){r.has(u)?r.delete(u):r.add(u),l(3,r=new Set([...r]))}const a=u=>p(u.id),b=u=>f(u.id);function k(u){r=u,l(3,r)}function d(u){r=u,l(3,r)}return t.$$.update=()=>{t.$$.dirty&129&&(s.last_subject_id,l(2,c=i.filter(u=>s.last_subject_id?u.subject?u.subject.id===s.last_subject_id:!1:!0)))},[s,o,c,r,p,f,g,i,a,b,k,d]}class Tt extends je{constructor(e){super(),Le(this,e,Ht,Gt,Ne,{})}}const Et=document.getElementById("NewSessionView");new Tt({target:Et});
