import{S as ge,i as pe,s as me,e as Qe,b as A,n as B,d as P,c as k,f as m,I as Ae,h as b,l as j,a as z,t as Y,q as _e,p as re,k as D,E as We,m as Je,H as Ke,C as Ee,o as I,y as G,z as x,x as Q,F as Xe,r as W,u as ee,v as se,w as J,A as ne,D as $,J as Ye,G as Ce,B as Ze}from"./index-BBxbQYOu.js";import{p as Pe,d as je}from"./purify.es-DfBF0len.js";import{M as xe}from"./Messages-cZuW1hV5.js";import{C as $e}from"./auto-B1JLC99t.js";import{S as es}from"./SessionProgressBar-CBjUMqqW.js";import{e as Me}from"./each-DRTt0YH0.js";import{h as Ie,S as ss}from"./SessionQuestionView-BDNFeLHj.js";import{s as ns}from"./StatsHelper-B91isISU.js";import{U as we}from"./UserSettingsStore-bJDZU8Jx.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./parseISO-Ds5nI7_t.js";import"./lodash-D0JQdfhu.js";import"./QuestionForm-DL-Tikwj.js";function Se(s){let n,e,i,o,u;return{c(){n=k("div"),e=k("img"),m(e,"class","img-fluid"),Ae(e.src,i="/"+s[0])||m(e,"src",i),m(e,"alt","Magic GIF"),m(n,"class","img-fullscreen d-flex justify-content-center align-items-center svelte-k1osqd")},m(t,c){A(t,n,c),b(n,e),o||(u=j(n,"click",s[2]),o=!0)},p(t,c){c&1&&!Ae(e.src,i="/"+t[0])&&m(e,"src",i)},d(t){t&&P(n),o=!1,u()}}}function is(s){let n,e=s[0]&&s[1]&&Se(s);return{c(){e&&e.c(),n=Qe()},m(i,o){e&&e.m(i,o),A(i,n,o)},p(i,[o]){i[0]&&i[1]?e?e.p(i,o):(e=Se(i),e.c(),e.m(n.parentNode,n)):e&&(e.d(1),e=null)},i:B,o:B,d(i){i&&P(n),e&&e.d(i)}}}function ts(s,n,e){let{magicGIFPath:i=""}=n;var o=!0;function u(){e(1,o=!o)}return s.$$set=t=>{"magicGIFPath"in t&&e(0,i=t.magicGIFPath)},[i,o,u]}class os extends ge{constructor(n){super(),pe(this,n,ts,is,me,{magicGIFPath:0})}}function Te(s){let n,e,i;return{c(){n=k("button"),n.innerHTML='<i class="bi bi-repeat"></i> Repeat incorrect',m(n,"class","btn btn-sm btn-outline-secondary"),m(n,"type","button")},m(o,u){A(o,n,u),e||(i=j(n,"click",re(s[5])),e=!0)},p:B,d(o){o&&P(n),e=!1,i()}}}function rs(s){let n,e,i,o,u,t,c,f=s[0].correct+"",r,a,w,M,q,V,C,y,T,g=s[0].incorrect>0&&Te(s);return{c(){n=k("div"),e=k("div"),i=k("canvas"),o=z(),u=k("div"),t=k("p"),c=k("span"),r=Y(f),a=Y("%"),w=Y(" correct"),M=z(),q=k("div"),V=k("a"),V.innerHTML='<i class="bi bi-rocket-takeoff"></i> New session',C=z(),g&&g.c(),y=z(),T=k("a"),T.textContent="Home",m(e,"class","col-md"),m(c,"class","fs-4 font-monospace"),m(t,"class","mt-3 text-dark"),m(V,"href","/sessions/create"),m(V,"class","btn btn-sm btn-primary"),m(T,"href","/"),m(T,"class","btn btn-sm btn-outline-secondary"),m(q,"class","d-grid gap-2"),m(u,"class","col-md"),m(n,"class","row mb-5")},m(p,h){A(p,n,h),b(n,e),b(e,i),s[4](i),b(n,o),b(n,u),b(u,t),b(t,c),b(c,r),b(c,a),b(t,w),b(u,M),b(u,q),b(q,V),b(q,C),g&&g.m(q,null),b(q,y),b(q,T)},p(p,[h]){h&1&&f!==(f=p[0].correct+"")&&_e(r,f),p[0].incorrect>0?g?g.p(p,h):(g=Te(p),g.c(),g.m(q,y)):g&&(g.d(1),g=null)},i:B,o:B,d(p){p&&P(n),s[4](null),g&&g.d()}}}function us(s){axios.post("/api/sessions/"+s+"/newfromincorrect").then(function(n){window.location.href="/sessions/"+n.data.id}).catch(function(n){alert(n)})}function ls(s,n,e){let{progressPercentage:i}=n,{sessionId:o}=n,u,t;function c(r){D[r?"unshift":"push"](()=>{u=r,e(2,u)})}const f=()=>us(o);return s.$$set=r=>{"progressPercentage"in r&&e(0,i=r.progressPercentage),"sessionId"in r&&e(1,o=r.sessionId)},s.$$.update=()=>{s.$$.dirty&13&&u&&(()=>{if(t)return;const r={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect"],datasets:[{label:"%",data:[i.correct,i.correctWithHelp,i.incorrect],backgroundColor:["#d4edda","#fff3cd","#f8d7da"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};t&&t.destroy();var a=u.getContext("2d");e(3,t=new $e(a,r))})()},[i,o,u,t,c,f]}class fs extends ge{constructor(n){super(),pe(this,n,ls,rs,me,{progressPercentage:0,sessionId:1})}}function Fe(s,n,e){const i=s.slice();return i[4]=n[e],i[6]=e,i}function Ge(s){let n;return{c(){n=k("li"),n.textContent="Loading ...",m(n,"class","svelte-za7w49")},m(e,i){A(e,n,i)},p:B,d(e){e&&P(n)}}}function cs(s){let n,e=s[6]+1+"",i;return{c(){n=Y("Question Nr. "),i=Y(e)},m(o,u){A(o,n,u),A(o,i,u)},p:B,d(o){o&&(P(n),P(i))}}}function as(s){let n=Pe.sanitize(s[4].text).replace(/<\/?[^>]+(>|$)/g,"")+"",e;return{c(){e=Y(n)},m(i,o){A(i,e,o)},p(i,o){o&1&&n!==(n=Pe.sanitize(i[4].text).replace(/<\/?[^>]+(>|$)/g,"")+"")&&_e(e,n)},d(i){i&&P(e)}}}function ye(s){let n,e,i,o=s[1](s[4])+"",u,t,c,f,r,a;function w(C,y){return C[4].text?as:cs}let M=w(s),q=M(s);function V(){return s[3](s[4])}return{c(){n=k("li"),e=k("small"),i=new Ke(!1),u=z(),q.c(),t=z(),i.a=u,m(n,"class",c="list-group-item list-group-item-action text-overflow "+(s[4].id===s[0].session.current_question_id?"list-group-item-dark":"list-group-item-light")+" svelte-za7w49"),m(n,"id",f="question"+s[4].id)},m(C,y){A(C,n,y),b(n,e),i.m(o,e),b(e,u),q.m(e,null),b(n,t),r||(a=j(n,"click",V),r=!0)},p(C,y){s=C,y&3&&o!==(o=s[1](s[4])+"")&&i.p(o),M===(M=w(s))&&q?q.p(s,y):(q.d(1),q=M(s),q&&(q.c(),q.m(e,null))),y&1&&c!==(c="list-group-item list-group-item-action text-overflow "+(s[4].id===s[0].session.current_question_id?"list-group-item-dark":"list-group-item-light")+" svelte-za7w49")&&m(n,"class",c),y&1&&f!==(f="question"+s[4].id)&&m(n,"id",f)},d(C){C&&P(n),q.d(),r=!1,a()}}}function ds(s){let n,e,i=Me(s[0].deck.questions),o=[];for(let t=0;t<i.length;t+=1)o[t]=ye(Fe(s,i,t));let u=null;return i.length||(u=Ge()),{c(){n=k("div"),e=k("ul");for(let t=0;t<o.length;t+=1)o[t].c();u&&u.c(),m(e,"class","list-group"),m(n,"class","overflow-scroll"),We(n,"max-height","85vh")},m(t,c){A(t,n,c),b(n,e);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(e,null);u&&u.m(e,null)},p(t,[c]){if(c&3){i=Me(t[0].deck.questions);let f;for(f=0;f<i.length;f+=1){const r=Fe(t,i,f);o[f]?o[f].p(r,c):(o[f]=ye(r),o[f].c(),o[f].m(e,null))}for(;f<o.length;f+=1)o[f].d(1);o.length=i.length,!i.length&&u?u.p(t,c):i.length?u&&(u.d(1),u=null):(u=Ge(),u.c(),u.m(e,null))}},i:B,o:B,d(t){t&&P(n),Je(o,t),u&&u.d()}}}function _s(s,n,e){let i,{data:o}=n,{examMode:u}=n;const t=c=>e(0,o.session.current_question_id=c.id,o);return s.$$set=c=>{"data"in c&&e(0,o=c.data),"examMode"in c&&e(2,u=c.examMode)},s.$$.update=()=>{s.$$.dirty&1&&(o.session.current_question_id,(()=>{var c=document.getElementById("question"+o.session.current_question_id);c&&c.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})})()),s.$$.dirty&5&&e(1,i=function(c){var f=o.session.answer_choices.find(r=>r.question_id===c.id);return f?u?'<span class="text-dark fw-bold">&check;</span>':f.is_correct?f.help_used?'<span class="text-warning-dark fw-bold">&check;</span>':'<span class="text-success-dark fw-bold">&check;</span>':'<span class="text-danger-dark fw-bold">&cross;</span>':'<span class="text-dark fw-bold">&rightarrow;</span>'})},[o,i,u,t]}class gs extends ge{constructor(n){super(),pe(this,n,_s,ds,me,{data:0,examMode:2})}}function ps(s){let n;return{c(){n=k("div"),n.innerHTML="",m(n,"class","col-6")},m(e,i){A(e,n,i)},p:B,d(e){e&&P(n)}}}function ms(s){let n,e,i,o;return{c(){n=k("div"),e=k("button"),e.innerHTML='<span class="fw-bold">←</span> Previous',m(e,"class","btn btn-sm btn-light w-100"),m(n,"class","col-6")},m(u,t){A(u,n,t),b(n,e),i||(o=j(e,"click",re(s[2])),i=!0)},p:B,d(u){u&&P(n),i=!1,o()}}}function bs(s){let n;return{c(){n=k("div"),n.innerHTML="",m(n,"class","col-6")},m(e,i){A(e,n,i)},p:B,d(e){e&&P(n)}}}function hs(s){let n,e,i,o;return{c(){n=k("div"),e=k("button"),e.innerHTML='Next <span class="fw-bold">→</span>',m(e,"class","btn btn-sm w-100"),I(e,"btn-warning",s[1].isAnswered),I(e,"btn-light",!s[1].isAnswered),m(n,"class","col-6")},m(u,t){A(u,n,t),b(n,e),i||(o=j(e,"click",re(s[3])),i=!0)},p(u,t){t&2&&I(e,"btn-warning",u[1].isAnswered),t&2&&I(e,"btn-light",!u[1].isAnswered)},d(u){u&&P(n),i=!1,o()}}}function ws(s){let n,e;function i(r,a){return r[0].session.current_question_id&&r[0].session.current_question_id!=r[0].deck.questions[0].id?ms:ps}let o=i(s),u=o(s);function t(r,a){return r[0].session.current_question_id!=r[0].deck.questions[r[0].deck.questions.length-1].id?hs:bs}let c=t(s),f=c(s);return{c(){n=k("div"),u.c(),e=z(),f.c(),m(n,"class","row mb-3 pt-1 pb-1 sticky-top bg-white")},m(r,a){A(r,n,a),u.m(n,null),b(n,e),f.m(n,null)},p(r,[a]){o===(o=i(r))&&u?u.p(r,a):(u.d(1),u=o(r),u&&(u.c(),u.m(n,e))),c===(c=t(r))&&f?f.p(r,a):(f.d(1),f=c(r),f&&(f.c(),f.m(n,null)))},i:B,o:B,d(r){r&&P(n),u.d(),f.d()}}}function ks(s,n,e){let{data:i}=n,{currentQuestionId:o}=n,{currentQuestionContext:u}=n;Ee(()=>{Ie("left","questions",function(r,a){c()}),Ie("right","questions",function(r,a){f()}),Ie.setScope("questions")});function t(r){return i.deck.questions.findIndex(a=>a.id===r)}function c(){var r=t(o),a=i.deck.questions[r-1];a&&e(0,i.session.current_question_id=a.id,i)}function f(){var r=t(o),a=i.deck.questions[r+1];a&&e(0,i.session.current_question_id=a.id,i)}return s.$$set=r=>{"data"in r&&e(0,i=r.data),"currentQuestionId"in r&&e(4,o=r.currentQuestionId),"currentQuestionContext"in r&&e(1,u=r.currentQuestionContext)},[i,u,c,f,o]}class qs extends ge{constructor(n){super(),pe(this,n,ks,ws,me,{data:0,currentQuestionId:4,currentQuestionContext:1})}}function vs(s){let n;return{c(){n=k("p"),n.textContent="Loading ..."},m(e,i){A(e,n,i)},p:B,i:B,o:B,d(e){e&&P(n)}}}function Cs(s){let n,e,i,o,u,t,c,f,r,a,w,M,q,V,C,y,T=s[0].deck.name+"",g,p,h,d,K,Z,ie,E,ue,O,R,le,fe,ce,be,S,ae,he,H=!s[11]&&(!s[3]||!s[8].isAnswered)&&He(s),L=s[3]&&s[8].isAnswered&&Le(s),U=s[6]&&Ue(s);function ke(_){s[30](_)}function qe(_){s[31](_)}function ve(_){s[32](_)}let te={};s[0]!==void 0&&(te.data=s[0]),s[0].session.current_question_id!==void 0&&(te.currentQuestionId=s[0].session.current_question_id),s[8]!==void 0&&(te.currentQuestionContext=s[8]),R=new qs({props:te}),D.push(()=>W(R,"data",ke)),D.push(()=>W(R,"currentQuestionId",qe)),D.push(()=>W(R,"currentQuestionContext",ve));let N=s[12]&&Ne(s);return{c(){n=k("div"),e=k("div"),i=k("p"),o=k("button"),o.innerHTML='<i class="bi bi-layout-sidebar"></i>',u=z(),t=k("button"),t.innerHTML='<i class="bi bi-shuffle"></i>',c=z(),f=k("button"),f.innerHTML='<i class="bi bi-exclamation-square"></i>',r=z(),a=k("span"),w=Y(s[13]),M=Y("/"),q=Y(s[14]),V=z(),C=k("a"),y=k("strong"),g=Y(T),h=z(),d=k("div"),K=k("div"),H&&H.c(),Z=z(),L&&L.c(),ie=z(),E=k("div"),U&&U.c(),ue=z(),O=k("div"),ee(R.$$.fragment),be=z(),N&&N.c(),m(o,"class","btn btn-sm d-none d-sm-none d-md-none d-lg-inline"),m(o,"title","Toggle sidebar"),I(o,"bg-light",!s[6]),I(o,"bg-dark-subtle",s[6]),m(t,"class","btn btn-sm"),m(t,"title","Toggle answer shuffling"),I(t,"bg-light",!s[4]),I(t,"bg-dark-subtle",s[4]),m(f,"class","btn btn-sm"),m(f,"title","Toggle exam mode"),I(f,"bg-light",!s[5]),I(f,"bg-dark-subtle",s[5]),m(a,"class","ms-1 float-end fw-bold font-monospace badge text-dark"),I(a,"text-bg-light",!s[1]||s[11]),I(a,"bg-success",!s[11]&&!s[12].is_invalid&&s[1]&&s[1].is_correct),I(a,"bg-danger",!s[11]&&!s[12].is_invalid&&s[1]&&!s[1].is_correct),m(C,"href",p="/decks/"+s[0].deck.id),m(C,"class","text-reset text-decoration-none"),m(i,"class","text-overflow svelte-1gfmo48"),m(e,"class","col mb-1"),m(n,"class","row"),m(K,"class","col mb-1"),m(d,"class","row"),m(O,"class","col-md-12"),I(O,"col-lg-9",s[6]),I(O,"col-lg-10",!s[6]),I(O,"offset-lg-1",!s[6]),m(E,"class","row mt-3")},m(_,v){A(_,n,v),b(n,e),b(e,i),b(i,o),b(i,u),b(i,t),b(i,c),b(i,f),b(i,r),b(i,a),b(a,w),b(a,M),b(a,q),b(i,V),b(i,C),b(C,y),b(y,g),A(_,h,v),A(_,d,v),b(d,K),H&&H.m(K,null),b(K,Z),L&&L.m(K,null),A(_,ie,v),A(_,E,v),U&&U.m(E,null),b(E,ue),b(E,O),se(R,O,null),b(O,be),N&&N.m(O,null),S=!0,ae||(he=[j(o,"click",re(s[23])),j(t,"click",re(s[24])),j(f,"click",re(s[25]))],ae=!0)},p(_,v){(!S||v[0]&64)&&I(o,"bg-light",!_[6]),(!S||v[0]&64)&&I(o,"bg-dark-subtle",_[6]),(!S||v[0]&16)&&I(t,"bg-light",!_[4]),(!S||v[0]&16)&&I(t,"bg-dark-subtle",_[4]),(!S||v[0]&32)&&I(f,"bg-light",!_[5]),(!S||v[0]&32)&&I(f,"bg-dark-subtle",_[5]),(!S||v[0]&8192)&&_e(w,_[13]),(!S||v[0]&16384)&&_e(q,_[14]),(!S||v[0]&2050)&&I(a,"text-bg-light",!_[1]||_[11]),(!S||v[0]&6146)&&I(a,"bg-success",!_[11]&&!_[12].is_invalid&&_[1]&&_[1].is_correct),(!S||v[0]&6146)&&I(a,"bg-danger",!_[11]&&!_[12].is_invalid&&_[1]&&!_[1].is_correct),(!S||v[0]&1)&&T!==(T=_[0].deck.name+"")&&_e(g,T),(!S||v[0]&1&&p!==(p="/decks/"+_[0].deck.id))&&m(C,"href",p),!_[11]&&(!_[3]||!_[8].isAnswered)?H?(H.p(_,v),v[0]&2312&&Q(H,1)):(H=He(_),H.c(),Q(H,1),H.m(K,Z)):H&&($(),G(H,1,1,()=>{H=null}),x()),_[3]&&_[8].isAnswered?L?(L.p(_,v),v[0]&264&&Q(L,1)):(L=Le(_),L.c(),Q(L,1),L.m(K,null)):L&&($(),G(L,1,1,()=>{L=null}),x()),_[6]?U?(U.p(_,v),v[0]&64&&Q(U,1)):(U=Ue(_),U.c(),Q(U,1),U.m(E,ue)):U&&($(),G(U,1,1,()=>{U=null}),x());const oe={};!le&&v[0]&1&&(le=!0,oe.data=_[0],J(()=>le=!1)),!fe&&v[0]&1&&(fe=!0,oe.currentQuestionId=_[0].session.current_question_id,J(()=>fe=!1)),!ce&&v[0]&256&&(ce=!0,oe.currentQuestionContext=_[8],J(()=>ce=!1)),R.$set(oe),_[12]?N?(N.p(_,v),v[0]&4096&&Q(N,1)):(N=Ne(_),N.c(),Q(N,1),N.m(O,null)):N&&($(),G(N,1,1,()=>{N=null}),x()),(!S||v[0]&64)&&I(O,"col-lg-9",_[6]),(!S||v[0]&64)&&I(O,"col-lg-10",!_[6]),(!S||v[0]&64)&&I(O,"offset-lg-1",!_[6])},i(_){S||(Q(H),Q(L),Q(U),Q(R.$$.fragment,_),Q(N),S=!0)},o(_){G(H),G(L),G(U),G(R.$$.fragment,_),G(N),S=!1},d(_){_&&(P(n),P(h),P(d),P(ie),P(E)),H&&H.d(),L&&L.d(),U&&U.d(),ne(R),N&&N.d(),ae=!1,Ze(he)}}}function He(s){let n,e,i;function o(t){s[26](t)}let u={};return s[2]!==void 0&&(u.progressPercentage=s[2]),n=new es({props:u}),D.push(()=>W(n,"progressPercentage",o)),{c(){ee(n.$$.fragment)},m(t,c){se(n,t,c),i=!0},p(t,c){const f={};!e&&c[0]&4&&(e=!0,f.progressPercentage=t[2],J(()=>e=!1)),n.$set(f)},i(t){i||(Q(n.$$.fragment,t),i=!0)},o(t){G(n.$$.fragment,t),i=!1},d(t){ne(n,t)}}}function Le(s){let n,e,i;function o(t){s[27](t)}let u={sessionId:s[0].session.id};return s[2]!==void 0&&(u.progressPercentage=s[2]),n=new fs({props:u}),D.push(()=>W(n,"progressPercentage",o)),{c(){ee(n.$$.fragment)},m(t,c){se(n,t,c),i=!0},p(t,c){const f={};c[0]&1&&(f.sessionId=t[0].session.id),!e&&c[0]&4&&(e=!0,f.progressPercentage=t[2],J(()=>e=!1)),n.$set(f)},i(t){i||(Q(n.$$.fragment,t),i=!0)},o(t){G(n.$$.fragment,t),i=!1},d(t){ne(n,t)}}}function Ue(s){let n,e,i,o,u;function t(r){s[28](r)}function c(r){s[29](r)}let f={};return s[0]!==void 0&&(f.data=s[0]),s[11]!==void 0&&(f.examMode=s[11]),e=new gs({props:f}),D.push(()=>W(e,"data",t)),D.push(()=>W(e,"examMode",c)),{c(){n=k("div"),ee(e.$$.fragment),m(n,"class","col-lg-3 d-none d-lg-block")},m(r,a){A(r,n,a),se(e,n,null),u=!0},p(r,a){const w={};!i&&a[0]&1&&(i=!0,w.data=r[0],J(()=>i=!1)),!o&&a[0]&2048&&(o=!0,w.examMode=r[11],J(()=>o=!1)),e.$set(w)},i(r){u||(Q(e.$$.fragment,r),u=!0)},o(r){G(e.$$.fragment,r),u=!1},d(r){r&&P(n),ne(e)}}}function Ne(s){let n,e,i,o,u,t,c,f,r,a;function w(p){s[33](p)}function M(p){s[34](p)}function q(p){s[35](p)}function V(p){s[36](p)}function C(p){s[37](p)}function y(p){s[38](p)}let T={submitAnswer:s[16],deleteAnswer:s[17],updateCurrentQuestionData:s[15]};s[12]!==void 0&&(T.question=s[12]),s[8]!==void 0&&(T.questionContext=s[8]),s[9]!==void 0&&(T.helpUsed=s[9]),s[1]!==void 0&&(T.answerChoice=s[1]),s[11]!==void 0&&(T.examMode=s[11]),s[4]!==void 0&&(T.settingsShuffleAnswers=s[4]),n=new ss({props:T}),D.push(()=>W(n,"question",w)),D.push(()=>W(n,"questionContext",M)),D.push(()=>W(n,"helpUsed",q)),D.push(()=>W(n,"answerChoice",V)),D.push(()=>W(n,"examMode",C)),D.push(()=>W(n,"settingsShuffleAnswers",y));let g=!s[11]&&s[8].isAnswered&&Ve(s);return{c(){ee(n.$$.fragment),f=z(),g&&g.c(),r=Qe()},m(p,h){se(n,p,h),A(p,f,h),g&&g.m(p,h),A(p,r,h),a=!0},p(p,h){const d={};!e&&h[0]&4096&&(e=!0,d.question=p[12],J(()=>e=!1)),!i&&h[0]&256&&(i=!0,d.questionContext=p[8],J(()=>i=!1)),!o&&h[0]&512&&(o=!0,d.helpUsed=p[9],J(()=>o=!1)),!u&&h[0]&2&&(u=!0,d.answerChoice=p[1],J(()=>u=!1)),!t&&h[0]&2048&&(t=!0,d.examMode=p[11],J(()=>t=!1)),!c&&h[0]&16&&(c=!0,d.settingsShuffleAnswers=p[4],J(()=>c=!1)),n.$set(d),!p[11]&&p[8].isAnswered?g?(g.p(p,h),h[0]&2304&&Q(g,1)):(g=Ve(p),g.c(),Q(g,1),g.m(r.parentNode,r)):g&&($(),G(g,1,1,()=>{g=null}),x())},i(p){a||(Q(n.$$.fragment,p),Q(g),a=!0)},o(p){G(n.$$.fragment,p),G(g),a=!1},d(p){p&&(P(f),P(r)),ne(n,p),g&&g.d(p)}}}function Ve(s){let n,e,i;function o(t){s[39](t)}let u={};return s[12].id!==void 0&&(u.questionId=s[12].id),n=new xe({props:u}),D.push(()=>W(n,"questionId",o)),{c(){ee(n.$$.fragment)},m(t,c){se(n,t,c),i=!0},p(t,c){const f={};!e&&c[0]&4096&&(e=!0,f.questionId=t[12].id,J(()=>e=!1)),n.$set(f)},i(t){i||(Q(n.$$.fragment,t),i=!0)},o(t){G(n.$$.fragment,t),i=!1},d(t){ne(n,t)}}}function ze(s){let n,e,i;function o(t){s[40](t)}let u={};return s[10]!==void 0&&(u.magicGIFPath=s[10]),n=new os({props:u}),D.push(()=>W(n,"magicGIFPath",o)),{c(){ee(n.$$.fragment)},m(t,c){se(n,t,c),i=!0},p(t,c){const f={};!e&&c[0]&1024&&(e=!0,f.magicGIFPath=t[10],J(()=>e=!1)),n.$set(f)},i(t){i||(Q(n.$$.fragment,t),i=!0)},o(t){G(n.$$.fragment,t),i=!1},d(t){ne(n,t)}}}function Is(s){let n,e,i,o,u;const t=[Cs,vs],c=[];function f(a,w){return a[0]?0:1}n=f(s),e=c[n]=t[n](s);let r=!s[11]&&ze(s);return{c(){e.c(),i=z(),r&&r.c(),o=Qe()},m(a,w){c[n].m(a,w),A(a,i,w),r&&r.m(a,w),A(a,o,w),u=!0},p(a,w){let M=n;n=f(a),n===M?c[n].p(a,w):($(),G(c[M],1,1,()=>{c[M]=null}),x(),e=c[n],e?e.p(a,w):(e=c[n]=t[n](a),e.c()),Q(e,1),e.m(i.parentNode,i)),a[11]?r&&($(),G(r,1,1,()=>{r=null}),x()):r?(r.p(a,w),w[0]&2048&&Q(r,1)):(r=ze(a),r.c(),Q(r,1),r.m(o.parentNode,o))},i(a){u||(Q(e),Q(r),u=!0)},o(a){G(e),G(r),u=!1},d(a){a&&(P(i),P(o)),c[n].d(a),r&&r.d(a)}}}function Qs(s,n,e){let i,o,u,t,c,f,r,a,w,M,q,V,C,y,T,g;Xe(s,we,l=>e(7,g=l));let{id:p}=n;var h,d,K=!1,Z="";function ie(){return{isAnswered:!!V,answerContext:w.answers.reduce((F,X)=>(F[X.id]={isCorrectAnswer:X.id===w.correct_answer_id,isSubmittedAnswer:r?X.id===r.answer_id:!1,isSelectedAnswer:r?X.id===r.answer_id:!1},F),{})}}var E=-1;Ee(()=>{axios.get("/api/sessions/"+p).then(function(l){e(0,d=l.data)}).catch(function(l){alert(l)})});function ue(){return axios.get("/api/questions/"+w.id).then(function(l){var F=d.deck.questions.findIndex(de=>de.id===w.id),X=l.data;e(0,d.deck.questions[F]=X,d),O(X)}).catch(function(l){alert(l)})}function O(l){if(l.type!=="card"){var F=d.session.answer_choices.findIndex(X=>X.question_id===l.id);F!==-1&&e(0,d.session.answer_choices[F].is_correct=d.session.answer_choices[F].answer_id===l.correct_answer_id,d)}}var R;function le(){R&&R.cancel(),R=je(()=>{axios.put("/api/sessions/"+d.session.id,d.session).then(function(l){}).catch(function(l){alert(l)})},1e3,{maxWait:2e3}),R()}function fe(l){if(l&&l!==-1?e(8,h.answerContext[l].isSelectedAnswer=!0,h):e(8,h.isAnswered=!0,h),V&&l&&l===w.correct_answer_id){e(8,h.isAnswered=!0,h);return}else if(V)return;var F=!1;w.type==="card"?(F=!!l,l===-1&&(l=null)):F=w.correct_answer_id===l,(F||i||!c)&&e(8,h.isAnswered=!0,h),l&&l!==-1&&(e(8,h.answerContext[l].isSubmittedAnswer=!0,h),e(8,h.answerContext[l].isCorrectAnswer=F,h));var X={question_id:q,answer_id:l,is_correct:F,help_used:K};axios.post("/api/sessions/"+p+"/answerchoices",X).then(function(de){e(0,d.session.answer_choices=[...d.session.answer_choices,de.data],d)}).catch(function(de){alert(de)})}function ce(){V&&(e(1,r=d.session.answer_choices.find(l=>l.question_id===q)),r&&axios.delete("/api/sessions/"+p+"/answerchoices/"+r.id).then(function(l){e(0,d.session.answer_choices=[...d.session.answer_choices.filter(F=>F.question_id!==q)],d),Ye().then(()=>{e(8,h=ie())})}).catch(function(l){alert(l)}))}const be=()=>{Ce(we,g.session_show_sidebar=!g.session_show_sidebar,g)},S=()=>{Ce(we,g.session_shuffle_answers=!g.session_shuffle_answers,g)},ae=()=>{Ce(we,g.session_exam_mode=!g.session_exam_mode,g)};function he(l){C=l,e(2,C),e(0,d),e(22,f),e(21,a)}function H(l){C=l,e(2,C),e(0,d),e(22,f),e(21,a)}function L(l){d=l,e(0,d)}function U(l){i=l,e(11,i),e(3,M),e(7,g),e(0,d),e(22,f),e(21,a)}function ke(l){d=l,e(0,d)}function qe(l){s.$$.not_equal(d.session.current_question_id,l)&&(d.session.current_question_id=l,e(0,d))}function ve(l){h=l,e(8,h),e(20,q),e(0,d)}function te(l){w=l,e(12,w),e(0,d)}function N(l){h=l,e(8,h),e(20,q),e(0,d)}function _(l){K=l,e(9,K)}function v(l){r=l,e(1,r),e(0,d),e(20,q)}function oe(l){i=l,e(11,i),e(3,M),e(7,g),e(0,d),e(22,f),e(21,a)}function De(l){t=l,e(4,t),e(7,g)}function Oe(l){s.$$.not_equal(w.id,l)&&(w.id=l,e(12,w),e(0,d))}function Re(l){Z=l,e(10,Z),e(2,C),e(19,E),e(0,d),e(22,f),e(21,a)}return s.$$set=l=>{"id"in l&&e(18,p=l.id)},s.$$.update=()=>{s.$$.dirty[0]&1&&e(22,f=d?d.deck.questions.filter(l=>!l.is_invalid):null),s.$$.dirty[0]&4194305&&e(21,a=d?d.session.answer_choices.filter(l=>f.some(({id:F})=>F===l.question_id)):null),s.$$.dirty[0]&6291457&&e(3,M=d?f.length===a.length:!1),s.$$.dirty[0]&136&&e(11,i=M?!1:g.session_exam_mode),s.$$.dirty[0]&128&&e(6,o=g.session_show_sidebar),s.$$.dirty[0]&128&&e(5,u=g.session_exam_mode),s.$$.dirty[0]&128&&e(4,t=g.session_shuffle_answers),s.$$.dirty[0]&128&&(c=g.session_multiple_answer_tries),s.$$.dirty[0]&64&&axios.put("/api/users/me/settings",{session_show_sidebar:o}).then(function(l){}).catch(function(l){alert(l)}),s.$$.dirty[0]&32&&axios.put("/api/users/me/settings",{session_exam_mode:u}).then(function(l){}).catch(function(l){alert(l)}),s.$$.dirty[0]&16&&axios.put("/api/users/me/settings",{session_shuffle_answers:t}).then(function(l){}).catch(function(l){alert(l)}),s.$$.dirty[0]&1&&e(20,q=d?d.session.current_question_id:null),s.$$.dirty[0]&1048577&&e(1,r=d?d.session.answer_choices.find(l=>l.question_id===q):null),s.$$.dirty[0]&1&&e(12,w=d?d.deck.questions.find(l=>l.id===d.session.current_question_id):null),s.$$.dirty[0]&8&&M&&e(11,i=!1),s.$$.dirty[0]&1048576&&le(),s.$$.dirty[0]&3&&(V=d?!!r:!1),s.$$.dirty[0]&1048576&&q&&e(8,h=ie()),s.$$.dirty[0]&6291457&&e(2,C=d?ns(f.length,a):null),s.$$.dirty[0]&1&&e(14,y=d?d.deck.questions.length:0),s.$$.dirty[0]&1&&e(13,T=d?d.deck.questions.findIndex(l=>l.id==d.session.current_question_id)+1:null),s.$$.dirty[0]&524292&&(()=>{if(C){var l=C.correct;if(l<60){e(19,E=l);return}if(E===-1){e(19,E=l);return}E<60&&(e(19,E=l),axios.get("/api/magic-gif").then(function(F){e(10,Z="magic-gifs/"+F.data.id)}).catch(function(F){}))}})()},[d,r,C,M,t,u,o,g,h,K,Z,i,w,T,y,ue,fe,ce,p,E,q,a,f,be,S,ae,he,H,L,U,ke,qe,ve,te,N,_,v,oe,De,Oe,Re]}class As extends ge{constructor(n){super(),pe(this,n,Qs,Is,me,{id:18},null,[-1,-1])}}const Be=document.getElementById("SessionView");new As({target:Be,props:{id:Be.dataset.sessionId}});
