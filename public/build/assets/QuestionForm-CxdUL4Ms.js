import{y as xt,p as Ve,g as i,s as y,a as l,f as h,c as s,j as n,t as p,h as u,i as Xe,d as yt,r as kt,b as re,k as H,o as je,x as qt,m as At}from"./render-COO8opCt.js";import{o as Ze}from"./index-client-DGX_bLx7.js";import{B as Ct,i as Q}from"./if-CwjDoZzt.js";import{e as He,p as R,i as Et}from"./event-modifiers-BGh6mCkd.js";import{h as U}from"./html-DHpoEShY.js";import{s as I,a as g,d as Ht,c as Qe}from"./attributes-DYipTw7O.js";import{s as k}from"./class-BfJg_ovI.js";import{s as Qt}from"./style-BtOSwUPa.js";import{b as de,a as Ke}from"./input-CSrHR2ik.js";import{b as Ye}from"./select-DxDuCAfo.js";import{b as ce}from"./this-DYJjSBKP.js";import{p as he}from"./props-B2c_TekP.js";import{r as P}from"./legacy-client-30PpYn5B.js";import{_ as It}from"./lodash-d8dSvcKh.js";import{d as $e,K as Je,p as Ue}from"./hotkeys-js-Bzouew-W.js";function Dt(V,d,e){var L=new Ct(V);xt(()=>{var q=d();L.ensure(q,e)})}var St=h('<form action="#"><div class="mb-3"><label class="form-label">Answer text</label> <input type="hidden"/> <trix-editor></trix-editor> <!></div> <div class="accordion my-2 "><div class="accordion-item"><h2 class="accordion-header"><button type="button" data-bs-toggle="collapse" aria-expanded="false">Answer hint (optional)</button></h2> <div><div class="accordion-body"><div class="mb-3"><input type="hidden"/> <trix-editor></trix-editor> <!> <div class="form-text">A hint that will be shown once the user has answered the question.</div></div></div></div></div></div></form>',2);function Tt(V,d){Ve(d,!0);let e=he(d,"answer",15),L=y(void 0),q=y(void 0),N=y(void 0),w=y("");P(()=>{i(L)&&D(i(L))}),P(()=>{i(q)&&D(i(q))}),Ze(()=>{const v=document.getElementById("collapseAnswerHint"+e().id);v&&v.addEventListener("shown.bs.collapse",()=>{i(q)&&i(q).focus()}),l(N,!!e().hint)});function D(v){v.addEventListener("trix-change",function(){e(e().text=document.getElementById("answerText"+e().id).value,!0),e(e().hint=document.getElementById("answerHint"+e().id).value,!0),l(w,'<p class="text-end">Saving ...</p>'),le()})}var E;function le(){E&&E.cancel(),E=$e(()=>{axios.put("/api/answers/"+e().id,e()).then(function(v){l(w,'<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(v){l(w,'<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(v)})},500,{maxWait:2e3}),E()}var j=St(),K=n(j),X=n(K),Z=s(X,2),x=s(Z,2);p(()=>I(x,"id",`editor-answer${e().id??""}`)),k(x,1,"bg-light trix-content"),p(()=>I(x,"input",`answerText${e().id??""}`)),ce(x,v=>l(L,v),()=>i(L));var $=s(x,2);U($,()=>i(w));var Y=s(K,2),fe=n(Y),z=n(fe),J=n(z),ee=s(z,2),be=n(ee),ve=n(be),te=n(ve),G=s(te,2);p(()=>I(G,"id",`editor-answerHint${e().id??""}`)),k(G,1,"bg-light trix-content"),p(()=>I(G,"input",`answerHint${e().id??""}`)),ce(G,v=>l(q,v),()=>i(q));var ue=s(G,2);U(ue,()=>i(w));var ge=s(ue,2);p(()=>{g(X,"for",`answerText${e().id??""}`),g(Z,"id",`answerText${e().id??""}`),g(Y,"id",`accordionAnswerHint${e().id??""}`),k(J,1,`accordion-button text-black bg-white py-2 px-3 ${i(N)?"":"collapsed"}`),g(J,"data-bs-target",`#collapseAnswerHint${e().id??""}`),g(J,"aria-controls",`#collapseAnswerHint${e().id??""}`),g(ee,"id",`collapseAnswerHint${e().id??""}`),k(ee,1,`accordion-collapse collapse ${i(N)?"show":""}`),g(te,"id",`answerHint${e().id??""}`),g(ge,"id",`answerHint${e().id??""}`)}),de(Z,()=>e().text,v=>e(e().text=v,!0)),de(te,()=>e().hint,v=>e(e().hint=v,!0)),u(V,j),Xe()}var Bt=h('<button type="button" class="btn btn-outline-secondary btn-sm">Close editor</button>'),Rt=h('<div class="alert alert-secondary m-1" role="alert"><p class="small fw-bold"><i class="bi bi-clipboard2-pulse"></i> CASE</p> <p class="trix-content"><!></p></div> <div class="text-end m-1"><button type="button" class="btn btn-sm btn-light" title="Remove case"><i class="bi bi-trash"></i> Remove case</button></div>',1),Lt=h("<option> </option>"),Nt=h('<div class="alert alert-light" role="alert"><div class="row g-3 align-items-center"><div class="col-auto"><label for="case" class="col-form-label small fw-bold"><i class="bi bi-clipboard2-pulse"></i> CASE</label></div> <div class="col-auto"><select id="case" class="form-select"><option>Select case</option><!></select></div></div></div>'),Ft=h(`<!> <div class="mt-3 mb-2"><label for="questionText" class="form-label">Question text</label> <input type="hidden"/> <trix-editor></trix-editor> <!></div> <div class="accordion my-2 " id="accordionQuestionHint"><div class="accordion-item"><h2 class="accordion-header"><button type="button" data-bs-toggle="collapse" data-bs-target="#collapseQuestionHint" aria-expanded="false" aria-controls="collapseQuestionHint">Question hint (optional)</button></h2> <div id="collapseQuestionHint"><div class="accordion-body"><div class="mt-3 mb-3"><input type="hidden"/> <trix-editor></trix-editor> <!> <div id="questionHint" class="form-text">A hint that can be shown to the user if they are stuck.</div></div></div></div></div></div> <div class="accordion my-2" id="accordionQuestionComment"><div class="accordion-item"><h2 class="accordion-header"><button type="button" data-bs-toggle="collapse" data-bs-target="#collapseQuestionComment" aria-expanded="false" aria-controls="collapseQuestionComment">Question comment (optional)</button></h2> <div id="collapseQuestionComment"><div class="accordion-body"><div class="mt-3 mb-3"><input type="hidden"/> <trix-editor></trix-editor> <!> <div id="questionHint" class="form-text">A comment that will be shown once the user has answered the question.
                                It can be used to explain the correct answer or provide additional
                                information, for example sources.</div></div></div></div></div></div> <div class="mb-3 p-3 bg-light rounded"><div class="form-check mb-3"><input type="checkbox" class="form-check-input" id="checkInvalidQuestion"/> <label class="form-check-label" for="checkInvalidQuestion"><i class="bi bi-cone-striped"></i> <strong>Invalid question</strong> - Is the answer unknown or disputed? Invalid questions remain in deck but are not counted into results.</label></div> <div class="form-check"><input type="checkbox" class="form-check-input" id="checkNeedsReview"/> <label class="form-check-label" for="checkNeedsReview"><i class="bi bi-eraser-fill"></i> <strong>Needs review</strong> - Does this question need to be reviewed and improved? Questions marked for review remain in deck and are counted into results.</label></div></div>`,3),Wt=h(`<div class="col"><div class="alert alert-warning" role="alert">Don't forget to set the correct answer!</div></div>`),zt=h('<div class="card-body"><p class="card-text"> </p></div>'),Gt=h('<div class="col"><div class="card" style="width: 18rem"><div class="card-header bg-transparent"><button type="button" class="btn btn-sm btn-light"><i class="bi bi-trash"></i></button></div> <img class="card-img-top" alt=""/> <!></div></div>'),Mt=h('<button type="button" title="Set as correct answer"><i class="bi bi-check-lg"></i></button>'),Ot=h('<div class="mt-3 mb-1 px-3 pt-2 pb-1 bg-light-subtle rounded"><!> <div class="text-end mb-2"><!> <button type="button" class="btn btn-sm btn-light" title="Delete answer"><i class="bi bi-trash"></i></button></div></div>'),Pt=h('<div class="sticky-bottom bg-white mt-3" style="z-index: 10;"><div class="row py-3"><div class="col"><button class="btn btn-sm btn-primary" title="Add a new answer (Shortcut: Alt+A)">Add answer</button></div></div></div>'),jt=h("<option>card</option>"),Kt=h('<div class="alert alert-light" role="alert"><p><strong>Delete question?</strong> Deleting a question will also delete all associated answers and images.</p> <button type="button" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i> Delete question</button></div>'),Yt=h(`<div class="row"><div class="col"><div class="mb-3 border-dark" style="border-bottom: dotted; border-width: 1px;"></div></div></div> <div class="alert alert-light" role="alert"><div class="input-group mb-3"><span class="input-group-text">ID</span> <input type="text" class="form-control" disabled readonly=""/></div> <div class="row g-3 align-items-center"><div class="col-auto"><label for="questionType" class="col-form-label fw-bold">Question type:</label></div> <div class="col-auto"><select id="questionType" class="form-select font-monospace text-uppercase"><!><option>mc</option></select></div> <div class="col-auto"><span id="questionTypeHelp" class="form-text">Can be either multiple choice (MC) or card (CARD). <strong>Card Questions
                    can have only one or no answer.</strong></span></div></div></div> <!>`,1),Jt=h('<form action="#" class="mt-3"><!> <!> <div class="mb-3"><label for="image" class="form-label">Add image</label> <input class="form-control" type="file" accept="image/jpeg, image/png, image/webp" name="image"/> <div id="imageHelp" class="form-text">Supported formats are JPEG, PNG, and WebP.</div></div></form> <!> <div class="row row-cols-1 row-cols-lg-3 g4"></div> <!> <!> <!>',1);function li(V,d){Ve(d,!0);let e=he(d,"question",15),L=he(d,"showConfigEditor",3,!1),q=he(d,"showCaseSelector",3,!1),N=y(void 0),w=y(void 0),D=y(void 0),E=y(void 0),le=0,j=y(void 0),K=y(void 0),X=y(void 0);const Z=1e3;let x=y(""),$=H(()=>e().correct_answer_id);P(()=>{i(N)&&Y(i(N))}),P(()=>{i(w)&&Y(i(w))}),P(()=>{i(D)&&Y(i(D))}),P(()=>{e().case?l(E,e().case.id,!0):l(E,"")}),P(()=>{e().id!==i(X)&&(l(X,e().id,!0),l(j,!!e().hint),l(K,!!e().comment))}),Ze(()=>{Je.filter=function(){return!0},Je("alt+A",function(o){o.preventDefault();const c=Date.now();c-le>Z&&(ve(),le=c)});const t=document.getElementById("collapseQuestionHint");t&&t.addEventListener("shown.bs.collapse",()=>{i(D)&&i(D).focus()});const a=document.getElementById("collapseQuestionComment");a&&a.addEventListener("shown.bs.collapse",()=>{i(w)&&i(w).focus()})});function Y(t){t.addEventListener("trix-change",function(){e(e().text=document.getElementById("questionText"+e().id).value,!0),e(e().comment=document.getElementById("questionComment"+e().id).value,!0),e(e().hint=document.getElementById("questionHint"+e().id).value,!0),l(x,'<p class="text-end">Saving ...</p>'),J()})}function fe(t){t!==e().correct_answer_id&&(e(e().correct_answer_id=t,!0),axios.put("/api/questions/"+e().id,e()).then(function(a){}).catch(function(a){alert(a)}))}var z;function J(){z&&z.cancel(),z=$e(()=>{axios.put("/api/questions/"+e().id,e()).then(function(t){l(x,'<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(t){l(x,'<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(t)})},500,{maxWait:2e3}),z()}function ee(){var t=new FormData,a=document.getElementById("imageInput"+e().id);t.set("image",a.files[0]),axios.post("/api/questions/"+e().id+"/images",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(o){a.value="";var c=o.data;e(e().images=[...e().images,c],!0)}).catch(function(o){a.value="",alert(o)})}function be(t){axios.delete("/api/images/"+t).then(function(a){e(e().images=e().images.filter(o=>o.id!==t),!0)}).catch(function(a){alert(a)})}function ve(){axios.post("/api/questions/"+e().id+"/answers",{}).then(function(t){e(e().answers=[...e().answers,t.data],!0),kt().then(()=>{const a=document.getElementById("editor-answer"+t.data.id);a&&a.focus()})}).catch(function(t){alert(t)})}function te(t){axios.delete("/api/answers/"+t).then(function(a){e(e().answers=e().answers.filter(o=>o.id!==t),!0)}).catch(function(a){alert(a)})}function G(){axios.put("/api/questions/"+e().id,{type:e().type==="mc"?"mc":"card"}).then(function(t){e(e().type=t.data.type,!0)}).catch(function(t){alert(t)})}function ue(){axios.put("/api/questions/"+e().id,{case_id:i(E)}).then(function(t){e(e().case_id=t.data.case_id,!0);const a=d.cases.find(o=>o.id===t.data.case_id);e(e().case=a,!0),a.questions||(a.questions=[]),a.questions.push({id:e().id,case_id:a.id})}).catch(function(t){alert(t)})}function ge(){axios.put("/api/questions/"+e().id,{case_id:null}).then(function(t){e(e().case_id=null,!0),e(e().case=null,!0),d.cases.map(a=>{a.questions=a.questions.filter(o=>o.id!==e().id)})}).catch(function(t){alert(t)})}function v(){axios.put("/api/questions/"+e().id,{is_invalid:!e().is_invalid}).then(function(t){e(e().is_invalid=!e().is_invalid,!0)}).catch(function(t){alert(t)})}function et(){axios.put("/api/questions/"+e().id,{needs_review:!e().needs_review}).then(function(t){e(e().needs_review=!e().needs_review,!0)}).catch(function(t){alert(t)})}var Ie=Jt(),we=re(Ie),tt=H(()=>R(J)),De=n(we);{var it=t=>{var a=Bt(),o=H(()=>R(d.toggleEditor));a.__click=function(...c){i(o)?.apply(this,c)},u(t,a)};Q(De,t=>{d.toggleEditor&&t(it)})}var Se=s(De,2);Dt(Se,()=>e().id,t=>{var a=Ft(),o=re(a);{var c=r=>{var ne=Rt(),pe=re(ne),ke=s(n(pe),2),se=n(ke);U(se,()=>Ue.sanitize(d.cases.find(O=>O.id===e().case_id).text));var me=s(pe,2),qe=n(me),Ae=H(()=>R(ge));qe.__click=function(...O){i(Ae)?.apply(this,O)},u(r,ne)},A=r=>{var ne=At(),pe=re(ne);{var ke=se=>{var me=Nt(),qe=n(me),Ae=s(n(qe),2),O=n(Ae);O.__change=ue;var Ce=n(O);Ce.value=Ce.__value="";var bt=s(Ce);He(bt,17,()=>d.cases,Et,(Ee,_e)=>{var oe=Lt(),gt=n(oe),Pe={};p(wt=>{Qe(oe,e().case_id==i(_e).id),je(gt,wt),Pe!==(Pe=i(_e).id)&&(oe.value=(oe.__value=i(_e).id)??"")},[()=>It.truncate(Ue.sanitize(i(_e).text,{ALLOWED_TAGS:[]}),{length:30})]),u(Ee,oe)}),Ye(O,()=>i(E),Ee=>l(E,Ee)),u(se,me)};Q(pe,se=>{q()&&d.cases&&d.cases.length>0&&se(ke)},!0)}u(r,ne)};Q(o,r=>{q()&&e().case_id?r(c):r(A,!1)})}var S=s(o,2),T=s(n(S),2),m=s(T,2);I(m,"id","editor-questionText"),k(m,1,"bg-light trix-content"),p(()=>I(m,"input",`questionText${e().id??""}`)),ce(m,r=>l(N,r),()=>i(N));var F=s(m,2);U(F,()=>i(x));var W=s(S,2),b=n(W),f=n(b),B=n(f),_=s(f,2),C=n(_),xe=n(C),ie=n(xe),M=s(ie,2);I(M,"id","editor-questionHint"),k(M,1,"bg-light trix-content"),p(()=>I(M,"input",`questionHint${e().id??""}`)),ce(M,r=>l(D,r),()=>i(D));var dt=s(M,2);U(dt,()=>i(x));var Fe=s(W,2),ct=n(Fe),We=n(ct),lt=n(We),ze=s(We,2),vt=n(ze),ut=n(vt),ye=n(ut),ae=s(ye,2);I(ae,"id","editor-questionComment"),k(ae,1,"bg-light trix-content"),p(()=>I(ae,"input",`questionComment${e().id??""}`)),ce(ae,r=>l(w,r),()=>i(w));var pt=s(ae,2);U(pt,()=>i(x));var mt=s(Fe,2),Ge=n(mt),Me=n(Ge),_t=H(()=>R(v));Me.__click=function(...r){i(_t)?.apply(this,r)};var ht=s(Ge,2),Oe=n(ht),ft=H(()=>R(et));Oe.__click=function(...r){i(ft)?.apply(this,r)},p(()=>{g(T,"id",`questionText${e().id??""}`),k(B,1,`accordion-button text-black bg-white py-2 px-3 ${i(j)?"":"collapsed"}`),k(_,1,`accordion-collapse collapse ${i(j)?"show":""}`),g(ie,"id",`questionHint${e().id??""}`),k(lt,1,`accordion-button text-black bg-white py-2 px-3 ${i(K)?"":"collapsed"}`),k(ze,1,`accordion-collapse collapse ${i(K)?"show":""}`),g(ye,"id",`questionComment${e().id??""}`)}),de(T,()=>e().text,r=>e(e().text=r,!0)),de(ie,()=>e().hint,r=>e(e().hint=r,!0)),de(ye,()=>e().comment,r=>e(e().comment=r,!0)),Ke(Me,()=>e().is_invalid,r=>e(e().is_invalid=r,!0)),Ke(Oe,()=>e().needs_review,r=>e(e().needs_review=r,!0)),u(t,a)});var at=s(Se,2),Te=s(n(at),2);Te.__input=ee;var Be=s(we,2);{var nt=t=>{var a=Wt();u(t,a)};Q(Be,t=>{!i($)&&e().type==="mc"&&t(nt)})}var Re=s(Be,2);He(Re,21,()=>e().images,t=>t.id,(t,a)=>{var o=Gt(),c=n(o),A=n(c),S=n(A),T=H(()=>R(()=>{confirm("Are you sure you want to delete this image?")&&be(i(a).id)}));S.__click=function(...b){i(T)?.apply(this,b)};var m=s(A,2),F=s(m,2);{var W=b=>{var f=zt(),B=n(f),_=n(B);p(()=>je(_,i(a).comment)),u(b,f)};Q(F,b=>{i(a).comment&&b(W)})}p(()=>g(m,"src",`/${i(a).path??""}`)),u(t,o)});var Le=s(Re,2);He(Le,19,()=>e().answers,t=>t.id,(t,a,o)=>{var c=Ot();let A;var S=n(c);Tt(S,{get answer(){return e().answers[i(o)]},set answer(f){e(e().answers[i(o)]=f,!0)}});var T=s(S,2),m=n(T);{var F=f=>{var B=Mt(),_=H(()=>R(()=>{fe(i(a).id)}));B.__click=function(...C){i(_)?.apply(this,C)},p(()=>k(B,1,`btn btn-sm ${i($)===i(a).id?"btn-success":"btn-light"}`)),u(f,B)};Q(m,f=>{e().type==="mc"&&f(F)})}var W=s(m,2),b=H(()=>R(()=>{confirm("Are you sure you want to delete this answer?")&&te(i(a).id)}));W.__click=function(...f){i(b)?.apply(this,f)},p(()=>A=Qt(c,"",A,{border:"2px dotted "+(i($)===i(a).id?"green":"lightgray")})),u(t,c)});var Ne=s(Le,2);{var st=t=>{var a=Pt(),o=n(a),c=n(o),A=n(c);A.__click=ve,u(t,a)};Q(Ne,t=>{(e().type==="mc"||e().answers.length===0)&&t(st)})}var ot=s(Ne,2);{var rt=t=>{var a=Yt(),o=s(re(a),2),c=n(o),A=s(n(c),2),S=s(c,2),T=s(n(S),2),m=n(T);m.__change=G;var F=n(m);{var W=_=>{var C=jt();C.value=C.__value="card",p(()=>Qe(C,e().type=="card")),u(_,C)};Q(F,_=>{(e().answers.length<=1||e().type==="card")&&_(W)})}var b=s(F);b.value=b.__value="mc";var f=s(o,2);{var B=_=>{var C=Kt(),xe=s(n(C),2),ie=H(()=>R(()=>{confirm("Are you sure you want to delete this question?")&&d.handleQuestionRemove(e().id)}));xe.__click=function(...M){i(ie)?.apply(this,M)},u(_,C)};Q(f,_=>{d.handleQuestionRemove&&_(B)})}p(()=>{Ht(A,e().id),m.disabled=e().answers.length>1,Qe(b,e().type=="mc")}),Ye(m,()=>e().type,_=>e(e().type=_,!0)),u(t,a)};Q(ot,t=>{L()&&t(rt)})}p(()=>g(Te,"id",`imageInput${e().id??""}`)),qt("submit",we,function(...t){i(tt)?.apply(this,t)}),u(V,Ie),Xe()}yt(["click","change","input"]);export{li as Q,Dt as k};
