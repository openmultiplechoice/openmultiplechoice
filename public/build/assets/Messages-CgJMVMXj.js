import{S as he,i as ge,s as ke,b as p,g as w,e as Y,c as b,a as I,h as m,w as N,B as te,x as O,y as ne,d as q,E as Ie,l as L,p as D,r as P,f as qe,k as x,m as $,o as ve,u as ye,v as ee,z as Me,I as Ee,t as J,C as j,j as K,n as Z,H as Ce}from"./index-DgDIGCFR.js";import{e as X,u as He,o as Se}from"./each-CvUUWvvD.js";import{p as ie,d as Be}from"./purify.es-BxOHINE-.js";import{U as Te}from"./UserSettingsStore-CHRhuN6R.js";import{f as ae}from"./format-Dvme3Z7b.js";import{p as ue}from"./parseISO-Bm-E8o14.js";function oe(l,t,e){const n=l.slice();return n[20]=t[e],n[21]=t,n[22]=e,n}function Ae(l){let t,e,n,i,s,a,u,o,_,r,f,d,c,v,C,g,M,T,B;return{c(){t=p("div"),e=p("form"),n=p("div"),i=p("input"),a=w(),u=p("trix-editor"),o=w(),_=p("div"),r=p("input"),d=w(),c=p("label"),c.textContent="Anonymous",v=w(),C=p("input"),g=w(),M=p("button"),M.textContent="Cancel",b(i,"id","message"),b(i,"type","hidden"),b(i,"name","message"),i.value=s=l[0].text,Ee(u,"input","message"),b(n,"class","mb-3"),b(r,"type","checkbox"),b(r,"class","form-check-input"),b(r,"id","anonymous"),r.checked=f=l[0].is_anonymous,b(c,"class","form-check-label"),b(c,"for","anonymous"),b(_,"class","mb-3 form-check"),b(C,"class","btn btn-sm btn-primary"),b(C,"type","submit"),C.value="Save",b(M,"class","btn btn-link mr-0"),b(e,"class","mt-3 mb-3"),b(t,"class","col-md")},m(A,z){I(A,t,z),m(t,e),m(e,n),m(n,i),m(n,a),m(n,u),m(e,o),m(e,_),m(_,r),m(_,d),m(_,c),m(e,v),m(e,C),m(e,g),m(e,M),T||(B=[L(M,"click",D(l[11])),L(e,"submit",D(l[13]))],T=!0)},p(A,z){z&1&&s!==(s=A[0].text)&&(i.value=s),z&1&&f!==(f=A[0].is_anonymous)&&(r.checked=f)},d(A){A&&q(t),T=!1,P(B)}}}function Le(l){let t,e,n,i,s,a,u,o,_,r,f,d,c,v,C,g,M,T,B=ae(ue(l[0].created_at),"dd.MM.yyyy HH:mm")+"",A,z,V,h,y;function U(k,E){return k[0].text&&k[0].text!=""?Re:De}let W=U(l),R=W(l),H=l[10].id===l[0].author_id&&de(l),S=l[0].author&&re(l);return{c(){var k,E,F,G;t=p("div"),e=p("p"),R.c(),n=w(),i=p("p"),s=p("small"),a=J(l[9]),u=w(),o=p("button"),_=p("i"),r=w(),f=J(l[8]),d=w(),c=p("button"),v=p("i"),C=w(),H&&H.c(),g=w(),M=p("button"),M.textContent="Reply",T=w(),A=J(B),z=w(),S&&S.c(),b(e,"class","rounded-2 bg-light p-2 mb-0"),b(_,"class","bi"),j(_,"bi-hand-thumbs-up-fill",((k=l[7])==null?void 0:k.thumb)==="up"),j(_,"bi-hand-thumbs-up",((E=l[7])==null?void 0:E.thumb)!=="up"),b(o,"class","btn"),b(v,"class","bi"),j(v,"bi-hand-thumbs-down-fill",((F=l[7])==null?void 0:F.thumb)==="down"),j(v,"bi-hand-thumbs-down",((G=l[7])==null?void 0:G.thumb)!=="down"),b(c,"class","btn"),b(M,"class","btn btn-sm btn-link link-dark"),b(i,"class","text-muted text-end mb-0"),b(t,"class",V="col-md offset-md-"+l[1])},m(k,E){I(k,t,E),m(t,e),R.m(e,null),m(t,n),m(t,i),m(i,s),m(s,a),m(s,u),m(s,o),m(o,_),m(s,r),m(s,f),m(s,d),m(s,c),m(c,v),m(s,C),H&&H.m(s,null),m(s,g),m(s,M),m(s,T),m(s,A),m(s,z),S&&S.m(s,null),h||(y=[L(o,"click",D(l[17])),L(c,"click",D(l[18])),L(M,"click",D(l[12]))],h=!0)},p(k,E){var F,G,se,le;W===(W=U(k))&&R?R.p(k,E):(R.d(1),R=W(k),R&&(R.c(),R.m(e,null))),E&512&&K(a,k[9]),E&128&&j(_,"bi-hand-thumbs-up-fill",((F=k[7])==null?void 0:F.thumb)==="up"),E&128&&j(_,"bi-hand-thumbs-up",((G=k[7])==null?void 0:G.thumb)!=="up"),E&256&&K(f,k[8]),E&128&&j(v,"bi-hand-thumbs-down-fill",((se=k[7])==null?void 0:se.thumb)==="down"),E&128&&j(v,"bi-hand-thumbs-down",((le=k[7])==null?void 0:le.thumb)!=="down"),k[10].id===k[0].author_id?H?H.p(k,E):(H=de(k),H.c(),H.m(s,g)):H&&(H.d(1),H=null),E&1&&B!==(B=ae(ue(k[0].created_at),"dd.MM.yyyy HH:mm")+"")&&K(A,B),k[0].author?S?S.p(k,E):(S=re(k),S.c(),S.m(s,null)):S&&(S.d(1),S=null),E&2&&V!==(V="col-md offset-md-"+k[1])&&b(t,"class",V)},d(k){k&&q(t),R.d(),H&&H.d(),S&&S.d(),h=!1,P(y)}}}function De(l){let t;return{c(){t=p("i"),t.textContent="Deleted"},m(e,n){I(e,t,n)},p:Z,d(e){e&&q(t)}}}function Re(l){let t,e=ie.sanitize(l[0].text)+"",n;return{c(){t=new Ce(!1),n=Y(),t.a=n},m(i,s){t.m(e,i,s),I(i,n,s)},p(i,s){s&1&&e!==(e=ie.sanitize(i[0].text)+"")&&t.p(e)},d(i){i&&(q(n),t.d())}}}function de(l){let t,e,n,i,s;return{c(){t=p("button"),t.textContent="Edit",e=w(),n=p("button"),n.textContent="Delete",b(t,"class","btn btn-sm btn-link link-dark"),b(n,"class","btn btn-sm btn-link link-dark")},m(a,u){I(a,t,u),I(a,e,u),I(a,n,u),i||(s=[L(t,"click",D(l[11])),L(n,"click",D(l[15]))],i=!0)},p:Z,d(a){a&&(q(t),q(e),q(n)),i=!1,P(s)}}}function re(l){let t=l[0].author.name+"",e;return{c(){e=J(t)},m(n,i){I(n,e,i)},p(n,i){i&1&&t!==(t=n[0].author.name+"")&&K(e,t)},d(n){n&&q(e)}}}function ce(l){let t,e,n,i,s,a,u,o,_,r,f,d,c,v,C;return{c(){t=p("div"),e=p("div"),n=p("form"),i=p("input"),a=w(),u=p("div"),u.innerHTML='<input id="replyMessage" type="hidden" name="replyMessage" value=""/> <trix-editor input="replyMessage"></trix-editor>',o=w(),_=p("div"),_.innerHTML='<input type="checkbox" class="form-check-input" id="replyAnonymous" checked=""/> <label class="form-check-label" for="replyAnonymous">Anonymous</label>',r=w(),f=p("input"),d=w(),c=p("button"),c.textContent="Cancel",b(i,"id","parentMessageId"),b(i,"type","hidden"),i.value=s=l[0].id,b(u,"class","mb-3"),b(_,"class","mb-3 form-check"),b(f,"class","btn btn-sm btn-primary"),b(f,"type","submit"),f.value="Send reply",b(c,"class","btn btn-link mr-0"),b(n,"class","mt-3 mb-3"),b(e,"class","col-md"),b(t,"class","row")},m(g,M){I(g,t,M),m(t,e),m(e,n),m(n,i),m(n,a),m(n,u),m(n,o),m(n,_),m(n,r),m(n,f),m(n,d),m(n,c),v||(C=[L(c,"click",D(l[12])),L(n,"submit",D(l[14]))],v=!0)},p(g,M){M&1&&s!==(s=g[0].id)&&(i.value=s)},d(g){g&&q(t),v=!1,P(C)}}}function fe(l){let t,e,n=X(l[0].childs),i=[];for(let a=0;a<n.length;a+=1)i[a]=me(oe(l,n,a));const s=a=>O(i[a],1,1,()=>{i[a]=null});return{c(){for(let a=0;a<i.length;a+=1)i[a].c();t=Y()},m(a,u){for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(a,u);I(a,t,u),e=!0},p(a,u){if(u&31){n=X(a[0].childs);let o;for(o=0;o<n.length;o+=1){const _=oe(a,n,o);i[o]?(i[o].p(_,u),N(i[o],1)):(i[o]=me(_),i[o].c(),N(i[o],1),i[o].m(t.parentNode,t))}for(te(),o=n.length;o<i.length;o+=1)s(o);ne()}},i(a){if(!e){for(let u=0;u<n.length;u+=1)N(i[u]);e=!0}},o(a){i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)O(i[u]);e=!1},d(a){a&&q(t),qe(i,a)}}}function me(l){let t,e,n;function i(a){l[19](a,l[20],l[21],l[22])}let s={indent:l[1]+1,addMessage:l[2],updateMessage:l[3],questionId:l[4]};return l[20]!==void 0&&(s.message=l[20]),t=new we({props:s}),x.push(()=>$(t,"message",i)),{c(){ve(t.$$.fragment)},m(a,u){ye(t,a,u),n=!0},p(a,u){l=a;const o={};u&2&&(o.indent=l[1]+1),u&4&&(o.addMessage=l[2]),u&8&&(o.updateMessage=l[3]),u&16&&(o.questionId=l[4]),!e&&u&1&&(e=!0,o.message=l[20],ee(()=>e=!1)),t.$set(o)},i(a){n||(N(t.$$.fragment,a),n=!0)},o(a){O(t.$$.fragment,a),n=!1},d(a){Me(t,a)}}}function ze(l){let t,e,n,i,s,a;function u(d,c){return d[5]?Ae:Le}let o=u(l),_=o(l),r=l[6]&&ce(l),f=l[0].childs&&fe(l);return{c(){t=p("div"),e=p("div"),_.c(),n=w(),r&&r.c(),i=w(),f&&f.c(),s=Y(),b(e,"class","row"),b(t,"class","mt-1 mb-1")},m(d,c){I(d,t,c),m(t,e),_.m(e,null),m(t,n),r&&r.m(t,null),I(d,i,c),f&&f.m(d,c),I(d,s,c),a=!0},p(d,[c]){o===(o=u(d))&&_?_.p(d,c):(_.d(1),_=o(d),_&&(_.c(),_.m(e,null))),d[6]?r?r.p(d,c):(r=ce(d),r.c(),r.m(t,null)):r&&(r.d(1),r=null),d[0].childs?f?(f.p(d,c),c&1&&N(f,1)):(f=fe(d),f.c(),N(f,1),f.m(s.parentNode,s)):f&&(te(),O(f,1,1,()=>{f=null}),ne())},i(d){a||(N(f),a=!0)},o(d){O(f),a=!1},d(d){d&&(q(t),q(i),q(s)),_.d(),r&&r.d(),f&&f.d(d)}}}function Ne(l,t,e){let n,i,s,a;Ie(l,Te,h=>e(10,a=h));let{message:u}=t,{indent:o}=t,{addMessage:_}=t,{updateMessage:r}=t,{questionId:f}=t;var d=!1,c=!1;function v(){e(5,d=!d)}function C(){e(6,c=!c)}function g(){var h={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.put("/api/messages/"+u.id,h).then(function(y){v(),e(0,u.text=y.data.text,u),r(u)}).catch(function(y){alert(y)})}function M(){var h={text:document.getElementById("replyMessage").value,parent_message_id:document.getElementById("parentMessageId").value,is_anonymous:document.getElementById("replyAnonymous").checked};axios.post("/api/questions/"+f+"/messages",h).then(function(y){C(),_(y.data)}).catch(function(y){alert(y)})}function T(){var h={text:""};axios.put("/api/messages/"+u.id,h).then(function(y){e(0,u.text="",u),r(u)}).catch(function(y){alert(y)})}function B(h){s!==null?s.thumb===h?axios.delete("/api/messages/"+u.id+"/thumbs/"+s.id).then(function(y){e(0,u.thumbs=u.thumbs.filter(U=>U.user_id===void 0),u),r(u)}).catch(function(y){alert(y)}):axios.put("/api/messages/"+u.id+"/thumbs/"+s.id,{type:h}).then(function(y){u.thumbs.find(U=>U.user_id!==void 0).thumb=h,r(u)}).catch(function(y){alert(y)}):axios.post("/api/messages/"+u.id+"/thumbs",{type:h}).then(function(y){u.thumbs.push({thumb:y.data.type,user_id:y.data.user_id,id:y.data.id}),r(u)}).catch(function(y){alert(y)})}const A=()=>B("up"),z=()=>B("down");function V(h,y,U,W){U[W]=h,e(0,u)}return l.$$set=h=>{"message"in h&&e(0,u=h.message),"indent"in h&&e(1,o=h.indent),"addMessage"in h&&e(2,_=h.addMessage),"updateMessage"in h&&e(3,r=h.updateMessage),"questionId"in h&&e(4,f=h.questionId)},l.$$.update=()=>{l.$$.dirty&1&&e(9,n=u.thumbs.filter(h=>h.thumb==="up").length??0),l.$$.dirty&1&&e(8,i=u.thumbs.filter(h=>h.thumb==="down").length??0),l.$$.dirty&1&&e(7,s=u.thumbs.find(h=>h.user_id!==void 0)??null)},[u,o,_,r,f,d,c,s,i,n,a,v,C,g,M,T,B,A,z,V]}class we extends he{constructor(t){super(),ge(this,t,Ne,ze,ke,{message:0,indent:1,addMessage:2,updateMessage:3,questionId:4})}}function _e(l,t,e){const n=l.slice();return n[13]=t[e],n[14]=t,n[15]=e,n}function be(l){let t,e;return{c(){t=p("p"),e=J(l[3])},m(n,i){I(n,t,i),m(t,e)},p(n,i){i&8&&K(e,n[3])},d(n){n&&q(t)}}}function pe(l,t){let e,n,i,s,a;function u(r){t[8](r,t[13],t[14],t[15])}function o(r){t[9](r)}let _={indent:0,addMessage:t[4],updateMessage:t[5]};return t[13]!==void 0&&(_.message=t[13]),t[0]!==void 0&&(_.questionId=t[0]),n=new we({props:_}),x.push(()=>$(n,"message",u)),x.push(()=>$(n,"questionId",o)),{key:l,first:null,c(){e=Y(),ve(n.$$.fragment),this.first=e},m(r,f){I(r,e,f),ye(n,r,f),a=!0},p(r,f){t=r;const d={};!i&&f&4&&(i=!0,d.message=t[13],ee(()=>i=!1)),!s&&f&1&&(s=!0,d.questionId=t[0],ee(()=>s=!1)),n.$set(d)},i(r){a||(N(n.$$.fragment,r),a=!0)},o(r){O(n.$$.fragment,r),a=!1},d(r){r&&q(e),Me(n,r)}}}function Ue(l){let t,e,n;return{c(){t=p("button"),t.innerHTML='<i class="bi bi-chat-square-dots"></i> Add comment',b(t,"class","btn btn-sm btn-outline-secondary")},m(i,s){I(i,t,s),e||(n=L(t,"click",D(l[7])),e=!0)},p:Z,d(i){i&&q(t),e=!1,n()}}}function je(l){let t,e,n,i,s,a,u,o,_,r,f;return{c(){t=p("div"),e=p("form"),n=p("div"),n.innerHTML='<input id="message" type="hidden" name="message" value=""/> <trix-editor input="message"></trix-editor>',i=w(),s=p("div"),s.innerHTML='<input type="checkbox" class="form-check-input" id="anonymous" checked=""/> <label class="form-check-label" for="anonymous">Anonymous</label>',a=w(),u=p("input"),o=w(),_=p("button"),_.textContent="Cancel",b(n,"class","mb-3"),b(s,"class","mb-3 form-check"),b(u,"class","btn btn-sm btn-primary"),b(u,"type","submit"),u.value="Send",b(_,"class","btn btn-link mr-0"),b(e,"action","#"),b(e,"class","mt-3 mb-3"),b(t,"class","mt-3")},m(d,c){I(d,t,c),m(t,e),m(e,n),m(e,i),m(e,s),m(e,a),m(e,u),m(e,o),m(e,_),r||(f=[L(_,"click",D(l[7])),L(e,"submit",D(l[6]))],r=!0)},p:Z,d(d){d&&q(t),r=!1,P(f)}}}function Oe(l){let t,e=[],n=new Map,i,s,a=X(l[2]);const u=d=>d[13].id;for(let d=0;d<a.length;d+=1){let c=_e(l,a,d),v=u(c);n.set(v,e[d]=pe(v,c))}let o=null;a.length||(o=be(l));function _(d,c){return d[1]?je:Ue}let r=_(l),f=r(l);return{c(){t=p("div");for(let d=0;d<e.length;d+=1)e[d].c();o&&o.c(),i=w(),f.c(),b(t,"class","mt-3 mb-3")},m(d,c){I(d,t,c);for(let v=0;v<e.length;v+=1)e[v]&&e[v].m(t,null);o&&o.m(t,null),m(t,i),f.m(t,null),s=!0},p(d,[c]){c&61&&(a=X(d[2]),te(),e=He(e,c,u,1,d,a,n,t,Se,pe,i,_e),ne(),!a.length&&o?o.p(d,c):a.length?o&&(o.d(1),o=null):(o=be(d),o.c(),o.m(t,i))),r===(r=_(d))&&f?f.p(d,c):(f.d(1),f=r(d),f&&(f.c(),f.m(t,null)))},i(d){if(!s){for(let c=0;c<a.length;c+=1)N(e[c]);s=!0}},o(d){for(let c=0;c<e.length;c+=1)O(e[c]);s=!1},d(d){d&&q(t);for(let c=0;c<e.length;c+=1)e[c].d();o&&o.d(),f.d()}}}function Q(l){var t=structuredClone(l),e={},n=[];t.forEach(s=>{if(!s.parent_message_id&&!s.legacy_parent_message_id){n.push(s);return}var a=s.parent_message_id?s.parent_message_id:s.legacy_parent_message_id;e[a]||(e[a]=[]),e[a].push(s)});function i(s){var a=s.legacy_message_id?s.legacy_message_id:s.id;e[a]&&(s.childs=e[a],s.childs.forEach(u=>{i(u)}))}return n.forEach(s=>{i(s)}),n}function Ve(l,t,e){let{questionId:n}=t;var i=!1,s=[],a=[],u="Loading comments ...",o;function _(){s=[],e(3,u="Loading comments ..."),o&&o.cancel(),o=Be(()=>{axios.get("/api/questions/"+n+"/messages").then(function(g){if(s=g.data,s.length===0){e(3,u="No comments yet");return}e(2,a=Q(s))}).catch(function(g){alert(g)})},1e3,{maxWait:2e3}),o()}function r(g){s.push(g),e(2,a=Q(s))}function f(g){const M=s.findIndex(T=>T.id===g.id);s[M]=g,e(2,a=Q(s))}function d(){var g={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.post("/api/questions/"+n+"/messages",g).then(function(M){c(),s.push(M.data),e(2,a=Q(s))}).catch(function(M){alert(M)})}function c(){e(1,i=!i)}function v(g,M,T,B){T[B]=g,e(2,a),e(0,n)}function C(g){n=g,e(0,n)}return l.$$set=g=>{"questionId"in g&&e(0,n=g.questionId)},l.$$.update=()=>{l.$$.dirty&1&&(e(2,a=[]),e(1,i=!1),_())},[n,i,a,u,r,f,d,c,v,C]}class Qe extends he{constructor(t){super(),ge(this,t,Ve,Oe,ke,{questionId:0})}}export{Qe as M};
