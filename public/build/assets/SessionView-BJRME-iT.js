import{S as ge,i as pe,s as me,e as Qe,b as M,n as E,d as S,c as h,f as p,I as Ae,h as m,l as ee,a as B,t as Z,q as _e,p as le,k as D,E as Je,m as Ke,H as Xe,C as Ee,o as Q,y as L,z as se,x as P,F as Ye,r as R,u as ie,v as te,w as W,A as oe,D as ne,J as Ze,G as Ce,B as je}from"./index-BBxbQYOu.js";import{p as Pe,d as xe}from"./purify.es-DfBF0len.js";import{M as $e}from"./Messages-cZuW1hV5.js";import{C as es}from"./auto-De2ec26M.js";import{S as ss}from"./SessionProgressBar-CBjUMqqW.js";import{e as Me}from"./each-DRTt0YH0.js";import{h as Ie,S as ns}from"./SessionQuestionView-CUI-g7Qx.js";import{s as is}from"./StatsHelper-B91isISU.js";import{U as we}from"./UserSettingsStore-bJDZU8Jx.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./parseISO-Ds5nI7_t.js";import"./lodash-D0JQdfhu.js";import"./QuestionForm-DL-Tikwj.js";function Se(s){let n,e,i,r,u;return{c(){n=h("div"),e=h("img"),p(e,"class","img-fluid"),Ae(e.src,i="/"+s[0])||p(e,"src",i),p(e,"alt","Magic GIF"),p(n,"class","img-fullscreen d-flex justify-content-center align-items-center svelte-k1osqd")},m(t,d){M(t,n,d),m(n,e),r||(u=ee(n,"click",s[2]),r=!0)},p(t,d){d&1&&!Ae(e.src,i="/"+t[0])&&p(e,"src",i)},d(t){t&&S(n),r=!1,u()}}}function ts(s){let n,e=s[0]&&s[1]&&Se(s);return{c(){e&&e.c(),n=Qe()},m(i,r){e&&e.m(i,r),M(i,n,r)},p(i,[r]){i[0]&&i[1]?e?e.p(i,r):(e=Se(i),e.c(),e.m(n.parentNode,n)):e&&(e.d(1),e=null)},i:E,o:E,d(i){i&&S(n),e&&e.d(i)}}}function os(s,n,e){let{magicGIFPath:i=""}=n;var r=!0;function u(){e(1,r=!r)}return s.$$set=t=>{"magicGIFPath"in t&&e(0,i=t.magicGIFPath)},[i,r,u]}class rs extends ge{constructor(n){super(),pe(this,n,os,ts,me,{magicGIFPath:0})}}function Te(s){let n,e,i;return{c(){n=h("button"),n.innerHTML='<i class="bi bi-repeat"></i> Repeat incorrect',p(n,"class","btn btn-sm btn-outline-secondary"),p(n,"type","button")},m(r,u){M(r,n,u),e||(i=ee(n,"click",le(s[5])),e=!0)},p:E,d(r){r&&S(n),e=!1,i()}}}function us(s){let n,e,i,r,u,t,d,f=s[0].correct+"",o,c,w,C,v,y,T,A,G,b=s[0].incorrect>0&&Te(s);return{c(){n=h("div"),e=h("div"),i=h("canvas"),r=B(),u=h("div"),t=h("p"),d=h("span"),o=Z(f),c=Z("%"),w=Z(" correct"),C=B(),v=h("div"),y=h("a"),y.innerHTML='<i class="bi bi-rocket-takeoff"></i> New session',T=B(),b&&b.c(),A=B(),G=h("a"),G.textContent="Home",p(e,"class","col-md"),p(d,"class","fs-4 font-monospace"),p(t,"class","mt-3 text-dark"),p(y,"href","/sessions/create"),p(y,"class","btn btn-sm btn-primary"),p(G,"href","/"),p(G,"class","btn btn-sm btn-outline-secondary"),p(v,"class","d-grid gap-2"),p(u,"class","col-md"),p(n,"class","row mb-5")},m(a,I){M(a,n,I),m(n,e),m(e,i),s[4](i),m(n,r),m(n,u),m(u,t),m(t,d),m(d,o),m(d,c),m(t,w),m(u,C),m(u,v),m(v,y),m(v,T),b&&b.m(v,null),m(v,A),m(v,G)},p(a,[I]){I&1&&f!==(f=a[0].correct+"")&&_e(o,f),a[0].incorrect>0?b?b.p(a,I):(b=Te(a),b.c(),b.m(v,A)):b&&(b.d(1),b=null)},i:E,o:E,d(a){a&&S(n),s[4](null),b&&b.d()}}}function ls(s){axios.post("/api/sessions/"+s+"/newfromincorrect").then(function(n){window.location.href="/sessions/"+n.data.id}).catch(function(n){alert(n)})}function fs(s,n,e){let{progressPercentage:i}=n,{sessionId:r}=n,u,t;function d(o){D[o?"unshift":"push"](()=>{u=o,e(2,u)})}const f=()=>ls(r);return s.$$set=o=>{"progressPercentage"in o&&e(0,i=o.progressPercentage),"sessionId"in o&&e(1,r=o.sessionId)},s.$$.update=()=>{s.$$.dirty&13&&u&&(()=>{if(t)return;const o={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect"],datasets:[{label:"%",data:[i.correct,i.correctWithHelp,i.incorrect],backgroundColor:["#d4edda","#fff3cd","#f8d7da"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};t&&t.destroy();var c=u.getContext("2d");e(3,t=new es(c,o))})()},[i,r,u,t,d,f]}class cs extends ge{constructor(n){super(),pe(this,n,fs,us,me,{progressPercentage:0,sessionId:1})}}function ye(s,n,e){const i=s.slice();return i[5]=n[e],i[7]=e,i}function Fe(s){let n;return{c(){n=h("li"),n.textContent="Loading ...",p(n,"class","svelte-za7w49")},m(e,i){M(e,n,i)},p:E,d(e){e&&S(n)}}}function as(s){let n,e=s[7]+1+"",i;return{c(){n=Z("Question Nr. "),i=Z(e)},m(r,u){M(r,n,u),M(r,i,u)},p:E,d(r){r&&(S(n),S(i))}}}function ds(s){let n=Pe.sanitize(s[5].text).replace(/<\/?[^>]+(>|$)/g,"")+"",e;return{c(){e=Z(n)},m(i,r){M(i,e,r)},p(i,r){r&1&&n!==(n=Pe.sanitize(i[5].text).replace(/<\/?[^>]+(>|$)/g,"")+"")&&_e(e,n)},d(i){i&&S(e)}}}function Ge(s){let n,e,i,r=s[1](s[5])+"",u,t,d,f,o,c;function w(T,A){return T[5].text?ds:as}let C=w(s),v=C(s);function y(){return s[4](s[5])}return{c(){n=h("li"),e=h("small"),i=new Xe(!1),u=B(),v.c(),t=B(),i.a=u,p(n,"class",d="list-group-item list-group-item-action text-overflow "+(s[5].id===s[0].session.current_question_id?"list-group-item-dark":"list-group-item-light")+" svelte-za7w49"),p(n,"id",f="question"+s[5].id)},m(T,A){M(T,n,A),m(n,e),i.m(r,e),m(e,u),v.m(e,null),m(n,t),o||(c=ee(n,"click",y),o=!0)},p(T,A){s=T,A&3&&r!==(r=s[1](s[5])+"")&&i.p(r),C===(C=w(s))&&v?v.p(s,A):(v.d(1),v=C(s),v&&(v.c(),v.m(e,null))),A&1&&d!==(d="list-group-item list-group-item-action text-overflow "+(s[5].id===s[0].session.current_question_id?"list-group-item-dark":"list-group-item-light")+" svelte-za7w49")&&p(n,"class",d),A&1&&f!==(f="question"+s[5].id)&&p(n,"id",f)},d(T){T&&S(n),v.d(),o=!1,c()}}}function _s(s){let n,e,i=Me(s[0].deck.questions),r=[];for(let t=0;t<i.length;t+=1)r[t]=Ge(ye(s,i,t));let u=null;return i.length||(u=Fe()),{c(){n=h("div"),e=h("ul");for(let t=0;t<r.length;t+=1)r[t].c();u&&u.c(),p(e,"class","list-group"),p(n,"class","overflow-scroll"),Je(n,"max-height","85vh")},m(t,d){M(t,n,d),m(n,e);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(e,null);u&&u.m(e,null)},p(t,[d]){if(d&3){i=Me(t[0].deck.questions);let f;for(f=0;f<i.length;f+=1){const o=ye(t,i,f);r[f]?r[f].p(o,d):(r[f]=Ge(o),r[f].c(),r[f].m(e,null))}for(;f<r.length;f+=1)r[f].d(1);r.length=i.length,!i.length&&u?u.p(t,d):i.length?u&&(u.d(1),u=null):(u=Fe(),u.c(),u.m(e,null))}},i:E,o:E,d(t){t&&S(n),Ke(r,t),u&&u.d()}}}function gs(s,n,e){let i,r,{data:u}=n,{examMode:t}=n;const d=f=>e(0,u.session.current_question_id=f.id,u);return s.$$set=f=>{"data"in f&&e(0,u=f.data),"examMode"in f&&e(2,t=f.examMode)},s.$$.update=()=>{s.$$.dirty&1&&e(3,i=u.session.current_question_id),s.$$.dirty&8&&(()=>{var f=document.getElementById("question"+i);f&&f.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})})(),s.$$.dirty&5&&e(1,r=function(f){var o=u.session.answer_choices.find(c=>c.question_id===f.id);return o?t?'<span class="text-dark fw-bold">&check;</span>':o.is_correct?o.help_used?'<span class="text-warning-dark fw-bold">&check;</span>':'<span class="text-success-dark fw-bold">&check;</span>':'<span class="text-danger-dark fw-bold">&cross;</span>':'<span class="text-dark fw-bold">&rightarrow;</span>'})},[u,r,t,i,d]}class ps extends ge{constructor(n){super(),pe(this,n,gs,_s,me,{data:0,examMode:2})}}function ms(s){let n;return{c(){n=h("div"),n.innerHTML="",p(n,"class","col-6")},m(e,i){M(e,n,i)},p:E,d(e){e&&S(n)}}}function bs(s){let n,e,i,r;return{c(){n=h("div"),e=h("button"),e.innerHTML='<span class="fw-bold">←</span> Previous',p(e,"class","btn btn-sm btn-light w-100"),p(n,"class","col-6")},m(u,t){M(u,n,t),m(n,e),i||(r=ee(e,"click",le(s[2])),i=!0)},p:E,d(u){u&&S(n),i=!1,r()}}}function hs(s){let n;return{c(){n=h("div"),n.innerHTML="",p(n,"class","col-6")},m(e,i){M(e,n,i)},p:E,d(e){e&&S(n)}}}function ws(s){let n,e,i,r;return{c(){n=h("div"),e=h("button"),e.innerHTML='Next <span class="fw-bold">→</span>',p(e,"class","btn btn-sm w-100"),Q(e,"btn-warning",s[1].isAnswered),Q(e,"btn-light",!s[1].isAnswered),p(n,"class","col-6")},m(u,t){M(u,n,t),m(n,e),i||(r=ee(e,"click",le(s[3])),i=!0)},p(u,t){t&2&&Q(e,"btn-warning",u[1].isAnswered),t&2&&Q(e,"btn-light",!u[1].isAnswered)},d(u){u&&S(n),i=!1,r()}}}function ks(s){let n,e;function i(o,c){return o[0].session.current_question_id&&o[0].session.current_question_id!=o[0].deck.questions[0].id?bs:ms}let r=i(s),u=r(s);function t(o,c){return o[0].session.current_question_id!=o[0].deck.questions[o[0].deck.questions.length-1].id?ws:hs}let d=t(s),f=d(s);return{c(){n=h("div"),u.c(),e=B(),f.c(),p(n,"class","row mb-3 pt-1 pb-1 sticky-top bg-white")},m(o,c){M(o,n,c),u.m(n,null),m(n,e),f.m(n,null)},p(o,[c]){r===(r=i(o))&&u?u.p(o,c):(u.d(1),u=r(o),u&&(u.c(),u.m(n,e))),d===(d=t(o))&&f?f.p(o,c):(f.d(1),f=d(o),f&&(f.c(),f.m(n,null)))},i:E,o:E,d(o){o&&S(n),u.d(),f.d()}}}function qs(s,n,e){let{data:i}=n,{currentQuestionId:r}=n,{currentQuestionContext:u}=n;Ee(()=>{Ie("left","questions",function(o,c){d()}),Ie("right","questions",function(o,c){f()}),Ie.setScope("questions")});function t(o){return i.deck.questions.findIndex(c=>c.id===o)}function d(){var o=t(r),c=i.deck.questions[o-1];c&&e(0,i.session.current_question_id=c.id,i)}function f(){var o=t(r),c=i.deck.questions[o+1];c&&e(0,i.session.current_question_id=c.id,i)}return s.$$set=o=>{"data"in o&&e(0,i=o.data),"currentQuestionId"in o&&e(4,r=o.currentQuestionId),"currentQuestionContext"in o&&e(1,u=o.currentQuestionContext)},[i,u,d,f,r]}class vs extends ge{constructor(n){super(),pe(this,n,qs,ks,me,{data:0,currentQuestionId:4,currentQuestionContext:1})}}function Cs(s){let n;return{c(){n=h("p"),n.textContent="Loading ..."},m(e,i){M(e,n,i)},p:E,i:E,o:E,d(e){e&&S(n)}}}function Is(s){let n,e,i,r,u,t,d,f,o,c,w,C,v,y,T,A,G=s[0].deck.name+"",b,a,I,q,_,j,x,K,X,O,J,$,fe,ce,be,F,ae,he,U=!s[11]&&s[15]&&(!s[3]||!s[8].isAnswered)&&He(s),N=s[3]&&s[8].isAnswered&&Le(s),V=s[6]&&Ue(s);function ke(g){s[31](g)}function qe(g){s[32](g)}function ve(g){s[33](g)}let re={};s[0]!==void 0&&(re.data=s[0]),s[0].session.current_question_id!==void 0&&(re.currentQuestionId=s[0].session.current_question_id),s[8]!==void 0&&(re.currentQuestionContext=s[8]),J=new vs({props:re}),D.push(()=>R(J,"data",ke)),D.push(()=>R(J,"currentQuestionId",qe)),D.push(()=>R(J,"currentQuestionContext",ve));let z=s[12]&&Ne(s);return{c(){n=h("div"),e=h("div"),i=h("p"),r=h("button"),r.innerHTML='<i class="bi bi-layout-sidebar"></i>',u=B(),t=h("button"),t.innerHTML='<i class="bi bi-shuffle"></i>',d=B(),f=h("button"),f.innerHTML='<i class="bi bi-exclamation-square"></i>',o=B(),c=h("span"),w=Z(s[13]),C=Z("/"),v=Z(s[14]),y=B(),T=h("a"),A=h("strong"),b=Z(G),I=B(),q=h("div"),_=h("div"),U&&U.c(),j=B(),N&&N.c(),x=B(),K=h("div"),V&&V.c(),X=B(),O=h("div"),ie(J.$$.fragment),be=B(),z&&z.c(),p(r,"class","btn btn-sm d-none d-sm-none d-md-none d-lg-inline"),p(r,"title","Toggle sidebar"),Q(r,"bg-light",!s[6]),Q(r,"bg-dark-subtle",s[6]),p(t,"class","btn btn-sm"),p(t,"title","Toggle answer shuffling"),Q(t,"bg-light",!s[4]),Q(t,"bg-dark-subtle",s[4]),p(f,"class","btn btn-sm"),p(f,"title","Toggle exam mode"),Q(f,"bg-light",!s[5]),Q(f,"bg-dark-subtle",s[5]),p(c,"class","ms-1 float-end fw-bold font-monospace badge text-dark"),Q(c,"text-bg-light",!s[1]||s[11]),Q(c,"bg-success",!s[11]&&!s[12].is_invalid&&s[1]&&s[1].is_correct),Q(c,"bg-danger",!s[11]&&!s[12].is_invalid&&s[1]&&!s[1].is_correct),p(T,"href",a="/decks/"+s[0].deck.id),p(T,"class","text-reset text-decoration-none"),p(i,"class","text-overflow svelte-1gfmo48"),p(e,"class","col mb-1"),p(n,"class","row"),p(_,"class","col mb-1"),p(q,"class","row"),p(O,"class","col-md-12"),Q(O,"col-lg-9",s[6]),Q(O,"col-lg-10",!s[6]),Q(O,"offset-lg-1",!s[6]),p(K,"class","row mt-3")},m(g,k){M(g,n,k),m(n,e),m(e,i),m(i,r),m(i,u),m(i,t),m(i,d),m(i,f),m(i,o),m(i,c),m(c,w),m(c,C),m(c,v),m(i,y),m(i,T),m(T,A),m(A,b),M(g,I,k),M(g,q,k),m(q,_),U&&U.m(_,null),m(_,j),N&&N.m(_,null),M(g,x,k),M(g,K,k),V&&V.m(K,null),m(K,X),m(K,O),te(J,O,null),m(O,be),z&&z.m(O,null),F=!0,ae||(he=[ee(r,"click",le(s[24])),ee(t,"click",le(s[25])),ee(f,"click",le(s[26]))],ae=!0)},p(g,k){(!F||k[0]&64)&&Q(r,"bg-light",!g[6]),(!F||k[0]&64)&&Q(r,"bg-dark-subtle",g[6]),(!F||k[0]&16)&&Q(t,"bg-light",!g[4]),(!F||k[0]&16)&&Q(t,"bg-dark-subtle",g[4]),(!F||k[0]&32)&&Q(f,"bg-light",!g[5]),(!F||k[0]&32)&&Q(f,"bg-dark-subtle",g[5]),(!F||k[0]&8192)&&_e(w,g[13]),(!F||k[0]&16384)&&_e(v,g[14]),(!F||k[0]&2050)&&Q(c,"text-bg-light",!g[1]||g[11]),(!F||k[0]&6146)&&Q(c,"bg-success",!g[11]&&!g[12].is_invalid&&g[1]&&g[1].is_correct),(!F||k[0]&6146)&&Q(c,"bg-danger",!g[11]&&!g[12].is_invalid&&g[1]&&!g[1].is_correct),(!F||k[0]&1)&&G!==(G=g[0].deck.name+"")&&_e(b,G),(!F||k[0]&1&&a!==(a="/decks/"+g[0].deck.id))&&p(T,"href",a),!g[11]&&g[15]&&(!g[3]||!g[8].isAnswered)?U?(U.p(g,k),k[0]&35080&&P(U,1)):(U=He(g),U.c(),P(U,1),U.m(_,j)):U&&(ne(),L(U,1,1,()=>{U=null}),se()),g[3]&&g[8].isAnswered?N?(N.p(g,k),k[0]&264&&P(N,1)):(N=Le(g),N.c(),P(N,1),N.m(_,null)):N&&(ne(),L(N,1,1,()=>{N=null}),se()),g[6]?V?(V.p(g,k),k[0]&64&&P(V,1)):(V=Ue(g),V.c(),P(V,1),V.m(K,X)):V&&(ne(),L(V,1,1,()=>{V=null}),se());const ue={};!$&&k[0]&1&&($=!0,ue.data=g[0],W(()=>$=!1)),!fe&&k[0]&1&&(fe=!0,ue.currentQuestionId=g[0].session.current_question_id,W(()=>fe=!1)),!ce&&k[0]&256&&(ce=!0,ue.currentQuestionContext=g[8],W(()=>ce=!1)),J.$set(ue),g[12]?z?(z.p(g,k),k[0]&4096&&P(z,1)):(z=Ne(g),z.c(),P(z,1),z.m(O,null)):z&&(ne(),L(z,1,1,()=>{z=null}),se()),(!F||k[0]&64)&&Q(O,"col-lg-9",g[6]),(!F||k[0]&64)&&Q(O,"col-lg-10",!g[6]),(!F||k[0]&64)&&Q(O,"offset-lg-1",!g[6])},i(g){F||(P(U),P(N),P(V),P(J.$$.fragment,g),P(z),F=!0)},o(g){L(U),L(N),L(V),L(J.$$.fragment,g),L(z),F=!1},d(g){g&&(S(n),S(I),S(q),S(x),S(K)),U&&U.d(),N&&N.d(),V&&V.d(),oe(J),z&&z.d(),ae=!1,je(he)}}}function He(s){let n,e,i;function r(t){s[27](t)}let u={};return s[2]!==void 0&&(u.progressPercentage=s[2]),n=new ss({props:u}),D.push(()=>R(n,"progressPercentage",r)),{c(){ie(n.$$.fragment)},m(t,d){te(n,t,d),i=!0},p(t,d){const f={};!e&&d[0]&4&&(e=!0,f.progressPercentage=t[2],W(()=>e=!1)),n.$set(f)},i(t){i||(P(n.$$.fragment,t),i=!0)},o(t){L(n.$$.fragment,t),i=!1},d(t){oe(n,t)}}}function Le(s){let n,e,i;function r(t){s[28](t)}let u={sessionId:s[0].session.id};return s[2]!==void 0&&(u.progressPercentage=s[2]),n=new cs({props:u}),D.push(()=>R(n,"progressPercentage",r)),{c(){ie(n.$$.fragment)},m(t,d){te(n,t,d),i=!0},p(t,d){const f={};d[0]&1&&(f.sessionId=t[0].session.id),!e&&d[0]&4&&(e=!0,f.progressPercentage=t[2],W(()=>e=!1)),n.$set(f)},i(t){i||(P(n.$$.fragment,t),i=!0)},o(t){L(n.$$.fragment,t),i=!1},d(t){oe(n,t)}}}function Ue(s){let n,e,i,r,u;function t(o){s[29](o)}function d(o){s[30](o)}let f={};return s[0]!==void 0&&(f.data=s[0]),s[11]!==void 0&&(f.examMode=s[11]),e=new ps({props:f}),D.push(()=>R(e,"data",t)),D.push(()=>R(e,"examMode",d)),{c(){n=h("div"),ie(e.$$.fragment),p(n,"class","col-lg-3 d-none d-lg-block")},m(o,c){M(o,n,c),te(e,n,null),u=!0},p(o,c){const w={};!i&&c[0]&1&&(i=!0,w.data=o[0],W(()=>i=!1)),!r&&c[0]&2048&&(r=!0,w.examMode=o[11],W(()=>r=!1)),e.$set(w)},i(o){u||(P(e.$$.fragment,o),u=!0)},o(o){L(e.$$.fragment,o),u=!1},d(o){o&&S(n),oe(e)}}}function Ne(s){let n,e,i,r,u,t,d,f,o,c;function w(a){s[34](a)}function C(a){s[35](a)}function v(a){s[36](a)}function y(a){s[37](a)}function T(a){s[38](a)}function A(a){s[39](a)}let G={deckId:s[0].deck.id,submitAnswer:s[17],deleteAnswer:s[18],updateCurrentQuestionData:s[16]};s[12]!==void 0&&(G.question=s[12]),s[8]!==void 0&&(G.questionContext=s[8]),s[9]!==void 0&&(G.helpUsed=s[9]),s[1]!==void 0&&(G.answerChoice=s[1]),s[11]!==void 0&&(G.examMode=s[11]),s[4]!==void 0&&(G.settingsShuffleAnswers=s[4]),n=new ns({props:G}),D.push(()=>R(n,"question",w)),D.push(()=>R(n,"questionContext",C)),D.push(()=>R(n,"helpUsed",v)),D.push(()=>R(n,"answerChoice",y)),D.push(()=>R(n,"examMode",T)),D.push(()=>R(n,"settingsShuffleAnswers",A));let b=!s[11]&&s[8].isAnswered&&Ve(s);return{c(){ie(n.$$.fragment),f=B(),b&&b.c(),o=Qe()},m(a,I){te(n,a,I),M(a,f,I),b&&b.m(a,I),M(a,o,I),c=!0},p(a,I){const q={};I[0]&1&&(q.deckId=a[0].deck.id),!e&&I[0]&4096&&(e=!0,q.question=a[12],W(()=>e=!1)),!i&&I[0]&256&&(i=!0,q.questionContext=a[8],W(()=>i=!1)),!r&&I[0]&512&&(r=!0,q.helpUsed=a[9],W(()=>r=!1)),!u&&I[0]&2&&(u=!0,q.answerChoice=a[1],W(()=>u=!1)),!t&&I[0]&2048&&(t=!0,q.examMode=a[11],W(()=>t=!1)),!d&&I[0]&16&&(d=!0,q.settingsShuffleAnswers=a[4],W(()=>d=!1)),n.$set(q),!a[11]&&a[8].isAnswered?b?(b.p(a,I),I[0]&2304&&P(b,1)):(b=Ve(a),b.c(),P(b,1),b.m(o.parentNode,o)):b&&(ne(),L(b,1,1,()=>{b=null}),se())},i(a){c||(P(n.$$.fragment,a),P(b),c=!0)},o(a){L(n.$$.fragment,a),L(b),c=!1},d(a){a&&(S(f),S(o)),oe(n,a),b&&b.d(a)}}}function Ve(s){let n,e,i;function r(t){s[40](t)}let u={};return s[12].id!==void 0&&(u.questionId=s[12].id),n=new $e({props:u}),D.push(()=>R(n,"questionId",r)),{c(){ie(n.$$.fragment)},m(t,d){te(n,t,d),i=!0},p(t,d){const f={};!e&&d[0]&4096&&(e=!0,f.questionId=t[12].id,W(()=>e=!1)),n.$set(f)},i(t){i||(P(n.$$.fragment,t),i=!0)},o(t){L(n.$$.fragment,t),i=!1},d(t){oe(n,t)}}}function ze(s){let n,e,i;function r(t){s[41](t)}let u={};return s[10]!==void 0&&(u.magicGIFPath=s[10]),n=new rs({props:u}),D.push(()=>R(n,"magicGIFPath",r)),{c(){ie(n.$$.fragment)},m(t,d){te(n,t,d),i=!0},p(t,d){const f={};!e&&d[0]&1024&&(e=!0,f.magicGIFPath=t[10],W(()=>e=!1)),n.$set(f)},i(t){i||(P(n.$$.fragment,t),i=!0)},o(t){L(n.$$.fragment,t),i=!1},d(t){oe(n,t)}}}function Qs(s){let n,e,i,r,u;const t=[Is,Cs],d=[];function f(c,w){return c[0]?0:1}n=f(s),e=d[n]=t[n](s);let o=!s[11]&&ze(s);return{c(){e.c(),i=B(),o&&o.c(),r=Qe()},m(c,w){d[n].m(c,w),M(c,i,w),o&&o.m(c,w),M(c,r,w),u=!0},p(c,w){let C=n;n=f(c),n===C?d[n].p(c,w):(ne(),L(d[C],1,1,()=>{d[C]=null}),se(),e=d[n],e?e.p(c,w):(e=d[n]=t[n](c),e.c()),P(e,1),e.m(i.parentNode,i)),c[11]?o&&(ne(),L(o,1,1,()=>{o=null}),se()):o?(o.p(c,w),w[0]&2048&&P(o,1)):(o=ze(c),o.c(),P(o,1),o.m(r.parentNode,r))},i(c){u||(P(e),P(o),u=!0)},o(c){L(e),L(o),u=!1},d(c){c&&(S(i),S(r)),d[n].d(c),o&&o.d(c)}}}function As(s,n,e){let i,r,u,t,d,f,o,c,w,C,v,y,T,A,G,b,a;Ye(s,we,l=>e(7,a=l));let{id:I}=n;var q,_,j=!1,x="";function K(){return{isAnswered:!!T,answerContext:C.answers.reduce((H,Y)=>(H[Y.id]={isCorrectAnswer:Y.id===C.correct_answer_id,isSubmittedAnswer:c?Y.id===c.answer_id:!1,isSelectedAnswer:c?Y.id===c.answer_id:!1},H),{})}}var X=-1;Ee(()=>{axios.get("/api/sessions/"+I).then(function(l){e(0,_=l.data)}).catch(function(l){alert(l)})});function O(){return axios.get("/api/questions/"+C.id).then(function(l){var H=_.deck.questions.findIndex(de=>de.id===C.id),Y=l.data;e(0,_.deck.questions[H]=Y,_),J(Y)}).catch(function(l){alert(l)})}function J(l){if(l.type!=="card"){var H=_.session.answer_choices.findIndex(Y=>Y.question_id===l.id);H!==-1&&e(0,_.session.answer_choices[H].is_correct=_.session.answer_choices[H].answer_id===l.correct_answer_id,_)}}var $;function fe(){$&&$.cancel(),$=xe(()=>{axios.put("/api/sessions/"+_.session.id,_.session).then(function(l){}).catch(function(l){alert(l)})},1e3,{maxWait:2e3}),$()}function ce(l){if(l&&l!==-1?e(8,q.answerContext[l].isSelectedAnswer=!0,q):e(8,q.isAnswered=!0,q),T&&l&&l===C.correct_answer_id){e(8,q.isAnswered=!0,q);return}else if(T)return;var H=!1;C.type==="card"?(H=!!l,l===-1&&(l=null)):H=C.correct_answer_id===l,(H||i||!d)&&e(8,q.isAnswered=!0,q),l&&l!==-1&&(e(8,q.answerContext[l].isSubmittedAnswer=!0,q),e(8,q.answerContext[l].isCorrectAnswer=H,q));var Y={question_id:y,answer_id:l,is_correct:H,help_used:j};axios.post("/api/sessions/"+I+"/answerchoices",Y).then(function(de){e(0,_.session.answer_choices=[..._.session.answer_choices,de.data],_)}).catch(function(de){alert(de)})}function be(){T&&(e(1,c=_.session.answer_choices.find(l=>l.question_id===y)),c&&axios.delete("/api/sessions/"+I+"/answerchoices/"+c.id).then(function(l){e(0,_.session.answer_choices=[..._.session.answer_choices.filter(H=>H.question_id!==y)],_),Ze().then(()=>{e(8,q=K())})}).catch(function(l){alert(l)}))}const F=()=>{Ce(we,a.session_show_sidebar=!a.session_show_sidebar,a)},ae=()=>{Ce(we,a.session_shuffle_answers=!a.session_shuffle_answers,a)},he=()=>{Ce(we,a.session_exam_mode=!a.session_exam_mode,a)};function U(l){A=l,e(2,A),e(0,_),e(23,o),e(22,w)}function N(l){A=l,e(2,A),e(0,_),e(23,o),e(22,w)}function V(l){_=l,e(0,_)}function ke(l){i=l,e(11,i),e(3,v),e(7,a),e(0,_),e(23,o),e(22,w)}function qe(l){_=l,e(0,_)}function ve(l){s.$$.not_equal(_.session.current_question_id,l)&&(_.session.current_question_id=l,e(0,_))}function re(l){q=l,e(8,q),e(21,y),e(0,_)}function z(l){C=l,e(12,C),e(0,_)}function g(l){q=l,e(8,q),e(21,y),e(0,_)}function k(l){j=l,e(9,j)}function ue(l){c=l,e(1,c),e(0,_),e(21,y)}function De(l){i=l,e(11,i),e(3,v),e(7,a),e(0,_),e(23,o),e(22,w)}function Oe(l){t=l,e(4,t),e(7,a)}function Re(l){s.$$.not_equal(C.id,l)&&(C.id=l,e(12,C),e(0,_))}function We(l){x=l,e(10,x),e(2,A),e(20,X),e(0,_),e(23,o),e(22,w)}return s.$$set=l=>{"id"in l&&e(19,I=l.id)},s.$$.update=()=>{s.$$.dirty[0]&1&&e(23,o=_?_.deck.questions.filter(l=>!l.is_invalid):null),s.$$.dirty[0]&8388609&&e(22,w=_?_.session.answer_choices.filter(l=>o.some(({id:H})=>H===l.question_id)):null),s.$$.dirty[0]&12582913&&e(3,v=_?o.length===w.length:!1),s.$$.dirty[0]&136&&e(11,i=v?!1:a.session_exam_mode),s.$$.dirty[0]&128&&e(6,r=a.session_show_sidebar),s.$$.dirty[0]&128&&e(5,u=a.session_exam_mode),s.$$.dirty[0]&128&&e(4,t=a.session_shuffle_answers),s.$$.dirty[0]&128&&(d=a.session_multiple_answer_tries),s.$$.dirty[0]&128&&e(15,f=a.session_show_progress_bar),s.$$.dirty[0]&64&&axios.put("/api/users/me/settings",{session_show_sidebar:r}).then(function(l){}).catch(function(l){alert(l)}),s.$$.dirty[0]&32&&axios.put("/api/users/me/settings",{session_exam_mode:u}).then(function(l){}).catch(function(l){alert(l)}),s.$$.dirty[0]&16&&axios.put("/api/users/me/settings",{session_shuffle_answers:t}).then(function(l){}).catch(function(l){alert(l)}),s.$$.dirty[0]&1&&e(21,y=_?_.session.current_question_id:null),s.$$.dirty[0]&2097153&&e(1,c=_?_.session.answer_choices.find(l=>l.question_id===y):null),s.$$.dirty[0]&1&&e(12,C=_?_.deck.questions.find(l=>l.id===_.session.current_question_id):null),s.$$.dirty[0]&8&&v&&e(11,i=!1),s.$$.dirty[0]&2097152&&fe(),s.$$.dirty[0]&3&&(T=_?!!c:!1),s.$$.dirty[0]&2097152&&y&&e(8,q=K()),s.$$.dirty[0]&12582913&&e(2,A=_?is(o.length,w):null),s.$$.dirty[0]&1&&e(14,G=_?_.deck.questions.length:0),s.$$.dirty[0]&1&&e(13,b=_?_.deck.questions.findIndex(l=>l.id==_.session.current_question_id)+1:null),s.$$.dirty[0]&1048580&&(()=>{if(A){var l=A.correct;if(l<60){e(20,X=l);return}if(X===-1){e(20,X=l);return}X<60&&(e(20,X=l),axios.get("/api/magic-gif").then(function(H){e(10,x="magic-gifs/"+H.data.id)}).catch(function(H){}))}})()},[_,c,A,v,t,u,r,a,q,j,x,i,C,b,G,f,O,ce,be,I,X,y,w,o,F,ae,he,U,N,V,ke,qe,ve,re,z,g,k,ue,De,Oe,Re,We]}class Ps extends ge{constructor(n){super(),pe(this,n,As,Qs,me,{id:19},null,[-1,-1])}}const Be=document.getElementById("SessionView");new Ps({target:Be,props:{id:Be.dataset.sessionId}});
