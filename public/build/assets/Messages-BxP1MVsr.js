import{S as re,i as me,s as _e,a as I,e as j,b as q,x as L,D as Q,y as N,z as X,d as E,K as ke,c as _,f as c,h as d,l as A,p as B,B as O,m as ye,k as F,r as G,u as pe,v as be,w as J,A as he,g as ve,t as U,q as K,o as D,n as P,H as we}from"./index-CW_84yAU.js";import{e as W,u as Me,o as Ie}from"./each-23V_io8F.js";import{p as x,d as qe}from"./purify.es-BMHaTOf2.js";import{U as Ee}from"./UserSettingsStore-D7Gisc9d.js";import{f as $,p as ee}from"./parseISO-JEmvXouO.js";function te(u,t,e){const n=u.slice();return n[18]=t[e],n[19]=t,n[20]=e,n}function se(u){let t,e,n;function i(o,p){return o[5]?Ce:He}let s=i(u),l=s(u),a=u[6]&&ue(u);return{c(){t=_("div"),e=_("div"),l.c(),n=I(),a&&a.c(),c(e,"class","row"),c(t,"class","mt-1 mb-1")},m(o,p){q(o,t,p),d(t,e),l.m(e,null),d(t,n),a&&a.m(t,null)},p(o,p){s===(s=i(o))&&l?l.p(o,p):(l.d(1),l=s(o),l&&(l.c(),l.m(e,null))),o[6]?a?a.p(o,p):(a=ue(o),a.c(),a.m(t,null)):a&&(a.d(1),a=null)},d(o){o&&E(t),l.d(),a&&a.d()}}}function Ce(u){let t,e,n,i,s,l,a,o,p,m,b,f,r,y,H,h,g,v,C;return{c(){t=_("div"),e=_("form"),n=_("div"),i=_("input"),l=I(),a=_("trix-editor"),o=I(),p=_("div"),m=_("input"),f=I(),r=_("label"),r.textContent="Anonymous",y=I(),H=_("input"),h=I(),g=_("button"),g.textContent="Cancel",c(i,"id","message"),c(i,"type","hidden"),c(i,"name","message"),i.value=s=u[0].text,ve(a,"input","message"),c(n,"class","mb-3"),c(m,"type","checkbox"),c(m,"class","form-check-input"),c(m,"id","anonymous"),m.checked=b=u[0].is_anonymous,c(r,"class","form-check-label"),c(r,"for","anonymous"),c(p,"class","mb-3 form-check"),c(H,"class","btn btn-sm btn-primary"),c(H,"type","submit"),H.value="Save",c(g,"class","btn btn-link mr-0"),c(e,"class","mt-3 mb-3"),c(t,"class","col-md")},m(T,k){q(T,t,k),d(t,e),d(e,n),d(n,i),d(n,l),d(n,a),d(e,o),d(e,p),d(p,m),d(p,f),d(p,r),d(e,y),d(e,H),d(e,h),d(e,g),v||(C=[A(g,"click",B(u[9])),A(e,"submit",B(u[11]))],v=!0)},p(T,k){k&1&&s!==(s=T[0].text)&&(i.value=s),k&1&&b!==(b=T[0].is_anonymous)&&(m.checked=b)},d(T){T&&E(t),v=!1,O(C)}}}function He(u){let t,e,n,i,s,l,a=$(ee(u[0].created_at),"dd.MM.yyyy HH:mm")+"",o,p,m;function b(v,C){return v[0].is_deleted?Se:Te}let f=b(u),r=f(u),y=!u[0].is_deleted&&le(u);function H(v,C){if(v[0].is_anonymous)return Be;if(v[0].author&&!v[0].is_deleted)return Ae}let h=H(u),g=h&&h(u);return{c(){t=_("div"),r.c(),e=I(),n=_("p"),i=_("small"),s=_("div"),y&&y.c(),l=I(),o=U(a),p=I(),g&&g.c(),c(s,"class","d-flex align-items-center py-1"),c(n,"class","text-muted text-end mb-0"),c(t,"class",m="col-md offset-md-"+u[1])},m(v,C){q(v,t,C),r.m(t,null),d(t,e),d(t,n),d(n,i),d(i,s),y&&y.m(s,null),d(s,l),d(s,o),d(s,p),g&&g.m(s,null)},p(v,C){f===(f=b(v))&&r?r.p(v,C):(r.d(1),r=f(v),r&&(r.c(),r.m(t,e))),v[0].is_deleted?y&&(y.d(1),y=null):y?y.p(v,C):(y=le(v),y.c(),y.m(s,l)),C&1&&a!==(a=$(ee(v[0].created_at),"dd.MM.yyyy HH:mm")+"")&&K(o,a),h===(h=H(v))&&g?g.p(v,C):(g&&g.d(1),g=h&&h(v),g&&(g.c(),g.m(s,null))),C&2&&m!==(m="col-md offset-md-"+v[1])&&c(t,"class",m)},d(v){v&&E(t),r.d(),y&&y.d(),g&&g.d()}}}function Se(u){let t;return{c(){t=_("p"),t.innerHTML="<small><i>deleted</i></small>",c(t,"class","rounded-2 bg-light-subtle p-1 mb-0 text-muted")},m(e,n){q(e,t,n)},p:P,d(e){e&&E(t)}}}function Te(u){let t,e=u[0].text&&ne(u);return{c(){t=_("p"),e&&e.c(),c(t,"class","rounded-2 bg-light p-2 mb-0 text-break")},m(n,i){q(n,t,i),e&&e.m(t,null)},p(n,i){n[0].text?e?e.p(n,i):(e=ne(n),e.c(),e.m(t,null)):e&&(e.d(1),e=null)},d(n){n&&E(t),e&&e.d()}}}function ne(u){let t,e=x.sanitize(u[0].text)+"",n;return{c(){t=new we(!1),n=j(),t.a=n},m(i,s){t.m(e,i,s),q(i,n,s)},p(i,s){s&1&&e!==(e=x.sanitize(i[0].text)+"")&&t.p(e)},d(i){i&&(E(n),t.d())}}}function le(u){let t,e,n,i,s,l=u[0].thumbs_up_count+"",a,o,p,m,b,f,r,y,H=u[0].thumbs_down_count+"",h,g,v,C,T,k,w=u[8].id===u[0].author_id&&ie(u);return{c(){var M,S,R,z;t=_("div"),e=_("button"),n=_("i"),i=I(),s=_("span"),a=U(l),o=I(),p=_("span"),p.textContent="|",m=I(),b=_("button"),f=_("i"),r=I(),y=_("span"),h=U(H),g=I(),w&&w.c(),v=I(),C=_("button"),C.textContent="Reply",c(n,"class","bi"),D(n,"bi-hand-thumbs-up-fill",((M=u[7])==null?void 0:M.type)==="up"),D(n,"bi-hand-thumbs-up",((S=u[7])==null?void 0:S.type)!=="up"),c(e,"class","btn mx-0 ps-0 pe-1"),c(s,"class","pe-1 font-monospace"),c(p,"class","px-1"),c(f,"class","bi"),D(f,"bi-hand-thumbs-down-fill",((R=u[7])==null?void 0:R.type)==="down"),D(f,"bi-hand-thumbs-down",((z=u[7])==null?void 0:z.type)!=="down"),c(b,"class","btn mx-0 px-1"),c(y,"class","pe-1 font-monospace"),c(t,"class","d-flex rounded-4 align-items-center bg-light ms-auto px-2"),c(C,"class","btn btn-sm btn-link link-dark")},m(M,S){q(M,t,S),d(t,e),d(e,n),d(t,i),d(t,s),d(s,a),d(t,o),d(t,p),d(t,m),d(t,b),d(b,f),d(t,r),d(t,y),d(y,h),q(M,g,S),w&&w.m(M,S),q(M,v,S),q(M,C,S),T||(k=[A(e,"click",B(u[15])),A(b,"click",B(u[16])),A(C,"click",B(u[10]))],T=!0)},p(M,S){var R,z,Y,Z;S&128&&D(n,"bi-hand-thumbs-up-fill",((R=M[7])==null?void 0:R.type)==="up"),S&128&&D(n,"bi-hand-thumbs-up",((z=M[7])==null?void 0:z.type)!=="up"),S&1&&l!==(l=M[0].thumbs_up_count+"")&&K(a,l),S&128&&D(f,"bi-hand-thumbs-down-fill",((Y=M[7])==null?void 0:Y.type)==="down"),S&128&&D(f,"bi-hand-thumbs-down",((Z=M[7])==null?void 0:Z.type)!=="down"),S&1&&H!==(H=M[0].thumbs_down_count+"")&&K(h,H),M[8].id===M[0].author_id?w?w.p(M,S):(w=ie(M),w.c(),w.m(v.parentNode,v)):w&&(w.d(1),w=null)},d(M){M&&(E(t),E(g),E(v),E(C)),w&&w.d(M),T=!1,O(k)}}}function ie(u){let t,e,n,i,s;return{c(){t=_("button"),t.textContent="Edit",e=I(),n=_("button"),n.textContent="Delete",c(t,"class","btn btn-sm btn-link link-dark"),c(n,"class","btn btn-sm btn-link link-dark")},m(l,a){q(l,t,a),q(l,e,a),q(l,n,a),i||(s=[A(t,"click",B(u[9])),A(n,"click",B(u[13]))],i=!0)},p:P,d(l){l&&(E(t),E(e),E(n)),i=!1,O(s)}}}function Ae(u){let t,e,n=(u[0].author.public_name?u[0].author.public_name:u[0].author.name)+"",i;return{c(){t=_("strong"),e=_("span"),i=U(n),c(e,"class","ps-2")},m(s,l){q(s,t,l),d(t,e),d(e,i)},p(s,l){l&1&&n!==(n=(s[0].author.public_name?s[0].author.public_name:s[0].author.name)+"")&&K(i,n)},d(s){s&&E(t)}}}function Be(u){let t;return{c(){t=_("i"),c(t,"class","bi bi-incognito ps-2"),c(t,"title","anonymous")},m(e,n){q(e,t,n)},p:P,d(e){e&&E(t)}}}function ue(u){let t,e,n,i,s,l,a,o,p,m,b,f,r,y,H;return{c(){t=_("div"),e=_("div"),n=_("form"),i=_("input"),l=I(),a=_("div"),a.innerHTML='<input id="replyMessage" type="hidden" name="replyMessage" value=""/> <trix-editor input="replyMessage"></trix-editor>',o=I(),p=_("div"),p.innerHTML='<input type="checkbox" class="form-check-input" id="replyAnonymous" checked=""/> <label class="form-check-label" for="replyAnonymous">Anonymous</label>',m=I(),b=_("input"),f=I(),r=_("button"),r.textContent="Cancel",c(i,"id","parentMessageId"),c(i,"type","hidden"),i.value=s=u[0].id,c(a,"class","mb-3"),c(p,"class","mb-3 form-check"),c(b,"class","btn btn-sm btn-primary"),c(b,"type","submit"),b.value="Send reply",c(r,"class","btn btn-link mr-0"),c(n,"class","mt-3 mb-3"),c(e,"class","col-md"),c(t,"class","row")},m(h,g){q(h,t,g),d(t,e),d(e,n),d(n,i),d(n,l),d(n,a),d(n,o),d(n,p),d(n,m),d(n,b),d(n,f),d(n,r),y||(H=[A(r,"click",B(u[10])),A(n,"submit",B(u[12]))],y=!0)},p(h,g){g&1&&s!==(s=h[0].id)&&(i.value=s)},d(h){h&&E(t),y=!1,O(H)}}}function ae(u){let t,e,n=W(u[0].childs),i=[];for(let l=0;l<n.length;l+=1)i[l]=oe(te(u,n,l));const s=l=>N(i[l],1,1,()=>{i[l]=null});return{c(){for(let l=0;l<i.length;l+=1)i[l].c();t=j()},m(l,a){for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(l,a);q(l,t,a),e=!0},p(l,a){if(a&31){n=W(l[0].childs);let o;for(o=0;o<n.length;o+=1){const p=te(l,n,o);i[o]?(i[o].p(p,a),L(i[o],1)):(i[o]=oe(p),i[o].c(),L(i[o],1),i[o].m(t.parentNode,t))}for(Q(),o=n.length;o<i.length;o+=1)s(o);X()}},i(l){if(!e){for(let a=0;a<n.length;a+=1)L(i[a]);e=!0}},o(l){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)N(i[a]);e=!1},d(l){l&&E(t),ye(i,l)}}}function oe(u){let t,e,n;function i(l){u[17](l,u[18],u[19],u[20])}let s={indent:u[1]+1,addMessage:u[2],updateMessage:u[3],questionId:u[4]};return u[18]!==void 0&&(s.message=u[18]),t=new ge({props:s}),F.push(()=>G(t,"message",i)),{c(){pe(t.$$.fragment)},m(l,a){be(t,l,a),n=!0},p(l,a){u=l;const o={};a&2&&(o.indent=u[1]+1),a&4&&(o.addMessage=u[2]),a&8&&(o.updateMessage=u[3]),a&16&&(o.questionId=u[4]),!e&&a&1&&(e=!0,o.message=u[18],J(()=>e=!1)),t.$set(o)},i(l){n||(L(t.$$.fragment,l),n=!0)},o(l){N(t.$$.fragment,l),n=!1},d(l){he(t,l)}}}function Le(u){let t,e,n,i=(!u[0].is_deleted||u[0].is_deleted&&u[0].childs)&&se(u),s=u[0].childs&&ae(u);return{c(){i&&i.c(),t=I(),s&&s.c(),e=j()},m(l,a){i&&i.m(l,a),q(l,t,a),s&&s.m(l,a),q(l,e,a),n=!0},p(l,[a]){!l[0].is_deleted||l[0].is_deleted&&l[0].childs?i?i.p(l,a):(i=se(l),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null),l[0].childs?s?(s.p(l,a),a&1&&L(s,1)):(s=ae(l),s.c(),L(s,1),s.m(e.parentNode,e)):s&&(Q(),N(s,1,1,()=>{s=null}),X())},i(l){n||(L(s),n=!0)},o(l){N(s),n=!1},d(l){l&&(E(t),E(e)),i&&i.d(l),s&&s.d(l)}}}function De(u,t,e){let n,i;ke(u,Ee,k=>e(8,i=k));let{message:s}=t,{indent:l}=t,{addMessage:a}=t,{updateMessage:o}=t,{questionId:p}=t;var m=!1,b=!1;function f(){e(5,m=!m)}function r(){e(6,b=!b)}function y(){var k={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.put("/api/messages/"+s.id,k).then(function(w){f(),e(0,s.text=w.data.text,s),e(0,s.is_anonymous=w.data.is_anonymous,s),o(s)}).catch(function(w){alert(w)})}function H(){var k={text:document.getElementById("replyMessage").value,parent_message_id:document.getElementById("parentMessageId").value,is_anonymous:document.getElementById("replyAnonymous").checked};axios.post("/api/questions/"+p+"/messages",k).then(function(w){r(),a(w.data)}).catch(function(w){alert(w)})}function h(){confirm("Are you sure you want to delete this message?")&&axios.delete("/api/messages/"+s.id).then(function(k){e(0,s.text="",s),e(0,s.is_deleted=!0,s),o(s)}).catch(function(k){alert(k)})}function g(k){n!==null?n.type===k?axios.delete("/api/messages/"+s.id+"/thumbs/"+n.id).then(function(w){e(0,s.thumbs=s.thumbs.filter(M=>M.user_id===void 0),s),k==="up"?e(0,s.thumbs_up_count-=1,s):e(0,s.thumbs_down_count-=1,s),o(s)}).catch(function(w){alert(w)}):axios.put("/api/messages/"+s.id+"/thumbs/"+n.id,{type:k}).then(function(w){s.thumbs.find(M=>M.user_id!==void 0).type=k,k==="up"?(e(0,s.thumbs_up_count+=1,s),e(0,s.thumbs_down_count-=1,s)):(e(0,s.thumbs_down_count+=1,s),e(0,s.thumbs_up_count-=1,s)),o(s)}).catch(function(w){alert(w)}):axios.post("/api/messages/"+s.id+"/thumbs",{type:k}).then(function(w){s.thumbs.push({type:w.data.type,user_id:w.data.user_id,id:w.data.id}),k==="up"?e(0,s.thumbs_up_count+=1,s):e(0,s.thumbs_down_count+=1,s),o(s)}).catch(function(w){alert(w)})}const v=()=>g("up"),C=()=>g("down");function T(k,w,M,S){M[S]=k,e(0,s)}return u.$$set=k=>{"message"in k&&e(0,s=k.message),"indent"in k&&e(1,l=k.indent),"addMessage"in k&&e(2,a=k.addMessage),"updateMessage"in k&&e(3,o=k.updateMessage),"questionId"in k&&e(4,p=k.questionId)},u.$$.update=()=>{u.$$.dirty&1&&e(7,n=s.thumbs.find(k=>k.user_id!==void 0)??null)},[s,l,a,o,p,m,b,n,i,f,r,y,H,h,g,v,C,T]}class ge extends re{constructor(t){super(),me(this,t,De,Le,_e,{message:0,indent:1,addMessage:2,updateMessage:3,questionId:4})}}function de(u,t,e){const n=u.slice();return n[13]=t[e],n[14]=t,n[15]=e,n}function fe(u){let t,e;return{c(){t=_("p"),e=U(u[3])},m(n,i){q(n,t,i),d(t,e)},p(n,i){i&8&&K(e,n[3])},d(n){n&&E(t)}}}function ce(u,t){let e,n,i,s,l;function a(m){t[8](m,t[13],t[14],t[15])}function o(m){t[9](m)}let p={indent:0,addMessage:t[4],updateMessage:t[5]};return t[13]!==void 0&&(p.message=t[13]),t[0]!==void 0&&(p.questionId=t[0]),n=new ge({props:p}),F.push(()=>G(n,"message",a)),F.push(()=>G(n,"questionId",o)),{key:u,first:null,c(){e=j(),pe(n.$$.fragment),this.first=e},m(m,b){q(m,e,b),be(n,m,b),l=!0},p(m,b){t=m;const f={};!i&&b&4&&(i=!0,f.message=t[13],J(()=>i=!1)),!s&&b&1&&(s=!0,f.questionId=t[0],J(()=>s=!1)),n.$set(f)},i(m){l||(L(n.$$.fragment,m),l=!0)},o(m){N(n.$$.fragment,m),l=!1},d(m){m&&E(e),he(n,m)}}}function Ne(u){let t,e,n;return{c(){t=_("button"),t.innerHTML='<i class="bi bi-chat-square-dots"></i> Add comment',c(t,"class","btn btn-sm btn-outline-secondary")},m(i,s){q(i,t,s),e||(n=A(t,"click",B(u[7])),e=!0)},p:P,d(i){i&&E(t),e=!1,n()}}}function Re(u){let t,e,n,i,s,l,a,o,p,m,b;return{c(){t=_("div"),e=_("form"),n=_("div"),n.innerHTML='<input id="message" type="hidden" name="message" value=""/> <trix-editor input="message"></trix-editor>',i=I(),s=_("div"),s.innerHTML='<input type="checkbox" class="form-check-input" id="anonymous" checked=""/> <label class="form-check-label" for="anonymous">Anonymous</label>',l=I(),a=_("input"),o=I(),p=_("button"),p.textContent="Cancel",c(n,"class","mb-3 text-break"),c(s,"class","mb-3 form-check"),c(a,"class","btn btn-sm btn-primary"),c(a,"type","submit"),a.value="Send",c(p,"class","btn btn-link mr-0"),c(e,"action","#"),c(e,"class","mt-3 mb-3"),c(t,"class","mt-3")},m(f,r){q(f,t,r),d(t,e),d(e,n),d(e,i),d(e,s),d(e,l),d(e,a),d(e,o),d(e,p),m||(b=[A(p,"click",B(u[7])),A(e,"submit",B(u[6]))],m=!0)},p:P,d(f){f&&E(t),m=!1,O(b)}}}function ze(u){let t,e=[],n=new Map,i,s,l=W(u[2]);const a=f=>f[13].id;for(let f=0;f<l.length;f+=1){let r=de(u,l,f),y=a(r);n.set(y,e[f]=ce(y,r))}let o=null;l.length||(o=fe(u));function p(f,r){return f[1]?Re:Ne}let m=p(u),b=m(u);return{c(){t=_("div");for(let f=0;f<e.length;f+=1)e[f].c();o&&o.c(),i=I(),b.c(),c(t,"class","mt-3 mb-3")},m(f,r){q(f,t,r);for(let y=0;y<e.length;y+=1)e[y]&&e[y].m(t,null);o&&o.m(t,null),d(t,i),b.m(t,null),s=!0},p(f,[r]){r&61&&(l=W(f[2]),Q(),e=Me(e,r,a,1,f,l,n,t,Ie,ce,i,de),X(),!l.length&&o?o.p(f,r):l.length?o&&(o.d(1),o=null):(o=fe(f),o.c(),o.m(t,i))),m===(m=p(f))&&b?b.p(f,r):(b.d(1),b=m(f),b&&(b.c(),b.m(t,null)))},i(f){if(!s){for(let r=0;r<l.length;r+=1)L(e[r]);s=!0}},o(f){for(let r=0;r<e.length;r+=1)N(e[r]);s=!1},d(f){f&&E(t);for(let r=0;r<e.length;r+=1)e[r].d();o&&o.d(),b.d()}}}function V(u){var t=structuredClone(u),e={},n=[];t.forEach(s=>{if(!s.parent_message_id&&!s.legacy_parent_message_id){n.push(s);return}var l=s.parent_message_id;if(!l){const a=t.find(o=>o.legacy_message_id===s.legacy_parent_message_id);a?l=a.id:console.error("Parent message not found for message",s)}e[l]||(e[l]=[]),e[l].push(s)});function i(s){var l=s.id;e[l]&&(s.childs=e[l],s.childs.forEach(a=>{i(a)}))}return n.forEach(s=>{i(s)}),n}function Ue(u,t,e){let{questionId:n}=t;var i=!1,s=[],l=[],a="Loading comments ...",o;function p(){s=[],e(3,a="Loading comments ..."),o&&o.cancel(),o=qe(()=>{axios.get("/api/questions/"+n+"/messages").then(function(h){if(s=h.data,s.length===0){e(3,a="No comments yet");return}e(2,l=V(s))}).catch(function(h){alert(h)})},1e3,{maxWait:2e3}),o()}function m(h){s.push(h),e(2,l=V(s))}function b(h){const g=s.findIndex(v=>v.id===h.id);s[g]=h,e(2,l=V(s))}function f(){var h={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.post("/api/questions/"+n+"/messages",h).then(function(g){r(),s.push(g.data),e(2,l=V(s))}).catch(function(g){alert(g)})}function r(){e(1,i=!i)}function y(h,g,v,C){v[C]=h,e(2,l),e(0,n)}function H(h){n=h,e(0,n)}return u.$$set=h=>{"questionId"in h&&e(0,n=h.questionId)},u.$$.update=()=>{u.$$.dirty&1&&(e(2,l=[]),e(1,i=!1),p())},[n,i,l,a,m,b,f,r,y,H]}class je extends re{constructor(t){super(),me(this,t,Ue,ze,_e,{questionId:0})}}export{je as M};
