import{S as ue,i as de,s as me,k as _e,r as ge,d as z,u as be,w as Y,x as k,y as he,q as G,g as m,o as E,a as L,B as pe,c as f,f as b,C as Me,b as P,t as H,E as w,n as N,l as ke,p as Ie,A as ve,e as De,D as Se,m as Oe,z as we}from"./index-C5hKwDc9.js";import{e as se}from"./each-JoEH9o9l.js";import{S as Pe}from"./SessionProgressBar-D35tF687.js";import{s as He}from"./StatsHelper-B91isISU.js";import{t as I,n as J,g as te,a as Ye,e as ze,m as re,b as V,p as ie,f as Le}from"./parseISO-nqt9u7wd.js";function C(s,e){const n=+I(s)-+I(e);return n<0?-1:n>0?1:n}function Ne(s,e,n){const[a,t]=J(n==null?void 0:n.in,s,e),c=a.getFullYear()-t.getFullYear(),r=a.getMonth()-t.getMonth();return c*12+r}function Xe(s){return e=>{const n=Math.trunc,a=n(e);return a===0?0:a}}function Te(s,e){return+I(s)-+I(e)}function Ae(s,e){const n=I(s,e==null?void 0:e.in);return n.setHours(23,59,59,999),n}function Fe(s,e){const n=I(s,e==null?void 0:e.in),a=n.getMonth();return n.setFullYear(n.getFullYear(),a+1,0),n.setHours(23,59,59,999),n}function qe(s,e){const n=I(s,e==null?void 0:e.in);return+Ae(n,e)==+Fe(n,e)}function Be(s,e,n){const[a,t,c]=J(n==null?void 0:n.in,s,s,e),r=C(t,c),i=Math.abs(Ne(t,c));if(i<1)return 0;t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-r*i);let o=C(t,c)===-r;qe(a)&&i===1&&C(a,c)===1&&(o=!1);const l=r*(i-+o);return l===0?0:l}function Ee(s,e,n){const a=Te(s,e)/1e3;return Xe()(a)}function Ve(s,e,n){const a=Ye(),t=(n==null?void 0:n.locale)??a.locale??ze,c=2520,r=C(s,e);if(isNaN(r))throw new RangeError("Invalid time value");const i=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:r}),[o,l]=J(n==null?void 0:n.in,...r>0?[e,s]:[s,e]),_=Ee(l,o),S=(te(l)-te(o))/1e3,u=Math.round((_-S)/60);let g;if(u<2)return u===0?t.formatDistance("lessThanXMinutes",1,i):t.formatDistance("xMinutes",u,i);if(u<45)return t.formatDistance("xMinutes",u,i);if(u<90)return t.formatDistance("aboutXHours",1,i);if(u<re){const v=Math.round(u/60);return t.formatDistance("aboutXHours",v,i)}else{if(u<c)return t.formatDistance("xDays",1,i);if(u<V){const v=Math.round(u/re);return t.formatDistance("xDays",v,i)}else if(u<V*2)return g=Math.round(u/V),t.formatDistance("aboutXMonths",g,i)}if(g=Be(l,o),g<12){const v=Math.round(u/V);return t.formatDistance("xMonths",v,i)}else{const v=g%12,O=Math.trunc(g/12);return v<3?t.formatDistance("aboutXYears",O,i):v<9?t.formatDistance("overXYears",O,i):t.formatDistance("almostXYears",O+1,i)}}function ae(s){let e,n,a;return{c(){e=b("button"),e.innerHTML='<i class="bi bi-repeat"></i> Repeat incorrect',m(e,"class","btn btn-sm btn-outline-secondary"),w(e,"--bs-btn-padding-y",".25rem"),w(e,"--bs-btn-padding-x",".5rem"),w(e,"--bs-btn-font-size",".75rem"),m(e,"type","button")},m(t,c){L(t,e,c),n||(a=ke(e,"click",Ie(s[6])),n=!0)},p:N,d(t){t&&z(e),n=!1,a()}}}function Ce(s){let e,n,a,t,c,r,i,o=s[0].name+"",l,_,S,u,g,v,O,X,K,R,D,j,T,W,y,A,F,Q,Z,$,q,B,U,x,p;function ye(d){s[5](d)}let ee={};s[1]!==void 0&&(ee.progressPercentage=s[1]),n=new Pe({props:ee}),_e.push(()=>ge(n,"progressPercentage",ye));let h=s[1].unanswered===0&&s[1].incorrect>0&&ae(s);return{c(){e=b("div"),Me(n.$$.fragment),t=P(),c=b("div"),r=b("div"),i=b("strong"),l=H(o),S=P(),u=b("div"),g=b("a"),v=b("i"),O=H(" Open"),K=P(),h&&h.c(),R=P(),D=b("a"),j=b("i"),W=P(),y=b("div"),A=b("span"),F=b("small"),Q=H(s[3]),Z=H(" ago"),$=P(),q=b("span"),B=b("small"),U=H(s[3]),x=H(" ago"),m(r,"class","col-md-4 text-truncate"),m(r,"title",_=s[0].name),m(v,"class","bi bi-rocket-takeoff"),m(g,"href",X="/sessions/"+s[0].id),m(g,"class","btn btn-sm"),w(g,"--bs-btn-padding-y",".25rem"),w(g,"--bs-btn-padding-x",".5rem"),w(g,"--bs-btn-font-size",".75rem"),E(g,"btn-primary",s[1].unanswered),E(g,"btn-outline-secondary",!s[1].unanswered),m(j,"class","bi bi-three-dots-vertical"),m(D,"href",T="/sessions/"+s[0].id+"/edit"),m(D,"class","btn btn-sm btn-outline-secondary"),w(D,"--bs-btn-padding-y",".25rem"),w(D,"--bs-btn-padding-x",".5rem"),w(D,"--bs-btn-font-size",".75rem"),m(u,"class","col-md-4"),m(A,"class","float-end d-none d-sm-none d-md-inline"),m(q,"class","d-inline d-sm-inline d-md-none"),m(y,"class","col-md-4"),m(y,"title",s[2]),m(c,"class","row mt-1"),m(e,"class","mt-3 mb-3")},m(d,M){L(d,e,M),pe(n,e,null),f(e,t),f(e,c),f(c,r),f(r,i),f(i,l),f(c,S),f(c,u),f(u,g),f(g,v),f(g,O),f(u,K),h&&h.m(u,null),f(u,R),f(u,D),f(D,j),f(c,W),f(c,y),f(y,A),f(A,F),f(F,Q),f(F,Z),f(y,$),f(y,q),f(q,B),f(B,U),f(B,x),p=!0},p(d,[M]){const ne={};!a&&M&2&&(a=!0,ne.progressPercentage=d[1],he(()=>a=!1)),n.$set(ne),(!p||M&1)&&o!==(o=d[0].name+"")&&G(l,o),(!p||M&1&&_!==(_=d[0].name))&&m(r,"title",_),(!p||M&1&&X!==(X="/sessions/"+d[0].id))&&m(g,"href",X),(!p||M&2)&&E(g,"btn-primary",d[1].unanswered),(!p||M&2)&&E(g,"btn-outline-secondary",!d[1].unanswered),d[1].unanswered===0&&d[1].incorrect>0?h?h.p(d,M):(h=ae(d),h.c(),h.m(u,R)):h&&(h.d(1),h=null),(!p||M&1&&T!==(T="/sessions/"+d[0].id+"/edit"))&&m(D,"href",T),(!p||M&8)&&G(Q,d[3]),(!p||M&8)&&G(U,d[3]),(!p||M&4)&&m(y,"title",d[2])},i(d){p||(k(n.$$.fragment,d),p=!0)},o(d){Y(n.$$.fragment,d),p=!1},d(d){d&&z(e),be(n),h&&h.d()}}}function Re(s){axios.post("/api/sessions/"+s+"/newfromincorrect").then(function(e){window.location.href="/sessions/"+e.data.id}).catch(function(e){alert(e)})}function je(s,e,n){let a,t,c,r,{session:i}=e;function o(_){r=_,n(1,r),n(0,i),n(4,c)}const l=()=>Re(i.id);return s.$$set=_=>{"session"in _&&n(0,i=_.session)},s.$$.update=()=>{s.$$.dirty&1&&n(3,a=Ve(ie(i.created_at),new Date)),s.$$.dirty&1&&n(2,t=Le(ie(i.created_at),"dd.MM.yyyy HH:mm")),s.$$.dirty&1&&n(4,c=i?i.deck.questions.filter(_=>!_.is_invalid):null),s.$$.dirty&17&&n(1,r=i?He(c.length,i.answerchoices.filter(_=>c.some(({id:S})=>S===_.question_id))):null)},[i,r,t,a,c,o,l]}class Qe extends ue{constructor(e){super(),de(this,e,je,Ce,me,{session:0})}}function oe(s,e,n){const a=s.slice();return a[3]=e[n],a[4]=e,a[5]=n,a}function Ue(s){let e;return{c(){e=b("div"),e.innerHTML='<div class="spinner-border text-secondary" role="status"><span class="visually-hidden">Loading sessions ...</span></div>',m(e,"class","d-flex justify-content-center")},m(n,a){L(n,e,a)},p:N,i:N,o:N,d(n){n&&z(e)}}}function Ge(s){let e,n,a=se(s[0]),t=[];for(let i=0;i<a.length;i+=1)t[i]=ce(oe(s,a,i));const c=i=>Y(t[i],1,1,()=>{t[i]=null});let r=null;return a.length||(r=le()),{c(){for(let i=0;i<t.length;i+=1)t[i].c();e=De(),r&&r.c()},m(i,o){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(i,o);L(i,e,o),r&&r.m(i,o),n=!0},p(i,o){if(o&1){a=se(i[0]);let l;for(l=0;l<a.length;l+=1){const _=oe(i,a,l);t[l]?(t[l].p(_,o),k(t[l],1)):(t[l]=ce(_),t[l].c(),k(t[l],1),t[l].m(e.parentNode,e))}for(we(),l=a.length;l<t.length;l+=1)c(l);ve(),!a.length&&r?r.p(i,o):a.length?r&&(r.d(1),r=null):(r=le(),r.c(),r.m(e.parentNode,e))}},i(i){if(!n){for(let o=0;o<a.length;o+=1)k(t[o]);n=!0}},o(i){t=t.filter(Boolean);for(let o=0;o<t.length;o+=1)Y(t[o]);n=!1},d(i){i&&z(e),Oe(t,i),r&&r.d(i)}}}function le(s){let e;return{c(){e=b("div"),e.innerHTML='No sessions yet <i class="bi bi-rocket"></i> ',m(e,"class","alert alert-light text-center"),m(e,"role","alert")},m(n,a){L(n,e,a)},p:N,d(n){n&&z(e)}}}function ce(s){let e,n,a;function t(r){s[2](r,s[3],s[4],s[5])}let c={};return s[3]!==void 0&&(c.session=s[3]),e=new Qe({props:c}),_e.push(()=>ge(e,"session",t)),{c(){Me(e.$$.fragment)},m(r,i){pe(e,r,i),a=!0},p(r,i){s=r;const o={};!n&&i&1&&(n=!0,o.session=s[3],he(()=>n=!1)),e.$set(o)},i(r){a||(k(e.$$.fragment,r),a=!0)},o(r){Y(e.$$.fragment,r),a=!1},d(r){be(e,r)}}}function Je(s){let e,n,a,t;const c=[Ge,Ue],r=[];function i(o,l){return o[0]?0:1}return e=i(s),n=r[e]=c[e](s),{c(){n.c(),a=De()},m(o,l){r[e].m(o,l),L(o,a,l),t=!0},p(o,[l]){let _=e;e=i(o),e===_?r[e].p(o,l):(we(),Y(r[_],1,1,()=>{r[_]=null}),ve(),n=r[e],n?n.p(o,l):(n=r[e]=c[e](o),n.c()),k(n,1),n.m(a.parentNode,a))},i(o){t||(k(n),t=!0)},o(o){Y(n),t=!1},d(o){o&&z(a),r[e].d(o)}}}function Ke(s,e,n){let{userId:a}=e;var t=void 0;Se(()=>{axios.get("/api/sessions?take=15&user-id="+a).then(function(r){n(0,t=r.data)}).catch(function(r){alert(r)})});function c(r,i,o,l){o[l]=r,n(0,t)}return s.$$set=r=>{"userId"in r&&n(1,a=r.userId)},[t,a,c]}class We extends ue{constructor(e){super(),de(this,e,Ke,Je,me,{userId:1})}}const fe=document.getElementById("IndexSessionView");new We({target:fe,props:{userId:fe.dataset.userId}});
