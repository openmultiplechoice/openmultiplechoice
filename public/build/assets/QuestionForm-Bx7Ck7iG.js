import{S as Re,i as Ne,s as me,c,t as ne,a as w,f as l,g as K,b as T,h as a,j as Z,l as W,n as ce,d as L,B as re,H as ae,k as se,e as pe,p as $,D as Ge,z as je,x as Be,y as ze,L as Je,J as he,E as Ve,r as Ke,u as Pe,v as Ue,w as Xe,A as Ye,M as Fe,N as fe,O as be,q as Oe,m as Ze}from"./index-Cm33_cbi.js";import{e as le,u as ge,d as xe,o as $e}from"./each-C5IGOPsu.js";import{_ as ve}from"./lodash-D0JQdfhu.js";import{d as We,p as _e}from"./purify.es-DfBF0len.js";function et(n){let e,i,s,t,r,_,d,p,A,v,m,b,y,o,q,h,Q,z,V,O,F,S,U,M,C,E,H,R,X,Y,N,B,u,g;return{c(){e=c("form"),i=c("div"),s=c("label"),t=ne("Answer text"),_=w(),d=c("input"),A=w(),v=c("trix-editor"),y=w(),o=new ae(!1),q=w(),h=c("div"),Q=c("label"),z=ne("Answer hint (optional)"),O=w(),F=c("input"),U=w(),M=c("trix-editor"),H=w(),R=new ae(!1),X=w(),Y=c("div"),N=ne("A hint that will be shown once the user has answered the question."),l(s,"for",r="answerText"+n[0].id),l(s,"class","form-label"),l(d,"id",p="answerText"+n[0].id),l(d,"type","hidden"),K(v,"id",m="editor-answer"+n[0].id),K(v,"class","bg-light"),K(v,"input",b="answerText"+n[0].id),o.a=null,l(i,"class","mb-3"),l(Q,"for",V="answerHint"+n[0].id+"t"),l(Q,"class","form-label"),l(F,"id",S="answerHint"+n[0].id),l(F,"type","hidden"),K(M,"id",C="editor-answerHint"+n[0].id),K(M,"class","bg-light"),K(M,"input",E="answerHint"+n[0].id),R.a=X,l(Y,"id",B="answerHint"+n[0].id),l(Y,"class","form-text"),l(h,"class","mb-3"),l(e,"action","#"),l(e,"class","mt-3 mb-1 p-3 bg-light-subtle rounded")},m(k,G){T(k,e,G),a(e,i),a(i,s),a(s,t),a(i,_),a(i,d),Z(d,n[0].text),a(i,A),a(i,v),n[5](v),a(i,y),o.m(n[3],i),a(e,q),a(e,h),a(h,Q),a(Q,z),a(h,O),a(h,F),Z(F,n[0].hint),a(h,U),a(h,M),n[7](M),a(h,H),R.m(n[3],h),a(h,X),a(h,Y),a(Y,N),u||(g=[W(d,"input",n[4]),W(F,"input",n[6])],u=!0)},p(k,[G]){G&1&&r!==(r="answerText"+k[0].id)&&l(s,"for",r),G&1&&p!==(p="answerText"+k[0].id)&&l(d,"id",p),G&1&&Z(d,k[0].text),G&1&&m!==(m="editor-answer"+k[0].id)&&K(v,"id",m),G&1&&b!==(b="answerText"+k[0].id)&&K(v,"input",b),G&8&&o.p(k[3]),G&1&&V!==(V="answerHint"+k[0].id+"t")&&l(Q,"for",V),G&1&&S!==(S="answerHint"+k[0].id)&&l(F,"id",S),G&1&&Z(F,k[0].hint),G&1&&C!==(C="editor-answerHint"+k[0].id)&&K(M,"id",C),G&1&&E!==(E="answerHint"+k[0].id)&&K(M,"input",E),G&8&&R.p(k[3]),G&1&&B!==(B="answerHint"+k[0].id)&&l(Y,"id",B)},i:ce,o:ce,d(k){k&&L(e),n[5](null),n[7](null),u=!1,re(g)}}}function tt(n,e,i){let{answer:s}=e,t,r,_="";function d(o){o.addEventListener("trix-change",function(){i(0,s.text=document.getElementById("answerText"+s.id).value,s),i(0,s.hint=document.getElementById("answerHint"+s.id).value,s),i(3,_='<p class="text-end">Saving ...</p>'),A()}),o.toolbarElement.style.display="none",o.addEventListener("trix-focus",function(q){q.target.toolbarElement.style.display="block"}),o.addEventListener("trix-blur",function(q){q.target.toolbarElement.contains(document.activeElement)||(q.target.toolbarElement.style.display="none")})}var p;function A(){p&&p.cancel(),p=We(()=>{axios.put("/api/answers/"+s.id,s).then(function(o){i(3,_='<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(o){i(3,_='<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(o)})},500,{maxWait:2e3}),p()}function v(){s.text=this.value,i(0,s)}function m(o){se[o?"unshift":"push"](()=>{t=o,i(1,t)})}function b(){s.hint=this.value,i(0,s)}function y(o){se[o?"unshift":"push"](()=>{r=o,i(2,r)})}return n.$$set=o=>{"answer"in o&&i(0,s=o.answer)},n.$$.update=()=>{n.$$.dirty&2&&t&&d(t),n.$$.dirty&4&&r&&d(r)},[s,t,r,_,v,m,b,y]}class it extends Re{constructor(e){super(),Ne(this,e,tt,et,me,{answer:0})}}function we(n,e,i){const s=n.slice();return s[41]=e[i],s[42]=e,s[43]=i,s}function ke(n,e,i){const s=n.slice();return s[44]=e[i],s}function ye(n,e,i){const s=n.slice();return s[47]=e[i],s}function qe(n){let e,i,s;return{c(){e=c("button"),e.textContent="Close editor",l(e,"type","button"),l(e,"class","btn btn-outline-secondary btn-sm")},m(t,r){T(t,e,r),i||(s=W(e,"click",$(function(){Je(n[2])&&n[2].apply(this,arguments)})),i=!0)},p(t,r){n=t},d(t){t&&L(e),i=!1,s()}}}function nt(n){let e,i,s,t,r,_,d,p,A,v=le(n[1]),m=[];for(let b=0;b<v.length;b+=1)m[b]=Ce(ye(n,v,b));return{c(){e=c("div"),i=c("div"),s=c("div"),s.innerHTML='<label for="case" class="col-form-label small fw-bold"><i class="bi bi-clipboard2-pulse"></i> CASE</label>',t=w(),r=c("div"),_=c("select"),d=c("option"),d.textContent="Select case";for(let b=0;b<m.length;b+=1)m[b].c();l(s,"class","col-auto"),d.__value="",Z(d,d.__value),l(_,"id","case"),l(_,"class","form-select"),n[9]===void 0&&Fe(()=>n[24].call(_)),l(r,"class","col-auto"),l(i,"class","row g-3 align-items-center"),l(e,"class","alert alert-light"),l(e,"role","alert")},m(b,y){T(b,e,y),a(e,i),a(i,s),a(i,t),a(i,r),a(r,_),a(_,d);for(let o=0;o<m.length;o+=1)m[o]&&m[o].m(_,null);fe(_,n[9],!0),p||(A=[W(_,"change",n[24]),W(_,"change",n[19])],p=!0)},p(b,y){if(y[0]&3){v=le(b[1]);let o;for(o=0;o<v.length;o+=1){const q=ye(b,v,o);m[o]?m[o].p(q,y):(m[o]=Ce(q),m[o].c(),m[o].m(_,null))}for(;o<m.length;o+=1)m[o].d(1);m.length=v.length}y[0]&514&&fe(_,b[9])},d(b){b&&L(e),Ze(m,b),p=!1,re(A)}}}function lt(n){let e,i,s,t,r=_e.sanitize(n[1].find(n[23]).text)+"",_,d,p,A,v;return{c(){e=c("div"),i=c("p"),i.innerHTML='<i class="bi bi-clipboard2-pulse"></i> CASE',s=w(),t=c("p"),_=w(),d=c("div"),p=c("button"),p.innerHTML='<i class="bi bi-trash"></i> Remove case',l(i,"class","small fw-bold"),l(e,"class","alert alert-light m-1"),l(e,"role","alert"),l(p,"type","button"),l(p,"class","btn btn-sm btn-light"),l(p,"title","Remove case"),l(d,"class","text-end m-1")},m(m,b){T(m,e,b),a(e,i),a(e,s),a(e,t),t.innerHTML=r,T(m,_,b),T(m,d,b),a(d,p),A||(v=W(p,"click",$(n[20])),A=!0)},p(m,b){b[0]&3&&r!==(r=_e.sanitize(m[1].find(m[23]).text)+"")&&(t.innerHTML=r)},d(m){m&&(L(e),L(_),L(d)),A=!1,v()}}}function Ce(n){let e,i=ve.truncate(_e.sanitize(n[47].text,{ALLOWED_TAGS:[]}),{length:30})+"",s,t,r;return{c(){e=c("option"),s=ne(i),e.__value=t=n[47].id,Z(e,e.__value),e.selected=r=n[0].case_id==n[47].id},m(_,d){T(_,e,d),a(e,s)},p(_,d){d[0]&2&&i!==(i=ve.truncate(_e.sanitize(_[47].text,{ALLOWED_TAGS:[]}),{length:30})+"")&&Oe(s,i),d[0]&2&&t!==(t=_[47].id)&&(e.__value=t,Z(e,e.__value)),d[0]&3&&r!==(r=_[0].case_id==_[47].id)&&(e.selected=r)},d(_){_&&L(e)}}}function Ee(n){let e,i,s,t,r,_,d,p,A,v,m,b,y,o,q,h,Q,z,V,O,F,S,U,M,C,E,H,R,X,Y,N,B,u,g,k,G,te,ue,ee,x,de,ie,oe,f;function I(D,J){if(D[5]&&D[0].case_id)return lt;if(D[5]&&D[1]&&D[1].length>0)return nt}let j=I(n),P=j&&j(n);return{c(){P&&P.c(),e=w(),i=c("div"),s=c("label"),s.textContent="Question text",t=w(),r=c("input"),_=w(),d=c("trix-editor"),p=w(),A=new ae(!1),v=w(),m=c("div"),b=c("label"),b.textContent="Question hint (optional)",y=w(),o=c("input"),q=w(),h=c("trix-editor"),Q=w(),z=new ae(!1),V=w(),O=c("div"),O.textContent="A hint that can be shown to the user if they are stuck.",F=w(),S=c("div"),U=c("label"),U.textContent="Question comment (optional)",M=w(),C=c("input"),E=w(),H=c("trix-editor"),R=w(),X=new ae(!1),Y=w(),N=c("div"),N.textContent=`A comment that will be shown once the user has answered the question.
                It can be used to explain the correct answer or provide additional
                information, for example sources.`,B=w(),u=c("div"),g=c("div"),k=c("input"),G=w(),te=c("label"),te.innerHTML='<i class="bi bi-cone-striped"></i> <strong>Invalid question</strong> - Is the answer unknown or disputed? Invalid questions remain in deck but are not counted into results.',ue=w(),ee=c("div"),x=c("input"),de=w(),ie=c("label"),ie.innerHTML='<i class="bi bi-eraser-fill"></i> <strong>Needs review</strong> - Does this question need to be reviewed and improved? Questions marked for review remain in deck and are counted into results.',l(s,"for","questionText"),l(s,"class","form-label"),l(r,"id","questionText"),l(r,"type","hidden"),K(d,"id","editor-questionText"),K(d,"class","bg-light"),K(d,"input","questionText"),A.a=null,l(i,"class","mt-3 mb-3"),l(b,"for","questionHint"),l(b,"class","form-label"),l(o,"id","questionHint"),l(o,"type","hidden"),K(h,"id","editor-questionHint"),K(h,"class","bg-light"),K(h,"input","questionHint"),z.a=V,l(O,"id","questionHint"),l(O,"class","form-text"),l(m,"class","mt-3 mb-3"),l(U,"for","questionComment"),l(U,"class","form-label"),l(C,"id","questionComment"),l(C,"type","hidden"),K(H,"id","editor-questionComment"),K(H,"class","bg-light"),K(H,"input","questionComment"),X.a=Y,l(N,"id","questionHint"),l(N,"class","form-text"),l(S,"class","mt-3 mb-3"),l(k,"type","checkbox"),l(k,"class","form-check-input"),l(k,"id","checkInvalidQuestion"),l(te,"class","form-check-label"),l(te,"for","checkInvalidQuestion"),l(g,"class","form-check mb-3"),l(x,"type","checkbox"),l(x,"class","form-check-input"),l(x,"id","checkNeedsReview"),l(ie,"class","form-check-label"),l(ie,"for","checkNeedsReview"),l(ee,"class","form-check"),l(u,"class","mb-3 p-3 bg-light rounded")},m(D,J){P&&P.m(D,J),T(D,e,J),T(D,i,J),a(i,s),a(i,t),a(i,r),Z(r,n[0].text),a(i,_),a(i,d),n[26](d),a(i,p),A.m(n[10],i),T(D,v,J),T(D,m,J),a(m,b),a(m,y),a(m,o),Z(o,n[0].hint),a(m,q),a(m,h),n[28](h),a(m,Q),z.m(n[10],m),a(m,V),a(m,O),T(D,F,J),T(D,S,J),a(S,U),a(S,M),a(S,C),Z(C,n[0].comment),a(S,E),a(S,H),n[30](H),a(S,R),X.m(n[10],S),a(S,Y),a(S,N),T(D,B,J),T(D,u,J),a(u,g),a(g,k),k.checked=n[0].is_invalid,a(g,G),a(g,te),a(u,ue),a(u,ee),a(ee,x),x.checked=n[0].needs_review,a(ee,de),a(ee,ie),oe||(f=[W(r,"input",n[25]),W(o,"input",n[27]),W(C,"input",n[29]),W(k,"change",n[31]),W(k,"click",$(n[21])),W(x,"change",n[32]),W(x,"click",$(n[22]))],oe=!0)},p(D,J){j===(j=I(D))&&P?P.p(D,J):(P&&P.d(1),P=j&&j(D),P&&(P.c(),P.m(e.parentNode,e))),J[0]&1&&Z(r,D[0].text),J[0]&1024&&A.p(D[10]),J[0]&1&&Z(o,D[0].hint),J[0]&1024&&z.p(D[10]),J[0]&1&&Z(C,D[0].comment),J[0]&1024&&X.p(D[10]),J[0]&1&&(k.checked=D[0].is_invalid),J[0]&1&&(x.checked=D[0].needs_review)},d(D){D&&(L(e),L(i),L(v),L(m),L(F),L(S),L(B),L(u)),P&&P.d(D),n[26](null),n[28](null),n[30](null),oe=!1,re(f)}}}function He(n){let e;return{c(){e=c("div"),e.innerHTML='<div class="alert alert-warning" role="alert">Don&#39;t forget to set the correct answer!</div>',l(e,"class","col")},m(i,s){T(i,e,s)},d(i){i&&L(e)}}}function Te(n){let e,i,s=n[44].comment+"",t;return{c(){e=c("div"),i=c("p"),t=ne(s),l(i,"class","card-text"),l(e,"class","card-body")},m(r,_){T(r,e,_),a(e,i),a(i,t)},p(r,_){_[0]&1&&s!==(s=r[44].comment+"")&&Oe(t,s)},d(r){r&&L(e)}}}function Le(n,e){let i,s,t,r,_,d,p,A,v,m,b;function y(){return e[33](e[44])}let o=e[44].comment&&Te(e);return{key:n,first:null,c(){i=c("div"),s=c("div"),t=c("div"),r=c("button"),r.innerHTML='<i class="bi bi-trash"></i>',_=w(),d=c("img"),A=w(),o&&o.c(),v=w(),l(r,"type","button"),l(r,"class","btn btn-sm btn-light"),l(t,"class","card-header bg-transparent"),he(d.src,p="/"+e[44].path)||l(d,"src",p),l(d,"class","card-img-top"),l(d,"alt",""),l(s,"class","card"),Ve(s,"width","18rem"),l(i,"class","col"),this.first=i},m(q,h){T(q,i,h),a(i,s),a(s,t),a(t,r),a(s,_),a(s,d),a(s,A),o&&o.m(s,null),a(i,v),m||(b=W(r,"click",$(y)),m=!0)},p(q,h){e=q,h[0]&1&&!he(d.src,p="/"+e[44].path)&&l(d,"src",p),e[44].comment?o?o.p(e,h):(o=Te(e),o.c(),o.m(s,null)):o&&(o.d(1),o=null)},d(q){q&&L(i),o&&o.d(),m=!1,b()}}}function Ae(n){let e,i,s,t,r;function _(){return n[35](n[41])}return{c(){e=c("button"),i=c("i"),l(i,"class","bi bi-check-lg"),l(e,"type","button"),l(e,"class",s="btn btn-sm "+(n[11]===n[41].id?"btn-success":"btn-light")),l(e,"title","Set as correct answer")},m(d,p){T(d,e,p),a(e,i),t||(r=W(e,"click",$(_)),t=!0)},p(d,p){n=d,p[0]&2049&&s!==(s="btn btn-sm "+(n[11]===n[41].id?"btn-success":"btn-light"))&&l(e,"class",s)},d(d){d&&L(e),t=!1,r()}}}function Se(n,e){let i,s,t,r,_,d,p,A,v,m;function b(h){e[34](h,e[41],e[42],e[43])}let y={};e[41]!==void 0&&(y.answer=e[41]),s=new it({props:y}),se.push(()=>Ke(s,"answer",b));let o=e[0].type==="mc"&&Ae(e);function q(){return e[36](e[41])}return{key:n,first:null,c(){i=pe(),Pe(s.$$.fragment),r=w(),_=c("div"),o&&o.c(),d=w(),p=c("button"),p.innerHTML='<i class="bi bi-trash"></i>',l(p,"type","button"),l(p,"class","btn btn-sm btn-light"),l(p,"title","Delete answer"),l(_,"class","text-end mb-2"),this.first=i},m(h,Q){T(h,i,Q),Ue(s,h,Q),T(h,r,Q),T(h,_,Q),o&&o.m(_,null),a(_,d),a(_,p),A=!0,v||(m=W(p,"click",$(q)),v=!0)},p(h,Q){e=h;const z={};!t&&Q[0]&1&&(t=!0,z.answer=e[41],Xe(()=>t=!1)),s.$set(z),e[0].type==="mc"?o?o.p(e,Q):(o=Ae(e),o.c(),o.m(_,d)):o&&(o.d(1),o=null)},i(h){A||(Be(s.$$.fragment,h),A=!0)},o(h){ze(s.$$.fragment,h),A=!1},d(h){h&&(L(i),L(r),L(_)),Ye(s,h),o&&o.d(),v=!1,m()}}}function Me(n){let e,i,s;return{c(){e=c("button"),e.textContent="Add answer",l(e,"class","btn btn-sm btn-primary")},m(t,r){T(t,e,r),i||(s=W(e,"click",n[16]),i=!0)},p:ce,d(t){t&&L(e),i=!1,s()}}}function Qe(n){let e,i,s,t,r,_,d,p,A,v,m,b,y,o,q,h,Q,z,V,O,F,S,U,M,C=(n[0].answers.length<=1||n[0].type==="card")&&Ie(n),E=n[3]&&De(n);return{c(){e=c("div"),e.innerHTML='<div class="col"><div class="mt-5 mb-5 border-dark" style="border-bottom: dotted; border-width: 1px;"></div></div>',i=w(),s=c("div"),t=c("div"),r=c("span"),r.textContent="ID",_=w(),d=c("input"),A=w(),v=c("div"),m=c("div"),m.innerHTML='<label for="questionType" class="col-form-label fw-bold">Question type:</label>',b=w(),y=c("div"),o=c("select"),C&&C.c(),q=c("option"),h=ne("mc"),V=w(),O=c("div"),O.innerHTML=`<span id="questionTypeHelp" class="form-text">Can be either multiple choice (MC) or card (CARD). <strong>Card Questions
                    can have only one or no answer.</strong></span>`,F=w(),E&&E.c(),S=pe(),l(e,"class","row"),l(r,"class","input-group-text"),l(d,"type","text"),l(d,"class","form-control"),d.value=p=n[0].id,d.disabled=!0,d.readOnly=!0,l(t,"class","input-group mb-3"),l(m,"class","col-auto"),q.__value="mc",Z(q,q.__value),q.selected=Q=n[0].type=="mc",l(o,"id","questionType"),l(o,"class","form-select font-monospace text-uppercase"),o.disabled=z=n[0].answers.length>1,n[0].type===void 0&&Fe(()=>n[37].call(o)),l(y,"class","col-auto"),l(O,"class","col-auto"),l(v,"class","row g-3 align-items-center"),l(s,"class","alert alert-light"),l(s,"role","alert")},m(H,R){T(H,e,R),T(H,i,R),T(H,s,R),a(s,t),a(t,r),a(t,_),a(t,d),a(s,A),a(s,v),a(v,m),a(v,b),a(v,y),a(y,o),C&&C.m(o,null),a(o,q),a(q,h),fe(o,n[0].type,!0),a(v,V),a(v,O),T(H,F,R),E&&E.m(H,R),T(H,S,R),U||(M=[W(o,"change",n[37]),W(o,"change",n[18])],U=!0)},p(H,R){R[0]&1&&p!==(p=H[0].id)&&d.value!==p&&(d.value=p),H[0].answers.length<=1||H[0].type==="card"?C?C.p(H,R):(C=Ie(H),C.c(),C.m(o,q)):C&&(C.d(1),C=null),R[0]&1&&Q!==(Q=H[0].type=="mc")&&(q.selected=Q),R[0]&1&&z!==(z=H[0].answers.length>1)&&(o.disabled=z),R[0]&1&&fe(o,H[0].type),H[3]?E?E.p(H,R):(E=De(H),E.c(),E.m(S.parentNode,S)):E&&(E.d(1),E=null)},d(H){H&&(L(e),L(i),L(s),L(F),L(S)),C&&C.d(),E&&E.d(H),U=!1,re(M)}}}function Ie(n){let e,i,s;return{c(){e=c("option"),i=ne("card"),e.__value="card",Z(e,e.__value),e.selected=s=n[0].type=="card"},m(t,r){T(t,e,r),a(e,i)},p(t,r){r[0]&1&&s!==(s=t[0].type=="card")&&(e.selected=s)},d(t){t&&L(e)}}}function De(n){let e,i,s,t,r,_;return{c(){e=c("div"),i=c("p"),i.innerHTML="<strong>Delete question?</strong> Deleting a question will also delete all associated answers and images.",s=w(),t=c("button"),t.innerHTML='<i class="bi bi-trash"></i> Delete question',l(t,"type","button"),l(t,"class","btn btn-sm btn-danger"),l(e,"class","alert alert-light"),l(e,"role","alert")},m(d,p){T(d,e,p),a(e,i),a(e,s),a(e,t),r||(_=W(t,"click",$(n[38])),r=!0)},p:ce,d(d){d&&L(e),r=!1,_()}}}function st(n){let e,i,s=n[0].id,t,r,_,d,p,A,v,m,b,y=[],o=new Map,q,h=[],Q=new Map,z,V,O,F,S,U,M=n[2]&&qe(n),C=Ee(n),E=!n[11]&&n[0].type==="mc"&&He(),H=le(n[0].images);const R=u=>u[44].id;for(let u=0;u<H.length;u+=1){let g=ke(n,H,u),k=R(g);o.set(k,y[u]=Le(k,g))}let X=le(n[0].answers);const Y=u=>u[41].id;for(let u=0;u<X.length;u+=1){let g=we(n,X,u),k=Y(g);Q.set(k,h[u]=Se(k,g))}let N=(n[0].type==="mc"||n[0].answers.length===0)&&Me(n),B=n[4]&&Qe(n);return{c(){e=c("form"),M&&M.c(),i=w(),C.c(),t=w(),r=c("div"),_=c("label"),_.textContent="Add image",d=w(),p=c("input"),v=w(),E&&E.c(),m=w(),b=c("div");for(let u=0;u<y.length;u+=1)y[u].c();q=w();for(let u=0;u<h.length;u+=1)h[u].c();z=w(),N&&N.c(),V=w(),B&&B.c(),O=pe(),l(_,"for","image"),l(_,"class","form-label"),l(p,"class","form-control"),l(p,"type","file"),l(p,"id",A="imageInput"+n[0].id),l(p,"name","image"),l(r,"class","mb-3"),l(e,"action","#"),l(e,"class","mt-3"),l(b,"class","row row-cols-1 row-cols-lg-3 g4")},m(u,g){T(u,e,g),M&&M.m(e,null),a(e,i),C.m(e,null),a(e,t),a(e,r),a(r,_),a(r,d),a(r,p),T(u,v,g),E&&E.m(u,g),T(u,m,g),T(u,b,g);for(let k=0;k<y.length;k+=1)y[k]&&y[k].m(b,null);T(u,q,g);for(let k=0;k<h.length;k+=1)h[k]&&h[k].m(u,g);T(u,z,g),N&&N.m(u,g),T(u,V,g),B&&B.m(u,g),T(u,O,g),F=!0,S||(U=[W(p,"input",n[14]),W(e,"submit",$(n[13]))],S=!0)},p(u,g){u[2]?M?M.p(u,g):(M=qe(u),M.c(),M.m(e,i)):M&&(M.d(1),M=null),g[0]&1&&me(s,s=u[0].id)?(C.d(1),C=Ee(u),C.c(),C.m(e,t)):C.p(u,g),(!F||g[0]&1&&A!==(A="imageInput"+u[0].id))&&l(p,"id",A),!u[11]&&u[0].type==="mc"?E||(E=He(),E.c(),E.m(m.parentNode,m)):E&&(E.d(1),E=null),g[0]&32769&&(H=le(u[0].images),y=ge(y,g,R,1,u,H,o,b,xe,Le,null,ke)),g[0]&137217&&(X=le(u[0].answers),Ge(),h=ge(h,g,Y,1,u,X,Q,z.parentNode,$e,Se,z,we),je()),u[0].type==="mc"||u[0].answers.length===0?N?N.p(u,g):(N=Me(u),N.c(),N.m(V.parentNode,V)):N&&(N.d(1),N=null),u[4]?B?B.p(u,g):(B=Qe(u),B.c(),B.m(O.parentNode,O)):B&&(B.d(1),B=null)},i(u){if(!F){for(let g=0;g<X.length;g+=1)Be(h[g]);F=!0}},o(u){for(let g=0;g<h.length;g+=1)ze(h[g]);F=!1},d(u){u&&(L(e),L(v),L(m),L(b),L(q),L(z),L(V),L(O)),M&&M.d(),C.d(u),E&&E.d(u);for(let g=0;g<y.length;g+=1)y[g].d();for(let g=0;g<h.length;g+=1)h[g].d(u);N&&N.d(u),B&&B.d(u),S=!1,re(U)}}}function ot(n,e,i){let s,{question:t}=e,{cases:r}=e,{toggleEditor:_}=e,{handleQuestionRemove:d}=e,{showConfigEditor:p=!1}=e,{showCaseSelector:A=!1}=e,v,m,b,y,o="";function q(f){f.addEventListener("trix-change",function(){i(0,t.text=document.getElementById("questionText").value,t),i(0,t.comment=document.getElementById("questionComment").value,t),i(0,t.hint=document.getElementById("questionHint").value,t),i(10,o='<p class="text-end">Saving ...</p>'),z()}),f.toolbarElement.style.display="none",f.addEventListener("trix-focus",function(I){I.target.toolbarElement.style.display="block"}),f.addEventListener("trix-blur",function(I){I.target.toolbarElement.contains(document.activeElement)||(I.target.toolbarElement.style.display="none")})}function h(f){f!==t.correct_answer_id&&(i(0,t.correct_answer_id=f,t),axios.put("/api/questions/"+t.id,t).then(function(I){}).catch(function(I){alert(I)}))}var Q;function z(){Q&&Q.cancel(),Q=We(()=>{axios.put("/api/questions/"+t.id,t).then(function(f){i(10,o='<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(f){i(10,o='<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(f)})},500,{maxWait:2e3}),Q()}function V(){var f=new FormData,I=document.getElementById("imageInput"+t.id);f.set("image",I.files[0]),axios.post("/api/questions/"+t.id+"/images",f,{headers:{"Content-Type":"multipart/form-data"}}).then(function(j){I.value="";var P=j.data;i(0,t.images=[...t.images,P],t)}).catch(function(j){I.value="",alert(j)})}function O(f){axios.delete("/api/images/"+f).then(function(I){i(0,t.images=t.images.filter(j=>j.id!==f),t)}).catch(function(I){alert(I)})}function F(){axios.post("/api/questions/"+t.id+"/answers",{}).then(function(f){i(0,t.answers=[...t.answers,f.data],t)}).catch(function(f){alert(f)})}function S(f){axios.delete("/api/answers/"+f).then(function(I){i(0,t.answers=t.answers.filter(j=>j.id!==f),t)}).catch(function(I){alert(I)})}function U(){axios.put("/api/questions/"+t.id,{type:t.type==="mc"?"mc":"card"}).then(function(f){i(0,t.type=f.data.type,t)}).catch(function(f){alert(f)})}function M(){axios.put("/api/questions/"+t.id,{case_id:y}).then(function(f){i(0,t.case_id=f.data.case_id,t);const I=r.find(j=>j.id===f.data.case_id);i(0,t.case=I,t),I.questions||(I.questions=[]),I.questions.push({id:t.id,case_id:I.id})}).catch(function(f){alert(f)})}function C(){axios.put("/api/questions/"+t.id,{case_id:null}).then(function(f){i(0,t.case_id=null,t),i(0,t.case=null,t),r.map(I=>{I.questions=I.questions.filter(j=>j.id!==t.id)})}).catch(function(f){alert(f)})}function E(){axios.put("/api/questions/"+t.id,{is_invalid:!t.is_invalid}).then(function(f){i(0,t.is_invalid=!t.is_invalid,t)}).catch(function(f){alert(f)})}function H(){axios.put("/api/questions/"+t.id,{needs_review:!t.needs_review}).then(function(f){i(0,t.needs_review=!t.needs_review,t)}).catch(function(f){alert(f)})}const R=f=>f.id===t.case_id;function X(){y=be(this),i(9,y),i(0,t),i(1,r)}function Y(){t.text=this.value,i(0,t)}function N(f){se[f?"unshift":"push"](()=>{v=f,i(6,v)})}function B(){t.hint=this.value,i(0,t)}function u(f){se[f?"unshift":"push"](()=>{b=f,i(8,b)})}function g(){t.comment=this.value,i(0,t)}function k(f){se[f?"unshift":"push"](()=>{m=f,i(7,m)})}function G(){t.is_invalid=this.checked,i(0,t)}function te(){t.needs_review=this.checked,i(0,t)}const ue=f=>{confirm("Are you sure you want to delete this image?")&&O(f.id)};function ee(f,I,j,P){j[P]=f,i(0,t)}const x=f=>{h(f.id)},de=f=>{confirm("Are you sure you want to delete this answer?")&&S(f.id)};function ie(){t.type=be(this),i(0,t)}const oe=()=>{confirm("Are you sure you want to delete this question?")&&d(t.id)};return n.$$set=f=>{"question"in f&&i(0,t=f.question),"cases"in f&&i(1,r=f.cases),"toggleEditor"in f&&i(2,_=f.toggleEditor),"handleQuestionRemove"in f&&i(3,d=f.handleQuestionRemove),"showConfigEditor"in f&&i(4,p=f.showConfigEditor),"showCaseSelector"in f&&i(5,A=f.showCaseSelector)},n.$$.update=()=>{n.$$.dirty[0]&1&&i(11,s=t.correct_answer_id),n.$$.dirty[0]&64&&v&&q(v),n.$$.dirty[0]&128&&m&&q(m),n.$$.dirty[0]&256&&b&&q(b),n.$$.dirty[0]&1&&(t.case?i(9,y=t.case.id):i(9,y=""))},[t,r,_,d,p,A,v,m,b,y,o,s,h,z,V,O,F,S,U,M,C,E,H,R,X,Y,N,B,u,g,k,G,te,ue,ee,x,de,ie,oe]}class ct extends Re{constructor(e){super(),Ne(this,e,ot,st,me,{question:0,cases:1,toggleEditor:2,handleQuestionRemove:3,showConfigEditor:4,showCaseSelector:5},null,[-1,-1])}}export{ct as Q};
