import{S as ne,i as se,s as le,b,g as I,e as T,c as p,a as q,h as _,z as B,E as O,A,B as V,d as E,I as re,l as H,p as S,r as D,f as ce,k as N,m as U,o as ie,x as ae,y as j,C as oe,L as fe,t as W,j as F,n as R,H as de}from"./index-CfkxbGBF.js";import{e as L,u as me,o as _e}from"./each-11-GcuRw.js";import{p as G,d as pe}from"./purify.es-WTxncMLc.js";import{U as ge}from"./UserSettingsStore--bDKyU3G.js";import{f as J,p as K}from"./parseISO-rY9c-aYN.js";function P(a,t,e){const n=a.slice();return n[13]=t[e],n[14]=t,n[15]=e,n}function be(a){let t,e,n,s,i,l,r,u,m,c,f,o,d,M,k,g,h,v,w;return{c(){t=b("div"),e=b("form"),n=b("div"),s=b("input"),l=I(),r=b("trix-editor"),u=I(),m=b("div"),c=b("input"),o=I(),d=b("label"),d.textContent="Anonymous",M=I(),k=b("input"),g=I(),h=b("button"),h.textContent="Cancel",p(s,"id","message"),p(s,"type","hidden"),p(s,"name","message"),s.value=i=a[0].text,fe(r,"input","message"),p(n,"class","mb-3"),p(c,"type","checkbox"),p(c,"class","form-check-input"),p(c,"id","anonymous"),c.checked=f=a[0].is_anonymous,p(d,"class","form-check-label"),p(d,"for","anonymous"),p(m,"class","mb-3 form-check"),p(k,"class","btn btn-sm btn-primary"),p(k,"type","submit"),k.value="Save",p(h,"class","btn btn-link mr-0"),p(e,"class","mt-3 mb-3"),p(t,"class","col-md")},m(y,C){q(y,t,C),_(t,e),_(e,n),_(n,s),_(n,l),_(n,r),_(e,u),_(e,m),_(m,c),_(m,o),_(m,d),_(e,M),_(e,k),_(e,g),_(e,h),v||(w=[H(h,"click",S(a[7])),H(e,"submit",S(a[9]))],v=!0)},p(y,C){C&1&&i!==(i=y[0].text)&&(s.value=i),C&1&&f!==(f=y[0].is_anonymous)&&(c.checked=f)},d(y){y&&E(t),v=!1,D(w)}}}function he(a){let t,e,n,s,i,l,r,u,m=J(K(a[0].created_at),"dd/MM/yyyy HH:mm")+"",c,f,o,d,M;function k(y,C){return y[0].text&&y[0].text!=""?ye:ke}let g=k(a),h=g(a),v=a[6].id===a[0].author_id&&Q(a),w=a[0].author&&X(a);return{c(){t=b("div"),e=b("p"),h.c(),n=I(),s=b("p"),i=b("small"),v&&v.c(),l=I(),r=b("button"),r.textContent="Reply",u=I(),c=W(m),f=I(),w&&w.c(),p(e,"class","rounded-2 bg-light p-2 mb-0"),p(r,"class","btn btn-sm btn-link link-dark"),p(s,"class","text-muted text-end mb-0"),p(t,"class",o="col-md offset-md-"+a[1])},m(y,C){q(y,t,C),_(t,e),h.m(e,null),_(t,n),_(t,s),_(s,i),v&&v.m(i,null),_(i,l),_(i,r),_(i,u),_(i,c),_(i,f),w&&w.m(i,null),d||(M=H(r,"click",S(a[8])),d=!0)},p(y,C){g===(g=k(y))&&h?h.p(y,C):(h.d(1),h=g(y),h&&(h.c(),h.m(e,null))),y[6].id===y[0].author_id?v?v.p(y,C):(v=Q(y),v.c(),v.m(i,l)):v&&(v.d(1),v=null),C&1&&m!==(m=J(K(y[0].created_at),"dd/MM/yyyy HH:mm")+"")&&F(c,m),y[0].author?w?w.p(y,C):(w=X(y),w.c(),w.m(i,null)):w&&(w.d(1),w=null),C&2&&o!==(o="col-md offset-md-"+y[1])&&p(t,"class",o)},d(y){y&&E(t),h.d(),v&&v.d(),w&&w.d(),d=!1,M()}}}function ke(a){let t;return{c(){t=b("i"),t.textContent="Deleted"},m(e,n){q(e,t,n)},p:R,d(e){e&&E(t)}}}function ye(a){let t,e=G.sanitize(a[0].text)+"",n;return{c(){t=new de(!1),n=T(),t.a=n},m(s,i){t.m(e,s,i),q(s,n,i)},p(s,i){i&1&&e!==(e=G.sanitize(s[0].text)+"")&&t.p(e)},d(s){s&&(E(n),t.d())}}}function Q(a){let t,e,n,s,i;return{c(){t=b("button"),t.textContent="Edit",e=I(),n=b("button"),n.textContent="Delete",p(t,"class","btn btn-sm btn-link link-dark"),p(n,"class","btn btn-sm btn-link link-dark")},m(l,r){q(l,t,r),q(l,e,r),q(l,n,r),s||(i=[H(t,"click",S(a[7])),H(n,"click",S(a[11]))],s=!0)},p:R,d(l){l&&(E(t),E(e),E(n)),s=!1,D(i)}}}function X(a){let t=a[0].author.name+"",e;return{c(){e=W(t)},m(n,s){q(n,e,s)},p(n,s){s&1&&t!==(t=n[0].author.name+"")&&F(e,t)},d(n){n&&E(e)}}}function Y(a){let t,e,n,s,i,l,r,u,m,c,f,o,d,M,k;return{c(){t=b("div"),e=b("div"),n=b("form"),s=b("input"),l=I(),r=b("div"),r.innerHTML='<input id="replyMessage" type="hidden" name="replyMessage" value=""/> <trix-editor input="replyMessage"></trix-editor>',u=I(),m=b("div"),m.innerHTML='<input type="checkbox" class="form-check-input" id="replyAnonymous" checked=""/> <label class="form-check-label" for="replyAnonymous">Anonymous</label>',c=I(),f=b("input"),o=I(),d=b("button"),d.textContent="Cancel",p(s,"id","parentMessageId"),p(s,"type","hidden"),s.value=i=a[0].id,p(r,"class","mb-3"),p(m,"class","mb-3 form-check"),p(f,"class","btn btn-sm btn-primary"),p(f,"type","submit"),f.value="Send reply",p(d,"class","btn btn-link mr-0"),p(n,"class","mt-3 mb-3"),p(e,"class","col-md"),p(t,"class","row")},m(g,h){q(g,t,h),_(t,e),_(e,n),_(n,s),_(n,l),_(n,r),_(n,u),_(n,m),_(n,c),_(n,f),_(n,o),_(n,d),M||(k=[H(d,"click",S(a[8])),H(n,"submit",S(a[10]))],M=!0)},p(g,h){h&1&&i!==(i=g[0].id)&&(s.value=i)},d(g){g&&E(t),M=!1,D(k)}}}function Z(a){let t,e,n=L(a[0].childs),s=[];for(let l=0;l<n.length;l+=1)s[l]=x(P(a,n,l));const i=l=>A(s[l],1,1,()=>{s[l]=null});return{c(){for(let l=0;l<s.length;l+=1)s[l].c();t=T()},m(l,r){for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(l,r);q(l,t,r),e=!0},p(l,r){if(r&15){n=L(l[0].childs);let u;for(u=0;u<n.length;u+=1){const m=P(l,n,u);s[u]?(s[u].p(m,r),B(s[u],1)):(s[u]=x(m),s[u].c(),B(s[u],1),s[u].m(t.parentNode,t))}for(O(),u=n.length;u<s.length;u+=1)i(u);V()}},i(l){if(!e){for(let r=0;r<n.length;r+=1)B(s[r]);e=!0}},o(l){s=s.filter(Boolean);for(let r=0;r<s.length;r+=1)A(s[r]);e=!1},d(l){l&&E(t),ce(s,l)}}}function x(a){let t,e,n;function s(l){a[12](l,a[13],a[14],a[15])}let i={indent:a[1]+1,addMessage:a[2],questionId:a[3]};return a[13]!==void 0&&(i.message=a[13]),t=new ue({props:i}),N.push(()=>U(t,"message",s)),{c(){ie(t.$$.fragment)},m(l,r){ae(t,l,r),n=!0},p(l,r){a=l;const u={};r&2&&(u.indent=a[1]+1),r&4&&(u.addMessage=a[2]),r&8&&(u.questionId=a[3]),!e&&r&1&&(e=!0,u.message=a[13],j(()=>e=!1)),t.$set(u)},i(l){n||(B(t.$$.fragment,l),n=!0)},o(l){A(t.$$.fragment,l),n=!1},d(l){oe(t,l)}}}function ve(a){let t,e,n,s,i,l;function r(o,d){return o[4]?be:he}let u=r(a),m=u(a),c=a[5]&&Y(a),f=a[0].childs&&Z(a);return{c(){t=b("div"),e=b("div"),m.c(),n=I(),c&&c.c(),s=I(),f&&f.c(),i=T(),p(e,"class","row"),p(t,"class","mt-1 mb-1")},m(o,d){q(o,t,d),_(t,e),m.m(e,null),_(t,n),c&&c.m(t,null),q(o,s,d),f&&f.m(o,d),q(o,i,d),l=!0},p(o,[d]){u===(u=r(o))&&m?m.p(o,d):(m.d(1),m=u(o),m&&(m.c(),m.m(e,null))),o[5]?c?c.p(o,d):(c=Y(o),c.c(),c.m(t,null)):c&&(c.d(1),c=null),o[0].childs?f?(f.p(o,d),d&1&&B(f,1)):(f=Z(o),f.c(),B(f,1),f.m(i.parentNode,i)):f&&(O(),A(f,1,1,()=>{f=null}),V())},i(o){l||(B(f),l=!0)},o(o){A(f),l=!1},d(o){o&&(E(t),E(s),E(i)),m.d(),c&&c.d(),f&&f.d(o)}}}function Me(a,t,e){let n;re(a,ge,g=>e(6,n=g));let{message:s}=t,{indent:i}=t,{addMessage:l}=t,{questionId:r}=t;var u=!1,m=!1;function c(){e(4,u=!u)}function f(){e(5,m=!m)}function o(){var g={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.put("/api/messages/"+s.id,g).then(function(h){c(),e(0,s.text=h.data.text,s)}).catch(function(h){alert(h)})}function d(){var g={text:document.getElementById("replyMessage").value,parent_message_id:document.getElementById("parentMessageId").value,is_anonymous:document.getElementById("replyAnonymous").checked};axios.post("/api/questions/"+r+"/messages",g).then(function(h){f(),l(h.data)}).catch(function(h){alert(h)})}function M(){var g={text:""};axios.put("/api/messages/"+s.id,g).then(function(h){e(0,s.text="",s)}).catch(function(h){alert(h)})}function k(g,h,v,w){v[w]=g,e(0,s)}return a.$$set=g=>{"message"in g&&e(0,s=g.message),"indent"in g&&e(1,i=g.indent),"addMessage"in g&&e(2,l=g.addMessage),"questionId"in g&&e(3,r=g.questionId)},[s,i,l,r,u,m,n,c,f,o,d,M,k]}class ue extends ne{constructor(t){super(),se(this,t,Me,ve,le,{message:0,indent:1,addMessage:2,questionId:3})}}function $(a,t,e){const n=a.slice();return n[12]=t[e],n[13]=t,n[14]=e,n}function ee(a){let t,e;return{c(){t=b("p"),e=W(a[3])},m(n,s){q(n,t,s),_(t,e)},p(n,s){s&8&&F(e,n[3])},d(n){n&&E(t)}}}function te(a,t){let e,n,s,i,l;function r(c){t[7](c,t[12],t[13],t[14])}function u(c){t[8](c)}let m={indent:0,addMessage:t[4]};return t[12]!==void 0&&(m.message=t[12]),t[0]!==void 0&&(m.questionId=t[0]),n=new ue({props:m}),N.push(()=>U(n,"message",r)),N.push(()=>U(n,"questionId",u)),{key:a,first:null,c(){e=T(),ie(n.$$.fragment),this.first=e},m(c,f){q(c,e,f),ae(n,c,f),l=!0},p(c,f){t=c;const o={};!s&&f&4&&(s=!0,o.message=t[12],j(()=>s=!1)),!i&&f&1&&(i=!0,o.questionId=t[0],j(()=>i=!1)),n.$set(o)},i(c){l||(B(n.$$.fragment,c),l=!0)},o(c){A(n.$$.fragment,c),l=!1},d(c){c&&E(e),oe(n,c)}}}function Ie(a){let t,e,n;return{c(){t=b("button"),t.innerHTML='<i class="bi bi-chat-square-dots"></i> Add comment',p(t,"class","btn btn-sm btn-outline-secondary")},m(s,i){q(s,t,i),e||(n=H(t,"click",S(a[6])),e=!0)},p:R,d(s){s&&E(t),e=!1,n()}}}function we(a){let t,e,n,s,i,l,r,u,m,c,f;return{c(){t=b("div"),e=b("form"),n=b("div"),n.innerHTML='<input id="message" type="hidden" name="message" value=""/> <trix-editor input="message"></trix-editor>',s=I(),i=b("div"),i.innerHTML='<input type="checkbox" class="form-check-input" id="anonymous" checked=""/> <label class="form-check-label" for="anonymous">Anonymous</label>',l=I(),r=b("input"),u=I(),m=b("button"),m.textContent="Cancel",p(n,"class","mb-3"),p(i,"class","mb-3 form-check"),p(r,"class","btn btn-sm btn-primary"),p(r,"type","submit"),r.value="Send",p(m,"class","btn btn-link mr-0"),p(e,"action","#"),p(e,"class","mt-3 mb-3"),p(t,"class","mt-3")},m(o,d){q(o,t,d),_(t,e),_(e,n),_(e,s),_(e,i),_(e,l),_(e,r),_(e,u),_(e,m),c||(f=[H(m,"click",S(a[6])),H(e,"submit",S(a[5]))],c=!0)},p:R,d(o){o&&E(t),c=!1,D(f)}}}function qe(a){let t,e=[],n=new Map,s,i,l=L(a[2]);const r=o=>o[12].id;for(let o=0;o<l.length;o+=1){let d=$(a,l,o),M=r(d);n.set(M,e[o]=te(M,d))}let u=null;l.length||(u=ee(a));function m(o,d){return o[1]?we:Ie}let c=m(a),f=c(a);return{c(){t=b("div");for(let o=0;o<e.length;o+=1)e[o].c();u&&u.c(),s=I(),f.c(),p(t,"class","mt-3 mb-3")},m(o,d){q(o,t,d);for(let M=0;M<e.length;M+=1)e[M]&&e[M].m(t,null);u&&u.m(t,null),_(t,s),f.m(t,null),i=!0},p(o,[d]){d&29&&(l=L(o[2]),O(),e=me(e,d,r,1,o,l,n,t,_e,te,s,$),V(),!l.length&&u?u.p(o,d):l.length?u&&(u.d(1),u=null):(u=ee(o),u.c(),u.m(t,s))),c===(c=m(o))&&f?f.p(o,d):(f.d(1),f=c(o),f&&(f.c(),f.m(t,null)))},i(o){if(!i){for(let d=0;d<l.length;d+=1)B(e[d]);i=!0}},o(o){for(let d=0;d<e.length;d+=1)A(e[d]);i=!1},d(o){o&&E(t);for(let d=0;d<e.length;d+=1)e[d].d();u&&u.d(),f.d()}}}function z(a){var t=structuredClone(a),e={},n=[];t.forEach(i=>{if(!i.parent_message_id&&!i.legacy_parent_message_id){n.push(i);return}var l=i.parent_message_id?i.parent_message_id:i.legacy_parent_message_id;e[l]||(e[l]=[]),e[l].push(i)});function s(i){var l=i.legacy_message_id?i.legacy_message_id:i.id;e[l]&&(i.childs=e[l],i.childs.forEach(r=>{s(r)}))}return n.forEach(i=>{s(i)}),n}function Ee(a,t,e){let{questionId:n}=t;var s=!1,i=[],l=[],r="Loading comments ...",u;function m(){i=[],e(3,r="Loading comments ..."),u&&u.cancel(),u=pe(()=>{axios.get("/api/questions/"+n+"/messages").then(function(k){if(i=k.data,i.length===0){e(3,r="No comments yet");return}e(2,l=z(i))}).catch(function(k){alert(k)})},1e3,{maxWait:2e3}),u()}function c(k){i.push(k),e(2,l=z(i))}function f(){var k={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.post("/api/questions/"+n+"/messages",k).then(function(g){o(),i.push(g.data),e(2,l=z(i))}).catch(function(g){alert(g)})}function o(){e(1,s=!s)}function d(k,g,h,v){h[v]=k,e(2,l),e(0,n)}function M(k){n=k,e(0,n)}return a.$$set=k=>{"questionId"in k&&e(0,n=k.questionId)},a.$$.update=()=>{a.$$.dirty&1&&(e(2,l=[]),e(1,s=!1),m())},[n,s,l,r,c,f,o,d,M]}class Le extends ne{constructor(t){super(),se(this,t,Ee,qe,le,{questionId:0})}}export{Le as M};
