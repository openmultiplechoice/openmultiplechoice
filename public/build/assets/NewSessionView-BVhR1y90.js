import{d as pe,p as be,s as $,n as Z,a as b,g as e,u as N,k as de,b as T,i as R,e as f,h as ge,f as U,c as a,j as t,t as E,m as k,v as Ve,w as ce,q as Be}from"./if-Dze_Ohw6.js";import{o as Re}from"./index-client-B9dzlTdM.js";import{p as z,a as je,b as Ee,c as ye,e as De,i as $e}from"./event-modifiers-CNXKsEUd.js";import{s as ue}from"./class-BfJg_ovI.js";import{p as Me,s as Ge,a as Oe,b as Pe}from"./props-4VW5Q74_.js";import{r as me}from"./legacy-client-GmOCPGtd.js";import{b as We}from"./select-BL7eBuhm.js";import{b as Ye}from"./this-BezDMXgj.js";import{C as ze}from"./auto-sRkgK8jz.js";import{h as Fe}from"./html-a0oWzx4G.js";import{s as He}from"./StatsHelper-B91isISU.js";import{c as Ke}from"./NewSessionHelper-Ba9jtPTo.js";import{f as Le,p as Qe}from"./parseISO-BGu1X6cY.js";import{b as Te,a as Je}from"./input-2lkkpdu2.js";import{U as Se}from"./UserSettingsStore-AhLnTBX0.js";var Xe=U('<div class="row"><div class="col-md"><div class="alert alert-light mb-3 py-2">Number of questions: <span class="badge text-black font-monospace" title="Number of questions"><i class="bi bi-collection"></i> </span></div></div></div>'),Ze=U('<button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> Repeat 30 incorrect</button>'),et=U('<button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> Repeat 60 incorrect</button>'),tt=U('<div class="d-grid gap-2"><!> <!> <button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> </button></div>'),at=U('<div class="row mb-5"><div class="col-md-5"><canvas></canvas></div> <div class="col-md-7 mt-3"><table class="table"><thead></thead><tbody><tr><td>Questions</td><td class="font-monospace text-end"> </td></tr><tr><td>Answered</td><td class="font-monospace text-end"> </td></tr><tr><td>Unanswered</td><td class="font-monospace text-end"> </td></tr><tr><td>Correct</td><td class="font-monospace text-end"> </td></tr><tr><td>Correct with help</td><td class="font-monospace text-end"> </td></tr><tr><td>Incorrect</td><td class="font-monospace text-end"> </td></tr></tbody></table> <!></div></div>');function st(J,S){be(S,!0);let s=$(Z([])),w=$(Z([])),m=$(void 0),g=$(void 0);me(()=>{S.decks,(()=>{if(!S.decks)return;const o=S.decks.map(p=>p.questions).flat();b(s,o.filter(p=>!p.is_invalid),!0);const q=[];for(const p of S.decks){const A=p.sessions.sort((_,M)=>M.id-_.id);if(A.length===0)continue;const r=A[0];q.push(...r.answer_choices)}b(w,q.filter(p=>e(s).some(({id:A})=>A===p.question_id)),!0)})()});let x=N(()=>e(s).length),c=N(()=>e(w).length),D=N(()=>e(x)-e(c)),V=N(()=>e(w).filter(o=>o.is_correct&&!o.help_used).length),G=N(()=>e(w).filter(o=>o.is_correct&&o.help_used).length),L=N(()=>e(w).filter(o=>!o.is_correct).length),O=N(()=>e(w).filter(o=>!o.is_correct).map(o=>o.question_id));me(()=>{e(g)&&(()=>{const o={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect","Unanswered"],datasets:[{label:"n",data:[e(V),e(G),e(L),e(D)],backgroundColor:["#198754","#ffc107","#dc3545","#bbbbbb"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};e(m)&&e(m).destroy();var q=e(g).getContext("2d");b(m,new ze(q,o),!0)})()});function h(o){const q={module_id:S.moduleId,question_ids:o};axios.post("/api/sessions/newfromquestionids",q).then(function(p){window.location.href="/sessions/"+p.data.id}).catch(function(p){alert(p)})}var v=de(),Q=T(v);{var P=o=>{var q=de(),p=T(q);{var A=r=>{var _=Xe(),M=t(_),l=t(M),C=a(t(l)),i=a(t(C));E(()=>k(i,` ${e(x)??""}`)),f(r,_)};R(p,r=>{e(x)>0&&r(A)})}f(o,q)},Y=o=>{var q=de(),p=T(q);{var A=r=>{var _=at(),M=t(_),l=t(M);Ye(l,H=>b(g,H),()=>e(g));var C=a(M,2),i=t(C),n=a(t(i)),u=t(n),d=a(t(u)),j=t(d),B=a(u),I=a(t(B)),W=t(I),ee=a(B),ae=a(t(ee)),se=t(ae),y=a(ee),te=a(t(y)),re=t(te),ie=a(y),qe=a(t(ie)),ve=t(qe),he=a(ie),Ce=a(t(he)),Ie=t(Ce),ke=a(i,2);{var we=H=>{var oe=tt(),le=t(oe);{var X=F=>{var ne=Ze(),Ne=N(()=>z(()=>h(e(O).slice(0,30))));ne.__click=function(...Ae){e(Ne)?.apply(this,Ae)},f(F,ne)};R(le,F=>{e(L)>=40&&F(X)})}var K=a(le,2);{var _e=F=>{var ne=et(),Ne=N(()=>z(()=>h(e(O).slice(0,60))));ne.__click=function(...Ae){e(Ne)?.apply(this,Ae)},f(F,ne)};R(K,F=>{e(L)>=70&&F(_e)})}var fe=a(K,2),xe=N(()=>z(()=>h(e(O))));fe.__click=function(...F){e(xe)?.apply(this,F)};var Ue=a(t(fe));E(()=>k(Ue,` Repeat ${e(L)??""} incorrect`)),f(H,oe)};R(ke,H=>{e(L)>0&&H(we)})}E((H,oe,le,X,K)=>{k(j,e(x)),k(W,`${e(c)??""}
                            (${H??""}%)`),k(se,`${e(D)??""}
                            (${oe??""}%)`),k(re,`${e(V)??""}
                            (${le??""}%)`),k(ve,`${e(G)??""}
                            (${X??""}%)`),k(Ie,`${e(L)??""}
                            (${K??""}%)`)},[()=>Math.round(100*e(c)/e(x)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(D)/e(x)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(V)/e(c)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(G)/e(c)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(L)/e(c)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})]),f(r,_)};R(p,r=>{S.decks&&r(A)},!0)}f(o,q)};R(Q,o=>{S.decks&&e(x)===e(D)?o(P):o(Y,!1)})}f(J,v),ge()}pe(["click"]);var nt=U('<span class="badge text-bg-light"> </span>'),rt=U('<span class="badge text-bg-light"> </span>'),it=U('<span class="badge text-bg-light font-monospace" title="Number of sessions"><i class="bi bi-rocket"></i> </span>'),ot=U('<div class="col-md-6 mb-3"><div class="card"><div class="card-header"><!> <span class="badge text-bg-light font-monospace" title="Number of questions"><i class="bi bi-collection"></i> </span> <!> <!> <button class="btn btn-sm btn-link"><i></i></button> <input type="checkbox" class="form-check-input float-end" value=""/></div> <div class="card-body"><h6 class="card-title text-truncate"> </h6> <button type="button" class="btn btn-sm btn-primary"><i class="bi bi-rocket-takeoff"></i> Start session</button> <a class="card-link">Browse deck</a></div></div></div>');function lt(J,S){be(S,!0);let s=Me(S,"deck",15),w=$(void 0),m=$(s().bookmarks.length>0);Re(()=>{const n=s().questions.filter(I=>!I.is_invalid),u=s().sessions.sort((I,W)=>W.id-I.id);if(u.length===0)return;const j=u[0].answer_choices.filter(I=>n.some(({id:W})=>W===I.question_id)),B=He(n.length,j);B.correct>=60?b(w,'<span class="badge text-bg-success" title="Correct answers in percent">'+B.correct+" %</span>"):b(w,'<span class="badge text-bg-danger" title="Correct answers in percent">'+B.correct+" %</span>")});function g(){e(m)?axios.delete("/api/decks/"+s().id+"/bookmark/"+s().bookmarks[0].id).then(function(n){n.status===204&&b(m,!1)}).catch(function(n){alert(n)}):axios.post("/api/decks/"+s().id+"/bookmark").then(function(n){n.status===200&&(b(m,!0),s(s().bookmarks=[n.data],!0))}).catch(function(n){alert(n)})}var x=ot(),c=t(x),D=t(c),V=t(D);{var G=n=>{var u=nt(),d=t(u);E(j=>k(d,j),[()=>Le(Qe(s().exam_at),"dd.MM.yyyy")]),f(n,u)},L=n=>{var u=rt(),d=t(u);E(j=>k(d,j),[()=>Le(Qe(s().created_at),"dd.MM.yyyy")]),f(n,u)};R(V,n=>{s().exam_at?n(G):n(L,!1)})}var O=a(V,2),h=a(t(O)),v=a(O,2);{var Q=n=>{var u=it(),d=a(t(u));E(()=>k(d,` ${s().sessions.length??""}`)),f(n,u)};R(v,n=>{s().sessions&&n(Q)})}var P=a(v,2);{var Y=n=>{var u=de(),d=T(u);Fe(d,()=>e(w)),f(n,u)};R(P,n=>{e(w)&&n(Y)})}var o=a(P,2);o.__click=g;var q=t(o);let p;var A=a(o,2);A.__click=()=>S.selectDeck(s().id);var r=a(D,2),_=t(r),M=t(_),l=a(_,2),C=N(()=>z(()=>Ke(s().id)));l.__click=function(...n){e(C)?.apply(this,n)};var i=a(l,2);E(n=>{k(h,` ${s().questions.length??""}`),p=ue(q,1,"",null,p,{"bi-bookmark-check-fill":e(m),"bi-bookmark":!e(m)}),je(A,"id",`selected${s().id??""}`),Ee(A,n),je(_,"title",s().name),k(M,s().name),je(i,"href",`/decks/${s().id??""}`)},[()=>S.selectedDecks.has(s().id)]),f(J,x),ge()}pe(["click"]);var ct=U('<div class="col"><div class="alert alert-light">No decks found! Create a new deck <a href="/decks" class="alert-link">here</a>.</div></div>'),dt=U('<div class="d-flex justify-content-center"><div class="spinner-border text-secondary" role="status"><span class="visually-hidden">Loading decks ...</span></div></div>'),ut=U('<li><button class="page-link"> </button></li>'),vt=U('<div class="col"><nav><ul class="pagination"><li><button class="page-link">‹</button></li> <!> <li><button class="page-link">›</button></li></ul></nav></div>'),_t=U('<div class="row sticky-bottom bg-white mt-3 pt-3"><div class="col"><p class="small text-muted">Showing <span class="fw-semibold"> </span> to <span class="fw-semibold"> </span> of <span class="fw-semibold"> </span> decks</p></div> <!></div>'),ft=U('<div class="row mb-3"><div class="col"><div class="input-group"><span class="input-group-text"><i class="bi bi-archive"></i></span> <select id="kind" class="form-select"><option>Main decks</option><option>Your decks</option><option>User decks</option><option>Bookmarked decks</option></select></div></div></div> <!> <div class="row"><!></div> <!>',1);function mt(J,S){be(S,!0);let s=Me(S,"moduleId",15),w=Me(S,"selectedDecks",15),m=$(void 0),g=$(Z(D("kind")??"public-rw-listed")),x=$(Z(D("page")??1)),c=$(void 0);me(()=>{s(),b(x,D("page")??1,!0),V()});function D(i){return new URLSearchParams(window.location.search).get(i)}function V(){if(!s()){b(m,[],!0);return}b(m,void 0);const i=new URL(window.location);i.searchParams.set("module",s()),i.searchParams.set("kind",e(g)),i.searchParams.set("page",e(x)),window.history.replaceState({},"",i),axios.get("/api/decks?module="+s()+"&kind="+e(g)+"&page="+e(x)).then(function(n){b(c,n.data,!0),b(m,e(c).data,!0),e(m).sort(function(u,d){return u.exam_at===null||d.exam_at===null?u.id<d.id?1:u.id>d.id?-1:0:u.exam_at<d.exam_at?1:u.exam_at>d.exam_at?-1:0})}).catch(function(n){alert(n)})}function G(i){b(x,i,!0),V()}var L=ft(),O=T(L),h=t(O),v=t(h),Q=a(t(v),2);Q.__change=V;var P=t(Q);P.value=P.__value="public-rw-listed";var Y=a(P);Y.value=Y.__value="user";var o=a(Y);o.value=o.__value="public";var q=a(o);q.value=q.__value="bookmarked";var p=a(O,2);st(p,{get decks(){return e(m)},set decks(i){b(m,i,!0)},get moduleId(){return s()},set moduleId(i){s(i)}});var A=a(p,2),r=t(A);{var _=i=>{var n=de(),u=T(n);De(u,19,()=>e(m),d=>d.id,(d,j,B)=>{lt(d,{get selectDeck(){return S.selectDeck},get deck(){return e(m)[e(B)]},set deck(I){e(m)[e(B)]=I},get selectedDecks(){return w()},set selectedDecks(I){w(I)}})},d=>{var j=ct();f(d,j)}),f(i,n)},M=i=>{var n=dt();f(i,n)};R(r,i=>{e(m)?i(_):i(M,!1)})}var l=a(A,2);{var C=i=>{var n=_t(),u=t(n),d=t(u),j=a(t(d)),B=t(j),I=a(j,2),W=t(I),ee=a(I,2),ae=t(ee),se=a(u,2);{var y=te=>{var re=vt(),ie=t(re),qe=t(ie),ve=t(qe);let he;var Ce=t(ve),Ie=N(()=>z(()=>{e(c).prev_page_url&&G(e(c).current_page-1)}));Ce.__click=function(...X){e(Ie)?.apply(this,X)};var ke=a(ve,2);De(ke,17,()=>e(c).links.slice(1,e(c).links.length-1),$e,(X,K)=>{var _e=ut();let fe;var xe=t(_e),Ue=N(()=>z(()=>{e(K).url&&G(e(K).label)}));xe.__click=function(...ne){e(Ue)?.apply(this,ne)};var F=t(xe);E(()=>{fe=ue(_e,1,"page-item d-none d-sm-block",null,fe,{disabled:e(K).active||!e(K).url}),k(F,e(K).label)}),f(X,_e)});var we=a(ke,2);let H;var oe=t(we),le=N(()=>z(()=>{e(c).next_page_url&&G(e(c).current_page+1)}));oe.__click=function(...X){e(le)?.apply(this,X)},E(()=>{he=ue(ve,1,"page-item",null,he,{disabled:e(c).prev_page_url===null}),H=ue(we,1,"page-item",null,H,{disabled:e(c).next_page_url===null})}),f(te,re)};R(se,te=>{e(c).last_page>1&&te(y)})}E(()=>{k(B,e(c).from),k(W,e(c).to),k(ae,e(c).total)}),f(i,n)};R(l,i=>{e(c)&&e(c).total>0&&i(C)})}E(()=>{ye(P,e(g)==="public-rw-listed"),ye(Y,e(g)==="user"),ye(o,e(g)==="public"),ye(q,e(g)==="bookmarked")}),We(Q,()=>e(g),i=>b(g,i)),f(J,L),ge()}pe(["change","click"]);var pt=U("/ <strong> </strong>",1),bt=U('<div class="row"><div class="col-md"><div class="alert alert-light" role="alert"><p>Create your own super deck:</p> <p>You have <strong> </strong> with <strong> </strong> <!> </p> <div class="mb-3"><label for="name" class="form-label">Deck Name</label> <input type="text" class="form-control" id="name"/></div> <div class="mb-3 form-check"><input type="checkbox" class="form-check-input" id="checkboxRemoveDuplicates"/> <label class="form-check-label" for="checkboxRemoveDuplicates">Filter out duplicates</label></div> <div class="d-grid gap-2 d-md-block"><button class="btn btn-sm btn-primary"> </button> <button class="btn btn-sm btn-primary"> </button> <button class="btn btn-sm btn-link">Cancel</button></div></div></div></div>');function gt(J,S){be(S,!0);let s=Me(S,"selectedDecks",15),w=$(Z([])),m=$("My new super deck"),g=$(!0);me(()=>{s(),D()});let x=N(()=>(()=>{var h=[];return e(w).forEach(v=>h.push(...v.questions)),e(g)?[...new Map(h.map(v=>[v.id,v])).values()]:h})()),c=N(()=>(()=>{var h=[];return e(w).forEach(v=>{v.questions.forEach(Q=>{Q.images.length>0&&h.push(Q)})}),e(g)?[...new Map(h.map(v=>[v.id,v])).values()]:h})());function D(){if(s().size===0){b(w,[],!0);return}const h=[...s()].map(v=>"decks[]="+v);axios.get("/api/decks?"+h.join("&")).then(function(v){b(w,v.data,!0)}).catch(function(v){alert(v)})}function V(h,v){var Q={name:h,question_ids:v};axios.post("/api/decks",Q).then(function(P){window.location.href="/decks/"+P.data.id}).catch(function(P){alert(P)})}var G=de(),L=T(G);{var O=h=>{var v=bt(),Q=t(v),P=t(Q),Y=a(t(P),2),o=a(t(Y)),q=t(o),p=a(o,2),A=t(p),r=a(p,2);{var _=y=>{var te=pt(),re=a(T(te)),ie=t(re);E(()=>k(ie,`${e(c).length??""} question${e(c).length>1?"s":""} with images`)),f(y,te)};R(r,y=>{e(c).length>0&&y(_)})}var M=a(r),l=a(Y,2),C=a(t(l),2),i=a(l,2),n=t(i),u=a(i,2),d=t(u),j=N(()=>z(()=>V(e(m),e(x).map(y=>y.id))));d.__click=function(...y){e(j)?.apply(this,y)};var B=t(d),I=a(d,2),W=N(()=>z(()=>V(e(m),e(c).map(y=>y.id))));I.__click=function(...y){e(W)?.apply(this,y)};var ee=t(I),ae=a(I,2),se=N(()=>z(()=>s(new Set)));ae.__click=function(...y){e(se)?.apply(this,y)},E(()=>{k(q,`selected ${e(w).length??""} deck${e(w).length>1?"s":""}`),k(A,`${e(x).length??""} question${e(x).length>1?"s":""}`),k(M,` (duplicates ${e(g)?"excluded":"included"})`),k(B,`Create deck (${e(x).length??""} question${e(x).length>1?"s":""})`),k(ee,`Create deck (${e(c).length??""} image question${e(c).length>1?"s":""})`)}),Ve("focus",C,y=>y.target.select()),Te(C,()=>e(m),y=>b(m,y)),Je(n,()=>e(g),y=>b(g,y)),f(h,v)};R(L,h=>{e(w).length>0&&h(O)})}f(J,G),ge()}pe(["click"]);var ht=U('<button data-bs-target="#offcanvasModuleSelection" data-bs-dismiss="offcanvas"> </button>'),kt=U('<ul class="list-group m-2 me-0"></ul>'),wt=U("<button> </button> <!>",1),xt=U('<div class="alert alert-light text-center" role="alert">No module selected</div>'),yt=U('<div class="row"><div class="col-12 d-grid mb-2"><button type="button" class="btn btn-sm btn-primary d-lg-none my-2" data-bs-toggle="offcanvas" data-bs-target="#offcanvasModuleSelection" aria-controls="offcanvasModuleSelection">Switch module</button></div></div> <div class="row"><div class="col-lg-4 offcanvas-lg offcanvas-start" tabindex="-1" id="offcanvasModuleSelection"><div class="offcanvas-header"><h5 id="offcanvasAddToDeckLabel">Choose subject and module</h5> <button type="button" class="btn-close text-reset" data-bs-target="#offcanvasModuleSelection" data-bs-dismiss="offcanvas" aria-label="Close"></button></div> <div class="offcanvas-body"><ul class="list-group w-100"></ul></div></div> <div class="col-12 col-lg-8"><!> <!></div></div>',1);function St(J,S){be(S,!0);const s=()=>Ge(Se,"$UserSettings",w),[w,m]=Oe();let g=$(Z([])),x=$(Z([])),c=$(Z([])),D=$(Z(new Set));me(()=>{s().last_subject_id,b(c,e(g).filter(r=>s().last_subject_id?r.subject?r.subject.id===s().last_subject_id:!1:!0),!0)}),Re(()=>{axios.get("/api/modules").then(function(r){var _=r.data;b(g,_.filter((l,C,i)=>C===i.findIndex(n=>n.id===l.id)).sort(function(l,C){return l.name>C.name?1:l.name<C.name?-1:0}),!0);var M=e(g).map(l=>l.subject).filter(l=>!!l);b(x,M.filter((l,C,i)=>C===i.findIndex(n=>n.id===l.id)).sort(function(l,C){return l.name>C.name?1:l.name<C.name?-1:0}),!0)}).catch(function(r){alert(r)})});function V(r){var _={last_subject_id:r,last_module_id:0};axios.put("/api/users/me/settings",_).then(function(M){const l=new URL(window.location);l.searchParams.delete("module"),l.searchParams.delete("page"),window.history.replaceState({},"",l),Pe(Se,ce(s).last_subject_id=r,ce(s)),Pe(Se,ce(s).last_module_id=0,ce(s))}).catch(function(M){alert(M)})}function G(r){var _={last_module_id:r};axios.put("/api/users/me/settings",_).then(function(M){const l=new URL(window.location);l.searchParams.set("module",r),l.searchParams.set("page",1),window.history.replaceState({},"",l),Pe(Se,ce(s).last_module_id=r,ce(s))}).catch(function(M){alert(M)})}function L(r){e(D).has(r)?e(D).delete(r):e(D).add(r),b(D,new Set([...e(D)]),!0)}var O=yt(),h=a(T(O),2),v=t(h),Q=a(t(v),2),P=t(Q);De(P,21,()=>e(x),$e,(r,_)=>{var M=wt(),l=T(M),C=N(()=>z(()=>V(e(_).id)));l.__click=function(...d){e(C)?.apply(this,d)};var i=t(l),n=a(l,2);{var u=d=>{var j=kt();De(j,21,()=>e(c),$e,(B,I)=>{var W=ht(),ee=N(()=>z(()=>G(e(I).id)));W.__click=function(...se){e(ee)?.apply(this,se)};var ae=t(W);E(()=>{ue(W,1,`list-group-item list-group-item-action ${s().last_module_id===e(I).id?"list-group-item-secondary":"list-group-item-light"}`),k(ae,e(I).name)}),f(B,W)}),f(d,j)};R(n,d=>{s().last_subject_id===e(_).id&&d(u)})}E(()=>{ue(l,1,`list-group-item list-group-item-action ${s().last_subject_id===e(_).id?"list-group-item-dark":"list-group-item-light"}`),k(i,e(_).name)}),f(r,M)});var Y=a(v,2),o=t(Y);gt(o,{get selectedDecks(){return e(D)},set selectedDecks(r){b(D,r,!0)}});var q=a(o,2);{var p=r=>{mt(r,{get moduleId(){return s().last_module_id},selectDeck:L,get selectedDecks(){return e(D)},set selectedDecks(_){b(D,_,!0)}})},A=r=>{var _=xt();f(r,_)};R(q,r=>{s().last_module_id?r(p):r(A,!1)})}f(J,O),ge(),m()}pe(["click"]);const Dt=document.getElementById("NewSessionView");Be(St,{target:Dt});
