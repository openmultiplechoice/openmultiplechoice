import{e as mt,u as _t,d as J,p as X,g as e,s as V,a as T,f as Q,b as Z,c as f,h as m,i as $,j as n,t as k,k as L,l as st,m as ft,n as P,o as j,q as bt,r as it,v as pt}from"./render-COO8opCt.js";import{o as ht}from"./index-client-DGX_bLx7.js";import{i as O}from"./if-CwjDoZzt.js";import{s as at,a as M}from"./attributes-DYipTw7O.js";import{k as gt,Q as xt}from"./QuestionForm-CxdUL4Ms.js";import{h as wt}from"./html-DHpoEShY.js";import{s as G}from"./class-BfJg_ovI.js";import{b as kt}from"./input-CSrHR2ik.js";import{b as qt}from"./this-DYJjSBKP.js";import{p as yt,e as rt,i as nt}from"./event-modifiers-BGh6mCkd.js";import{p as ut}from"./props-B2c_TekP.js";import{r as Et}from"./legacy-client-30PpYn5B.js";import{d as Ct,p as ot,K as dt}from"./hotkeys-js-Bzouew-W.js";import{s as ct}from"./style-BtOSwUPa.js";import{s as lt}from"./utils-CsCDY5_e.js";import"./select-DxDuCAfo.js";import"./lodash-d8dSvcKh.js";import"./_commonjsHelpers-CE1G-McA.js";class tt{#t=new WeakMap;#e;#s;static entries=new WeakMap;constructor(s){this.#s=s}observe(s,t){var o=this.#t.get(s)||new Set;return o.add(t),this.#t.set(s,o),this.#i().observe(s,this.#s),()=>{var b=this.#t.get(s);b.delete(t),b.size===0&&(this.#t.delete(s),this.#e.unobserve(s))}}#i(){return this.#e??(this.#e=new ResizeObserver(s=>{for(var t of s){tt.entries.set(t.target,t);for(var o of this.#t.get(t.target)||[])o(t)}}))}}var It=new tt({box:"border-box"});function Tt(q,s,t){var o=It.observe(q,()=>t(q[s]));mt(()=>(_t(()=>t(q[s])),o))}var Qt=Q('<form action="#" class="mt-3"><div class="mb-3"><label class="form-label">Case text</label> <input type="hidden"/> <trix-editor></trix-editor> <!></div></form>',2),Dt=Q(`<div class="alert alert-light mt-5" role="alert"><p><strong>Delete case?</strong> A case can only be deleted if it's not associated with any question.</p> <button type="button" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i> Delete case</button></div>`),zt=Q("<!> <!>",1);function At(q,s){X(s,!0);let t=ut(s,"kase",15),o=V(void 0),b=V("");Et(()=>{e(o)&&D(e(o))});function D(r){r.addEventListener("trix-change",function(){t(t().text=document.getElementById("caseText"+t().id).value,!0),T(b,'<p class="text-end">Saving ...</p>'),S()}),r.toolbarElement.style.display="none",r.addEventListener("trix-focus",function(d){d.target.toolbarElement.style.display="block"}),r.addEventListener("trix-blur",function(d){d.target.toolbarElement.contains(document.activeElement)||(d.target.toolbarElement.style.display="none")})}var h;function S(){h&&h.cancel(),h=Ct(()=>{axios.put("/api/cases/"+t().id,t()).then(function(r){T(b,'<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(r){T(b,'<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(r)})},500,{maxWait:2e3}),h()}var F=zt(),z=Z(F);gt(z,()=>t().id,r=>{var d=Qt(),y=n(d),A=n(y),u=f(A,2),l=f(u,2);k(()=>at(l,"id",`editor-case${t().id??""}`)),G(l,1,"bg-light trix-content"),k(()=>at(l,"input",`caseText${t().id??""}`)),qt(l,g=>T(o,g),()=>e(o));var v=f(l,2);wt(v,()=>e(b)),k(()=>{M(A,"for",`caseText${t().id??""}`),M(u,"id",`caseText${t().id??""}`)}),kt(u,()=>t().text,g=>t(t().text=g,!0)),m(r,d)});var H=f(z,2);{var c=r=>{var d=Dt(),y=f(n(d),2),A=L(()=>yt(()=>{confirm("Are you sure you want to delete this case?")&&s.handleCaseRemove(t().id)}));y.__click=function(...u){e(A)?.apply(this,u)},k(u=>y.disabled=u,[()=>s.cases.some(u=>u.questions?u.questions.some(l=>l.case_id===t().id):!1)]),m(r,d)};O(H,r=>{s.handleCaseRemove&&r(c)})}m(q,F),$()}J(["click"]);var St=Q('<button type="button" aria-current="true"><small><!></small></button>'),Bt=Q('<button type="button" aria-current="true"><small><i class="bi bi-clipboard2-pulse"></i> <!></small></button>'),Lt=Q('<div class="overflow-scroll mt-2" style="max-height: 20vh;"><div class="list-group"></div></div>'),Ot=Q('<div class="sticky-top pt-3"><div class="overflow-scroll"><div class="list-group"></div></div> <!></div>'),Ft=Q("<p>Loading ...</p>");function Nt(q,s){X(s,!0);let t=ut(s,"data",15),o=L(()=>t()?t().questions.find(c=>c.id===t().current_question_id):null),b=L(()=>t()?t().current_question_id:null),D=L(()=>t()?t().current_case_id:null),h=L(()=>t()&&t().cases&&t().cases.length>0);st(()=>{if(!e(b))return;let c=document.getElementById("editor-question"+e(b));lt(c),window.scrollTo({top:0,behavior:"smooth"})}),st(()=>{if(!e(D))return;let c=document.getElementById("editor-case-item"+e(D));lt(c),window.scrollTo({top:0,behavior:"smooth"})});var S=ft(),F=Z(S);{var z=c=>{var r=Ot(),d=n(r),y=n(d);rt(y,21,()=>t().questions,nt,(l,v,g)=>{var E=St();E.__click=()=>{t(t().current_question_id=e(v).id,!0),t(t().current_case_id=null,!0)};let _;var N=n(E),w=n(N);{var R=x=>{var C=P();k(K=>j(C,K),[()=>ot.sanitize(e(v).text).replace(/<\/?[^>]+(>|$)/g,"")]),m(x,C)},W=x=>{var C=P();C.nodeValue=`Question Nr. ${g+1}`,m(x,C)};O(w,x=>{e(v).text?x(R):x(W,!1)})}k(()=>{M(E,"id",`editor-question${e(v).id??""}`),_=G(E,1,"list-group-item list-group-item-action text-truncate",null,_,{"list-group-item-dark":e(v).id===t().current_question_id,"list-group-item-light":e(v).id!==t().current_question_id,"bg-warning-subtle":t().current_case_id&&e(v).case_id===t().current_case_id})}),m(l,E)});var A=f(d,2);{var u=l=>{var v=Lt(),g=n(v);rt(g,21,()=>t().cases,nt,(E,_,N)=>{var w=Bt();w.__click=()=>{t(t().current_case_id=e(_).id,!0),t(t().current_question_id=null,!0)};let R;var W=n(w),x=f(n(W),2);{var C=I=>{var B=P();k(Y=>j(B,Y),[()=>ot.sanitize(e(_).text).replace(/<\/?[^>]+(>|$)/g,"")]),m(I,B)},K=I=>{var B=P();B.nodeValue=`Case Nr. ${N+1}`,m(I,B)};O(x,I=>{e(_).text?I(C):I(K,!1)})}k(()=>{M(w,"id",`editor-case-item${e(_).id??""}`),R=G(w,1,"list-group-item list-group-item-action text-truncate",null,R,{"list-group-item-dark":e(_).id===t().current_case_id,"list-group-item-info":e(_).id!==t().current_case_id&&!(e(o)&&e(o).case_id===e(_).id),"list-group-item-warning":e(o)&&e(o).case_id===e(_).id})}),m(E,w)}),m(l,v)};O(A,l=>{e(h)&&l(u)})}k(()=>{ct(r,`z-index: 19; top: ${s.stickyTopOffset??""}px`),ct(d,`max-height: ${e(h)?"55vh":"80vh"};`)}),m(c,r)},H=c=>{var r=Ft();m(c,r)};O(F,c=>{t()?c(z):c(H,!1)})}m(q,S),$()}J(["click"]);var Rt=Q('<div class="row"><div class="col"><h4 class="text-truncate"><a class="text-reset text-decoration-none"> </a></h4></div></div> <div class="sticky-top bg-white" style="z-index: 20;"><div class="row"><div class="col d-grid d-sm-block gap-2 py-3"><button type="button" class="btn btn-sm btn-primary" title="Add a new MC question (Shortcut: Alt+Q)">Add MC question</button> <button type="button" class="btn btn-sm btn-primary">Add card question</button> <button type="button" class="btn btn-sm btn-light"><i class="bi bi-clipboard2-pulse"></i> Add case</button></div></div> <div class="row"><div class="col"><div class="border-dark" style="border-bottom: dotted; border-width: 1px;"></div></div></div></div> <div class="row"><div class="col-md-4"><!></div> <div class="col-md-8"><!> <!></div></div>',1);function Mt(q,s){X(s,!0);let t=V(bt({cases:[],questions:[]})),o=0;const b=1e3;let D=L(()=>e(t)?e(t).questions.find(i=>i.id===e(t).current_question_id):null),h=L(()=>e(t)?e(t).cases.find(i=>i.id===e(t).current_case_id):null),S=V(0);ht(()=>{dt.filter=function(){return!0},dt("alt+Q",function(i){i.preventDefault();const a=Date.now();a-o>b&&(z("mc"),o=a)}),axios.get("/api/decks/"+s.id).then(function(i){T(t,i.data,!0);const a=F();a&&e(t).questions.some(p=>p.id===parseInt(a))?e(t).current_question_id=parseInt(a):e(t).questions.length>0&&(e(t).current_question_id=e(t).questions[e(t).questions.length-1].id)}).catch(function(i){alert(i)})});function F(){return new URLSearchParams(window.location.search).get("question_id")}function z(i){var a={id:null,text:"",type:i||"mc",correct_answer_id:null,images:[],answers:[]};axios.post("/api/decks/"+s.id+"/questions",a).then(function(p){a.id=p.data.id,e(t).questions=[...e(t).questions,a],e(t).current_question_id=a.id,it().then(()=>{const et=document.getElementById("editor-questionText");et&&et.focus()})}).catch(function(p){alert(p)}),window.scrollTo({top:0,behavior:"smooth"})}function H(){var i={deck_id:s.id};axios.post("/api/cases",i).then(function(a){e(t).cases=[...e(t).cases,a.data],e(t).current_case_id=a.data.id,e(t).current_question_id=null,it().then(()=>{const p=document.getElementById("editor-case"+a.data.id);p&&p.focus()})}).catch(function(a){alert(a)}),window.scrollTo({top:0,behavior:"smooth"})}function c(i){axios.delete("/api/decks/"+s.id+"/questions/"+i).then(function(a){e(t).questions=e(t).questions.filter(p=>p.id!==i),e(t).questions.length>0&&(e(t).current_question_id=e(t).questions[e(t).questions.length-1].id)}).catch(function(a){alert(a)})}function r(i){axios.delete("/api/decks/"+s.id+"/cases/"+i).then(function(a){e(t).cases=e(t).cases.filter(p=>p.id!==i),e(t).questions.length>0&&(e(t).current_question_id=e(t).questions[e(t).questions.length-1].id)}).catch(function(a){alert(a)})}var d=Rt(),y=Z(d),A=n(y),u=n(A),l=n(u),v=n(l),g=f(y,2),E=n(g),_=n(E),N=n(_);N.__click=()=>{z("mc")};var w=f(N,2);w.__click=()=>{z("card")};var R=f(w,2);R.__click=H;var W=f(g,2),x=n(W),C=n(x);Nt(C,{get stickyTopOffset(){return e(S)},get data(){return e(t)},set data(i){T(t,i,!0)}});var K=f(x,2),I=n(K);{var B=i=>{xt(i,{showConfigEditor:"true",showCaseSelector:"true",handleQuestionRemove:c,get question(){return e(D)},set question(a){T(D,a)},get cases(){return e(t).cases},set cases(a){e(t).cases=a}})};O(I,i=>{e(D)&&i(B)})}var Y=f(I,2);{var vt=i=>{At(i,{handleCaseRemove:r,get kase(){return e(h)},set kase(a){T(h,a)},get cases(){return e(t).cases},set cases(a){e(t).cases=a}})};O(Y,i=>{e(h)&&i(vt)})}k(()=>{M(u,"title",s.name),M(l,"href",`/decks/${s.id??""}`),j(v,s.name)}),Tt(g,"clientHeight",i=>T(S,i)),m(q,d),$()}J(["click"]);const U=document.getElementById("DeckForm");pt(Mt,{target:U,props:{id:U.dataset.deckId,name:U.dataset.deckName,moduleId:U.dataset.moduleId}});
