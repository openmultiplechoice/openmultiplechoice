import{p as ne,a as u,s as T,k as Oe,b as se,i as V,g as e,e as h,h as ie,f as k,t as H,d as re,r as s,j as g,c as A,m as ue,u as _,l as ze,w as K,o as lt,q as dt}from"./if-GZgNzgdl.js";import{o as Ae}from"./index-client-CpfOMyFP.js";import{e as He,i as Le,a as Qe,p as $}from"./event-modifiers-CaIg6h4B.js";import{s as O}from"./class-BfJg_ovI.js";import{p as w,a as ut,s as vt,b as Ce}from"./props-D-4SDZEQ.js";import{r as E}from"./legacy-client-DjQiZhkg.js";import{p as ft,d as _t}from"./purify.es-Dnvgf1Dd.js";import{s as Ee}from"./style-BtOSwUPa.js";import{M as gt}from"./Messages-1uM76a6d.js";import{b as mt}from"./this-VlG-phZ8.js";import{C as ht}from"./auto-g150VQ4A.js";import{S as pt}from"./SessionProgressBar-BpNUm9E2.js";import{h as bt}from"./html-G7Rd4QX6.js";import{h as Se}from"./QuestionForm-C04B0TaU.js";import{S as wt}from"./SessionQuestionView-DbTIYI4F.js";import{s as xt}from"./StatsHelper-B91isISU.js";import{U as de}from"./UserSettingsStore-B6cfb3ZE.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./parseISO-BGu1X6cY.js";import"./formatDistance-C5pjvq49.js";import"./input-B1qKra93.js";import"./select-BE7SEtm-.js";import"./lodash-DjGC5Q8M.js";var kt=k('<div class="confetti svelte-rtt661"></div>'),qt=k("<div></div>");function yt(B,i){ne(i,!0);const r=w(i,"size",3,10),q=w(i,"x",19,()=>[-.5,.5]),M=w(i,"y",19,()=>[.25,1]),c=w(i,"duration",3,2e3),n=w(i,"infinite",3,!1),f=w(i,"delay",19,()=>[0,50]),v=w(i,"colorRange",19,()=>[0,360]),C=w(i,"colorArray",19,()=>[]),U=w(i,"amount",3,50),p=w(i,"iterationCount",3,1),x=w(i,"fallDistance",3,"100px"),a=w(i,"rounded",3,!1),o=w(i,"cone",3,!1),b=w(i,"noGravity",3,!1),m=w(i,"xSpread",3,.15),Q=w(i,"destroyOnComplete",3,!0),D=w(i,"disableForReducedMotion",3,!1);let y=T(!1);Ae(()=>{!Q()||n()||typeof p()=="string"||setTimeout(()=>u(y,!0),(c()+f()[1])*p())});function F(z,G){return Math.random()*(G-z)+z}function P(){return C().length?C()[Math.round(Math.random()*(C().length-1))]:`hsl(${Math.round(F(v()[0],v()[1]))}, 75%, 50%)`}var L=Oe(),N=se(L);{var X=z=>{var G=qt();let ee;He(G,21,()=>({length:U()}),Le,(te,W)=>{var ae=kt();H((ve,Y,fe,_e,ge,oe,ce,me,he,le,pe)=>Ee(ae,`
        --color: ${ve??""};
        --skew: ${Y??""}deg,${fe??""}deg;
        --rotation-xyz: ${_e??""}, ${ge??""}, ${oe??""};
        --rotation-deg: ${ce??""}deg;
        --translate-y-multiplier: ${me??""};
        --translate-x-multiplier: ${he??""};
        --scale: ${le??""};
        --transition-delay: ${pe??""}ms;
        --transition-duration: ${n()?`calc(${c()}ms * var(--scale))`:`${c()}ms`};`),[P,()=>F(-45,45),()=>F(-45,45),()=>F(-10,10),()=>F(-10,10),()=>F(-10,10),()=>F(0,360),()=>F(M()[0],M()[1]),()=>F(q()[0],q()[1]),()=>.1*F(2,10),()=>F(f()[0],f()[1])]),h(te,ae)}),H(te=>{ee=O(G,1,"confetti-holder svelte-rtt661",null,ee,te),Ee(G,`
    --fall-distance: ${x()??""};
    --size: ${r()??""}px;
    --x-spread: ${1-m()};
    --transition-iteration-count: ${(n()?"infinite":p())??""};`)},[()=>({rounded:a(),cone:o(),"no-gravity":b(),"reduced-motion":D()})]),h(z,G)};V(N,z=>{e(y)||z(X)})}h(B,L),ie()}function Ct(B,i){u(i,!s(i))}var St=k('<div class="img-fullscreen d-flex justify-content-center align-items-center svelte-1ibqgr8"><img class="img-fluid svelte-1ibqgr8" alt="Magic GIF"/></div>');function At(B,i){let r=w(i,"magicGIFPath",3,"");var q=T(!0),M=Oe(),c=se(M);{var n=f=>{var v=St();v.__click=[Ct,q];var C=g(v);H(()=>Qe(C,"src",`/${r()??""}`)),h(f,v)};V(c,f=>{r()&&s(q)&&f(n)})}h(B,M)}re(["click"]);var Qt=k('<button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> Repeat incorrect</button>'),Pt=k('<div class="row mb-5"><div class="col-md"><canvas></canvas></div> <div class="col-md"><p class="mt-3 text-dark"><span class="fs-4 font-monospace"> </span> correct</p> <div class="d-grid gap-2"><a href="/sessions/create" class="btn btn-sm btn-primary"><i class="bi bi-rocket-takeoff"></i> New session</a> <!> <a href="/" class="btn btn-sm btn-outline-secondary">Home</a></div></div></div>');function It(B,i){ne(i,!0);let r=T(void 0),q=T(void 0);E(()=>{e(r)&&(()=>{if(e(q))return;const b={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect"],datasets:[{label:"%",data:[i.progressPercentage.correct,i.progressPercentage.correctWithHelp,i.progressPercentage.incorrect],backgroundColor:["#198754","#ffc107","#dc3545"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};e(q)&&e(q).destroy();var m=e(r).getContext("2d");u(q,new ht(m,b),!0)})()});function M(b){axios.post("/api/sessions/"+b+"/newfromincorrect").then(function(m){window.location.href="/sessions/"+m.data.id}).catch(function(m){alert(m)})}var c=Pt(),n=g(c),f=g(n);mt(f,b=>u(r,b),()=>e(r));var v=A(n,2),C=g(v),U=g(C),p=g(U),x=A(C,2),a=A(g(x),2);{var o=b=>{var m=Qt(),Q=_(()=>$(()=>M(i.sessionId)));m.__click=function(...D){e(Q)?.apply(this,D)},h(b,m)};V(a,b=>{i.progressPercentage.incorrect>0&&b(o)})}H(()=>ue(p,`${i.progressPercentage.correct??""}%`)),h(B,c),ie()}re(["click"]);var Mt=(B,i,r)=>i(i().session.current_question_id=e(r).id,!0),Ft=k("<li><small><!> <!></small></li>"),Gt=k('<li class="svelte-ns1rbt">Loading ...</li>'),Vt=k('<div class="overflow-scroll" style="max-height: 85vh;"><ul class="list-group"></ul></div>');function Bt(B,i){ne(i,!0);let r=w(i,"data",15),q=_(()=>r().session.current_question_id);E(()=>{e(q),(()=>{var f=document.getElementById("question"+e(q));f&&f.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})})()});let M=_(()=>function(f){var v=r().session.answer_choices.find(C=>C.question_id===f.id);return v?i.examMode?'<span class="text-dark fw-bold">&check;</span>':v.is_correct?v.help_used?'<span class="text-warning-dark fw-bold">&check;</span>':'<span class="text-success-dark fw-bold">&check;</span>':'<span class="text-danger-dark fw-bold">&cross;</span>':'<span class="text-dark fw-bold">&rightarrow;</span>'});var c=Vt(),n=g(c);He(n,21,()=>r().deck.questions,Le,(f,v,C)=>{var U=Ft();U.__click=[Mt,r,v];var p=g(U),x=g(p);bt(x,()=>e(M)(e(v)));var a=A(x,2);{var o=m=>{var Q=ze();H(D=>ue(Q,D),[()=>ft.sanitize(e(v).text).replace(/<\/?[^>]+(>|$)/g,"")]),h(m,Q)},b=m=>{var Q=ze();Q.nodeValue=`Question Nr. ${C+1}`,h(m,Q)};V(a,m=>{e(v).text?m(o):m(b,!1)})}H(()=>{O(U,1,`list-group-item list-group-item-action text-truncate ${e(v).id===r().session.current_question_id?"list-group-item-dark":"list-group-item-light"}`,"svelte-ns1rbt"),Qe(U,"id",`question${e(v).id??""}`)}),h(f,U)},f=>{var v=Gt();h(f,v)}),h(B,c),ie()}re(["click"]);var Ut=k('<div class="col-6"><button class="btn btn-sm btn-light w-100"><span class="fw-bold">&leftarrow;</span> Previous</button></div>'),Dt=k('<div class="col-6"></div>'),Rt=k('<div class="col-6"><button>Next <span class="fw-bold">&rightarrow;</span></button></div>'),Tt=k('<div class="col-6"></div>'),zt=k('<div class="row mb-3 pt-1 pb-1 sticky-top bg-white"><!> <!></div>');function Et(B,i){ne(i,!0);let r=w(i,"data",15);Ae(()=>{Se("left","questions",function(a,o){M()}),Se("right","questions",function(a,o){c()}),Se.setScope("questions")});function q(a){return r().deck.questions.findIndex(o=>o.id===a)}function M(){var a=q(i.currentQuestionId),o=r().deck.questions[a-1];o&&r(r().session.current_question_id=o.id,!0)}function c(){var a=q(i.currentQuestionId),o=r().deck.questions[a+1];o&&r(r().session.current_question_id=o.id,!0)}var n=zt(),f=g(n);{var v=a=>{var o=Ut(),b=g(o),m=_(()=>$(M));b.__click=function(...Q){e(m)?.apply(this,Q)},h(a,o)},C=a=>{var o=Dt();h(a,o)};V(f,a=>{r().session.current_question_id&&r().session.current_question_id!=r().deck.questions[0].id?a(v):a(C,!1)})}var U=A(f,2);{var p=a=>{var o=Rt(),b=g(o),m=_(()=>$(c));b.__click=function(...D){e(m)?.apply(this,D)};let Q;H(D=>Q=O(b,1,"btn btn-sm w-100",null,Q,D),[()=>({"btn-warning":i.currentQuestionContext.isAnswered,"btn-light":!i.currentQuestionContext.isAnswered})]),h(a,o)},x=a=>{var o=Tt();h(a,o)};V(U,a=>{r().session.current_question_id!=r().deck.questions[r().deck.questions.length-1].id?a(p):a(x,!1)})}h(B,n),ie()}re(["click"]);var Nt=k('<div class="col-lg-3 d-none d-lg-block"><!></div>'),Ot=k("<!> <!>",1),Ht=k('<div class="row"><div class="col mb-1"><p class="text-truncate"><button title="Toggle sidebar"><i class="bi bi-layout-sidebar"></i></button> <button title="Toggle answer shuffling"><i class="bi bi-shuffle"></i></button> <button title="Toggle exam mode"><i class="bi bi-exclamation-square"></i></button> <span> </span> <a class="text-reset text-decoration-none"><strong> </strong></a></p></div></div> <div class="row"><div class="col mb-1"><!> <!></div></div> <div class="row mt-3"><!> <div><!> <!></div></div>',1),Lt=k("<p>Loading ...</p>"),Wt=k(`<div style="
            position: fixed;
            top: -50px;
            left: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            overflow: hidden;
            pointer-events: none;"><!></div>`),jt=k("<!> <!> <!>",1);function Jt(B,i){ne(i,!0);const r=()=>vt(de,"$UserSettings",q),[q,M]=ut();var c=T(void 0),n=T(void 0),f=T(!1),v=T(""),C=T(0);const U=document.getElementById("appconfig").dataset;let p=_(()=>e(L)?!1:r().session_exam_mode),x=_(()=>r().session_show_sidebar),a=_(()=>r().session_exam_mode),o=_(()=>r().session_shuffle_answers),b=_(()=>r().session_multiple_answer_tries),m=_(()=>r().session_show_answer_stats),Q=_(()=>r().session_show_progress_bar);E(()=>{e(x),axios.put("/api/users/me/settings",{session_show_sidebar:e(x)}).then(function(t){}).catch(function(t){alert(t)})}),E(()=>{e(a),axios.put("/api/users/me/settings",{session_exam_mode:e(a)}).then(function(t){}).catch(function(t){alert(t)})}),E(()=>{e(o),axios.put("/api/users/me/settings",{session_shuffle_answers:e(o)}).then(function(t){}).catch(function(t){alert(t)})});let D=_(()=>s(n)?s(n).deck.questions.filter(t=>!t.is_invalid):null),y=_(()=>s(n)?s(n).session.answer_choices.find(t=>t.question_id===e(N)):null),F=_(()=>s(n)?s(n).session.answer_choices.filter(t=>e(D).some(({id:l})=>l===t.question_id)):null),P=_(()=>s(n)?s(n).deck.questions.find(t=>t.id===s(n).session.current_question_id):null),L=_(()=>s(n)?e(D).length===e(F).length:!1);E(()=>{e(L)&&u(p,!1)});let N=_(()=>s(n)?s(n).session.current_question_id:null);E(()=>{e(N),fe()});let X=_(()=>s(n)?!!e(y):!1);E(()=>{e(N)&&u(c,K(()=>z()),!0)});function z(){return{isAnswered:!!e(X),answerContext:e(P).answers.reduce((l,I)=>(l[I.id]={isCorrectAnswer:I.id===e(P).correct_answer_id,isSubmittedAnswer:e(y)?I.id===e(y).answer_id:!1,isSelectedAnswer:e(y)?I.id===e(y).answer_id:!1},l),{})}}let G=_(()=>s(n)?xt(e(D).length,e(F)):null),ee=_(()=>s(n)?s(n).deck.questions.length:0),te=_(()=>s(n)?s(n).deck.questions.findIndex(t=>t.id==s(n).session.current_question_id)+1:null);var W=T(-1);E(()=>{e(G),(()=>{if(e(G)){var t=e(G).correct;if(t<60){u(W,t,!0);return}if(s(W)===-1){u(W,t,!0);return}s(W)<60&&(u(W,t,!0),axios.get("/api/magic-gif").then(function(l){u(v,"magic-gifs/"+l.data.id)}).catch(function(l){})),U.magic==="1"&&t===100&&s(W)<100&&e(ee)>=10&&s(n).session.parent_session_id===null&&u(C,1)}})()}),Ae(()=>{axios.get("/api/sessions/"+i.id).then(function(t){u(n,t.data,!0)}).catch(function(t){alert(t)})});function ae(){return axios.get("/api/questions/"+e(P).id).then(function(t){var l=s(n).deck.questions.findIndex(j=>j.id===e(P).id),I=t.data;s(n).deck.questions[l]=I,ve(I)}).catch(function(t){alert(t)})}function ve(t){if(t.type!=="card"){var l=s(n).session.answer_choices.findIndex(I=>I.question_id===t.id);l!==-1&&(s(n).session.answer_choices[l].is_correct=s(n).session.answer_choices[l].answer_id===t.correct_answer_id)}}var Y;function fe(){Y&&Y.cancel(),Y=_t(()=>{axios.put("/api/sessions/"+s(n).session.id,s(n).session).then(function(t){}).catch(function(t){alert(t)})},1e3,{maxWait:2e3}),Y()}function _e(t){if(t&&t!==-1?s(c).answerContext[t].isSelectedAnswer=!0:s(c).isAnswered=!0,e(X)&&t&&t===e(P).correct_answer_id){s(c).isAnswered=!0;return}else if(e(X))return;var l=!1;e(P).type==="card"?(l=!!t,t===-1&&(t=null)):l=e(P).correct_answer_id===t,(l||e(p)||!e(b))&&(s(c).isAnswered=!0),t&&t!==-1&&(s(c).answerContext[t].isSubmittedAnswer=!0,s(c).answerContext[t].isCorrectAnswer=l);var I={question_id:e(N),answer_id:t,is_correct:l,help_used:s(f)};axios.post("/api/sessions/"+i.id+"/answerchoices",I).then(function(j){s(n).session.answer_choices=[...s(n).session.answer_choices,j.data]}).catch(function(j){alert(j)})}function ge(){e(X)&&(u(y,s(n).session.answer_choices.find(t=>t.question_id===e(N))),e(y)&&axios.delete("/api/sessions/"+i.id+"/answerchoices/"+e(y).id).then(function(t){s(n).session.answer_choices=[...s(n).session.answer_choices.filter(l=>l.question_id!==e(N))],lt().then(()=>{u(c,z(),!0)})}).catch(function(t){alert(t)}))}var oe=jt(),ce=se(oe);{var me=t=>{var l=Ht(),I=se(l),j=g(I),Je=g(j),be=g(Je);let Pe;var Ke=_(()=>$(()=>{Ce(de,K(r).session_show_sidebar=!r().session_show_sidebar,K(r))}));be.__click=function(...d){e(Ke)?.apply(this,d)};var we=A(be,2);let Ie;var Xe=_(()=>$(()=>{Ce(de,K(r).session_shuffle_answers=!r().session_shuffle_answers,K(r))}));we.__click=function(...d){e(Xe)?.apply(this,d)};var xe=A(we,2);let Me;var Ye=_(()=>$(()=>{Ce(de,K(r).session_exam_mode=!r().session_exam_mode,K(r))}));xe.__click=function(...d){e(Ye)?.apply(this,d)};var ke=A(xe,2);let Fe;var Ze=g(ke),Ge=A(ke,2),$e=g(Ge),et=g($e),Ve=A(I,2),tt=g(Ve),Be=g(tt);{var st=d=>{pt(d,{get progressPercentage(){return e(G)},set progressPercentage(R){u(G,R)}})};V(Be,d=>{!e(p)&&e(Q)&&(!e(L)||!s(c).isAnswered)&&d(st)})}var nt=A(Be,2);{var it=d=>{It(d,{get sessionId(){return s(n).session.id},get progressPercentage(){return e(G)},set progressPercentage(R){u(G,R)}})};V(nt,d=>{e(L)&&s(c).isAnswered&&d(it)})}var rt=A(Ve,2),Ue=g(rt);{var at=d=>{var R=Nt(),Z=g(R);Bt(Z,{get data(){return s(n)},set data(J){u(n,J,!0)},get examMode(){return e(p)},set examMode(J){u(p,J)}}),h(d,R)};V(Ue,d=>{e(x)&&d(at)})}var De=A(Ue,2);let Re;var Te=g(De);Et(Te,{get data(){return s(n)},set data(d){u(n,d,!0)},get currentQuestionId(){return s(n).session.current_question_id},set currentQuestionId(d){s(n).session.current_question_id=d},get currentQuestionContext(){return s(c)},set currentQuestionContext(d){u(c,d,!0)}});var ot=A(Te,2);{var ct=d=>{var R=Ot(),Z=se(R);wt(Z,{get deckId(){return s(n).deck.id},submitAnswer:_e,deleteAnswer:ge,updateCurrentQuestionData:ae,get question(){return e(P)},set question(S){u(P,S)},get questionContext(){return s(c)},set questionContext(S){u(c,S,!0)},get helpUsed(){return s(f)},set helpUsed(S){u(f,S,!0)},get answerChoice(){return e(y)},set answerChoice(S){u(y,S)},get examMode(){return e(p)},set examMode(S){u(p,S)},get settingsShuffleAnswers(){return e(o)},set settingsShuffleAnswers(S){u(o,S)},get settingsShowAnswerStats(){return e(m)},set settingsShowAnswerStats(S){u(m,S)}});var J=A(Z,2);{var qe=S=>{gt(S,{get questionId(){return e(P).id},set questionId(ye){e(P).id=ye},get questionContext(){return s(c)},set questionContext(ye){u(c,ye,!0)}})};V(J,S=>{e(p)||S(qe)})}h(d,R)};V(ot,d=>{e(P)&&d(ct)})}H((d,R,Z,J,qe)=>{Pe=O(be,1,"btn btn-sm d-none d-sm-none d-md-none d-lg-inline",null,Pe,d),Ie=O(we,1,"btn btn-sm",null,Ie,R),Me=O(xe,1,"btn btn-sm",null,Me,Z),Fe=O(ke,1,"ms-1 float-end fw-bold font-monospace badge",null,Fe,J),ue(Ze,`${e(te)??""}/${e(ee)??""}`),Qe(Ge,"href",`/sessions/${s(n).session.id??""}/edit`),ue(et,s(n).session.name),Re=O(De,1,"col-md-12 col-xl-8 col-xxl-6",null,Re,qe)},[()=>({"bg-light":!e(x),"bg-dark-subtle":e(x)}),()=>({"bg-light":!e(o),"bg-dark-subtle":e(o)}),()=>({"bg-light":!e(a),"bg-dark-subtle":e(a)}),()=>({"text-bg-light":!e(y)||e(p),"bg-success":!e(p)&&!e(P).is_invalid&&e(y)&&e(y).is_correct,"bg-danger":!e(p)&&!e(P).is_invalid&&e(y)&&!e(y).is_correct}),()=>({"col-lg-9":e(x),"col-lg-10":!e(x),"offset-lg-1":!e(x),"offset-xl-2":!e(x),"offset-xxl-3":!e(x)})]),h(t,l)},he=t=>{var l=Lt();h(t,l)};V(ce,t=>{s(n)?t(me):t(he,!1)})}var le=A(ce,2);{var pe=t=>{At(t,{get magicGIFPath(){return s(v)},set magicGIFPath(l){u(v,l,!0)}})};V(le,t=>{e(p)||t(pe)})}var We=A(le,2);{var je=t=>{var l=Wt(),I=g(l);yt(I,{x:[-5,5],y:[0,.1],delay:[100,3e3],infinite:!0,duration:"5000",amount:"200",fallDistance:"100vh"}),h(t,l)};V(We,t=>{s(C)&&t(je)})}h(B,oe),ie(),M()}re(["click"]);const Ne=document.getElementById("SessionView");dt(Jt,{target:Ne,props:{id:Ne.dataset.sessionId}});
