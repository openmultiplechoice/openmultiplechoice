import{S as Ue,i as Qe,s as Ge,e as je,a as N,n as le,d as U,k as Se,b as d,g as C,t as v,c as f,h as l,j,l as Z,p as ie,m as Ie,o as Te,u as Re,v as Ce,w as ye,x as qe,z as Pe,f as Ve,r as ot,H as ct,D as ze,y as at,E as ut,A as rt,B as dt,F as Ee}from"./index-CovtvcR3.js";import{e as De}from"./each-CtuGQY9F.js";import{s as ft}from"./StatsHelper-B91isISU.js";import{C as _t}from"./auto-DTdYmgno.js";import{f as Ae,p as Ne}from"./parseISO-Ds5nI7_t.js";import{U as Le}from"./UserSettingsStore-B1GYynLG.js";function mt(e){let t,n,s,i,o,a,u,h,k,m,p,g,w,S,c,_,M,r,b,q,L,I=Math.round(100*e[5]/e[6]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"",y,P,D,Q,B,F,A,W,G,E=Math.round(100*e[1]/e[6]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"",$,K,X,T,me,ee,z,pe,de,oe=Math.round(100*e[4]/e[5]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"",he,fe,ge,ce,be,x,te,ae,ke,_e=Math.round(100*e[3]/e[5]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"",ue,ve,Me,re,se,we,ne,O,R,V=Math.round(100*e[2]/e[5]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"",He,Be,Oe,Y=e[2]>0&&Fe(e);return{c(){t=d("div"),n=d("div"),s=d("canvas"),i=C(),o=d("div"),a=d("table"),u=d("thead"),h=C(),k=d("tbody"),m=d("tr"),p=d("td"),p.textContent="Questions",g=C(),w=d("td"),S=v(e[6]),c=C(),_=d("tr"),M=d("td"),M.textContent="Answered",r=C(),b=d("td"),q=v(e[5]),L=v(`
                            (`),y=v(I),P=v("%)"),D=C(),Q=d("tr"),B=d("td"),B.textContent="Unanswered",F=C(),A=d("td"),W=v(e[1]),G=v(`
                            (`),$=v(E),K=v("%)"),X=C(),T=d("tr"),me=d("td"),me.textContent="Correct",ee=C(),z=d("td"),pe=v(e[4]),de=v(`
                            (`),he=v(oe),fe=v("%)"),ge=C(),ce=d("tr"),be=d("td"),be.textContent="Correct with help",x=C(),te=d("td"),ae=v(e[3]),ke=v(`
                            (`),ue=v(_e),ve=v("%)"),Me=C(),re=d("tr"),se=d("td"),se.textContent="Incorrect",we=C(),ne=d("td"),O=v(e[2]),R=v(`
                            (`),He=v(V),Be=v("%)"),Oe=C(),Y&&Y.c(),f(n,"class","col-md-5"),f(w,"class","font-monospace text-end"),f(b,"class","font-monospace text-end"),f(A,"class","font-monospace text-end"),f(z,"class","font-monospace text-end"),f(te,"class","font-monospace text-end"),f(ne,"class","font-monospace text-end"),f(a,"class","table"),f(o,"class","col-md-7 mt-3"),f(t,"class","row mb-5")},m(H,J){N(H,t,J),l(t,n),l(n,s),e[15](s),l(t,i),l(t,o),l(o,a),l(a,u),l(a,h),l(a,k),l(k,m),l(m,p),l(m,g),l(m,w),l(w,S),l(k,c),l(k,_),l(_,M),l(_,r),l(_,b),l(b,q),l(b,L),l(b,y),l(b,P),l(k,D),l(k,Q),l(Q,B),l(Q,F),l(Q,A),l(A,W),l(A,G),l(A,$),l(A,K),l(k,X),l(k,T),l(T,me),l(T,ee),l(T,z),l(z,pe),l(z,de),l(z,he),l(z,fe),l(k,ge),l(k,ce),l(ce,be),l(ce,x),l(ce,te),l(te,ae),l(te,ke),l(te,ue),l(te,ve),l(k,Me),l(k,re),l(re,se),l(re,we),l(re,ne),l(ne,O),l(ne,R),l(ne,He),l(ne,Be),l(o,Oe),Y&&Y.m(o,null)},p(H,J){J&64&&j(S,H[6]),J&32&&j(q,H[5]),J&96&&I!==(I=Math.round(100*H[5]/H[6]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"")&&j(y,I),J&2&&j(W,H[1]),J&66&&E!==(E=Math.round(100*H[1]/H[6]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"")&&j($,E),J&16&&j(pe,H[4]),J&48&&oe!==(oe=Math.round(100*H[4]/H[5]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"")&&j(he,oe),J&8&&j(ae,H[3]),J&40&&_e!==(_e=Math.round(100*H[3]/H[5]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"")&&j(ue,_e),J&4&&j(O,H[2]),J&36&&V!==(V=Math.round(100*H[2]/H[5]).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"")&&j(He,V),H[2]>0?Y?Y.p(H,J):(Y=Fe(H),Y.c(),Y.m(o,null)):Y&&(Y.d(1),Y=null)},d(H){H&&U(t),e[15](null),Y&&Y.d()}}}function pt(e){let t,n,s,i,o,a,u,h;return{c(){t=d("div"),n=d("div"),s=d("p"),i=v("Number of questions in this module (duplicates included): "),o=d("span"),a=d("i"),u=C(),h=v(e[6]),f(a,"class","bi bi-collection"),f(o,"class","badge text-bg-secondary"),f(n,"class","col-md"),f(t,"class","row")},m(k,m){N(k,t,m),l(t,n),l(n,s),l(s,i),l(s,o),l(o,a),l(o,u),l(o,h)},p(k,m){m&64&&j(h,k[6])},d(k){k&&U(t)}}}function Fe(e){let t,n,s,i,o,a,u,h,k,m,p=e[2]>=40&&We(e),g=e[2]>=70&&Ye(e);return{c(){t=d("div"),p&&p.c(),n=C(),g&&g.c(),s=C(),i=d("button"),o=d("i"),a=v(" Repeat "),u=v(e[2]),h=v(" incorrect"),f(o,"class","bi bi-repeat"),f(i,"class","btn btn-sm btn-outline-secondary"),f(i,"type","button"),f(t,"class","d-grid gap-2")},m(w,S){N(w,t,S),p&&p.m(t,null),l(t,n),g&&g.m(t,null),l(t,s),l(t,i),l(i,o),l(i,a),l(i,u),l(i,h),k||(m=Z(i,"click",ie(e[18])),k=!0)},p(w,S){w[2]>=40?p?p.p(w,S):(p=We(w),p.c(),p.m(t,n)):p&&(p.d(1),p=null),w[2]>=70?g?g.p(w,S):(g=Ye(w),g.c(),g.m(t,s)):g&&(g.d(1),g=null),S&4&&j(u,w[2])},d(w){w&&U(t),p&&p.d(),g&&g.d(),k=!1,m()}}}function We(e){let t,n,s;return{c(){t=d("button"),t.innerHTML='<i class="bi bi-repeat"></i> Repeat 30 incorrect',f(t,"class","btn btn-sm btn-outline-secondary"),f(t,"type","button")},m(i,o){N(i,t,o),n||(s=Z(t,"click",ie(e[16])),n=!0)},p:le,d(i){i&&U(t),n=!1,s()}}}function Ye(e){let t,n,s;return{c(){t=d("button"),t.innerHTML='<i class="bi bi-repeat"></i> Repeat 60 incorrect',f(t,"class","btn btn-sm btn-outline-secondary"),f(t,"type","button")},m(i,o){N(i,t,o),n||(s=Z(t,"click",ie(e[17])),n=!0)},p:le,d(i){i&&U(t),n=!1,s()}}}function ht(e){let t;function n(o,a){return o[6]===o[1]?pt:mt}let s=n(e),i=s(e);return{c(){i.c(),t=je()},m(o,a){i.m(o,a),N(o,t,a)},p(o,[a]){s===(s=n(o))&&i?i.p(o,a):(i.d(1),i=s(o),i&&(i.c(),i.m(t.parentNode,t)))},i:le,o:le,d(o){o&&U(t),i.d(o)}}}function gt(e,t,n){let s,i,o,a,u,h,k,m,p,{questionsInModule:g}=t,{answerChoices:w}=t,{moduleId:S}=t,c,_;function M(I){const y={module_id:S,question_ids:I};axios.post("/api/sessions/newfromquestionids",y).then(function(P){window.location.href="/sessions/"+P.data.id}).catch(function(P){alert(P)})}function r(I){Se[I?"unshift":"push"](()=>{_=I,n(0,_)})}const b=()=>M(p.slice(0,30)),q=()=>M(p.slice(0,60)),L=()=>M(p);return e.$$set=I=>{"questionsInModule"in I&&n(9,g=I.questionsInModule),"answerChoices"in I&&n(10,w=I.answerChoices),"moduleId"in I&&n(11,S=I.moduleId)},e.$$.update=()=>{e.$$.dirty&512&&n(14,s=g.filter(I=>!I.is_invalid)),e.$$.dirty&17408&&n(13,i=w.filter(I=>s.some(({id:y})=>y===I.question_id))),e.$$.dirty&16384&&n(6,o=s.length),e.$$.dirty&8192&&n(5,a=i.length),e.$$.dirty&96&&n(1,u=o-a),e.$$.dirty&8192&&n(4,h=i.filter(I=>I.is_correct===1&&I.help_used===0).length),e.$$.dirty&8192&&n(3,k=i.filter(I=>I.is_correct===1&&I.help_used===1).length),e.$$.dirty&8192&&n(2,m=i.filter(I=>I.is_correct===0).length),e.$$.dirty&8192&&n(7,p=i.filter(I=>I.is_correct===0).map(I=>I.question_id)),e.$$.dirty&4127&&_&&(()=>{const I={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect","Unanswered"],datasets:[{label:"n",data:[h,k,m,u],backgroundColor:["#d4edda","#fff3cd","#f8d7da","#bbbbbb"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};c&&c.destroy();var y=_.getContext("2d");n(12,c=new _t(y,I))})()},[_,u,m,k,h,a,o,p,M,g,w,S,c,i,s,r,b,q,L]}class bt extends Ue{constructor(t){super(),Qe(this,t,gt,ht,Ge,{questionsInModule:9,answerChoices:10,moduleId:11})}}function Je(e,t,n){const s=e.slice();return s[15]=t[n],s}function Ke(e){let t;return{c(){t=d("p"),t.textContent="Loading ..."},m(n,s){N(n,t,s)},p:le,d(n){n&&U(t)}}}function kt(e){let t,n=Ae(Ne(e[15].created_at),"dd.MM.yyyy")+"",s;return{c(){t=d("span"),s=v(n),f(t,"class","badge text-bg-light")},m(i,o){N(i,t,o),l(t,s)},p(i,o){o&16&&n!==(n=Ae(Ne(i[15].created_at),"dd.MM.yyyy")+"")&&j(s,n)},d(i){i&&U(t)}}}function vt(e){let t,n=Ae(Ne(e[15].exam_at),"dd.MM.yyyy")+"",s;return{c(){t=d("span"),s=v(n),f(t,"class","badge text-bg-light")},m(i,o){N(i,t,o),l(t,s)},p(i,o){o&16&&n!==(n=Ae(Ne(i[15].exam_at),"dd.MM.yyyy")+"")&&j(s,n)},d(i){i&&U(t)}}}function Xe(e){let t,n=e[5][e[15].id]+"",s;return{c(){t=new ct(!1),s=je(),t.a=s},m(i,o){t.m(n,i,o),N(i,s,o)},p(i,o){o&48&&n!==(n=i[5][i[15].id]+"")&&t.p(n)},d(i){i&&(U(s),t.d())}}}function Ze(e){let t,n,s,i,o,a,u,h=e[15].questions.length+"",k,m,p,g,w,S,c,_,M,r=e[15].name+"",b,q,L,I,y,P,D,Q,B,F;function A(X,T){return X[15].exam_at?vt:kt}let W=A(e),G=W(e),E=e[5][e[15].id]&&Xe(e);function $(){return e[12](e[15])}function K(){return e[13](e[15])}return{c(){t=d("div"),n=d("div"),s=d("div"),G.c(),i=C(),o=d("span"),a=d("i"),u=C(),k=v(h),m=C(),E&&E.c(),p=C(),g=d("input"),c=C(),_=d("div"),M=d("h6"),b=v(r),q=C(),L=d("button"),L.innerHTML='<i class="bi bi-rocket-takeoff"></i> New session',I=C(),y=d("a"),P=v("Browse deck"),Q=C(),f(a,"class","bi bi-collection"),f(o,"class","badge text-bg-secondary"),f(o,"title","Number of questions"),f(g,"class","form-check-input float-end"),f(g,"type","checkbox"),g.value="",f(g,"id",w="selected"+e[15].id),g.checked=S=e[3].has(e[15].id),f(s,"class","card-header"),f(M,"class","card-title"),f(L,"type","button"),f(L,"class","btn btn-sm btn-primary"),f(y,"href",D="/decks/"+e[15].id),f(y,"class","card-link"),f(_,"class","card-body"),f(n,"class","card"),f(t,"class","col-lg-6 mb-1")},m(X,T){N(X,t,T),l(t,n),l(n,s),G.m(s,null),l(s,i),l(s,o),l(o,a),l(o,u),l(o,k),l(s,m),E&&E.m(s,null),l(s,p),l(s,g),l(n,c),l(n,_),l(_,M),l(M,b),l(_,q),l(_,L),l(_,I),l(_,y),l(y,P),l(t,Q),B||(F=[Z(g,"click",$),Z(L,"click",ie(K))],B=!0)},p(X,T){e=X,W===(W=A(e))&&G?G.p(e,T):(G.d(1),G=W(e),G&&(G.c(),G.m(s,i))),T&16&&h!==(h=e[15].questions.length+"")&&j(k,h),e[5][e[15].id]?E?E.p(e,T):(E=Xe(e),E.c(),E.m(s,p)):E&&(E.d(1),E=null),T&16&&w!==(w="selected"+e[15].id)&&f(g,"id",w),T&24&&S!==(S=e[3].has(e[15].id))&&(g.checked=S),T&16&&r!==(r=e[15].name+"")&&j(b,r),T&16&&D!==(D="/decks/"+e[15].id)&&f(y,"href",D)},d(X){X&&U(t),G.d(),E&&E.d(),B=!1,ot(F)}}}function wt(e){let t,n,s,i,o,a,u;function h(c){e[9](c)}function k(c){e[10](c)}function m(c){e[11](c)}let p={};e[0]!==void 0&&(p.moduleId=e[0]),e[7]!==void 0&&(p.questionsInModule=e[7]),e[6]!==void 0&&(p.answerChoices=e[6]),t=new bt({props:p}),Se.push(()=>Ie(t,"moduleId",h)),Se.push(()=>Ie(t,"questionsInModule",k)),Se.push(()=>Ie(t,"answerChoices",m));let g=De(e[4]),w=[];for(let c=0;c<g.length;c+=1)w[c]=Ze(Je(e,g,c));let S=null;return g.length||(S=Ke()),{c(){Te(t.$$.fragment),o=C();for(let c=0;c<w.length;c+=1)w[c].c();a=je(),S&&S.c()},m(c,_){Re(t,c,_),N(c,o,_);for(let M=0;M<w.length;M+=1)w[M]&&w[M].m(c,_);N(c,a,_),S&&S.m(c,_),u=!0},p(c,[_]){const M={};if(!n&&_&1&&(n=!0,M.moduleId=c[0],Ce(()=>n=!1)),!s&&_&128&&(s=!0,M.questionsInModule=c[7],Ce(()=>s=!1)),!i&&_&64&&(i=!0,M.answerChoices=c[6],Ce(()=>i=!1)),t.$set(M),_&62){g=De(c[4]);let r;for(r=0;r<g.length;r+=1){const b=Je(c,g,r);w[r]?w[r].p(b,_):(w[r]=Ze(b),w[r].c(),w[r].m(a.parentNode,a))}for(;r<w.length;r+=1)w[r].d(1);w.length=g.length,!g.length&&S?S.p(c,_):g.length?S&&(S.d(1),S=null):(S=Ke(),S.c(),S.m(a.parentNode,a))}},i(c){u||(ye(t.$$.fragment,c),u=!0)},o(c){qe(t.$$.fragment,c),u=!1},d(c){c&&(U(o),U(a)),Pe(t,c),Ve(w,c),S&&S.d(c)}}}function St(e,t,n){let s,i,o,{moduleId:a}=t,{createSession:u}=t,{selectDeck:h}=t,{userSelectedDecks:k}=t,m=[],p={};function g(r){if(!r){n(4,m=[]);return}axios.get("/api/decks?module="+r).then(function(b){n(4,m=b.data),m.sort(function(q,L){return q.exam_at===null?1:L.exam_at===null?-1:q.exam_at<L.exam_at?1:q.exam_at>L.exam_at?-1:0})}).catch(function(b){alert(b)})}function w(r){a=r,n(0,a)}function S(r){s=r,n(7,s),n(4,m)}function c(r){i=r,n(6,i),n(8,p),n(4,m)}const _=r=>h(r.id),M=r=>u(r.id);return e.$$set=r=>{"moduleId"in r&&n(0,a=r.moduleId),"createSession"in r&&n(1,u=r.createSession),"selectDeck"in r&&n(2,h=r.selectDeck),"userSelectedDecks"in r&&n(3,k=r.userSelectedDecks)},e.$$.update=()=>{e.$$.dirty&16&&n(7,s=(()=>{var r=[];return m.forEach(b=>r.push(...b.questions)),r})()),e.$$.dirty&16&&(()=>{if(m.length===0)return;const r=m.map(b=>"decks[]="+b.id);axios.get("/api/stats/sessionsfordecks?"+r.join("&")).then(function(b){n(8,p=b.data)}).catch(function(b){alert(b)})})(),e.$$.dirty&256&&n(6,i=(()=>{var r=[];for(const b in p)r.push(...p[b].answer_choices);return r.sort(function(b,q){return b.created_at<q.created_at}),r})()),e.$$.dirty&1&&g(a),e.$$.dirty&272&&n(5,o=(()=>{var r={};if(!p)return r;for(const q of m){if(!p[q.id]){r[q.id]="";continue}const L=p[q.id],I=L.deck.questions.filter(D=>!D.is_invalid),y=L.answer_choices.filter(D=>I.some(({id:Q})=>Q===D.question_id)),P=ft(I.length,y);var b='style="color: #721c24; background-color: #f8d7da;"';P.correct>=60&&(b='style="color: #155724; background-color: #d4edda;"'),r[q.id]="<span "+b+` class="badge" data-bs-toggle="popover" data-bs-title="Popover title" data-bs-content="And here's some..." title="Correct answers in percent">`+P.correct+" %</span>"}return r})())},[a,u,h,k,m,o,i,s,p,w,S,c,_,M]}class Dt extends Ue{constructor(t){super(),Qe(this,t,St,wt,Ge,{moduleId:0,createSession:1,selectDeck:2,userSelectedDecks:3})}}function $e(e){let t,n,s,i,o,a,u,h,k,m=e[1].length+"",p,g,w=e[1].length>1?"s":"",S,c,_,M=e[3].length+"",r,b,q=e[3].length>1?"s":"",L,I,y,P=e[2]?"excluded":"included",D,Q,B,F,A,W,G,E,$,K,X,T,me,ee,z,pe,de=e[3].length+"",oe,he,fe=e[3].length>1?"s":"",ge,ce,be,x,te,ae=e[5].length+"",ke,_e,ue=e[5].length>1?"s":"",ve,Me,re,se,we,ne,O=e[5].length>0&&xe(e);return{c(){t=d("div"),n=d("div"),s=d("div"),i=d("p"),i.textContent="Create your own super deck:",o=C(),a=d("p"),u=v("You have "),h=d("strong"),k=v("selected "),p=v(m),g=v(" deck"),S=v(w),c=v(`
                    with `),_=d("strong"),r=v(M),b=v(" question"),L=v(q),I=C(),O&&O.c(),y=v(`
                    (duplicates `),D=v(P),Q=v(")"),B=C(),F=d("div"),A=d("label"),A.textContent="Deck Name",W=C(),G=d("input"),E=C(),$=d("div"),K=d("input"),X=C(),T=d("label"),T.textContent="Filter out duplicates",me=C(),ee=d("div"),z=d("button"),pe=v("Create deck ("),oe=v(de),he=v(" question"),ge=v(fe),ce=v(")"),be=C(),x=d("button"),te=v("Create deck ("),ke=v(ae),_e=v(" image question"),ve=v(ue),Me=v(")"),re=C(),se=d("button"),se.textContent="Cancel",f(A,"for","name"),f(A,"class","form-label"),f(G,"type","text"),f(G,"class","form-control"),f(G,"id","name"),f(F,"class","mb-3"),f(K,"type","checkbox"),f(K,"class","form-check-input"),f(K,"id","checkboxRemoveDuplicates"),f(T,"class","form-check-label"),f(T,"for","checkboxRemoveDuplicates"),f($,"class","mb-3 form-check"),f(z,"class","btn btn-sm btn-primary"),f(x,"class","btn btn-sm btn-primary"),f(se,"class","btn btn-sm btn-link"),f(ee,"class","d-grid gap-2 d-md-block"),f(s,"class","alert alert-light"),f(s,"role","alert"),f(n,"class","col-md"),f(t,"class","row")},m(R,V){N(R,t,V),l(t,n),l(n,s),l(s,i),l(s,o),l(s,a),l(a,u),l(a,h),l(h,k),l(h,p),l(h,g),l(h,S),l(a,c),l(a,_),l(_,r),l(_,b),l(_,L),l(a,I),O&&O.m(a,null),l(a,y),l(a,D),l(a,Q),l(s,B),l(s,F),l(F,A),l(F,W),l(F,G),ze(G,e[4]),l(s,E),l(s,$),l($,K),K.checked=e[2],l($,X),l($,T),l(s,me),l(s,ee),l(ee,z),l(z,pe),l(z,oe),l(z,he),l(z,ge),l(z,ce),l(ee,be),l(ee,x),l(x,te),l(x,ke),l(x,_e),l(x,ve),l(x,Me),l(ee,re),l(ee,se),we||(ne=[Z(G,"input",e[6]),Z(G,"focus",It),Z(K,"change",e[7]),Z(z,"click",ie(e[8])),Z(x,"click",ie(e[9])),Z(se,"click",ie(e[10]))],we=!0)},p(R,V){V&2&&m!==(m=R[1].length+"")&&j(p,m),V&2&&w!==(w=R[1].length>1?"s":"")&&j(S,w),V&8&&M!==(M=R[3].length+"")&&j(r,M),V&8&&q!==(q=R[3].length>1?"s":"")&&j(L,q),R[5].length>0?O?O.p(R,V):(O=xe(R),O.c(),O.m(a,y)):O&&(O.d(1),O=null),V&4&&P!==(P=R[2]?"excluded":"included")&&j(D,P),V&16&&G.value!==R[4]&&ze(G,R[4]),V&4&&(K.checked=R[2]),V&8&&de!==(de=R[3].length+"")&&j(oe,de),V&8&&fe!==(fe=R[3].length>1?"s":"")&&j(ge,fe),V&32&&ae!==(ae=R[5].length+"")&&j(ke,ae),V&32&&ue!==(ue=R[5].length>1?"s":"")&&j(ve,ue)},d(R){R&&U(t),O&&O.d(),we=!1,ot(ne)}}}function xe(e){let t,n,s=e[5].length+"",i,o,a=e[5].length>1?"s":"",u,h;return{c(){t=v("/ "),n=d("strong"),i=v(s),o=v(" question"),u=v(a),h=v(" with images")},m(k,m){N(k,t,m),N(k,n,m),l(n,i),l(n,o),l(n,u),l(n,h)},p(k,m){m&32&&s!==(s=k[5].length+"")&&j(i,s),m&32&&a!==(a=k[5].length>1?"s":"")&&j(u,a)},d(k){k&&(U(t),U(n))}}}function Mt(e){let t,n=e[1].length>0&&$e(e);return{c(){n&&n.c(),t=je()},m(s,i){n&&n.m(s,i),N(s,t,i)},p(s,[i]){s[1].length>0?n?n.p(s,i):(n=$e(s),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:le,o:le,d(s){s&&U(t),n&&n.d(s)}}}function et(e,t){var n={name:e,question_ids:t};axios.post("/api/decks",n).then(function(s){window.location.href="/decks/"+s.data.id}).catch(function(s){alert(s)})}const It=e=>e.target.select();function Ct(e,t,n){let s,i,{userSelectedDecks:o}=t,a=[],u="My new super deck",h=!0;function k(){if(o.size===0){n(1,a=[]);return}const c=[...o].map(_=>"decks[]="+_);axios.get("/api/decks?"+c.join("&")).then(function(_){n(1,a=_.data)}).catch(function(_){alert(_)})}function m(){u=this.value,n(4,u)}function p(){h=this.checked,n(2,h)}const g=()=>et(u,s.map(c=>c.id)),w=()=>et(u,i.map(c=>c.id)),S=()=>n(0,o=new Set);return e.$$set=c=>{"userSelectedDecks"in c&&n(0,o=c.userSelectedDecks)},e.$$.update=()=>{e.$$.dirty&1&&k(),e.$$.dirty&6&&n(3,s=(()=>{var c=[];return a.forEach(_=>c.push(..._.questions)),h?[...new Map(c.map(_=>[_.id,_])).values()]:c})()),e.$$.dirty&6&&n(5,i=(()=>{var c=[];return a.forEach(_=>{_.questions.forEach(M=>{M.images.length>0&&c.push(M)})}),h?[...new Map(c.map(_=>[_.id,_])).values()]:c})())},[o,a,h,s,u,i,m,p,g,w,S]}class yt extends Ue{constructor(t){super(),Qe(this,t,Ct,Mt,Ge,{userSelectedDecks:0})}}function tt(e,t,n){const s=e.slice();return s[12]=t[n],s}function nt(e,t,n){const s=e.slice();return s[15]=t[n],s}function lt(e){let t,n,s=De(e[2]),i=[];for(let o=0;o<s.length;o+=1)i[o]=st(nt(e,s,o));return{c(){t=d("ul");for(let o=0;o<i.length;o+=1)i[o].c();n=C(),f(t,"class","list-group m-2 me-0")},m(o,a){N(o,t,a);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(t,null);l(t,n)},p(o,a){if(a&37){s=De(o[2]);let u;for(u=0;u<s.length;u+=1){const h=nt(o,s,u);i[u]?i[u].p(h,a):(i[u]=st(h),i[u].c(),i[u].m(t,n))}for(;u<i.length;u+=1)i[u].d(1);i.length=s.length}},d(o){o&&U(t),Ve(i,o)}}}function st(e){let t,n=e[15].name+"",s,i,o,a;function u(){return e[9](e[15])}return{c(){t=d("button"),s=v(n),f(t,"data-bs-target","#offcanvasModuleSelection"),f(t,"data-bs-dismiss","offcanvas"),f(t,"class",i="list-group-item list-group-item-action "+(e[0].last_module_id===e[15].id?"list-group-item-secondary":"list-group-item-light"))},m(h,k){N(h,t,k),l(t,s),o||(a=Z(t,"click",ie(u)),o=!0)},p(h,k){e=h,k&4&&n!==(n=e[15].name+"")&&j(s,n),k&5&&i!==(i="list-group-item list-group-item-action "+(e[0].last_module_id===e[15].id?"list-group-item-secondary":"list-group-item-light"))&&f(t,"class",i)},d(h){h&&U(t),o=!1,a()}}}function it(e){let t,n=e[12].name+"",s,i,o,a,u,h;function k(){return e[8](e[12])}let m=e[0].last_subject_id===e[12].id&&lt(e);return{c(){t=d("button"),s=v(n),o=C(),m&&m.c(),a=je(),f(t,"class",i="list-group-item list-group-item-action "+(e[0].last_subject_id===e[12].id?"list-group-item-dark":"list-group-item-light"))},m(p,g){N(p,t,g),l(t,s),N(p,o,g),m&&m.m(p,g),N(p,a,g),u||(h=Z(t,"click",ie(k)),u=!0)},p(p,g){e=p,g&2&&n!==(n=e[12].name+"")&&j(s,n),g&3&&i!==(i="list-group-item list-group-item-action "+(e[0].last_subject_id===e[12].id?"list-group-item-dark":"list-group-item-light"))&&f(t,"class",i),e[0].last_subject_id===e[12].id?m?m.p(e,g):(m=lt(e),m.c(),m.m(a.parentNode,a)):m&&(m.d(1),m=null)},d(p){p&&(U(t),U(o),U(a)),m&&m.d(p),u=!1,h()}}}function qt(e){let t;return{c(){t=d("p"),t.textContent="No module selected."},m(n,s){N(n,t,s)},p:le,i:le,o:le,d(n){n&&U(t)}}}function jt(e){let t,n,s;function i(a){e[11](a)}let o={moduleId:e[0].last_module_id,createSession:At,selectDeck:e[6]};return e[3]!==void 0&&(o.userSelectedDecks=e[3]),t=new Dt({props:o}),Se.push(()=>Ie(t,"userSelectedDecks",i)),{c(){Te(t.$$.fragment)},m(a,u){Re(t,a,u),s=!0},p(a,u){const h={};u&1&&(h.moduleId=a[0].last_module_id),!n&&u&8&&(n=!0,h.userSelectedDecks=a[3],Ce(()=>n=!1)),t.$set(h)},i(a){s||(ye(t.$$.fragment,a),s=!0)},o(a){qe(t.$$.fragment,a),s=!1},d(a){Pe(t,a)}}}function Lt(e){let t,n,s,i,o,a,u,h,k,m,p,g,w,S,c,_,M,r=De(e[1]),b=[];for(let D=0;D<r.length;D+=1)b[D]=it(tt(e,r,D));function q(D){e[10](D)}let L={};e[3]!==void 0&&(L.userSelectedDecks=e[3]),p=new yt({props:L}),Se.push(()=>Ie(p,"userSelectedDecks",q));const I=[jt,qt],y=[];function P(D,Q){return D[0].last_module_id?0:1}return c=P(e),_=y[c]=I[c](e),{c(){t=d("div"),t.innerHTML='<div class="col-12 d-grid mb-3"><button type="button" class="btn btn-sm btn-primary d-lg-none my-2" data-bs-toggle="offcanvas" data-bs-target="#offcanvasModuleSelection" aria-controls="offcanvasModuleSelection">Switch module</button></div>',n=C(),s=d("div"),i=d("div"),o=d("div"),o.innerHTML='<h5 id="offcanvasAddToDeckLabel">Choose subject and module</h5> <button type="button" class="btn-close text-reset" data-bs-target="#offcanvasModuleSelection" data-bs-dismiss="offcanvas" aria-label="Close"></button>',a=C(),u=d("div"),h=d("ul");for(let D=0;D<b.length;D+=1)b[D].c();k=C(),m=d("div"),Te(p.$$.fragment),w=C(),S=d("div"),_.c(),f(t,"class","row"),f(o,"class","offcanvas-header"),f(h,"class","list-group w-100"),f(u,"class","offcanvas-body"),f(i,"class","col-lg-4 offcanvas-lg offcanvas-start"),f(i,"tabindex","-1"),f(i,"id","offcanvasModuleSelection"),f(S,"class","row"),f(m,"class","col-12 col-lg-8"),f(s,"class","row")},m(D,Q){N(D,t,Q),N(D,n,Q),N(D,s,Q),l(s,i),l(i,o),l(i,a),l(i,u),l(u,h);for(let B=0;B<b.length;B+=1)b[B]&&b[B].m(h,null);l(s,k),l(s,m),Re(p,m,null),l(m,w),l(m,S),y[c].m(S,null),M=!0},p(D,[Q]){if(Q&55){r=De(D[1]);let A;for(A=0;A<r.length;A+=1){const W=tt(D,r,A);b[A]?b[A].p(W,Q):(b[A]=it(W),b[A].c(),b[A].m(h,null))}for(;A<b.length;A+=1)b[A].d(1);b.length=r.length}const B={};!g&&Q&8&&(g=!0,B.userSelectedDecks=D[3],Ce(()=>g=!1)),p.$set(B);let F=c;c=P(D),c===F?y[c].p(D,Q):(dt(),qe(y[F],1,1,()=>{y[F]=null}),at(),_=y[c],_?_.p(D,Q):(_=y[c]=I[c](D),_.c()),ye(_,1),_.m(S,null))},i(D){M||(ye(p.$$.fragment,D),ye(_),M=!0)},o(D){qe(p.$$.fragment,D),qe(_),M=!1},d(D){D&&(U(t),U(n),U(s)),Ve(b,D),Pe(p),y[c].d()}}}function At(e){var t={deck_id:e};axios.post("/api/sessions",t).then(function(n){window.location.href="/sessions/"+n.data.id}).catch(function(n){alert(n)})}function Nt(e,t,n){let s;ut(e,Le,c=>n(0,s=c));let i=[],o=[],a=[],u=new Set;rt(()=>{axios.get("/api/modules").then(function(c){var _=c.data;n(7,i=_.filter((r,b,q)=>b===q.findIndex(L=>L.id===r.id)).sort(function(r,b){return r.name>b.name?1:r.name<b.name?-1:0}));var M=i.map(r=>r.subject).filter(r=>!!r);n(1,o=M.filter((r,b,q)=>b===q.findIndex(L=>L.id===r.id)).sort(function(r,b){return r.name>b.name?1:r.name<b.name?-1:0}))}).catch(function(c){alert(c)})});function h(c){var _={last_subject_id:c,last_module_id:0};axios.put("/api/users/me/settings",_).then(function(M){Ee(Le,s.last_subject_id=c,s),Ee(Le,s.last_module_id=0,s)}).catch(function(M){alert(M)})}function k(c){var _={last_module_id:c};axios.put("/api/users/me/settings",_).then(function(M){Ee(Le,s.last_module_id=c,s)}).catch(function(M){alert(M)})}function m(c){u.has(c)?u.delete(c):u.add(c),n(3,u=new Set([...u]))}const p=c=>h(c.id),g=c=>k(c.id);function w(c){u=c,n(3,u)}function S(c){u=c,n(3,u)}return e.$$.update=()=>{e.$$.dirty&129&&(s.last_subject_id,n(2,a=i.filter(c=>s.last_subject_id?c.subject?c.subject.id===s.last_subject_id:!1:!0)))},[s,o,a,u,h,k,m,i,p,g,w,S]}class Ut extends Ue{constructor(t){super(),Qe(this,t,Nt,Lt,Ge,{})}}const Qt=document.getElementById("NewSessionView");new Ut({target:Qt});
