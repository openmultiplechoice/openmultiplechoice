import{p as te,a as d,s as R,k as Ne,b as ee,g as e,e as m,h as se,f as y,t as H,d as ne,r as s,i as _,c as Q,m as ue,u as v,j as Le,l as Re,v as E,o as ut,q as ft}from"./render-CYeZSKAW.js";import{o as Se}from"./index-client-Dbvf6pRw.js";import{i as B}from"./if-CpEGQhVh.js";import{a as Ae}from"./attributes-BHpBkK0Q.js";import{s as O}from"./class-BfJg_ovI.js";import{e as Oe,i as He,p as Y}from"./event-modifiers-Bgjah3RO.js";import{p as x,s as vt,a as _t,b as qe}from"./props-Cr_568BV.js";import{r as L}from"./legacy-client-DCyKqh61.js";import{p as gt,K as ye,d as mt}from"./hotkeys-js-Bzouew-W.js";import{s as ze}from"./style-BtOSwUPa.js";import{M as ht}from"./Messages-DjTUw1ox.js";import{b as pt}from"./this-YKSURJA9.js";import{C as bt}from"./auto-sRkgK8jz.js";import{S as wt}from"./SessionProgressBar-CIb8vS0g.js";import{h as xt}from"./html-DxqZuNW-.js";import{s as kt}from"./utils-CsCDY5_e.js";import{S as Ct}from"./SessionQuestionView-Gcuk2Dhb.js";import{s as qt}from"./StatsHelper-B91isISU.js";import{U as de}from"./UserSettingsStore-CciWWY8F.js";import"./_commonjsHelpers-CE1G-McA.js";import"./parseISO-NWqeT_ov.js";import"./formatDistance-C_vtkNGs.js";import"./QuestionForm-DPzeLodB.js";import"./input-B1KW1ttA.js";import"./select-BXowa35n.js";import"./lodash-d8dSvcKh.js";var yt=y('<div class="confetti svelte-rtt661"></div>'),St=y("<div></div>");function At(U,r){te(r,!0);const i=x(r,"size",3,10),k=x(r,"x",19,()=>[-.5,.5]),T=x(r,"y",19,()=>[.25,1]),a=x(r,"duration",3,2e3),n=x(r,"infinite",3,!1),h=x(r,"delay",19,()=>[0,50]),u=x(r,"colorRange",19,()=>[0,360]),C=x(r,"colorArray",19,()=>[]),M=x(r,"amount",3,50),p=x(r,"iterationCount",3,1),q=x(r,"fallDistance",3,"100px"),o=x(r,"rounded",3,!1),c=x(r,"cone",3,!1),b=x(r,"noGravity",3,!1),g=x(r,"xSpread",3,.15),P=x(r,"destroyOnComplete",3,!0),V=x(r,"disableForReducedMotion",3,!1);let S=R(!1);Se(()=>{!P()||n()||typeof p()=="string"||setTimeout(()=>d(S,!0),(a()+h()[1])*p())});function F(D,G){return Math.random()*(G-D)+D}function w(){return C().length?C()[Math.round(Math.random()*(C().length-1))]:`hsl(${Math.round(F(u()[0],u()[1]))}, 75%, 50%)`}var W=Ne(),N=ee(W);{var J=D=>{var G=St();let Z;Oe(G,21,()=>({length:M()}),He,(fe,K)=>{var ie=yt();H((ve,re,X,_e,ge,me,ae,oe,he,pe,ce)=>ze(ie,`
        --color: ${ve??""};
        --skew: ${re??""}deg,${X??""}deg;
        --rotation-xyz: ${_e??""}, ${ge??""}, ${me??""};
        --rotation-deg: ${ae??""}deg;
        --translate-y-multiplier: ${oe??""};
        --translate-x-multiplier: ${he??""};
        --scale: ${pe??""};
        --transition-delay: ${ce??""}ms;
        --transition-duration: ${n()?`calc(${a()}ms * var(--scale))`:`${a()}ms`};`),[w,()=>F(-45,45),()=>F(-45,45),()=>F(-10,10),()=>F(-10,10),()=>F(-10,10),()=>F(0,360),()=>F(T()[0],T()[1]),()=>F(k()[0],k()[1]),()=>.1*F(2,10),()=>F(h()[0],h()[1])]),m(fe,ie)}),H(()=>{Z=O(G,1,"confetti-holder svelte-rtt661",null,Z,{rounded:o(),cone:c(),"no-gravity":b(),"reduced-motion":V()}),ze(G,`
    --fall-distance: ${q()??""};
    --size: ${i()??""}px;
    --x-spread: ${1-g()};
    --transition-iteration-count: ${(n()?"infinite":p())??""};`)}),m(D,G)};B(N,D=>{e(S)||D(J)})}m(U,W),se()}var Qt=y('<div class="img-fullscreen d-flex justify-content-center align-items-center svelte-1ibqgr8"><img class="img-fluid svelte-1ibqgr8" alt="Magic GIF"/></div>');function Pt(U,r){let i=x(r,"magicGIFPath",3,"");var k=R(!0);function T(){d(k,!s(k))}var a=Ne(),n=ee(a);{var h=u=>{var C=Qt();C.__click=T;var M=_(C);H(()=>Ae(M,"src",`/${i()??""}`)),m(u,C)};B(n,u=>{i()&&s(k)&&u(h)})}m(U,a)}ne(["click"]);var It=y('<button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> Repeat incorrect</button>'),Mt=y('<div class="row mb-5"><div class="col-md"><canvas></canvas></div> <div class="col-md"><p class="mt-3 text-dark"><span class="fs-4 font-monospace"> </span> correct</p> <div class="d-grid gap-2"><a href="/sessions/create" class="btn btn-sm btn-primary"><i class="bi bi-rocket-takeoff"></i> New session</a> <!> <a href="/" class="btn btn-sm btn-outline-secondary">Home</a></div></div></div>');function Ft(U,r){te(r,!0);let i=R(void 0),k=R(void 0);L(()=>{e(i)&&(()=>{if(e(k))return;const b={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect"],datasets:[{label:"%",data:[r.progressPercentage.correct,r.progressPercentage.correctWithHelp,r.progressPercentage.incorrect],backgroundColor:["#198754","#ffc107","#dc3545"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};e(k)&&e(k).destroy();var g=e(i).getContext("2d");d(k,new bt(g,b),!0)})()});function T(b){axios.post("/api/sessions/"+b+"/newfromincorrect").then(function(g){window.location.href="/sessions/"+g.data.id}).catch(function(g){alert(g)})}var a=Mt(),n=_(a),h=_(n);pt(h,b=>d(i,b),()=>e(i));var u=Q(n,2),C=_(u),M=_(C),p=_(M),q=Q(C,2),o=Q(_(q),2);{var c=b=>{var g=It(),P=v(()=>Y(()=>T(r.sessionId)));g.__click=function(...V){e(P)?.apply(this,V)},m(b,g)};B(o,b=>{r.progressPercentage.incorrect>0&&b(c)})}H(()=>ue(p,`${r.progressPercentage.correct??""}%`)),m(U,a),se()}ne(["click"]);var Gt=y("<li><small><!> <!></small></li>"),Bt=y('<li class="svelte-ns1rbt">Loading ...</li>'),Tt=y('<div class="overflow-scroll" style="max-height: 75vh;"><ul class="list-group"></ul></div>');function Ut(U,r){te(r,!0);let i=x(r,"data",15),k=v(()=>i().session.current_question_id);Le(()=>{if(!e(k))return;let h=document.getElementById("questionLink"+e(k));kt(h)});let T=v(()=>function(h){var u=i().session.answer_choices.find(C=>C.question_id===h.id);return u?r.examMode?'<span class="text-dark fw-bold">&check;</span>':u.is_correct?u.help_used?'<span class="text-warning-dark fw-bold">&check;</span>':'<span class="text-success-dark fw-bold">&check;</span>':'<span class="text-danger-dark fw-bold">&cross;</span>':'<span class="text-dark fw-bold">&rightarrow;</span>'});var a=Tt(),n=_(a);Oe(n,21,()=>i().deck.questions,He,(h,u,C)=>{var M=Gt();M.__click=()=>i(i().session.current_question_id=e(u).id,!0);var p=_(M),q=_(p);xt(q,()=>e(T)(e(u)));var o=Q(q,2);{var c=g=>{var P=Re();H(V=>ue(P,V),[()=>gt.sanitize(e(u).text).replace(/<\/?[^>]+(>|$)/g,"")]),m(g,P)},b=g=>{var P=Re();P.nodeValue=`Question Nr. ${C+1}`,m(g,P)};B(o,g=>{e(u).text?g(c):g(b,!1)})}H(()=>{O(M,1,`list-group-item list-group-item-action text-truncate ${e(u).id===i().session.current_question_id?"list-group-item-dark":"list-group-item-light"}`,"svelte-ns1rbt"),Ae(M,"id",`questionLink${e(u).id??""}`)}),m(h,M)},h=>{var u=Bt();m(h,u)}),m(U,a),se()}ne(["click"]);var Vt=y('<div class="col-6"><button class="btn btn-sm btn-light w-100"><span class="fw-bold">&leftarrow;</span> Previous</button></div>'),Dt=y('<div class="col-6"></div>'),Rt=y('<div class="col-6"><button>Next <span class="fw-bold">&rightarrow;</span></button></div>'),zt=y('<div class="col-6"></div>'),Et=y('<div class="row mb-3 pt-1 pb-1 sticky-top bg-white"><!> <!></div>');function Nt(U,r){te(r,!0);let i=x(r,"data",15);Se(()=>{ye("left","questions",function(o,c){T()}),ye("right","questions",function(o,c){a()}),ye.setScope("questions")});function k(o){return i().deck.questions.findIndex(c=>c.id===o)}function T(){var o=k(r.currentQuestionId),c=i().deck.questions[o-1];c&&i(i().session.current_question_id=c.id,!0)}function a(){var o=k(r.currentQuestionId),c=i().deck.questions[o+1];c&&i(i().session.current_question_id=c.id,!0)}var n=Et(),h=_(n);{var u=o=>{var c=Vt(),b=_(c),g=v(()=>Y(T));b.__click=function(...P){e(g)?.apply(this,P)},m(o,c)},C=o=>{var c=Dt();m(o,c)};B(h,o=>{i().session.current_question_id&&i().session.current_question_id!=i().deck.questions[0].id?o(u):o(C,!1)})}var M=Q(h,2);{var p=o=>{var c=Rt(),b=_(c),g=v(()=>Y(a));b.__click=function(...V){e(g)?.apply(this,V)};let P;H(()=>P=O(b,1,"btn btn-sm w-100",null,P,{"btn-warning":r.currentQuestionContext.isAnswered,"btn-light":!r.currentQuestionContext.isAnswered})),m(o,c)},q=o=>{var c=zt();m(o,c)};B(M,o=>{i().session.current_question_id!=i().deck.questions[i().deck.questions.length-1].id?o(p):o(q,!1)})}m(U,n),se()}ne(["click"]);var Lt=y('<div class="col-lg-3 d-none d-lg-block"><!></div>'),Ot=y("<!> <!>",1),Ht=y('<div class="row"><div class="col mb-1"><p class="text-truncate"><button title="Toggle sidebar"><i class="bi bi-layout-sidebar"></i></button> <button title="Toggle answer shuffling"><i class="bi bi-shuffle"></i></button> <button title="Toggle exam mode"><i class="bi bi-exclamation-square"></i></button> <span> </span> <a class="text-reset text-decoration-none"><strong> </strong></a></p></div></div> <div class="row"><div class="col mb-1"><!> <!></div></div> <div class="row mt-3"><!> <div><!> <!></div></div>',1),Wt=y("<p>Loading ...</p>"),Kt=y(`<div style="
            position: fixed;
            top: -50px;
            left: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            overflow: hidden;
            pointer-events: none;"><!></div>`),jt=y("<!> <!> <!>",1);function Jt(U,r){te(r,!0);const i=()=>_t(de,"$UserSettings",k),[k,T]=vt();var a=R(void 0),n=R(void 0),h=R(!1),u=R(""),C=R(0);const M=document.getElementById("appconfig").dataset;let p=v(()=>e(W)?!1:i().session_exam_mode),q=v(()=>i().session_show_sidebar),o=v(()=>i().session_exam_mode),c=v(()=>i().session_shuffle_answers),b=v(()=>i().session_multiple_answer_tries),g=v(()=>i().session_show_answer_stats),P=v(()=>i().session_show_progress_bar);L(()=>{e(q),axios.put("/api/users/me/settings",{session_show_sidebar:e(q)}).then(function(t){}).catch(function(t){alert(t)})}),L(()=>{e(o),axios.put("/api/users/me/settings",{session_exam_mode:e(o)}).then(function(t){}).catch(function(t){alert(t)})}),L(()=>{e(c),axios.put("/api/users/me/settings",{session_shuffle_answers:e(c)}).then(function(t){}).catch(function(t){alert(t)})});let V=v(()=>s(n)?s(n).deck.questions.filter(t=>!t.is_invalid):null),S=v(()=>s(n)?s(n).session.answer_choices.find(t=>t.question_id===e(N)):null),F=v(()=>s(n)?s(n).session.answer_choices.filter(t=>e(V).some(({id:l})=>l===t.question_id)):null),w=v(()=>s(n)?s(n).deck.questions.find(t=>t.id===s(n).session.current_question_id):null),W=v(()=>s(n)?e(V).length===e(F).length:!1);L(()=>{e(W)&&d(p,!1)});let N=v(()=>s(n)?s(n).session.current_question_id:null);L(()=>{e(N),_e()});let J=v(()=>s(n)?!!e(S):!1);L(()=>{e(N)&&d(a,E(()=>D()),!0)});function D(){return{isAnswered:!!e(J),answerContext:e(w).answers.reduce((l,I)=>(l[I.id]={isCorrectAnswer:I.id===e(w).correct_answer_id,isSubmittedAnswer:e(S)?I.id===e(S).answer_id:!1,isSelectedAnswer:e(S)?I.id===e(S).answer_id:!1},l),{})}}let G=v(()=>s(n)?qt(e(V).length,e(F)):null),Z=v(()=>s(n)?s(n).deck.questions.length:0),fe=v(()=>s(n)?s(n).deck.questions.findIndex(t=>t.id==s(n).session.current_question_id)+1:null);var K=R(-1);L(()=>{e(G),(()=>{if(e(G)){var t=e(G).correct;if(t<60){d(K,t,!0);return}if(s(K)===-1){d(K,t,!0);return}s(K)<60&&(d(K,t,!0),axios.get("/api/magic-gif").then(function(l){d(u,"magic-gifs/"+l.data.id)}).catch(function(l){})),M.magic==="1"&&t===100&&s(K)<100&&e(Z)>=10&&s(n).session.parent_session_id===null&&d(C,1)}})()}),Se(()=>{axios.get("/api/sessions/"+r.id).then(function(t){d(n,t.data,!0)}).catch(function(t){alert(t)})});function ie(){return axios.get("/api/questions/"+e(w).id).then(function(t){var l=s(n).deck.questions.findIndex(j=>j.id===e(w).id),I=t.data;s(n).deck.questions[l]=I,re(I)}).catch(function(t){alert(t)})}Le(()=>{e(w)&&e(w).correct_answer_id&&(E(()=>ve()),d(a,E(()=>D()),!0))});function ve(){e(w)&&re(e(w))}function re(t){if(t.type!=="card"){var l=s(n).session.answer_choices.findIndex(I=>I.question_id===t.id);l!==-1&&(s(n).session.answer_choices[l].is_correct=s(n).session.answer_choices[l].answer_id===t.correct_answer_id)}}var X;function _e(){X&&X.cancel(),X=mt(()=>{axios.put("/api/sessions/"+s(n).session.id,s(n).session).then(function(t){}).catch(function(t){alert(t)})},1e3,{maxWait:2e3}),X()}function ge(t){if(t&&t!==-1?s(a).answerContext[t].isSelectedAnswer=!0:s(a).isAnswered=!0,e(J)&&t&&t===e(w).correct_answer_id){s(a).isAnswered=!0;return}else if(e(J))return;var l=!1;e(w).type==="card"?(l=!!t,t===-1&&(t=null)):l=e(w).correct_answer_id===t,(l||e(p)||!e(b))&&(s(a).isAnswered=!0),t&&t!==-1&&(s(a).answerContext[t].isSubmittedAnswer=!0,s(a).answerContext[t].isCorrectAnswer=l);var I={question_id:e(N),answer_id:t,is_correct:l,help_used:s(h)};axios.post("/api/sessions/"+r.id+"/answerchoices",I).then(function(j){s(n).session.answer_choices=[...s(n).session.answer_choices,j.data]}).catch(function(j){alert(j)})}function me(){e(J)&&(d(S,s(n).session.answer_choices.find(t=>t.question_id===e(N))),e(S)&&axios.delete("/api/sessions/"+r.id+"/answerchoices/"+e(S).id).then(function(t){s(n).session.answer_choices=[...s(n).session.answer_choices.filter(l=>l.question_id!==e(N))],ut().then(()=>{d(a,D(),!0)})}).catch(function(t){alert(t)}))}var ae=jt(),oe=ee(ae);{var he=t=>{var l=Ht(),I=ee(l),j=_(I),Je=_(j),be=_(Je);let Qe;var Xe=v(()=>Y(()=>{qe(de,E(i).session_show_sidebar=!i().session_show_sidebar,E(i))}));be.__click=function(...f){e(Xe)?.apply(this,f)};var we=Q(be,2);let Pe;var Ye=v(()=>Y(()=>{qe(de,E(i).session_shuffle_answers=!i().session_shuffle_answers,E(i))}));we.__click=function(...f){e(Ye)?.apply(this,f)};var xe=Q(we,2);let Ie;var Ze=v(()=>Y(()=>{qe(de,E(i).session_exam_mode=!i().session_exam_mode,E(i))}));xe.__click=function(...f){e(Ze)?.apply(this,f)};var ke=Q(xe,2);let Me;var $e=_(ke),Fe=Q(ke,2),et=_(Fe),tt=_(et),Ge=Q(I,2),st=_(Ge),Be=_(st);{var nt=f=>{wt(f,{get progressPercentage(){return e(G)},set progressPercentage(z){d(G,z)}})};B(Be,f=>{!e(p)&&e(P)&&(!e(W)||!s(a).isAnswered)&&f(nt)})}var it=Q(Be,2);{var rt=f=>{Ft(f,{get sessionId(){return s(n).session.id},get progressPercentage(){return e(G)},set progressPercentage(z){d(G,z)}})};B(it,f=>{e(W)&&s(a).isAnswered&&f(rt)})}var at=Q(Ge,2),Te=_(at);{var ot=f=>{var z=Lt(),le=_(z);Ut(le,{get data(){return s(n)},set data($){d(n,$,!0)},get examMode(){return e(p)},set examMode($){d(p,$)}}),m(f,z)};B(Te,f=>{e(q)&&f(ot)})}var Ue=Q(Te,2);let Ve;var De=_(Ue);Nt(De,{get data(){return s(n)},set data(f){d(n,f,!0)},get currentQuestionId(){return s(n).session.current_question_id},set currentQuestionId(f){s(n).session.current_question_id=f},get currentQuestionContext(){return s(a)},set currentQuestionContext(f){d(a,f,!0)}});var ct=Q(De,2);{var lt=f=>{var z=Ot(),le=ee(z);Ct(le,{get deckId(){return s(n).deck.id},submitAnswer:ge,deleteAnswer:me,updateCurrentQuestionData:ie,get question(){return e(w)},set question(A){d(w,A)},get questionContext(){return s(a)},set questionContext(A){d(a,A,!0)},get helpUsed(){return s(h)},set helpUsed(A){d(h,A,!0)},get answerChoice(){return e(S)},set answerChoice(A){d(S,A)},get examMode(){return e(p)},set examMode(A){d(p,A)},get settingsShuffleAnswers(){return e(c)},set settingsShuffleAnswers(A){d(c,A)},get settingsShowAnswerStats(){return e(g)},set settingsShowAnswerStats(A){d(g,A)}});var $=Q(le,2);{var dt=A=>{ht(A,{get questionId(){return e(w).id},set questionId(Ce){e(w).id=Ce},get questionContext(){return s(a)},set questionContext(Ce){d(a,Ce,!0)}})};B($,A=>{e(p)||A(dt)})}m(f,z)};B(ct,f=>{e(w)&&f(lt)})}H(()=>{Qe=O(be,1,"btn btn-sm d-none d-sm-none d-md-none d-lg-inline",null,Qe,{"bg-light":!e(q),"bg-dark-subtle":e(q)}),Pe=O(we,1,"btn btn-sm",null,Pe,{"bg-light":!e(c),"bg-dark-subtle":e(c)}),Ie=O(xe,1,"btn btn-sm",null,Ie,{"bg-light":!e(o),"bg-dark-subtle":e(o)}),Me=O(ke,1,"ms-1 float-end fw-bold font-monospace badge",null,Me,{"text-bg-light":!e(S)||e(p),"bg-success":!e(p)&&!e(w).is_invalid&&e(S)&&e(S).is_correct,"bg-danger":!e(p)&&!e(w).is_invalid&&e(S)&&!e(S).is_correct}),ue($e,`${e(fe)??""}/${e(Z)??""}`),Ae(Fe,"href",`/sessions/${s(n).session.id??""}/edit`),ue(tt,s(n).session.name),Ve=O(Ue,1,"col-md-12 col-xl-8 col-xxl-6",null,Ve,{"col-lg-9":e(q),"col-lg-10":!e(q),"offset-lg-1":!e(q),"offset-xl-2":!e(q),"offset-xxl-3":!e(q)})}),m(t,l)},pe=t=>{var l=Wt();m(t,l)};B(oe,t=>{s(n)?t(he):t(pe,!1)})}var ce=Q(oe,2);{var We=t=>{Pt(t,{get magicGIFPath(){return s(u)},set magicGIFPath(l){d(u,l,!0)}})};B(ce,t=>{e(p)||t(We)})}var Ke=Q(ce,2);{var je=t=>{var l=Kt(),I=_(l);At(I,{x:[-5,5],y:[0,.1],delay:[100,3e3],infinite:!0,duration:"5000",amount:"200",fallDistance:"100vh"}),m(t,l)};B(Ke,t=>{s(C)&&t(je)})}m(U,ae),se(),T()}ne(["click"]);const Ee=document.getElementById("SessionView");ft(Jt,{target:Ee,props:{id:Ee.dataset.sessionId}});
