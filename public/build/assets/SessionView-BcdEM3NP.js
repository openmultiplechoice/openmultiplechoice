import{p as te,a as d,s as T,j as Ne,b as ee,g as e,e as h,h as se,f as y,t as L,d as ne,q as s,i as _,c as Q,l as ue,u as f,k as Te,w as dt,v as E,n as ut,o as vt}from"./render-DmmYWkZq.js";import{o as Se}from"./index-client-CSM4NHHy.js";import{i as V}from"./if-qgMZekRM.js";import{a as Ae}from"./attributes-Cp2PrCir.js";import{s as H}from"./class-BfJg_ovI.js";import{e as Oe,i as He,p as Y}from"./event-modifiers-B-z6qf1-.js";import{p as x,a as ft,s as _t,b as qe}from"./props-Bo30g3de.js";import{r as N}from"./legacy-client-oIJ-7bi0.js";import{p as gt,d as mt}from"./purify.es-CmVf96vk.js";import{s as ze}from"./style-BtOSwUPa.js";import{M as ht}from"./Messages-BEqxCqHN.js";import{b as pt}from"./this-BZVWBAzr.js";import{C as bt}from"./auto-sRkgK8jz.js";import{S as wt}from"./SessionProgressBar-D__Om4z0.js";import{h as xt}from"./html-ChNwDKpL.js";import{h as ye}from"./QuestionForm-C-AyDNLf.js";import{S as kt}from"./SessionQuestionView-M3rg5awD.js";import{s as Ct}from"./StatsHelper-B91isISU.js";import{U as de}from"./UserSettingsStore-Ck4-ns3C.js";import"./_commonjsHelpers-CE1G-McA.js";import"./parseISO-BGu1X6cY.js";import"./formatDistance-C5pjvq49.js";import"./input-DNeqJamd.js";import"./select-C4dWo_UH.js";import"./lodash-d8dSvcKh.js";var qt=y('<div class="confetti svelte-rtt661"></div>'),yt=y("<div></div>");function St(U,r){te(r,!0);const i=x(r,"size",3,10),k=x(r,"x",19,()=>[-.5,.5]),B=x(r,"y",19,()=>[.25,1]),a=x(r,"duration",3,2e3),n=x(r,"infinite",3,!1),m=x(r,"delay",19,()=>[0,50]),u=x(r,"colorRange",19,()=>[0,360]),C=x(r,"colorArray",19,()=>[]),M=x(r,"amount",3,50),p=x(r,"iterationCount",3,1),q=x(r,"fallDistance",3,"100px"),o=x(r,"rounded",3,!1),c=x(r,"cone",3,!1),b=x(r,"noGravity",3,!1),g=x(r,"xSpread",3,.15),P=x(r,"destroyOnComplete",3,!0),D=x(r,"disableForReducedMotion",3,!1);let S=T(!1);Se(()=>{!P()||n()||typeof p()=="string"||setTimeout(()=>d(S,!0),(a()+m()[1])*p())});function F(R,G){return Math.random()*(G-R)+R}function w(){return C().length?C()[Math.round(Math.random()*(C().length-1))]:`hsl(${Math.round(F(u()[0],u()[1]))}, 75%, 50%)`}var W=Ne(),O=ee(W);{var K=R=>{var G=yt();let Z;Oe(G,21,()=>({length:M()}),He,(ve,j)=>{var ie=qt();L((fe,re,X,_e,ge,me,ae,oe,he,pe,ce)=>ze(ie,`
        --color: ${fe??""};
        --skew: ${re??""}deg,${X??""}deg;
        --rotation-xyz: ${_e??""}, ${ge??""}, ${me??""};
        --rotation-deg: ${ae??""}deg;
        --translate-y-multiplier: ${oe??""};
        --translate-x-multiplier: ${he??""};
        --scale: ${pe??""};
        --transition-delay: ${ce??""}ms;
        --transition-duration: ${n()?`calc(${a()}ms * var(--scale))`:`${a()}ms`};`),[w,()=>F(-45,45),()=>F(-45,45),()=>F(-10,10),()=>F(-10,10),()=>F(-10,10),()=>F(0,360),()=>F(B()[0],B()[1]),()=>F(k()[0],k()[1]),()=>.1*F(2,10),()=>F(m()[0],m()[1])]),h(ve,ie)}),L(()=>{Z=H(G,1,"confetti-holder svelte-rtt661",null,Z,{rounded:o(),cone:c(),"no-gravity":b(),"reduced-motion":D()}),ze(G,`
    --fall-distance: ${q()??""};
    --size: ${i()??""}px;
    --x-spread: ${1-g()};
    --transition-iteration-count: ${(n()?"infinite":p())??""};`)}),h(R,G)};V(O,R=>{e(S)||R(K)})}h(U,W),se()}var At=y('<div class="img-fullscreen d-flex justify-content-center align-items-center svelte-1ibqgr8"><img class="img-fluid svelte-1ibqgr8" alt="Magic GIF"/></div>');function Qt(U,r){let i=x(r,"magicGIFPath",3,"");var k=T(!0);function B(){d(k,!s(k))}var a=Ne(),n=ee(a);{var m=u=>{var C=At();C.__click=B;var M=_(C);L(()=>Ae(M,"src",`/${i()??""}`)),h(u,C)};V(n,u=>{i()&&s(k)&&u(m)})}h(U,a)}ne(["click"]);var Pt=y('<button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> Repeat incorrect</button>'),It=y('<div class="row mb-5"><div class="col-md"><canvas></canvas></div> <div class="col-md"><p class="mt-3 text-dark"><span class="fs-4 font-monospace"> </span> correct</p> <div class="d-grid gap-2"><a href="/sessions/create" class="btn btn-sm btn-primary"><i class="bi bi-rocket-takeoff"></i> New session</a> <!> <a href="/" class="btn btn-sm btn-outline-secondary">Home</a></div></div></div>');function Mt(U,r){te(r,!0);let i=T(void 0),k=T(void 0);N(()=>{e(i)&&(()=>{if(e(k))return;const b={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect"],datasets:[{label:"%",data:[r.progressPercentage.correct,r.progressPercentage.correctWithHelp,r.progressPercentage.incorrect],backgroundColor:["#198754","#ffc107","#dc3545"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};e(k)&&e(k).destroy();var g=e(i).getContext("2d");d(k,new bt(g,b),!0)})()});function B(b){axios.post("/api/sessions/"+b+"/newfromincorrect").then(function(g){window.location.href="/sessions/"+g.data.id}).catch(function(g){alert(g)})}var a=It(),n=_(a),m=_(n);pt(m,b=>d(i,b),()=>e(i));var u=Q(n,2),C=_(u),M=_(C),p=_(M),q=Q(C,2),o=Q(_(q),2);{var c=b=>{var g=Pt(),P=f(()=>Y(()=>B(r.sessionId)));g.__click=function(...D){e(P)?.apply(this,D)},h(b,g)};V(o,b=>{r.progressPercentage.incorrect>0&&b(c)})}L(()=>ue(p,`${r.progressPercentage.correct??""}%`)),h(U,a),se()}ne(["click"]);var Ft=y("<li><small><!> <!></small></li>"),Gt=y('<li class="svelte-ns1rbt">Loading ...</li>'),Vt=y('<div class="overflow-scroll" style="max-height: 85vh;"><ul class="list-group"></ul></div>');function Bt(U,r){te(r,!0);let i=x(r,"data",15),k=f(()=>i().session.current_question_id);N(()=>{e(k),(()=>{var m=document.getElementById("question"+e(k));m&&m.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})})()});let B=f(()=>function(m){var u=i().session.answer_choices.find(C=>C.question_id===m.id);return u?r.examMode?'<span class="text-dark fw-bold">&check;</span>':u.is_correct?u.help_used?'<span class="text-warning-dark fw-bold">&check;</span>':'<span class="text-success-dark fw-bold">&check;</span>':'<span class="text-danger-dark fw-bold">&cross;</span>':'<span class="text-dark fw-bold">&rightarrow;</span>'});var a=Vt(),n=_(a);Oe(n,21,()=>i().deck.questions,He,(m,u,C)=>{var M=Ft();M.__click=()=>i(i().session.current_question_id=e(u).id,!0);var p=_(M),q=_(p);xt(q,()=>e(B)(e(u)));var o=Q(q,2);{var c=g=>{var P=Te();L(D=>ue(P,D),[()=>gt.sanitize(e(u).text).replace(/<\/?[^>]+(>|$)/g,"")]),h(g,P)},b=g=>{var P=Te();P.nodeValue=`Question Nr. ${C+1}`,h(g,P)};V(o,g=>{e(u).text?g(c):g(b,!1)})}L(()=>{H(M,1,`list-group-item list-group-item-action text-truncate ${e(u).id===i().session.current_question_id?"list-group-item-dark":"list-group-item-light"}`,"svelte-ns1rbt"),Ae(M,"id",`question${e(u).id??""}`)}),h(m,M)},m=>{var u=Gt();h(m,u)}),h(U,a),se()}ne(["click"]);var Ut=y('<div class="col-6"><button class="btn btn-sm btn-light w-100"><span class="fw-bold">&leftarrow;</span> Previous</button></div>'),Dt=y('<div class="col-6"></div>'),Rt=y('<div class="col-6"><button>Next <span class="fw-bold">&rightarrow;</span></button></div>'),Tt=y('<div class="col-6"></div>'),zt=y('<div class="row mb-3 pt-1 pb-1 sticky-top bg-white"><!> <!></div>');function Et(U,r){te(r,!0);let i=x(r,"data",15);Se(()=>{ye("left","questions",function(o,c){B()}),ye("right","questions",function(o,c){a()}),ye.setScope("questions")});function k(o){return i().deck.questions.findIndex(c=>c.id===o)}function B(){var o=k(r.currentQuestionId),c=i().deck.questions[o-1];c&&i(i().session.current_question_id=c.id,!0)}function a(){var o=k(r.currentQuestionId),c=i().deck.questions[o+1];c&&i(i().session.current_question_id=c.id,!0)}var n=zt(),m=_(n);{var u=o=>{var c=Ut(),b=_(c),g=f(()=>Y(B));b.__click=function(...P){e(g)?.apply(this,P)},h(o,c)},C=o=>{var c=Dt();h(o,c)};V(m,o=>{i().session.current_question_id&&i().session.current_question_id!=i().deck.questions[0].id?o(u):o(C,!1)})}var M=Q(m,2);{var p=o=>{var c=Rt(),b=_(c),g=f(()=>Y(a));b.__click=function(...D){e(g)?.apply(this,D)};let P;L(()=>P=H(b,1,"btn btn-sm w-100",null,P,{"btn-warning":r.currentQuestionContext.isAnswered,"btn-light":!r.currentQuestionContext.isAnswered})),h(o,c)},q=o=>{var c=Tt();h(o,c)};V(M,o=>{i().session.current_question_id!=i().deck.questions[i().deck.questions.length-1].id?o(p):o(q,!1)})}h(U,n),se()}ne(["click"]);var Nt=y('<div class="col-lg-3 d-none d-lg-block"><!></div>'),Ot=y("<!> <!>",1),Ht=y('<div class="row"><div class="col mb-1"><p class="text-truncate"><button title="Toggle sidebar"><i class="bi bi-layout-sidebar"></i></button> <button title="Toggle answer shuffling"><i class="bi bi-shuffle"></i></button> <button title="Toggle exam mode"><i class="bi bi-exclamation-square"></i></button> <span> </span> <a class="text-reset text-decoration-none"><strong> </strong></a></p></div></div> <div class="row"><div class="col mb-1"><!> <!></div></div> <div class="row mt-3"><!> <div><!> <!></div></div>',1),Lt=y("<p>Loading ...</p>"),Wt=y(`<div style="
            position: fixed;
            top: -50px;
            left: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            overflow: hidden;
            pointer-events: none;"><!></div>`),jt=y("<!> <!> <!>",1);function Jt(U,r){te(r,!0);const i=()=>_t(de,"$UserSettings",k),[k,B]=ft();var a=T(void 0),n=T(void 0),m=T(!1),u=T(""),C=T(0);const M=document.getElementById("appconfig").dataset;let p=f(()=>e(W)?!1:i().session_exam_mode),q=f(()=>i().session_show_sidebar),o=f(()=>i().session_exam_mode),c=f(()=>i().session_shuffle_answers),b=f(()=>i().session_multiple_answer_tries),g=f(()=>i().session_show_answer_stats),P=f(()=>i().session_show_progress_bar);N(()=>{e(q),axios.put("/api/users/me/settings",{session_show_sidebar:e(q)}).then(function(t){}).catch(function(t){alert(t)})}),N(()=>{e(o),axios.put("/api/users/me/settings",{session_exam_mode:e(o)}).then(function(t){}).catch(function(t){alert(t)})}),N(()=>{e(c),axios.put("/api/users/me/settings",{session_shuffle_answers:e(c)}).then(function(t){}).catch(function(t){alert(t)})});let D=f(()=>s(n)?s(n).deck.questions.filter(t=>!t.is_invalid):null),S=f(()=>s(n)?s(n).session.answer_choices.find(t=>t.question_id===e(O)):null),F=f(()=>s(n)?s(n).session.answer_choices.filter(t=>e(D).some(({id:l})=>l===t.question_id)):null),w=f(()=>s(n)?s(n).deck.questions.find(t=>t.id===s(n).session.current_question_id):null),W=f(()=>s(n)?e(D).length===e(F).length:!1);N(()=>{e(W)&&d(p,!1)});let O=f(()=>s(n)?s(n).session.current_question_id:null);N(()=>{e(O),_e()});let K=f(()=>s(n)?!!e(S):!1);N(()=>{e(O)&&d(a,E(()=>R()),!0)});function R(){return{isAnswered:!!e(K),answerContext:e(w).answers.reduce((l,I)=>(l[I.id]={isCorrectAnswer:I.id===e(w).correct_answer_id,isSubmittedAnswer:e(S)?I.id===e(S).answer_id:!1,isSelectedAnswer:e(S)?I.id===e(S).answer_id:!1},l),{})}}let G=f(()=>s(n)?Ct(e(D).length,e(F)):null),Z=f(()=>s(n)?s(n).deck.questions.length:0),ve=f(()=>s(n)?s(n).deck.questions.findIndex(t=>t.id==s(n).session.current_question_id)+1:null);var j=T(-1);N(()=>{e(G),(()=>{if(e(G)){var t=e(G).correct;if(t<60){d(j,t,!0);return}if(s(j)===-1){d(j,t,!0);return}s(j)<60&&(d(j,t,!0),axios.get("/api/magic-gif").then(function(l){d(u,"magic-gifs/"+l.data.id)}).catch(function(l){})),M.magic==="1"&&t===100&&s(j)<100&&e(Z)>=10&&s(n).session.parent_session_id===null&&d(C,1)}})()}),Se(()=>{axios.get("/api/sessions/"+r.id).then(function(t){d(n,t.data,!0)}).catch(function(t){alert(t)})});function ie(){return axios.get("/api/questions/"+e(w).id).then(function(t){var l=s(n).deck.questions.findIndex(J=>J.id===e(w).id),I=t.data;s(n).deck.questions[l]=I,re(I)}).catch(function(t){alert(t)})}dt(()=>{e(w)&&e(w).correct_answer_id&&(E(()=>fe()),d(a,E(()=>R()),!0))});function fe(){e(w)&&re(e(w))}function re(t){if(t.type!=="card"){var l=s(n).session.answer_choices.findIndex(I=>I.question_id===t.id);l!==-1&&(s(n).session.answer_choices[l].is_correct=s(n).session.answer_choices[l].answer_id===t.correct_answer_id)}}var X;function _e(){X&&X.cancel(),X=mt(()=>{axios.put("/api/sessions/"+s(n).session.id,s(n).session).then(function(t){}).catch(function(t){alert(t)})},1e3,{maxWait:2e3}),X()}function ge(t){if(t&&t!==-1?s(a).answerContext[t].isSelectedAnswer=!0:s(a).isAnswered=!0,e(K)&&t&&t===e(w).correct_answer_id){s(a).isAnswered=!0;return}else if(e(K))return;var l=!1;e(w).type==="card"?(l=!!t,t===-1&&(t=null)):l=e(w).correct_answer_id===t,(l||e(p)||!e(b))&&(s(a).isAnswered=!0),t&&t!==-1&&(s(a).answerContext[t].isSubmittedAnswer=!0,s(a).answerContext[t].isCorrectAnswer=l);var I={question_id:e(O),answer_id:t,is_correct:l,help_used:s(m)};axios.post("/api/sessions/"+r.id+"/answerchoices",I).then(function(J){s(n).session.answer_choices=[...s(n).session.answer_choices,J.data]}).catch(function(J){alert(J)})}function me(){e(K)&&(d(S,s(n).session.answer_choices.find(t=>t.question_id===e(O))),e(S)&&axios.delete("/api/sessions/"+r.id+"/answerchoices/"+e(S).id).then(function(t){s(n).session.answer_choices=[...s(n).session.answer_choices.filter(l=>l.question_id!==e(O))],ut().then(()=>{d(a,R(),!0)})}).catch(function(t){alert(t)}))}var ae=jt(),oe=ee(ae);{var he=t=>{var l=Ht(),I=ee(l),J=_(I),Je=_(J),be=_(Je);let Qe;var Ke=f(()=>Y(()=>{qe(de,E(i).session_show_sidebar=!i().session_show_sidebar,E(i))}));be.__click=function(...v){e(Ke)?.apply(this,v)};var we=Q(be,2);let Pe;var Xe=f(()=>Y(()=>{qe(de,E(i).session_shuffle_answers=!i().session_shuffle_answers,E(i))}));we.__click=function(...v){e(Xe)?.apply(this,v)};var xe=Q(we,2);let Ie;var Ye=f(()=>Y(()=>{qe(de,E(i).session_exam_mode=!i().session_exam_mode,E(i))}));xe.__click=function(...v){e(Ye)?.apply(this,v)};var ke=Q(xe,2);let Me;var Ze=_(ke),Fe=Q(ke,2),$e=_(Fe),et=_($e),Ge=Q(I,2),tt=_(Ge),Ve=_(tt);{var st=v=>{wt(v,{get progressPercentage(){return e(G)},set progressPercentage(z){d(G,z)}})};V(Ve,v=>{!e(p)&&e(P)&&(!e(W)||!s(a).isAnswered)&&v(st)})}var nt=Q(Ve,2);{var it=v=>{Mt(v,{get sessionId(){return s(n).session.id},get progressPercentage(){return e(G)},set progressPercentage(z){d(G,z)}})};V(nt,v=>{e(W)&&s(a).isAnswered&&v(it)})}var rt=Q(Ge,2),Be=_(rt);{var at=v=>{var z=Nt(),le=_(z);Bt(le,{get data(){return s(n)},set data($){d(n,$,!0)},get examMode(){return e(p)},set examMode($){d(p,$)}}),h(v,z)};V(Be,v=>{e(q)&&v(at)})}var Ue=Q(Be,2);let De;var Re=_(Ue);Et(Re,{get data(){return s(n)},set data(v){d(n,v,!0)},get currentQuestionId(){return s(n).session.current_question_id},set currentQuestionId(v){s(n).session.current_question_id=v},get currentQuestionContext(){return s(a)},set currentQuestionContext(v){d(a,v,!0)}});var ot=Q(Re,2);{var ct=v=>{var z=Ot(),le=ee(z);kt(le,{get deckId(){return s(n).deck.id},submitAnswer:ge,deleteAnswer:me,updateCurrentQuestionData:ie,get question(){return e(w)},set question(A){d(w,A)},get questionContext(){return s(a)},set questionContext(A){d(a,A,!0)},get helpUsed(){return s(m)},set helpUsed(A){d(m,A,!0)},get answerChoice(){return e(S)},set answerChoice(A){d(S,A)},get examMode(){return e(p)},set examMode(A){d(p,A)},get settingsShuffleAnswers(){return e(c)},set settingsShuffleAnswers(A){d(c,A)},get settingsShowAnswerStats(){return e(g)},set settingsShowAnswerStats(A){d(g,A)}});var $=Q(le,2);{var lt=A=>{ht(A,{get questionId(){return e(w).id},set questionId(Ce){e(w).id=Ce},get questionContext(){return s(a)},set questionContext(Ce){d(a,Ce,!0)}})};V($,A=>{e(p)||A(lt)})}h(v,z)};V(ot,v=>{e(w)&&v(ct)})}L(()=>{Qe=H(be,1,"btn btn-sm d-none d-sm-none d-md-none d-lg-inline",null,Qe,{"bg-light":!e(q),"bg-dark-subtle":e(q)}),Pe=H(we,1,"btn btn-sm",null,Pe,{"bg-light":!e(c),"bg-dark-subtle":e(c)}),Ie=H(xe,1,"btn btn-sm",null,Ie,{"bg-light":!e(o),"bg-dark-subtle":e(o)}),Me=H(ke,1,"ms-1 float-end fw-bold font-monospace badge",null,Me,{"text-bg-light":!e(S)||e(p),"bg-success":!e(p)&&!e(w).is_invalid&&e(S)&&e(S).is_correct,"bg-danger":!e(p)&&!e(w).is_invalid&&e(S)&&!e(S).is_correct}),ue(Ze,`${e(ve)??""}/${e(Z)??""}`),Ae(Fe,"href",`/sessions/${s(n).session.id??""}/edit`),ue(et,s(n).session.name),De=H(Ue,1,"col-md-12 col-xl-8 col-xxl-6",null,De,{"col-lg-9":e(q),"col-lg-10":!e(q),"offset-lg-1":!e(q),"offset-xl-2":!e(q),"offset-xxl-3":!e(q)})}),h(t,l)},pe=t=>{var l=Lt();h(t,l)};V(oe,t=>{s(n)?t(he):t(pe,!1)})}var ce=Q(oe,2);{var Le=t=>{Qt(t,{get magicGIFPath(){return s(u)},set magicGIFPath(l){d(u,l,!0)}})};V(ce,t=>{e(p)||t(Le)})}var We=Q(ce,2);{var je=t=>{var l=Wt(),I=_(l);St(I,{x:[-5,5],y:[0,.1],delay:[100,3e3],infinite:!0,duration:"5000",amount:"200",fallDistance:"100vh"}),h(t,l)};V(We,t=>{s(C)&&t(je)})}h(U,ae),se(),B()}ne(["click"]);const Ee=document.getElementById("SessionView");vt(Jt,{target:Ee,props:{id:Ee.dataset.sessionId}});
