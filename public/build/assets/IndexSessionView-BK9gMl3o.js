import{S as ie,i as le,s as oe,k as ce,r as fe,c as _,u as ue,a as H,t as I,f as g,E as O,o as F,b as X,v as de,h as m,w as me,q as C,x as v,y as P,d as T,A as ge,l as Me,p as De,n as Y,e as _e,z as he,C as we,D as be,m as ye}from"./index-CW_84yAU.js";import{e as Z}from"./each-23V_io8F.js";import{S as ke}from"./SessionProgressBar-BE59Qe1D.js";import{s as ve}from"./StatsHelper-B91isISU.js";import{t as S,n as R,e as Se,g as $,m as x,a as q,b as Ie,p as ee,f as Oe}from"./parseISO-JEmvXouO.js";function E(r,e){const n=+S(r)-+S(e);return n<0?-1:n>0?1:n}function Pe(r,e,n){const[i,s]=R(n==null?void 0:n.in,r,e),c=i.getFullYear()-s.getFullYear(),a=i.getMonth()-s.getMonth();return c*12+a}function Xe(r){return e=>{const i=(r?Math[r]:Math.trunc)(e);return i===0?0:i}}function Te(r,e){return+S(r)-+S(e)}function He(r,e){const n=S(r,e==null?void 0:e.in);return n.setHours(23,59,59,999),n}function Ye(r,e){const n=S(r,e==null?void 0:e.in),i=n.getMonth();return n.setFullYear(n.getFullYear(),i+1,0),n.setHours(23,59,59,999),n}function Le(r,e){const n=S(r,e==null?void 0:e.in);return+He(n,e)==+Ye(n,e)}function Ne(r,e,n){const[i,s,c]=R(n==null?void 0:n.in,r,r,e),a=E(s,c),t=Math.abs(Pe(s,c));if(t<1)return 0;s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-a*t);let l=E(s,c)===-a;Le(i)&&t===1&&E(i,c)===1&&(l=!1);const o=a*(t-+l);return o===0?0:o}function ze(r,e,n){const i=Te(r,e)/1e3;return Xe(n==null?void 0:n.roundingMethod)(i)}function Ae(r,e,n){const i=Ie(),s=(n==null?void 0:n.locale)??i.locale??Se,c=2520,a=E(r,e);if(isNaN(a))throw new RangeError("Invalid time value");const t=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:a}),[l,o]=R(n==null?void 0:n.in,...a>0?[e,r]:[r,e]),u=ze(o,l),b=($(o)-$(l))/1e3,f=Math.round((u-b)/60);let w;if(f<2)return n!=null&&n.includeSeconds?u<5?s.formatDistance("lessThanXSeconds",5,t):u<10?s.formatDistance("lessThanXSeconds",10,t):u<20?s.formatDistance("lessThanXSeconds",20,t):u<40?s.formatDistance("halfAMinute",0,t):u<60?s.formatDistance("lessThanXMinutes",1,t):s.formatDistance("xMinutes",1,t):f===0?s.formatDistance("lessThanXMinutes",1,t):s.formatDistance("xMinutes",f,t);if(f<45)return s.formatDistance("xMinutes",f,t);if(f<90)return s.formatDistance("aboutXHours",1,t);if(f<x){const p=Math.round(f/60);return s.formatDistance("aboutXHours",p,t)}else{if(f<c)return s.formatDistance("xDays",1,t);if(f<q){const p=Math.round(f/x);return s.formatDistance("xDays",p,t)}else if(f<q*2)return w=Math.round(f/q),s.formatDistance("aboutXMonths",w,t)}if(w=Ne(o,l),w<12){const p=Math.round(f/q);return s.formatDistance("xMonths",p,t)}else{const p=w%12,y=Math.trunc(w/12);return p<3?s.formatDistance("aboutXYears",y,t):p<9?s.formatDistance("overXYears",y,t):s.formatDistance("almostXYears",y+1,t)}}function ne(r){let e,n,i;return{c(){e=_("button"),e.innerHTML='<i class="bi bi-repeat"></i> Repeat incorrect',g(e,"class","btn btn-sm btn-outline-secondary"),O(e,"--bs-btn-padding-y",".25rem"),O(e,"--bs-btn-padding-x",".5rem"),O(e,"--bs-btn-font-size",".75rem"),g(e,"type","button")},m(s,c){X(s,e,c),n||(i=Me(e,"click",De(r[6])),n=!0)},p:Y,d(s){s&&T(e),n=!1,i()}}}function Fe(r){let e,n,i,s,c,a,t,l=r[0].name+"",o,u,b,f,w,p,y,j,Q,k,L,N,V,U,G,z,A,B,J,M;function pe(d){r[5](d)}let K={};r[1]!==void 0&&(K.progressPercentage=r[1]),n=new ke({props:K}),ce.push(()=>fe(n,"progressPercentage",pe));let h=r[1].unanswered===0&&r[1].incorrect>0&&ne(r);return{c(){e=_("div"),ue(n.$$.fragment),s=H(),c=_("div"),a=_("div"),t=_("strong"),o=I(l),u=H(),b=_("div"),f=_("a"),w=_("i"),p=I(" Open"),j=H(),h&&h.c(),Q=H(),k=_("div"),L=_("span"),N=_("small"),V=I(r[3]),U=I(" ago"),G=H(),z=_("span"),A=_("small"),B=I(r[3]),J=I(" ago"),g(a,"class","col-md-4"),g(w,"class","bi bi-rocket-takeoff"),g(f,"href",y="/sessions/"+r[0].id),g(f,"class","btn btn-sm"),O(f,"--bs-btn-padding-y",".25rem"),O(f,"--bs-btn-padding-x",".5rem"),O(f,"--bs-btn-font-size",".75rem"),F(f,"btn-primary",r[1].unanswered),F(f,"btn-outline-secondary",!r[1].unanswered),g(b,"class","col-md-4"),g(L,"class","float-end d-none d-sm-none d-md-inline"),g(z,"class","d-inline d-sm-inline d-md-none"),g(k,"class","col-md-4"),g(k,"title",r[2]),g(c,"class","row mt-1"),g(e,"class","mt-3 mb-3")},m(d,D){X(d,e,D),de(n,e,null),m(e,s),m(e,c),m(c,a),m(a,t),m(t,o),m(c,u),m(c,b),m(b,f),m(f,w),m(f,p),m(b,j),h&&h.m(b,null),m(c,Q),m(c,k),m(k,L),m(L,N),m(N,V),m(N,U),m(k,G),m(k,z),m(z,A),m(A,B),m(A,J),M=!0},p(d,[D]){const W={};!i&&D&2&&(i=!0,W.progressPercentage=d[1],me(()=>i=!1)),n.$set(W),(!M||D&1)&&l!==(l=d[0].name+"")&&C(o,l),(!M||D&1&&y!==(y="/sessions/"+d[0].id))&&g(f,"href",y),(!M||D&2)&&F(f,"btn-primary",d[1].unanswered),(!M||D&2)&&F(f,"btn-outline-secondary",!d[1].unanswered),d[1].unanswered===0&&d[1].incorrect>0?h?h.p(d,D):(h=ne(d),h.c(),h.m(b,null)):h&&(h.d(1),h=null),(!M||D&8)&&C(V,d[3]),(!M||D&8)&&C(B,d[3]),(!M||D&4)&&g(k,"title",d[2])},i(d){M||(v(n.$$.fragment,d),M=!0)},o(d){P(n.$$.fragment,d),M=!1},d(d){d&&T(e),ge(n),h&&h.d()}}}function qe(r){axios.post("/api/sessions/"+r+"/newfromincorrect").then(function(e){window.location.href="/sessions/"+e.data.id}).catch(function(e){alert(e)})}function Ee(r,e,n){let i,s,c,a,{session:t}=e;function l(u){a=u,n(1,a),n(0,t),n(4,c)}const o=()=>qe(t.id);return r.$$set=u=>{"session"in u&&n(0,t=u.session)},r.$$.update=()=>{r.$$.dirty&1&&n(3,i=Ae(ee(t.created_at),new Date)),r.$$.dirty&1&&n(2,s=Oe(ee(t.created_at),"dd.MM.yyyy HH:mm")),r.$$.dirty&1&&n(4,c=t?t.deck.questions.filter(u=>!u.is_invalid):null),r.$$.dirty&17&&n(1,a=t?ve(c.length,t.answerchoices.filter(u=>c.some(({id:b})=>b===u.question_id))):null)},[t,a,s,i,c,l,o]}class Ve extends ie{constructor(e){super(),le(this,e,Ee,Fe,oe,{session:0})}}function se(r,e,n){const i=r.slice();return i[3]=e[n],i[4]=e,i[5]=n,i}function Be(r){let e;return{c(){e=_("div"),e.innerHTML='<div class="spinner-border text-secondary" role="status"><span class="visually-hidden">Loading sessions ...</span></div>',g(e,"class","d-flex justify-content-center")},m(n,i){X(n,e,i)},p:Y,i:Y,o:Y,d(n){n&&T(e)}}}function Ce(r){let e,n,i=Z(r[0]),s=[];for(let t=0;t<i.length;t+=1)s[t]=re(se(r,i,t));const c=t=>P(s[t],1,1,()=>{s[t]=null});let a=null;return i.length||(a=te()),{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=_e(),a&&a.c()},m(t,l){for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(t,l);X(t,e,l),a&&a.m(t,l),n=!0},p(t,l){if(l&1){i=Z(t[0]);let o;for(o=0;o<i.length;o+=1){const u=se(t,i,o);s[o]?(s[o].p(u,l),v(s[o],1)):(s[o]=re(u),s[o].c(),v(s[o],1),s[o].m(e.parentNode,e))}for(be(),o=i.length;o<s.length;o+=1)c(o);he(),!i.length&&a?a.p(t,l):i.length?a&&(a.d(1),a=null):(a=te(),a.c(),a.m(e.parentNode,e))}},i(t){if(!n){for(let l=0;l<i.length;l+=1)v(s[l]);n=!0}},o(t){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)P(s[l]);n=!1},d(t){t&&T(e),ye(s,t),a&&a.d(t)}}}function te(r){let e;return{c(){e=_("div"),e.innerHTML='No sessions yet <i class="bi bi-rocket"></i> ',g(e,"class","alert alert-light text-center"),g(e,"role","alert")},m(n,i){X(n,e,i)},p:Y,d(n){n&&T(e)}}}function re(r){let e,n,i;function s(a){r[2](a,r[3],r[4],r[5])}let c={};return r[3]!==void 0&&(c.session=r[3]),e=new Ve({props:c}),ce.push(()=>fe(e,"session",s)),{c(){ue(e.$$.fragment)},m(a,t){de(e,a,t),i=!0},p(a,t){r=a;const l={};!n&&t&1&&(n=!0,l.session=r[3],me(()=>n=!1)),e.$set(l)},i(a){i||(v(e.$$.fragment,a),i=!0)},o(a){P(e.$$.fragment,a),i=!1},d(a){ge(e,a)}}}function Re(r){let e,n,i,s;const c=[Ce,Be],a=[];function t(l,o){return l[0]?0:1}return e=t(r),n=a[e]=c[e](r),{c(){n.c(),i=_e()},m(l,o){a[e].m(l,o),X(l,i,o),s=!0},p(l,[o]){let u=e;e=t(l),e===u?a[e].p(l,o):(be(),P(a[u],1,1,()=>{a[u]=null}),he(),n=a[e],n?n.p(l,o):(n=a[e]=c[e](l),n.c()),v(n,1),n.m(i.parentNode,i))},i(l){s||(v(n),s=!0)},o(l){P(n),s=!1},d(l){l&&T(i),a[e].d(l)}}}function je(r,e,n){let{userId:i}=e;var s=void 0;we(()=>{axios.get("/api/sessions?take=15&user-id="+i).then(function(a){n(0,s=a.data)}).catch(function(a){alert(a)})});function c(a,t,l,o){l[o]=a,n(0,s)}return r.$$set=a=>{"userId"in a&&n(1,i=a.userId)},[s,i,c]}class Qe extends ie{constructor(e){super(),le(this,e,je,Re,oe,{userId:1})}}const ae=document.getElementById("IndexSessionView");new Qe({target:ae,props:{userId:ae.dataset.userId}});
