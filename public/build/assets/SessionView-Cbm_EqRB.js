import{p as ie,h as r,x as ft,n as je,b as ne,c as D,g as e,d as C,e as re,f as A,t as j,v as t,m as _,j as k,l as g,k as N,a as Ie,i as fe,s as P,u as q,o as Oe,q as T,r as vt}from"./lifecycle-BvmTvt_c.js";import{o as Me}from"./index-client-DUeXGvoC.js";import{b as Je,i as Ke,a as Pe,e as $,c as ue,p as ee}from"./event-modifiers-C9-V6teM.js";import{p as w,s as W,a as gt,b as _t,c as Ae}from"./props-DkMS-7Z0.js";import{p as He,d as mt}from"./purify.es-Dnvgf1Dd.js";import{s as Le}from"./style-BxdPOk1g.js";import{M as ht}from"./Messages-6lYDm7aV.js";import{b as pt}from"./this-DymA9FIw.js";import{C as We}from"./auto-g150VQ4A.js";import{S as bt}from"./SessionProgressBar-PoCQtOGQ.js";import{h as wt}from"./html-DWUw1S_J.js";import{h as Qe}from"./QuestionForm-DLV85khG.js";import{S as xt}from"./SessionQuestionView-JmJKNIRa.js";import{s as kt}from"./StatsHelper-B91isISU.js";import{U as de}from"./UserSettingsStore-CgXksdE5.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./parseISO-BjONWRSE.js";import"./formatDistance-DD1FqeGq.js";import"./input-CvY2ozlN.js";import"./select-DOPylVjq.js";import"./lodash-DjGC5Q8M.js";var yt=A('<div class="confetti svelte-rtt661"></div>'),Ct=A("<div></div>");function qt(z,o){ie(o,!0);const i=w(o,"size",3,10),I=w(o,"x",19,()=>[-.5,.5]),m=w(o,"y",19,()=>[.25,1]),d=w(o,"duration",3,2e3),h=w(o,"infinite",3,!1),S=w(o,"delay",19,()=>[0,50]),v=w(o,"colorRange",19,()=>[0,360]),u=w(o,"colorArray",19,()=>[]),B=w(o,"amount",3,50),Q=w(o,"iterationCount",3,1),U=w(o,"fallDistance",3,"100px"),p=w(o,"rounded",3,!1),R=w(o,"cone",3,!1),a=w(o,"noGravity",3,!1),c=w(o,"xSpread",3,.15),l=w(o,"destroyOnComplete",3,!0),x=w(o,"disableForReducedMotion",3,!1);let F=ft(!1);Me(()=>{!l()||h()||typeof Q()=="string"||setTimeout(()=>r(F,!0),(d()+S()[1])*Q())});function G(O,H){return Math.random()*(H-O)+O}function ae(){return u().length?u()[Math.round(Math.random()*(u().length-1))]:`hsl(${Math.round(G(v()[0],v()[1]))}, 75%, 50%)`}var X=je(),b=ne(X);{var n=O=>{var H=Ct();let te;Je(H,21,()=>({length:B()}),Ke,(se,ve)=>{var L=yt();j((ge,_e,Y,me,he,pe,oe,ce,be,we,le)=>Le(L,`
        --color: ${ge??""};
        --skew: ${_e??""}deg,${Y??""}deg;
        --rotation-xyz: ${me??""}, ${he??""}, ${pe??""};
        --rotation-deg: ${oe??""}deg;
        --translate-y-multiplier: ${ce??""};
        --translate-x-multiplier: ${be??""};
        --scale: ${we??""};
        --transition-delay: ${le??""}ms;
        --transition-duration: ${h()?`calc(${d()}ms * var(--scale))`:`${d()}ms`};`),[ae,()=>G(-45,45),()=>G(-45,45),()=>G(-10,10),()=>G(-10,10),()=>G(-10,10),()=>G(0,360),()=>G(m()[0],m()[1]),()=>G(I()[0],I()[1]),()=>.1*G(2,10),()=>G(S()[0],S()[1])]),C(se,L)}),j(se=>{te=W(H,1,"confetti-holder svelte-rtt661",null,te,se),Le(H,`
    --fall-distance: ${U()??""};
    --size: ${i()??""}px;
    --x-spread: ${1-c()};
    --transition-iteration-count: ${(h()?"infinite":Q())??""};`)},[()=>({rounded:p(),cone:R(),"no-gravity":a(),"reduced-motion":x()})]),C(O,H)};D(b,O=>{e(F)||O(n)})}C(z,X),re()}var St=A('<div class="img-fullscreen d-flex justify-content-center align-items-center svelte-1ibqgr8"><img class="img-fluid svelte-1ibqgr8" alt="Magic GIF"/></div>');function At(z,o){let i=w(o,"magicGIFPath",8,"");var I=_(!0);function m(){r(I,!t(I))}var d=je(),h=ne(d);{var S=v=>{var u=St(),B=k(u);j(()=>Pe(B,"src",`/${i()??""}`)),$("click",u,m),C(v,u)};D(h,v=>{i()&&t(I)&&v(S)})}C(z,d)}var Qt=A('<button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> Repeat incorrect</button>'),It=A('<div class="row mb-5"><div class="col-md"><canvas></canvas></div> <div class="col-md"><p class="mt-3 text-dark"><span class="fs-4 font-monospace"> </span> correct</p> <div class="d-grid gap-2"><a href="/sessions/create" class="btn btn-sm btn-primary"><i class="bi bi-rocket-takeoff"></i> New session</a> <!> <a href="/" class="btn btn-sm btn-outline-secondary">Home</a></div></div></div>');function Mt(z,o){ie(o,!1);let i=w(o,"progressPercentage",8),I=w(o,"sessionId",8),m=_(),d=_();function h(l){axios.post("/api/sessions/"+l+"/newfromincorrect").then(function(x){window.location.href="/sessions/"+x.data.id}).catch(function(x){alert(x)})}g(()=>(e(m),e(d),N(i()),We),()=>{e(m)&&(()=>{if(e(d))return;const l={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect"],datasets:[{label:"%",data:[i().correct,i().correctWithHelp,i().incorrect],backgroundColor:["#198754","#ffc107","#dc3545"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};e(d)&&e(d).destroy();var x=e(m).getContext("2d");r(d,new We(x,l))})()}),Ie(),fe();var S=It(),v=k(S),u=k(v);pt(u,l=>r(m,l),()=>e(m));var B=P(v,2),Q=k(B),U=k(Q),p=k(U),R=P(Q,2),a=P(k(R),2);{var c=l=>{var x=Qt();$("click",x,ee(()=>h(I()))),C(l,x)};D(a,l=>{N(i()),q(()=>i().incorrect>0)&&l(c)})}j(()=>ue(p,`${N(i()),q(()=>i().correct)??""}%`)),C(z,S),re()}var Pt=A("<li><small><!> <!></small></li>"),Ft=A('<li class="svelte-ns1rbt">Loading ...</li>'),Gt=A('<div class="overflow-scroll" style="max-height: 85vh;"><ul class="list-group"></ul></div>');function Vt(z,o){ie(o,!1);const i=_(),I=_();let m=w(o,"data",12),d=w(o,"examMode",8);g(()=>N(m()),()=>{r(i,m().session.current_question_id)}),g(()=>e(i),()=>{e(i),(()=>{var v=document.getElementById("question"+e(i));v&&v.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})})()}),g(()=>(N(m()),N(d())),()=>{r(I,function(v){var u=m().session.answer_choices.find(B=>B.question_id===v.id);return u?d()?'<span class="text-dark fw-bold">&check;</span>':u.is_correct?u.help_used?'<span class="text-warning-dark fw-bold">&check;</span>':'<span class="text-success-dark fw-bold">&check;</span>':'<span class="text-danger-dark fw-bold">&cross;</span>':'<span class="text-dark fw-bold">&rightarrow;</span>'})}),Ie(),fe();var h=Gt(),S=k(h);Je(S,5,()=>(N(m()),q(()=>m().deck.questions)),Ke,(v,u,B)=>{var Q=Pt(),U=k(Q),p=k(U);wt(p,()=>(e(I),e(u),q(()=>e(I)(e(u)))));var R=P(p,2);{var a=l=>{var x=Oe();j(F=>ue(x,F),[()=>(N(He),e(u),q(()=>He.sanitize(e(u).text).replace(/<\/?[^>]+(>|$)/g,"")))]),C(l,x)},c=l=>{var x=Oe();x.nodeValue=`Question Nr. ${B+1}`,C(l,x)};D(R,l=>{e(u),q(()=>e(u).text)?l(a):l(c,!1)})}j(()=>{W(Q,1,`list-group-item list-group-item-action text-truncate ${e(u),N(m()),q(()=>e(u).id===m().session.current_question_id?"list-group-item-dark":"list-group-item-light")??""}`,"svelte-ns1rbt"),Pe(Q,"id",`question${e(u),q(()=>e(u).id)??""}`)}),$("click",Q,()=>m(m().session.current_question_id=e(u).id,!0)),C(v,Q)},v=>{var u=Ft();C(v,u)}),C(z,h),re()}var Bt=A('<div class="col-6"><button class="btn btn-sm btn-light w-100"><span class="fw-bold">&leftarrow;</span> Previous</button></div>'),Ut=A('<div class="col-6"></div>'),Dt=A('<div class="col-6"><button>Next <span class="fw-bold">&rightarrow;</span></button></div>'),Rt=A('<div class="col-6"></div>'),Tt=A('<div class="row mb-3 pt-1 pb-1 sticky-top bg-white"><!> <!></div>');function zt(z,o){ie(o,!1);let i=w(o,"data",12),I=w(o,"currentQuestionId",8),m=w(o,"currentQuestionContext",8);Me(()=>{Qe("left","questions",function(a,c){h()}),Qe("right","questions",function(a,c){S()}),Qe.setScope("questions")});function d(a){return i().deck.questions.findIndex(c=>c.id===a)}function h(){var a=d(I()),c=i().deck.questions[a-1];c&&i(i().session.current_question_id=c.id,!0)}function S(){var a=d(I()),c=i().deck.questions[a+1];c&&i(i().session.current_question_id=c.id,!0)}fe();var v=Tt(),u=k(v);{var B=a=>{var c=Bt(),l=k(c);$("click",l,ee(h)),C(a,c)},Q=a=>{var c=Ut();C(a,c)};D(u,a=>{N(i()),q(()=>i().session.current_question_id&&i().session.current_question_id!=i().deck.questions[0].id)?a(B):a(Q,!1)})}var U=P(u,2);{var p=a=>{var c=Dt(),l=k(c);let x;j(F=>x=W(l,1,"btn btn-sm w-100",null,x,F),[()=>({"btn-warning":m().isAnswered,"btn-light":!m().isAnswered})]),$("click",l,ee(S)),C(a,c)},R=a=>{var c=Rt();C(a,c)};D(U,a=>{N(i()),q(()=>i().session.current_question_id!=i().deck.questions[i().deck.questions.length-1].id)?a(p):a(R,!1)})}C(z,v),re()}var Et=A('<div class="col-lg-3 d-none d-lg-block"><!></div>'),Nt=A("<!> <!>",1),Ot=A('<div class="row"><div class="col mb-1"><p class="text-truncate"><button title="Toggle sidebar"><i class="bi bi-layout-sidebar"></i></button> <button title="Toggle answer shuffling"><i class="bi bi-shuffle"></i></button> <button title="Toggle exam mode"><i class="bi bi-exclamation-square"></i></button> <span> </span> <a class="text-reset text-decoration-none"><strong> </strong></a></p></div></div> <div class="row"><div class="col mb-1"><!> <!></div></div> <div class="row mt-3"><!> <div><!> <!></div></div>',1),Ht=A("<p>Loading ...</p>"),Lt=A(`<div style="
            position: fixed;
            top: -50px;
            left: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            overflow: hidden;
            pointer-events: none;"><!></div>`),Wt=A("<!> <!> <!>",1);function $t(z,o){ie(o,!1);const i=()=>gt(de,"$UserSettings",I),[I,m]=_t(),d=_(),h=_(),S=_(),v=_(),u=_(),B=_(),Q=_(),U=_(),p=_(),R=_(),a=_(),c=_(),l=_(),x=_(),F=_(),G=_(),ae=_();let X=w(o,"id",8);var b=_(),n=_(),O=_(!1),H=_(""),te=_(0);const se=document.getElementById("appconfig").dataset;function ve(){return{isAnswered:!!e(x),answerContext:e(a).answers.reduce((f,V)=>(f[V.id]={isCorrectAnswer:V.id===e(a).correct_answer_id,isSubmittedAnswer:e(p)?V.id===e(p).answer_id:!1,isSelectedAnswer:e(p)?V.id===e(p).answer_id:!1},f),{})}}var L=_(-1);Me(()=>{axios.get("/api/sessions/"+X()).then(function(s){r(n,s.data)}).catch(function(s){alert(s)})});function ge(){return axios.get("/api/questions/"+e(a).id).then(function(s){var f=t(n).deck.questions.findIndex(J=>J.id===e(a).id),V=s.data;T(n,t(n).deck.questions[f]=V),_e(V)}).catch(function(s){alert(s)})}function _e(s){if(s.type!=="card"){var f=t(n).session.answer_choices.findIndex(V=>V.question_id===s.id);f!==-1&&T(n,t(n).session.answer_choices[f].is_correct=t(n).session.answer_choices[f].answer_id===s.correct_answer_id)}}var Y;function me(){Y&&Y.cancel(),Y=mt(()=>{axios.put("/api/sessions/"+t(n).session.id,t(n).session).then(function(s){}).catch(function(s){alert(s)})},1e3,{maxWait:2e3}),Y()}function he(s){if(s&&s!==-1?T(b,t(b).answerContext[s].isSelectedAnswer=!0):T(b,t(b).isAnswered=!0),e(x)&&s&&s===e(a).correct_answer_id){T(b,t(b).isAnswered=!0);return}else if(e(x))return;var f=!1;e(a).type==="card"?(f=!!s,s===-1&&(s=null)):f=e(a).correct_answer_id===s,(f||e(d)||!e(u))&&T(b,t(b).isAnswered=!0),s&&s!==-1&&(T(b,t(b).answerContext[s].isSubmittedAnswer=!0),T(b,t(b).answerContext[s].isCorrectAnswer=f));var V={question_id:e(l),answer_id:s,is_correct:f,help_used:t(O)};axios.post("/api/sessions/"+X()+"/answerchoices",V).then(function(J){T(n,t(n).session.answer_choices=[...t(n).session.answer_choices,J.data])}).catch(function(J){alert(J)})}function pe(){e(x)&&(r(p,t(n).session.answer_choices.find(s=>s.question_id===e(l))),e(p)&&axios.delete("/api/sessions/"+X()+"/answerchoices/"+e(p).id).then(function(s){T(n,t(n).session.answer_choices=[...t(n).session.answer_choices.filter(f=>f.question_id!==e(l))]),vt().then(()=>{r(b,ve())})}).catch(function(s){alert(s)}))}g(()=>t(n),()=>{r(U,t(n)?t(n).deck.questions.filter(s=>!s.is_invalid):null)}),g(()=>(t(n),e(U)),()=>{r(R,t(n)?t(n).session.answer_choices.filter(s=>e(U).some(({id:f})=>f===s.question_id)):null)}),g(()=>(t(n),e(U),e(R)),()=>{r(c,t(n)?e(U).length===e(R).length:!1)}),g(()=>(e(c),i()),()=>{r(d,e(c)?!1:i().session_exam_mode)}),g(()=>i(),()=>{r(h,i().session_show_sidebar)}),g(()=>i(),()=>{r(S,i().session_exam_mode)}),g(()=>i(),()=>{r(v,i().session_shuffle_answers)}),g(()=>i(),()=>{r(u,i().session_multiple_answer_tries)}),g(()=>i(),()=>{r(B,i().session_show_answer_stats)}),g(()=>i(),()=>{r(Q,i().session_show_progress_bar)}),g(()=>e(h),()=>{e(h),axios.put("/api/users/me/settings",{session_show_sidebar:e(h)}).then(function(s){}).catch(function(s){alert(s)})}),g(()=>e(S),()=>{e(S),axios.put("/api/users/me/settings",{session_exam_mode:e(S)}).then(function(s){}).catch(function(s){alert(s)})}),g(()=>e(v),()=>{e(v),axios.put("/api/users/me/settings",{session_shuffle_answers:e(v)}).then(function(s){}).catch(function(s){alert(s)})}),g(()=>t(n),()=>{r(l,t(n)?t(n).session.current_question_id:null)}),g(()=>(t(n),e(l)),()=>{r(p,t(n)?t(n).session.answer_choices.find(s=>s.question_id===e(l)):null)}),g(()=>t(n),()=>{r(a,t(n)?t(n).deck.questions.find(s=>s.id===t(n).session.current_question_id):null)}),g(()=>e(c),()=>{e(c)&&r(d,!1)}),g(()=>e(l),()=>{e(l),me()}),g(()=>(t(n),e(p)),()=>{r(x,t(n)?!!e(p):!1)}),g(()=>e(l),()=>{e(l)&&r(b,ve())}),g(()=>(t(n),e(U),e(R)),()=>{r(F,t(n)?kt(e(U).length,e(R)):null)}),g(()=>t(n),()=>{r(G,t(n)?t(n).deck.questions.length:0)}),g(()=>t(n),()=>{r(ae,t(n)?t(n).deck.questions.findIndex(s=>s.id==t(n).session.current_question_id)+1:null)}),g(()=>(e(F),t(L),e(G),t(n)),()=>{e(F),(()=>{if(e(F)){var s=e(F).correct;if(s<60){r(L,s);return}if(t(L)===-1){r(L,s);return}t(L)<60&&(r(L,s),axios.get("/api/magic-gif").then(function(f){r(H,"magic-gifs/"+f.data.id)}).catch(function(f){})),se.magic==="1"&&s===100&&t(L)<100&&e(G)>=10&&t(n).session.parent_session_id===null&&r(te,1)}})()}),Ie(),fe();var oe=Wt(),ce=ne(oe);{var be=s=>{var f=Ot(),V=ne(f),J=k(V),et=k(J),xe=k(et);let Fe;var ke=P(xe,2);let Ge;var ye=P(ke,2);let Ve;var Ce=P(ye,2);let Be;var tt=k(Ce),Ue=P(Ce,2),st=k(Ue),nt=k(st),De=P(V,2),it=k(De),Re=k(it);{var rt=y=>{bt(y,{get progressPercentage(){return e(F)},set progressPercentage(E){r(F,E)},$$legacy:!0})};D(Re,y=>{e(d),e(Q),e(c),t(b),q(()=>!e(d)&&e(Q)&&(!e(c)||!t(b).isAnswered))&&y(rt)})}var at=P(Re,2);{var ot=y=>{Mt(y,{get sessionId(){return t(n),q(()=>t(n).session.id)},get progressPercentage(){return e(F)},set progressPercentage(E){r(F,E)},$$legacy:!0})};D(at,y=>{e(c),t(b),q(()=>e(c)&&t(b).isAnswered)&&y(ot)})}var ct=P(De,2),Te=k(ct);{var lt=y=>{var E=Et(),Z=k(E);Vt(Z,{get data(){return t(n)},set data(K){r(n,K)},get examMode(){return e(d)},set examMode(K){r(d,K)},$$legacy:!0}),C(y,E)};D(Te,y=>{e(h)&&y(lt)})}var ze=P(Te,2);let Ee;var Ne=k(ze);zt(Ne,{get data(){return t(n)},set data(y){r(n,y)},get currentQuestionId(){return t(n).session.current_question_id},set currentQuestionId(y){T(n,t(n).session.current_question_id=y)},get currentQuestionContext(){return t(b)},set currentQuestionContext(y){r(b,y)},$$legacy:!0});var dt=P(Ne,2);{var ut=y=>{var E=Nt(),Z=ne(E);xt(Z,{get deckId(){return t(n),q(()=>t(n).deck.id)},submitAnswer:he,deleteAnswer:pe,updateCurrentQuestionData:ge,get question(){return e(a)},set question(M){r(a,M)},get questionContext(){return t(b)},set questionContext(M){r(b,M)},get helpUsed(){return t(O)},set helpUsed(M){r(O,M)},get answerChoice(){return e(p)},set answerChoice(M){r(p,M)},get examMode(){return e(d)},set examMode(M){r(d,M)},get settingsShuffleAnswers(){return e(v)},set settingsShuffleAnswers(M){r(v,M)},get settingsShowAnswerStats(){return e(B)},set settingsShowAnswerStats(M){r(B,M)},$$legacy:!0});var K=P(Z,2);{var qe=M=>{ht(M,{get questionId(){return e(a).id},set questionId(Se){T(a,e(a).id=Se)},get questionContext(){return t(b)},set questionContext(Se){r(b,Se)},$$legacy:!0})};D(K,M=>{e(d)||M(qe)})}C(y,E)};D(dt,y=>{e(a)&&y(ut)})}j((y,E,Z,K,qe)=>{Fe=W(xe,1,"btn btn-sm d-none d-sm-none d-md-none d-lg-inline",null,Fe,y),Ge=W(ke,1,"btn btn-sm",null,Ge,E),Ve=W(ye,1,"btn btn-sm",null,Ve,Z),Be=W(Ce,1,"ms-1 float-end fw-bold font-monospace badge",null,Be,K),ue(tt,`${e(ae)??""}/${e(G)??""}`),Pe(Ue,"href",`/sessions/${t(n),q(()=>t(n).session.id)??""}/edit`),ue(nt,(t(n),q(()=>t(n).session.name))),Ee=W(ze,1,"col-md-12 col-xl-8 col-xxl-6",null,Ee,qe)},[()=>({"bg-light":!e(h),"bg-dark-subtle":e(h)}),()=>({"bg-light":!e(v),"bg-dark-subtle":e(v)}),()=>({"bg-light":!e(S),"bg-dark-subtle":e(S)}),()=>({"text-bg-light":!e(p)||e(d),"bg-success":!e(d)&&!e(a).is_invalid&&e(p)&&e(p).is_correct,"bg-danger":!e(d)&&!e(a).is_invalid&&e(p)&&!e(p).is_correct}),()=>({"col-lg-9":e(h),"col-lg-10":!e(h),"offset-lg-1":!e(h),"offset-xl-2":!e(h),"offset-xxl-3":!e(h)})]),$("click",xe,ee(()=>{Ae(de,q(i).session_show_sidebar=!i().session_show_sidebar,q(i))})),$("click",ke,ee(()=>{Ae(de,q(i).session_shuffle_answers=!i().session_shuffle_answers,q(i))})),$("click",ye,ee(()=>{Ae(de,q(i).session_exam_mode=!i().session_exam_mode,q(i))})),C(s,f)},we=s=>{var f=Ht();C(s,f)};D(ce,s=>{t(n)?s(be):s(we,!1)})}var le=P(ce,2);{var Xe=s=>{At(s,{get magicGIFPath(){return t(H)},set magicGIFPath(f){r(H,f)},$$legacy:!0})};D(le,s=>{e(d)||s(Xe)})}var Ye=P(le,2);{var Ze=s=>{var f=Lt(),V=k(f);qt(V,{x:[-5,5],y:[0,.1],delay:[100,3e3],infinite:!0,duration:"5000",amount:"200",fallDistance:"100vh"}),C(s,f)};D(Ye,s=>{t(te)&&s(Ze)})}C(z,oe),re(),m()}const $e=document.getElementById("SessionView");new $t({target:$e,props:{id:$e.dataset.sessionId}});
