import{S as ae,i as ie,s as le,k as oe,r as ce,c as _,u as fe,a as O,t as v,f as g,E as k,o as z,b as q,v as ue,h as d,w as de,q as V,x as P,y as F,d as C,A as me,l as _e,p as be,n as ge,e as Me,z as De,m as pe,C as we,D as ye}from"./index-CW_84yAU.js";import{e as W}from"./each-23V_io8F.js";import{S as Se}from"./SessionProgressBar-BE59Qe1D.js";import{s as Ie}from"./StatsHelper-B91isISU.js";import{t as I,n as B,e as ve,g as Z,m as $,a as A,b as ke,p as x,f as Oe}from"./parseISO-JEmvXouO.js";function N(r,e){const n=+I(r)-+I(e);return n<0?-1:n>0?1:n}function Pe(r,e,n){const[i,s]=B(n==null?void 0:n.in,r,e),c=i.getFullYear()-s.getFullYear(),a=i.getMonth()-s.getMonth();return c*12+a}function Xe(r){return e=>{const i=(r?Math[r]:Math.trunc)(e);return i===0?0:i}}function Te(r,e){return+I(r)-+I(e)}function Ye(r,e){const n=I(r,e==null?void 0:e.in);return n.setHours(23,59,59,999),n}function He(r,e){const n=I(r,e==null?void 0:e.in),i=n.getMonth();return n.setFullYear(n.getFullYear(),i+1,0),n.setHours(23,59,59,999),n}function ze(r,e){const n=I(r,e==null?void 0:e.in);return+Ye(n,e)==+He(n,e)}function Ae(r,e,n){const[i,s,c]=B(n==null?void 0:n.in,r,r,e),a=N(s,c),t=Math.abs(Pe(s,c));if(t<1)return 0;s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-a*t);let o=N(s,c)===-a;ze(i)&&t===1&&N(i,c)===1&&(o=!1);const l=a*(t-+o);return l===0?0:l}function Ne(r,e,n){const i=Te(r,e)/1e3;return Xe(n==null?void 0:n.roundingMethod)(i)}function Fe(r,e,n){const i=ke(),s=(n==null?void 0:n.locale)??i.locale??ve,c=2520,a=N(r,e);if(isNaN(a))throw new RangeError("Invalid time value");const t=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:a}),[o,l]=B(n==null?void 0:n.in,...a>0?[e,r]:[r,e]),m=Ne(l,o),b=(Z(l)-Z(o))/1e3,f=Math.round((m-b)/60);let w;if(f<2)return n!=null&&n.includeSeconds?m<5?s.formatDistance("lessThanXSeconds",5,t):m<10?s.formatDistance("lessThanXSeconds",10,t):m<20?s.formatDistance("lessThanXSeconds",20,t):m<40?s.formatDistance("halfAMinute",0,t):m<60?s.formatDistance("lessThanXMinutes",1,t):s.formatDistance("xMinutes",1,t):f===0?s.formatDistance("lessThanXMinutes",1,t):s.formatDistance("xMinutes",f,t);if(f<45)return s.formatDistance("xMinutes",f,t);if(f<90)return s.formatDistance("aboutXHours",1,t);if(f<$){const M=Math.round(f/60);return s.formatDistance("aboutXHours",M,t)}else{if(f<c)return s.formatDistance("xDays",1,t);if(f<A){const M=Math.round(f/$);return s.formatDistance("xDays",M,t)}else if(f<A*2)return w=Math.round(f/A),s.formatDistance("aboutXMonths",w,t)}if(w=Ae(l,o),w<12){const M=Math.round(f/A);return s.formatDistance("xMonths",M,t)}else{const M=w%12,y=Math.trunc(w/12);return M<3?s.formatDistance("aboutXYears",y,t):M<9?s.formatDistance("overXYears",y,t):s.formatDistance("almostXYears",y+1,t)}}function ee(r){let e,n,i;return{c(){e=_("button"),e.innerHTML='<i class="bi bi-repeat"></i> Repeat incorrect',g(e,"class","btn btn-sm btn-outline-secondary"),k(e,"--bs-btn-padding-y",".25rem"),k(e,"--bs-btn-padding-x",".5rem"),k(e,"--bs-btn-font-size",".75rem"),g(e,"type","button")},m(s,c){q(s,e,c),n||(i=_e(e,"click",be(r[6])),n=!0)},p:ge,d(s){s&&C(e),n=!1,i()}}}function qe(r){let e,n,i,s,c,a,t,o=r[0].name+"",l,m,b,f,w,M,y,R,j,S,X,T,E,Q,U,Y,H,L,G,D;function he(u){r[5](u)}let J={};r[1]!==void 0&&(J.progressPercentage=r[1]),n=new Se({props:J}),oe.push(()=>ce(n,"progressPercentage",he));let h=r[1].unanswered===0&&r[1].incorrect>0&&ee(r);return{c(){e=_("div"),fe(n.$$.fragment),s=O(),c=_("div"),a=_("div"),t=_("strong"),l=v(o),m=O(),b=_("div"),f=_("a"),w=_("i"),M=v(" Open"),R=O(),h&&h.c(),j=O(),S=_("div"),X=_("span"),T=_("small"),E=v(r[3]),Q=v(" ago"),U=O(),Y=_("span"),H=_("small"),L=v(r[3]),G=v(" ago"),g(a,"class","col-md-4"),g(w,"class","bi bi-rocket-takeoff"),g(f,"href",y="/sessions/"+r[0].id),g(f,"class","btn btn-sm"),k(f,"--bs-btn-padding-y",".25rem"),k(f,"--bs-btn-padding-x",".5rem"),k(f,"--bs-btn-font-size",".75rem"),z(f,"btn-primary",r[1].unanswered),z(f,"btn-outline-secondary",!r[1].unanswered),g(b,"class","col-md-4"),g(X,"class","float-end d-none d-sm-none d-md-inline"),g(Y,"class","d-inline d-sm-inline d-md-none"),g(S,"class","col-md-4"),g(S,"title",r[2]),g(c,"class","row mt-1"),g(e,"class","mt-3 mb-3")},m(u,p){q(u,e,p),ue(n,e,null),d(e,s),d(e,c),d(c,a),d(a,t),d(t,l),d(c,m),d(c,b),d(b,f),d(f,w),d(f,M),d(b,R),h&&h.m(b,null),d(c,j),d(c,S),d(S,X),d(X,T),d(T,E),d(T,Q),d(S,U),d(S,Y),d(Y,H),d(H,L),d(H,G),D=!0},p(u,[p]){const K={};!i&&p&2&&(i=!0,K.progressPercentage=u[1],de(()=>i=!1)),n.$set(K),(!D||p&1)&&o!==(o=u[0].name+"")&&V(l,o),(!D||p&1&&y!==(y="/sessions/"+u[0].id))&&g(f,"href",y),(!D||p&2)&&z(f,"btn-primary",u[1].unanswered),(!D||p&2)&&z(f,"btn-outline-secondary",!u[1].unanswered),u[1].unanswered===0&&u[1].incorrect>0?h?h.p(u,p):(h=ee(u),h.c(),h.m(b,null)):h&&(h.d(1),h=null),(!D||p&8)&&V(E,u[3]),(!D||p&8)&&V(L,u[3]),(!D||p&4)&&g(S,"title",u[2])},i(u){D||(P(n.$$.fragment,u),D=!0)},o(u){F(n.$$.fragment,u),D=!1},d(u){u&&C(e),me(n),h&&h.d()}}}function Ce(r){axios.post("/api/sessions/"+r+"/newfromincorrect").then(function(e){window.location.href="/sessions/"+e.data.id}).catch(function(e){alert(e)})}function Ee(r,e,n){let i,s,c,a,{session:t}=e;function o(m){a=m,n(1,a),n(0,t),n(4,c)}const l=()=>Ce(t.id);return r.$$set=m=>{"session"in m&&n(0,t=m.session)},r.$$.update=()=>{r.$$.dirty&1&&n(3,i=Fe(x(t.created_at),new Date)),r.$$.dirty&1&&n(2,s=Oe(x(t.created_at),"dd.MM.yyyy HH:mm")),r.$$.dirty&1&&n(4,c=t?t.deck.questions.filter(m=>!m.is_invalid):null),r.$$.dirty&17&&n(1,a=t?Ie(c.length,t.answerchoices.filter(m=>c.some(({id:b})=>b===m.question_id))):null)},[t,a,s,i,c,o,l]}class Le extends ae{constructor(e){super(),ie(this,e,Ee,qe,le,{session:0})}}function ne(r,e,n){const i=r.slice();return i[3]=e[n],i[4]=e,i[5]=n,i}function se(r){let e;return{c(){e=_("p"),e.textContent="No sessions yet"},m(n,i){q(n,e,i)},p:ge,d(n){n&&C(e)}}}function te(r){let e,n,i;function s(a){r[2](a,r[3],r[4],r[5])}let c={};return r[3]!==void 0&&(c.session=r[3]),e=new Le({props:c}),oe.push(()=>ce(e,"session",s)),{c(){fe(e.$$.fragment)},m(a,t){ue(e,a,t),i=!0},p(a,t){r=a;const o={};!n&&t&1&&(n=!0,o.session=r[3],de(()=>n=!1)),e.$set(o)},i(a){i||(P(e.$$.fragment,a),i=!0)},o(a){F(e.$$.fragment,a),i=!1},d(a){me(e,a)}}}function Ve(r){let e,n,i=W(r[0]),s=[];for(let t=0;t<i.length;t+=1)s[t]=te(ne(r,i,t));const c=t=>F(s[t],1,1,()=>{s[t]=null});let a=null;return i.length||(a=se()),{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=Me(),a&&a.c()},m(t,o){for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(t,o);q(t,e,o),a&&a.m(t,o),n=!0},p(t,[o]){if(o&1){i=W(t[0]);let l;for(l=0;l<i.length;l+=1){const m=ne(t,i,l);s[l]?(s[l].p(m,o),P(s[l],1)):(s[l]=te(m),s[l].c(),P(s[l],1),s[l].m(e.parentNode,e))}for(ye(),l=i.length;l<s.length;l+=1)c(l);De(),!i.length&&a?a.p(t,o):i.length?a&&(a.d(1),a=null):(a=se(),a.c(),a.m(e.parentNode,e))}},i(t){if(!n){for(let o=0;o<i.length;o+=1)P(s[o]);n=!0}},o(t){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)F(s[o]);n=!1},d(t){t&&C(e),pe(s,t),a&&a.d(t)}}}function Be(r,e,n){let{userId:i}=e;var s=[];we(()=>{axios.get("/api/sessions?take=15&user-id="+i).then(function(a){n(0,s=a.data)}).catch(function(a){alert(a)})});function c(a,t,o,l){o[l]=a,n(0,s)}return r.$$set=a=>{"userId"in a&&n(1,i=a.userId)},[s,i,c]}class Re extends ae{constructor(e){super(),ie(this,e,Be,Ve,le,{userId:1})}}const re=document.getElementById("IndexSessionView");new Re({target:re,props:{userId:re.dataset.userId}});
