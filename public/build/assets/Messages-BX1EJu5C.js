import{S as me,i as _e,s as pe,d as q,w as N,x as T,z as W,A as F,a as C,b as I,e as K,K as ye,c as f,f as b,g as c,m as ve,v as O,l as B,p as L,k as G,r as J,u as be,y as X,B as he,C as ge,q as U,t as j,j as we,o as D,n as P,H as Me}from"./index-C5hKwDc9.js";import{e as V,u as Ie,o as qe}from"./each-JoEH9o9l.js";import{p as x,d as Ce}from"./purify.es-CzHI0FGf.js";import{U as Ee}from"./UserSettingsStore-DIGhToub.js";import{f as $,p as ee}from"./parseISO-nqt9u7wd.js";function te(u,t,e){const s=u.slice();return s[18]=t[e],s[19]=t,s[20]=e,s}function se(u){let t,e,s;function i(a,m){return a[5]?He:Ae}let n=i(u),l=n(u),o=u[6]&&ue(u);return{c(){t=b("div"),e=b("div"),l.c(),s=I(),o&&o.c(),c(e,"class","row"),c(t,"class","mt-1 mb-1")},m(a,m){C(a,t,m),f(t,e),l.m(e,null),f(t,s),o&&o.m(t,null)},p(a,m){n===(n=i(a))&&l?l.p(a,m):(l.d(1),l=n(a),l&&(l.c(),l.m(e,null))),a[6]?o?o.p(a,m):(o=ue(a),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},d(a){a&&q(t),l.d(),o&&o.d()}}}function He(u){let t,e,s,i,n,l,o,a,m,p,h,d,r,k,H,E,_,g,M;return{c(){t=b("div"),e=b("form"),s=b("div"),i=b("input"),l=I(),o=b("trix-editor"),a=I(),m=b("div"),p=b("input"),d=I(),r=b("label"),r.textContent="Anonymous",k=I(),H=b("input"),E=I(),_=b("button"),_.textContent="Cancel",c(i,"id","message"),c(i,"type","hidden"),c(i,"name","message"),i.value=n=u[0].text,we(o,"input","message"),c(s,"class","mb-3"),c(p,"type","checkbox"),c(p,"class","form-check-input"),c(p,"id","anonymous"),p.checked=h=u[0].is_anonymous,c(r,"class","form-check-label"),c(r,"for","anonymous"),c(m,"class","mb-3 form-check"),c(H,"class","btn btn-sm btn-primary"),c(H,"type","submit"),H.value="Save",c(_,"class","btn btn-link mr-0"),c(e,"class","mt-3 mb-3"),c(t,"class","col-md")},m(S,y){C(S,t,y),f(t,e),f(e,s),f(s,i),f(s,l),f(s,o),f(e,a),f(e,m),f(m,p),f(m,d),f(m,r),f(e,k),f(e,H),f(e,E),f(e,_),g||(M=[B(_,"click",L(u[9])),B(e,"submit",L(u[11]))],g=!0)},p(S,y){y&1&&n!==(n=S[0].text)&&(i.value=n),y&1&&h!==(h=S[0].is_anonymous)&&(p.checked=h)},d(S){S&&q(t),g=!1,O(M)}}}function Ae(u){let t,e,s,i,n,l,o=$(ee(u[0].created_at),"dd.MM.yyyy HH:mm")+"",a,m,p;function h(g,M){return g[0].is_deleted?Se:Te}let d=h(u),r=d(u),k=!u[0].is_deleted&&le(u);function H(g,M){if(g[0].is_anonymous)return Le;if(g[0].author&&!g[0].is_deleted)return Be}let E=H(u),_=E&&E(u);return{c(){t=b("div"),r.c(),e=I(),s=b("p"),i=b("small"),n=b("div"),k&&k.c(),l=I(),a=j(o),m=I(),_&&_.c(),c(n,"class","d-flex align-items-center py-1"),c(s,"class","text-muted text-end mb-0"),c(t,"class",p="col-md offset-md-"+u[1])},m(g,M){C(g,t,M),r.m(t,null),f(t,e),f(t,s),f(s,i),f(i,n),k&&k.m(n,null),f(n,l),f(n,a),f(n,m),_&&_.m(n,null)},p(g,M){d===(d=h(g))&&r?r.p(g,M):(r.d(1),r=d(g),r&&(r.c(),r.m(t,e))),g[0].is_deleted?k&&(k.d(1),k=null):k?k.p(g,M):(k=le(g),k.c(),k.m(n,l)),M&1&&o!==(o=$(ee(g[0].created_at),"dd.MM.yyyy HH:mm")+"")&&U(a,o),E===(E=H(g))&&_?_.p(g,M):(_&&_.d(1),_=E&&E(g),_&&(_.c(),_.m(n,null))),M&2&&p!==(p="col-md offset-md-"+g[1])&&c(t,"class",p)},d(g){g&&q(t),r.d(),k&&k.d(),_&&_.d()}}}function Se(u){let t;return{c(){t=b("p"),t.innerHTML="<small><i>deleted</i></small>",c(t,"class","rounded-2 bg-light-subtle p-1 mb-0 text-muted")},m(e,s){C(e,t,s)},p:P,d(e){e&&q(t)}}}function Te(u){let t,e=u[0].text&&ne(u);return{c(){t=b("p"),e&&e.c(),c(t,"class","rounded-2 bg-light p-2 mb-0 text-break")},m(s,i){C(s,t,i),e&&e.m(t,null)},p(s,i){s[0].text?e?e.p(s,i):(e=ne(s),e.c(),e.m(t,null)):e&&(e.d(1),e=null)},d(s){s&&q(t),e&&e.d()}}}function ne(u){let t,e=x.sanitize(u[0].text)+"",s;return{c(){t=new Me(!1),s=K(),t.a=s},m(i,n){t.m(e,i,n),C(i,s,n)},p(i,n){n&1&&e!==(e=x.sanitize(i[0].text)+"")&&t.p(e)},d(i){i&&(q(s),t.d())}}}function le(u){let t,e,s,i,n,l=u[0].thumbs_up_count+"",o,a,m,p,h,d,r,k,H=u[0].thumbs_down_count+"",E,_,g,M,S,y,v=u[8].id===u[0].author_id&&ie(u);return{c(){var w,A,R,z;t=b("div"),e=b("button"),s=b("i"),i=I(),n=b("span"),o=j(l),a=I(),m=b("span"),m.textContent="|",p=I(),h=b("button"),d=b("i"),r=I(),k=b("span"),E=j(H),_=I(),v&&v.c(),g=I(),M=b("button"),M.textContent="Reply",c(s,"class","bi"),D(s,"bi-hand-thumbs-up-fill",((w=u[7])==null?void 0:w.type)==="up"),D(s,"bi-hand-thumbs-up",((A=u[7])==null?void 0:A.type)!=="up"),c(e,"class","btn mx-0 ps-0 pe-1"),c(n,"class","pe-1 font-monospace"),c(m,"class","px-1"),c(d,"class","bi"),D(d,"bi-hand-thumbs-down-fill",((R=u[7])==null?void 0:R.type)==="down"),D(d,"bi-hand-thumbs-down",((z=u[7])==null?void 0:z.type)!=="down"),c(h,"class","btn mx-0 px-1"),c(k,"class","pe-1 font-monospace"),c(t,"class","d-flex rounded-4 align-items-center bg-light ms-auto px-2"),c(M,"class","btn btn-sm btn-link link-dark")},m(w,A){C(w,t,A),f(t,e),f(e,s),f(t,i),f(t,n),f(n,o),f(t,a),f(t,m),f(t,p),f(t,h),f(h,d),f(t,r),f(t,k),f(k,E),C(w,_,A),v&&v.m(w,A),C(w,g,A),C(w,M,A),S||(y=[B(e,"click",L(u[15])),B(h,"click",L(u[16])),B(M,"click",L(u[10]))],S=!0)},p(w,A){var R,z,Y,Z;A&128&&D(s,"bi-hand-thumbs-up-fill",((R=w[7])==null?void 0:R.type)==="up"),A&128&&D(s,"bi-hand-thumbs-up",((z=w[7])==null?void 0:z.type)!=="up"),A&1&&l!==(l=w[0].thumbs_up_count+"")&&U(o,l),A&128&&D(d,"bi-hand-thumbs-down-fill",((Y=w[7])==null?void 0:Y.type)==="down"),A&128&&D(d,"bi-hand-thumbs-down",((Z=w[7])==null?void 0:Z.type)!=="down"),A&1&&H!==(H=w[0].thumbs_down_count+"")&&U(E,H),w[8].id===w[0].author_id?v?v.p(w,A):(v=ie(w),v.c(),v.m(g.parentNode,g)):v&&(v.d(1),v=null)},d(w){w&&(q(t),q(_),q(g),q(M)),v&&v.d(w),S=!1,O(y)}}}function ie(u){let t,e,s,i,n;return{c(){t=b("button"),t.textContent="Edit",e=I(),s=b("button"),s.textContent="Delete",c(t,"class","btn btn-sm btn-link link-dark"),c(s,"class","btn btn-sm btn-link link-dark")},m(l,o){C(l,t,o),C(l,e,o),C(l,s,o),i||(n=[B(t,"click",L(u[9])),B(s,"click",L(u[13]))],i=!0)},p:P,d(l){l&&(q(t),q(e),q(s)),i=!1,O(n)}}}function Be(u){let t,e,s=(u[0].author.public_name?u[0].author.public_name:u[0].author.name)+"",i;return{c(){t=b("strong"),e=b("span"),i=j(s),c(e,"class","ps-2")},m(n,l){C(n,t,l),f(t,e),f(e,i)},p(n,l){l&1&&s!==(s=(n[0].author.public_name?n[0].author.public_name:n[0].author.name)+"")&&U(i,s)},d(n){n&&q(t)}}}function Le(u){let t;return{c(){t=b("i"),c(t,"class","bi bi-incognito ps-2"),c(t,"title","anonymous")},m(e,s){C(e,t,s)},p:P,d(e){e&&q(t)}}}function ue(u){let t,e,s,i,n,l,o,a,m,p,h,d,r,k,H;return{c(){t=b("div"),e=b("div"),s=b("form"),i=b("input"),l=I(),o=b("div"),o.innerHTML='<input id="replyMessage" type="hidden" name="replyMessage" value=""/> <trix-editor input="replyMessage"></trix-editor>',a=I(),m=b("div"),m.innerHTML='<input type="checkbox" class="form-check-input" id="replyAnonymous" checked=""/> <label class="form-check-label" for="replyAnonymous">Anonymous</label>',p=I(),h=b("input"),d=I(),r=b("button"),r.textContent="Cancel",c(i,"id","parentMessageId"),c(i,"type","hidden"),i.value=n=u[0].id,c(o,"class","mb-3"),c(m,"class","mb-3 form-check"),c(h,"class","btn btn-sm btn-primary"),c(h,"type","submit"),h.value="Send reply",c(r,"class","btn btn-link mr-0"),c(s,"class","mt-3 mb-3"),c(e,"class","col-md"),c(t,"class","row")},m(E,_){C(E,t,_),f(t,e),f(e,s),f(s,i),f(s,l),f(s,o),f(s,a),f(s,m),f(s,p),f(s,h),f(s,d),f(s,r),k||(H=[B(r,"click",L(u[10])),B(s,"submit",L(u[12]))],k=!0)},p(E,_){_&1&&n!==(n=E[0].id)&&(i.value=n)},d(E){E&&q(t),k=!1,O(H)}}}function oe(u){let t,e,s=V(u[0].childs),i=[];for(let l=0;l<s.length;l+=1)i[l]=ae(te(u,s,l));const n=l=>N(i[l],1,1,()=>{i[l]=null});return{c(){for(let l=0;l<i.length;l+=1)i[l].c();t=K()},m(l,o){for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(l,o);C(l,t,o),e=!0},p(l,o){if(o&31){s=V(l[0].childs);let a;for(a=0;a<s.length;a+=1){const m=te(l,s,a);i[a]?(i[a].p(m,o),T(i[a],1)):(i[a]=ae(m),i[a].c(),T(i[a],1),i[a].m(t.parentNode,t))}for(W(),a=s.length;a<i.length;a+=1)n(a);F()}},i(l){if(!e){for(let o=0;o<s.length;o+=1)T(i[o]);e=!0}},o(l){i=i.filter(Boolean);for(let o=0;o<i.length;o+=1)N(i[o]);e=!1},d(l){l&&q(t),ve(i,l)}}}function ae(u){let t,e,s;function i(l){u[17](l,u[18],u[19],u[20])}let n={indent:u[1]+1,addMessage:u[2],updateMessage:u[3],questionId:u[4]};return u[18]!==void 0&&(n.message=u[18]),t=new ke({props:n}),G.push(()=>J(t,"message",i)),{c(){ge(t.$$.fragment)},m(l,o){he(t,l,o),s=!0},p(l,o){u=l;const a={};o&2&&(a.indent=u[1]+1),o&4&&(a.addMessage=u[2]),o&8&&(a.updateMessage=u[3]),o&16&&(a.questionId=u[4]),!e&&o&1&&(e=!0,a.message=u[18],X(()=>e=!1)),t.$set(a)},i(l){s||(T(t.$$.fragment,l),s=!0)},o(l){N(t.$$.fragment,l),s=!1},d(l){be(t,l)}}}function Ne(u){let t,e,s,i=(!u[0].is_deleted||u[0].is_deleted&&u[0].childs)&&se(u),n=u[0].childs&&oe(u);return{c(){i&&i.c(),t=I(),n&&n.c(),e=K()},m(l,o){i&&i.m(l,o),C(l,t,o),n&&n.m(l,o),C(l,e,o),s=!0},p(l,[o]){!l[0].is_deleted||l[0].is_deleted&&l[0].childs?i?i.p(l,o):(i=se(l),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null),l[0].childs?n?(n.p(l,o),o&1&&T(n,1)):(n=oe(l),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(W(),N(n,1,1,()=>{n=null}),F())},i(l){s||(T(n),s=!0)},o(l){N(n),s=!1},d(l){l&&(q(t),q(e)),i&&i.d(l),n&&n.d(l)}}}function De(u,t,e){let s,i;ye(u,Ee,y=>e(8,i=y));let{message:n}=t,{indent:l}=t,{addMessage:o}=t,{updateMessage:a}=t,{questionId:m}=t;var p=!1,h=!1;function d(){e(5,p=!p)}function r(){e(6,h=!h)}function k(){var y={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.put("/api/messages/"+n.id,y).then(function(v){d(),e(0,n.text=v.data.text,n),e(0,n.is_anonymous=v.data.is_anonymous,n),a(n)}).catch(function(v){alert(v)})}function H(){var y={text:document.getElementById("replyMessage").value,parent_message_id:document.getElementById("parentMessageId").value,is_anonymous:document.getElementById("replyAnonymous").checked};axios.post("/api/questions/"+m+"/messages",y).then(function(v){r(),o(v.data)}).catch(function(v){alert(v)})}function E(){confirm("Are you sure you want to delete this message?")&&axios.delete("/api/messages/"+n.id).then(function(y){e(0,n.text="",n),e(0,n.is_deleted=!0,n),a(n)}).catch(function(y){alert(y)})}function _(y){s!==null?s.type===y?axios.delete("/api/messages/"+n.id+"/thumbs/"+s.id).then(function(v){e(0,n.thumbs=n.thumbs.filter(w=>w.user_id===void 0),n),y==="up"?e(0,n.thumbs_up_count-=1,n):e(0,n.thumbs_down_count-=1,n),a(n)}).catch(function(v){alert(v)}):axios.put("/api/messages/"+n.id+"/thumbs/"+s.id,{type:y}).then(function(v){n.thumbs.find(w=>w.user_id!==void 0).type=y,y==="up"?(e(0,n.thumbs_up_count+=1,n),e(0,n.thumbs_down_count-=1,n)):(e(0,n.thumbs_down_count+=1,n),e(0,n.thumbs_up_count-=1,n)),a(n)}).catch(function(v){alert(v)}):axios.post("/api/messages/"+n.id+"/thumbs",{type:y}).then(function(v){n.thumbs.push({type:v.data.type,user_id:v.data.user_id,id:v.data.id}),y==="up"?e(0,n.thumbs_up_count+=1,n):e(0,n.thumbs_down_count+=1,n),a(n)}).catch(function(v){alert(v)})}const g=()=>_("up"),M=()=>_("down");function S(y,v,w,A){w[A]=y,e(0,n)}return u.$$set=y=>{"message"in y&&e(0,n=y.message),"indent"in y&&e(1,l=y.indent),"addMessage"in y&&e(2,o=y.addMessage),"updateMessage"in y&&e(3,a=y.updateMessage),"questionId"in y&&e(4,m=y.questionId)},u.$$.update=()=>{u.$$.dirty&1&&e(7,s=n.thumbs.find(y=>y.user_id!==void 0)??null)},[n,l,o,a,m,p,h,s,i,d,r,k,H,E,_,g,M,S]}class ke extends me{constructor(t){super(),_e(this,t,De,Ne,pe,{message:0,indent:1,addMessage:2,updateMessage:3,questionId:4})}}function fe(u,t,e){const s=u.slice();return s[14]=t[e],s[15]=t,s[16]=e,s}function de(u){let t,e=[],s=new Map,i,n,l=V(u[3]);const o=d=>d[14].id;for(let d=0;d<l.length;d+=1){let r=fe(u,l,d),k=o(r);s.set(k,e[d]=re(k,r))}let a=null;l.length||(a=ce(u));function m(d,r){return d[2]?ze:Re}let p=m(u),h=p(u);return{c(){t=b("div");for(let d=0;d<e.length;d+=1)e[d].c();a&&a.c(),i=I(),h.c(),c(t,"class","mt-3 mb-3")},m(d,r){C(d,t,r);for(let k=0;k<e.length;k+=1)e[k]&&e[k].m(t,null);a&&a.m(t,null),f(t,i),h.m(t,null),n=!0},p(d,r){r&121&&(l=V(d[3]),W(),e=Ie(e,r,o,1,d,l,s,t,qe,re,i,fe),F(),!l.length&&a?a.p(d,r):l.length?a&&(a.d(1),a=null):(a=ce(d),a.c(),a.m(t,i))),p===(p=m(d))&&h?h.p(d,r):(h.d(1),h=p(d),h&&(h.c(),h.m(t,null)))},i(d){if(!n){for(let r=0;r<l.length;r+=1)T(e[r]);n=!0}},o(d){for(let r=0;r<e.length;r+=1)N(e[r]);n=!1},d(d){d&&q(t);for(let r=0;r<e.length;r+=1)e[r].d();a&&a.d(),h.d()}}}function ce(u){let t,e;return{c(){t=b("p"),e=j(u[4])},m(s,i){C(s,t,i),f(t,e)},p(s,i){i&16&&U(e,s[4])},d(s){s&&q(t)}}}function re(u,t){let e,s,i,n,l;function o(p){t[9](p,t[14],t[15],t[16])}function a(p){t[10](p)}let m={indent:0,addMessage:t[5],updateMessage:t[6]};return t[14]!==void 0&&(m.message=t[14]),t[0]!==void 0&&(m.questionId=t[0]),s=new ke({props:m}),G.push(()=>J(s,"message",o)),G.push(()=>J(s,"questionId",a)),{key:u,first:null,c(){e=K(),ge(s.$$.fragment),this.first=e},m(p,h){C(p,e,h),he(s,p,h),l=!0},p(p,h){t=p;const d={};!i&&h&8&&(i=!0,d.message=t[14],X(()=>i=!1)),!n&&h&1&&(n=!0,d.questionId=t[0],X(()=>n=!1)),s.$set(d)},i(p){l||(T(s.$$.fragment,p),l=!0)},o(p){N(s.$$.fragment,p),l=!1},d(p){p&&q(e),be(s,p)}}}function Re(u){let t,e,s;return{c(){t=b("button"),t.innerHTML='<i class="bi bi-chat-square-dots"></i> Add comment',c(t,"class","btn btn-sm btn-outline-secondary")},m(i,n){C(i,t,n),e||(s=B(t,"click",L(u[8])),e=!0)},p:P,d(i){i&&q(t),e=!1,s()}}}function ze(u){let t,e,s,i,n,l,o,a,m,p,h;return{c(){t=b("div"),e=b("form"),s=b("div"),s.innerHTML='<input id="message" type="hidden" name="message" value=""/> <trix-editor input="message"></trix-editor>',i=I(),n=b("div"),n.innerHTML='<input type="checkbox" class="form-check-input" id="anonymous" checked=""/> <label class="form-check-label" for="anonymous">Anonymous</label>',l=I(),o=b("input"),a=I(),m=b("button"),m.textContent="Cancel",c(s,"class","mb-3 text-break"),c(n,"class","mb-3 form-check"),c(o,"class","btn btn-sm btn-primary"),c(o,"type","submit"),o.value="Send",c(m,"class","btn btn-link mr-0"),c(e,"action","#"),c(e,"class","mt-3 mb-3"),c(t,"class","mt-3")},m(d,r){C(d,t,r),f(t,e),f(e,s),f(e,i),f(e,n),f(e,l),f(e,o),f(e,a),f(e,m),p||(h=[B(m,"click",L(u[8])),B(e,"submit",L(u[7]))],p=!0)},p:P,d(d){d&&q(t),p=!1,O(h)}}}function Ue(u){let t,e,s=u[1].isAnswered&&de(u);return{c(){s&&s.c(),t=K()},m(i,n){s&&s.m(i,n),C(i,t,n),e=!0},p(i,[n]){i[1].isAnswered?s?(s.p(i,n),n&2&&T(s,1)):(s=de(i),s.c(),T(s,1),s.m(t.parentNode,t)):s&&(W(),N(s,1,1,()=>{s=null}),F())},i(i){e||(T(s),e=!0)},o(i){N(s),e=!1},d(i){i&&q(t),s&&s.d(i)}}}function Q(u){var t=structuredClone(u),e={},s=[];t.forEach(n=>{if(!n.parent_message_id&&!n.legacy_parent_message_id){s.push(n);return}var l=n.parent_message_id;if(!l){const o=t.find(a=>a.legacy_message_id===n.legacy_parent_message_id);o?l=o.id:console.error("Parent message not found for message",n)}e[l]||(e[l]=[]),e[l].push(n)});function i(n){var l=n.id;e[l]&&(n.childs=e[l],n.childs.forEach(o=>{i(o)}))}return s.forEach(n=>{i(n)}),s}function je(u,t,e){let{questionId:s}=t,{questionContext:i}=t;var n=!1,l=[],o=[],a="Loading comments ...",m;function p(){l=[],e(4,a="Loading comments ..."),m&&m.cancel();const _=s;m=Ce(()=>{axios.get("/api/questions/"+s+"/messages").then(function(g){if(_===s){if(l=g.data,l.length===0){e(3,o=[]),e(4,a="No comments yet");return}e(3,o=Q(l))}}).catch(function(g){alert(g)})},1e3,{maxWait:2e3}),m()}function h(_){l.push(_),e(3,o=Q(l))}function d(_){const g=l.findIndex(M=>M.id===_.id);l[g]=_,e(3,o=Q(l))}function r(){var _={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.post("/api/questions/"+s+"/messages",_).then(function(g){k(),l.push(g.data),e(3,o=Q(l))}).catch(function(g){alert(g)})}function k(){e(2,n=!n)}function H(_,g,M,S){M[S]=_,e(3,o),e(0,s)}function E(_){s=_,e(0,s)}return u.$$set=_=>{"questionId"in _&&e(0,s=_.questionId),"questionContext"in _&&e(1,i=_.questionContext)},u.$$.update=()=>{u.$$.dirty&1&&(e(3,o=[]),e(2,n=!1),p())},[s,i,n,o,a,h,d,r,k,H,E]}class We extends me{constructor(t){super(),_e(this,t,je,Ue,pe,{questionId:0,questionContext:1})}}export{We as M};
