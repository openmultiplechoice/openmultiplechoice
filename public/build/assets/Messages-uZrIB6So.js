import{S as oe,i as de,s as fe,a as q,e as V,b as v,x as T,D as J,y as D,z as K,d as M,G as he,c as g,f as b,h,l as H,p as S,B as U,m as ge,k as W,r as j,u as re,v as me,w as F,A as ce,g as ke,t as R,q as z,o as L,n as G,H as ye}from"./index-Cm33_cbi.js";import{e as P,u as ve,o as Me}from"./each-C5IGOPsu.js";import{p as Q,d as we}from"./purify.es-DjnBrbT_.js";import{U as Ie}from"./UserSettingsStore-Csk5U10K.js";import{f as X,p as Y}from"./parseISO-JEmvXouO.js";function Z(u,t,e){const n=u.slice();return n[20]=t[e],n[21]=t,n[22]=e,n}function x(u){let t,e,n;function s(o,c){return o[5]?qe:Ee}let a=s(u),l=a(u),i=u[6]&&ne(u);return{c(){t=g("div"),e=g("div"),l.c(),n=q(),i&&i.c(),b(e,"class","row"),b(t,"class","mt-1 mb-1")},m(o,c){v(o,t,c),h(t,e),l.m(e,null),h(t,n),i&&i.m(t,null)},p(o,c){a===(a=s(o))&&l?l.p(o,c):(l.d(1),l=a(o),l&&(l.c(),l.m(e,null))),o[6]?i?i.p(o,c):(i=ne(o),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},d(o){o&&M(t),l.d(),i&&i.d()}}}function qe(u){let t,e,n,s,a,l,i,o,c,_,p,f,m,w,k,d,r,I,C;return{c(){t=g("div"),e=g("form"),n=g("div"),s=g("input"),l=q(),i=g("trix-editor"),o=q(),c=g("div"),_=g("input"),f=q(),m=g("label"),m.textContent="Anonymous",w=q(),k=g("input"),d=q(),r=g("button"),r.textContent="Cancel",b(s,"id","message"),b(s,"type","hidden"),b(s,"name","message"),s.value=a=u[0].text,ke(i,"input","message"),b(n,"class","mb-3"),b(_,"type","checkbox"),b(_,"class","form-check-input"),b(_,"id","anonymous"),_.checked=p=u[0].is_anonymous,b(m,"class","form-check-label"),b(m,"for","anonymous"),b(c,"class","mb-3 form-check"),b(k,"class","btn btn-sm btn-primary"),b(k,"type","submit"),k.value="Save",b(r,"class","btn btn-link mr-0"),b(e,"class","mt-3 mb-3"),b(t,"class","col-md")},m(A,B){v(A,t,B),h(t,e),h(e,n),h(n,s),h(n,l),h(n,i),h(e,o),h(e,c),h(c,_),h(c,f),h(c,m),h(e,w),h(e,k),h(e,d),h(e,r),I||(C=[H(r,"click",S(u[11])),H(e,"submit",S(u[13]))],I=!0)},p(A,B){B&1&&a!==(a=A[0].text)&&(s.value=a),B&1&&p!==(p=A[0].is_anonymous)&&(_.checked=p)},d(A){A&&M(t),I=!1,U(C)}}}function Ee(u){let t,e,n,s,a,l=X(Y(u[0].created_at),"dd.MM.yyyy HH:mm")+"",i,o,c;function _(r,I){return r[0].is_deleted?Ce:He}let p=_(u),f=p(u),m=!u[0].is_deleted&&ee(u);function w(r,I){if(r[0].is_anonymous)return Ae;if(r[0].author&&!r[0].is_deleted)return Se}let k=w(u),d=k&&k(u);return{c(){t=g("div"),f.c(),e=q(),n=g("p"),s=g("small"),m&&m.c(),a=q(),i=R(l),o=q(),d&&d.c(),b(n,"class","text-muted text-end mb-0"),b(t,"class",c="col-md offset-md-"+u[1])},m(r,I){v(r,t,I),f.m(t,null),h(t,e),h(t,n),h(n,s),m&&m.m(s,null),h(s,a),h(s,i),h(s,o),d&&d.m(s,null)},p(r,I){p===(p=_(r))&&f?f.p(r,I):(f.d(1),f=p(r),f&&(f.c(),f.m(t,e))),r[0].is_deleted?m&&(m.d(1),m=null):m?m.p(r,I):(m=ee(r),m.c(),m.m(s,a)),I&1&&l!==(l=X(Y(r[0].created_at),"dd.MM.yyyy HH:mm")+"")&&z(i,l),k===(k=w(r))&&d?d.p(r,I):(d&&d.d(1),d=k&&k(r),d&&(d.c(),d.m(s,null))),I&2&&c!==(c="col-md offset-md-"+r[1])&&b(t,"class",c)},d(r){r&&M(t),f.d(),m&&m.d(),d&&d.d()}}}function Ce(u){let t;return{c(){t=g("p"),t.innerHTML="<small><i>deleted</i></small>",b(t,"class","rounded-2 bg-light-subtle p-1 mb-0 text-muted")},m(e,n){v(e,t,n)},p:G,d(e){e&&M(t)}}}function He(u){let t,e=u[0].text&&$(u);return{c(){t=g("p"),e&&e.c(),b(t,"class","rounded-2 bg-light p-2 mb-0 text-break")},m(n,s){v(n,t,s),e&&e.m(t,null)},p(n,s){n[0].text?e?e.p(n,s):(e=$(n),e.c(),e.m(t,null)):e&&(e.d(1),e=null)},d(n){n&&M(t),e&&e.d()}}}function $(u){let t,e=Q.sanitize(u[0].text)+"",n;return{c(){t=new ye(!1),n=V(),t.a=n},m(s,a){t.m(e,s,a),v(s,n,a)},p(s,a){a&1&&e!==(e=Q.sanitize(s[0].text)+"")&&t.p(e)},d(s){s&&(M(n),t.d())}}}function ee(u){let t,e,n,s,a,l,i,o,c,_,p,f,m,w,k=u[10].id===u[0].author_id&&te(u);return{c(){var d,r,I,C;t=R(u[9]),e=q(),n=g("button"),s=g("i"),a=q(),l=R(u[8]),i=q(),o=g("button"),c=g("i"),_=q(),k&&k.c(),p=q(),f=g("button"),f.textContent="Reply",b(s,"class","bi"),L(s,"bi-hand-thumbs-up-fill",((d=u[7])==null?void 0:d.thumb)==="up"),L(s,"bi-hand-thumbs-up",((r=u[7])==null?void 0:r.thumb)!=="up"),b(n,"class","btn"),b(c,"class","bi"),L(c,"bi-hand-thumbs-down-fill",((I=u[7])==null?void 0:I.thumb)==="down"),L(c,"bi-hand-thumbs-down",((C=u[7])==null?void 0:C.thumb)!=="down"),b(o,"class","btn"),b(f,"class","btn btn-sm btn-link link-dark")},m(d,r){v(d,t,r),v(d,e,r),v(d,n,r),h(n,s),v(d,a,r),v(d,l,r),v(d,i,r),v(d,o,r),h(o,c),v(d,_,r),k&&k.m(d,r),v(d,p,r),v(d,f,r),m||(w=[H(n,"click",S(u[17])),H(o,"click",S(u[18])),H(f,"click",S(u[12]))],m=!0)},p(d,r){var I,C,A,B;r&512&&z(t,d[9]),r&128&&L(s,"bi-hand-thumbs-up-fill",((I=d[7])==null?void 0:I.thumb)==="up"),r&128&&L(s,"bi-hand-thumbs-up",((C=d[7])==null?void 0:C.thumb)!=="up"),r&256&&z(l,d[8]),r&128&&L(c,"bi-hand-thumbs-down-fill",((A=d[7])==null?void 0:A.thumb)==="down"),r&128&&L(c,"bi-hand-thumbs-down",((B=d[7])==null?void 0:B.thumb)!=="down"),d[10].id===d[0].author_id?k?k.p(d,r):(k=te(d),k.c(),k.m(p.parentNode,p)):k&&(k.d(1),k=null)},d(d){d&&(M(t),M(e),M(n),M(a),M(l),M(i),M(o),M(_),M(p),M(f)),k&&k.d(d),m=!1,U(w)}}}function te(u){let t,e,n,s,a;return{c(){t=g("button"),t.textContent="Edit",e=q(),n=g("button"),n.textContent="Delete",b(t,"class","btn btn-sm btn-link link-dark"),b(n,"class","btn btn-sm btn-link link-dark")},m(l,i){v(l,t,i),v(l,e,i),v(l,n,i),s||(a=[H(t,"click",S(u[11])),H(n,"click",S(u[15]))],s=!0)},p:G,d(l){l&&(M(t),M(e),M(n)),s=!1,U(a)}}}function Se(u){let t,e=(u[0].author.public_name?u[0].author.public_name:u[0].author.name)+"",n;return{c(){t=g("strong"),n=R(e)},m(s,a){v(s,t,a),h(t,n)},p(s,a){a&1&&e!==(e=(s[0].author.public_name?s[0].author.public_name:s[0].author.name)+"")&&z(n,e)},d(s){s&&M(t)}}}function Ae(u){let t;return{c(){t=g("i"),b(t,"class","bi bi-incognito"),b(t,"title","anonymous")},m(e,n){v(e,t,n)},p:G,d(e){e&&M(t)}}}function ne(u){let t,e,n,s,a,l,i,o,c,_,p,f,m,w,k;return{c(){t=g("div"),e=g("div"),n=g("form"),s=g("input"),l=q(),i=g("div"),i.innerHTML='<input id="replyMessage" type="hidden" name="replyMessage" value=""/> <trix-editor input="replyMessage"></trix-editor>',o=q(),c=g("div"),c.innerHTML='<input type="checkbox" class="form-check-input" id="replyAnonymous" checked=""/> <label class="form-check-label" for="replyAnonymous">Anonymous</label>',_=q(),p=g("input"),f=q(),m=g("button"),m.textContent="Cancel",b(s,"id","parentMessageId"),b(s,"type","hidden"),s.value=a=u[0].id,b(i,"class","mb-3"),b(c,"class","mb-3 form-check"),b(p,"class","btn btn-sm btn-primary"),b(p,"type","submit"),p.value="Send reply",b(m,"class","btn btn-link mr-0"),b(n,"class","mt-3 mb-3"),b(e,"class","col-md"),b(t,"class","row")},m(d,r){v(d,t,r),h(t,e),h(e,n),h(n,s),h(n,l),h(n,i),h(n,o),h(n,c),h(n,_),h(n,p),h(n,f),h(n,m),w||(k=[H(m,"click",S(u[12])),H(n,"submit",S(u[14]))],w=!0)},p(d,r){r&1&&a!==(a=d[0].id)&&(s.value=a)},d(d){d&&M(t),w=!1,U(k)}}}function se(u){let t,e,n=P(u[0].childs),s=[];for(let l=0;l<n.length;l+=1)s[l]=le(Z(u,n,l));const a=l=>D(s[l],1,1,()=>{s[l]=null});return{c(){for(let l=0;l<s.length;l+=1)s[l].c();t=V()},m(l,i){for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(l,i);v(l,t,i),e=!0},p(l,i){if(i&31){n=P(l[0].childs);let o;for(o=0;o<n.length;o+=1){const c=Z(l,n,o);s[o]?(s[o].p(c,i),T(s[o],1)):(s[o]=le(c),s[o].c(),T(s[o],1),s[o].m(t.parentNode,t))}for(J(),o=n.length;o<s.length;o+=1)a(o);K()}},i(l){if(!e){for(let i=0;i<n.length;i+=1)T(s[i]);e=!0}},o(l){s=s.filter(Boolean);for(let i=0;i<s.length;i+=1)D(s[i]);e=!1},d(l){l&&M(t),ge(s,l)}}}function le(u){let t,e,n;function s(l){u[19](l,u[20],u[21],u[22])}let a={indent:u[1]+1,addMessage:u[2],updateMessage:u[3],questionId:u[4]};return u[20]!==void 0&&(a.message=u[20]),t=new _e({props:a}),W.push(()=>j(t,"message",s)),{c(){re(t.$$.fragment)},m(l,i){me(t,l,i),n=!0},p(l,i){u=l;const o={};i&2&&(o.indent=u[1]+1),i&4&&(o.addMessage=u[2]),i&8&&(o.updateMessage=u[3]),i&16&&(o.questionId=u[4]),!e&&i&1&&(e=!0,o.message=u[20],F(()=>e=!1)),t.$set(o)},i(l){n||(T(t.$$.fragment,l),n=!0)},o(l){D(t.$$.fragment,l),n=!1},d(l){ce(t,l)}}}function Be(u){let t,e,n,s=(!u[0].is_deleted||u[0].is_deleted&&u[0].childs)&&x(u),a=u[0].childs&&se(u);return{c(){s&&s.c(),t=q(),a&&a.c(),e=V()},m(l,i){s&&s.m(l,i),v(l,t,i),a&&a.m(l,i),v(l,e,i),n=!0},p(l,[i]){!l[0].is_deleted||l[0].is_deleted&&l[0].childs?s?s.p(l,i):(s=x(l),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null),l[0].childs?a?(a.p(l,i),i&1&&T(a,1)):(a=se(l),a.c(),T(a,1),a.m(e.parentNode,e)):a&&(J(),D(a,1,1,()=>{a=null}),K())},i(l){n||(T(a),n=!0)},o(l){D(a),n=!1},d(l){l&&(M(t),M(e)),s&&s.d(l),a&&a.d(l)}}}function Te(u,t,e){let n,s,a,l;he(u,Ie,y=>e(10,l=y));let{message:i}=t,{indent:o}=t,{addMessage:c}=t,{updateMessage:_}=t,{questionId:p}=t;var f=!1,m=!1;function w(){e(5,f=!f)}function k(){e(6,m=!m)}function d(){var y={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.put("/api/messages/"+i.id,y).then(function(E){w(),e(0,i.text=E.data.text,i),e(0,i.is_anonymous=E.data.is_anonymous,i),_(i)}).catch(function(E){alert(E)})}function r(){var y={text:document.getElementById("replyMessage").value,parent_message_id:document.getElementById("parentMessageId").value,is_anonymous:document.getElementById("replyAnonymous").checked};axios.post("/api/questions/"+p+"/messages",y).then(function(E){k(),c(E.data)}).catch(function(E){alert(E)})}function I(){confirm("Are you sure you want to delete this message?")&&axios.delete("/api/messages/"+i.id).then(function(y){e(0,i.text="",i),e(0,i.is_deleted=!0,i),_(i)}).catch(function(y){alert(y)})}function C(y){a!==null?a.thumb===y?axios.delete("/api/messages/"+i.id+"/thumbs/"+a.id).then(function(E){e(0,i.thumbs=i.thumbs.filter(N=>N.user_id===void 0),i),_(i)}).catch(function(E){alert(E)}):axios.put("/api/messages/"+i.id+"/thumbs/"+a.id,{type:y}).then(function(E){i.thumbs.find(N=>N.user_id!==void 0).thumb=y,_(i)}).catch(function(E){alert(E)}):axios.post("/api/messages/"+i.id+"/thumbs",{type:y}).then(function(E){i.thumbs.push({thumb:E.data.type,user_id:E.data.user_id,id:E.data.id}),_(i)}).catch(function(E){alert(E)})}const A=()=>C("up"),B=()=>C("down");function be(y,E,N,pe){N[pe]=y,e(0,i)}return u.$$set=y=>{"message"in y&&e(0,i=y.message),"indent"in y&&e(1,o=y.indent),"addMessage"in y&&e(2,c=y.addMessage),"updateMessage"in y&&e(3,_=y.updateMessage),"questionId"in y&&e(4,p=y.questionId)},u.$$.update=()=>{u.$$.dirty&1&&e(9,n=i.thumbs.filter(y=>y.thumb==="up").length??0),u.$$.dirty&1&&e(8,s=i.thumbs.filter(y=>y.thumb==="down").length??0),u.$$.dirty&1&&e(7,a=i.thumbs.find(y=>y.user_id!==void 0)??null)},[i,o,c,_,p,f,m,a,s,n,l,w,k,d,r,I,C,A,B,be]}class _e extends oe{constructor(t){super(),de(this,t,Te,Be,fe,{message:0,indent:1,addMessage:2,updateMessage:3,questionId:4})}}function ie(u,t,e){const n=u.slice();return n[13]=t[e],n[14]=t,n[15]=e,n}function ue(u){let t,e;return{c(){t=g("p"),e=R(u[3])},m(n,s){v(n,t,s),h(t,e)},p(n,s){s&8&&z(e,n[3])},d(n){n&&M(t)}}}function ae(u,t){let e,n,s,a,l;function i(_){t[8](_,t[13],t[14],t[15])}function o(_){t[9](_)}let c={indent:0,addMessage:t[4],updateMessage:t[5]};return t[13]!==void 0&&(c.message=t[13]),t[0]!==void 0&&(c.questionId=t[0]),n=new _e({props:c}),W.push(()=>j(n,"message",i)),W.push(()=>j(n,"questionId",o)),{key:u,first:null,c(){e=V(),re(n.$$.fragment),this.first=e},m(_,p){v(_,e,p),me(n,_,p),l=!0},p(_,p){t=_;const f={};!s&&p&4&&(s=!0,f.message=t[13],F(()=>s=!1)),!a&&p&1&&(a=!0,f.questionId=t[0],F(()=>a=!1)),n.$set(f)},i(_){l||(T(n.$$.fragment,_),l=!0)},o(_){D(n.$$.fragment,_),l=!1},d(_){_&&M(e),ce(n,_)}}}function Le(u){let t,e,n;return{c(){t=g("button"),t.innerHTML='<i class="bi bi-chat-square-dots"></i> Add comment',b(t,"class","btn btn-sm btn-outline-secondary")},m(s,a){v(s,t,a),e||(n=H(t,"click",S(u[7])),e=!0)},p:G,d(s){s&&M(t),e=!1,n()}}}function De(u){let t,e,n,s,a,l,i,o,c,_,p;return{c(){t=g("div"),e=g("form"),n=g("div"),n.innerHTML='<input id="message" type="hidden" name="message" value=""/> <trix-editor input="message"></trix-editor>',s=q(),a=g("div"),a.innerHTML='<input type="checkbox" class="form-check-input" id="anonymous" checked=""/> <label class="form-check-label" for="anonymous">Anonymous</label>',l=q(),i=g("input"),o=q(),c=g("button"),c.textContent="Cancel",b(n,"class","mb-3 text-break"),b(a,"class","mb-3 form-check"),b(i,"class","btn btn-sm btn-primary"),b(i,"type","submit"),i.value="Send",b(c,"class","btn btn-link mr-0"),b(e,"action","#"),b(e,"class","mt-3 mb-3"),b(t,"class","mt-3")},m(f,m){v(f,t,m),h(t,e),h(e,n),h(e,s),h(e,a),h(e,l),h(e,i),h(e,o),h(e,c),_||(p=[H(c,"click",S(u[7])),H(e,"submit",S(u[6]))],_=!0)},p:G,d(f){f&&M(t),_=!1,U(p)}}}function Ne(u){let t,e=[],n=new Map,s,a,l=P(u[2]);const i=f=>f[13].id;for(let f=0;f<l.length;f+=1){let m=ie(u,l,f),w=i(m);n.set(w,e[f]=ae(w,m))}let o=null;l.length||(o=ue(u));function c(f,m){return f[1]?De:Le}let _=c(u),p=_(u);return{c(){t=g("div");for(let f=0;f<e.length;f+=1)e[f].c();o&&o.c(),s=q(),p.c(),b(t,"class","mt-3 mb-3")},m(f,m){v(f,t,m);for(let w=0;w<e.length;w+=1)e[w]&&e[w].m(t,null);o&&o.m(t,null),h(t,s),p.m(t,null),a=!0},p(f,[m]){m&61&&(l=P(f[2]),J(),e=ve(e,m,i,1,f,l,n,t,Me,ae,s,ie),K(),!l.length&&o?o.p(f,m):l.length?o&&(o.d(1),o=null):(o=ue(f),o.c(),o.m(t,s))),_===(_=c(f))&&p?p.p(f,m):(p.d(1),p=_(f),p&&(p.c(),p.m(t,null)))},i(f){if(!a){for(let m=0;m<l.length;m+=1)T(e[m]);a=!0}},o(f){for(let m=0;m<e.length;m+=1)D(e[m]);a=!1},d(f){f&&M(t);for(let m=0;m<e.length;m+=1)e[m].d();o&&o.d(),p.d()}}}function O(u){var t=structuredClone(u),e={},n=[];t.forEach(a=>{if(!a.parent_message_id&&!a.legacy_parent_message_id){n.push(a);return}var l=a.parent_message_id;if(!l){const i=t.find(o=>o.legacy_message_id===a.legacy_parent_message_id);i?l=i.id:console.error("Parent message not found for message",a)}e[l]||(e[l]=[]),e[l].push(a)});function s(a){var l=a.id;e[l]&&(a.childs=e[l],a.childs.forEach(i=>{s(i)}))}return n.forEach(a=>{s(a)}),n}function Re(u,t,e){let{questionId:n}=t;var s=!1,a=[],l=[],i="Loading comments ...",o;function c(){a=[],e(3,i="Loading comments ..."),o&&o.cancel(),o=we(()=>{axios.get("/api/questions/"+n+"/messages").then(function(d){if(a=d.data,a.length===0){e(3,i="No comments yet");return}e(2,l=O(a))}).catch(function(d){alert(d)})},1e3,{maxWait:2e3}),o()}function _(d){a.push(d),e(2,l=O(a))}function p(d){const r=a.findIndex(I=>I.id===d.id);a[r]=d,e(2,l=O(a))}function f(){var d={text:document.getElementById("message").value,is_anonymous:document.getElementById("anonymous").checked};axios.post("/api/questions/"+n+"/messages",d).then(function(r){m(),a.push(r.data),e(2,l=O(a))}).catch(function(r){alert(r)})}function m(){e(1,s=!s)}function w(d,r,I,C){I[C]=d,e(2,l),e(0,n)}function k(d){n=d,e(0,n)}return u.$$set=d=>{"questionId"in d&&e(0,n=d.questionId)},u.$$.update=()=>{u.$$.dirty&1&&(e(2,l=[]),e(1,s=!1),c())},[n,s,l,i,_,p,f,m,w,k]}class Ve extends oe{constructor(t){super(),de(this,t,Re,Ne,fe,{questionId:0})}}export{Ve as M};
