import{d as pe,p as be,s as $,m as Z,a as b,g as e,u as N,j as de,b as T,e as m,h as ge,f as U,c as a,i as t,t as E,l as k,r as Ve,v as ce,o as Be}from"./render-DmmYWkZq.js";import{o as Re}from"./index-client-CSM4NHHy.js";import{i as R}from"./if-qgMZekRM.js";import{p as z,e as De,i as $e}from"./event-modifiers-B-z6qf1-.js";import{s as ue}from"./class-BfJg_ovI.js";import{p as Me,s as Ee,a as Ge,b as je}from"./props-Bo30g3de.js";import{r as fe}from"./legacy-client-oIJ-7bi0.js";import{a as Pe,b as Oe,c as ye}from"./attributes-Cp2PrCir.js";import{b as We}from"./select-C4dWo_UH.js";import{b as Ye}from"./this-BZVWBAzr.js";import{C as ze}from"./auto-sRkgK8jz.js";import{h as Fe}from"./html-ChNwDKpL.js";import{s as He}from"./StatsHelper-B91isISU.js";import{c as Ke}from"./NewSessionHelper-Ba9jtPTo.js";import{f as Le,p as Qe}from"./parseISO-BGu1X6cY.js";import{b as Te,a as Je}from"./input-DNeqJamd.js";import{U as Se}from"./UserSettingsStore-Ck4-ns3C.js";var Xe=U('<div class="row"><div class="col-md"><div class="alert alert-light mb-3 py-2">Number of questions: <span class="badge text-black font-monospace" title="Number of questions"><i class="bi bi-collection"></i> </span></div></div></div>'),Ze=U('<button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> Repeat 30 incorrect</button>'),et=U('<button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> Repeat 60 incorrect</button>'),tt=U('<div class="d-grid gap-2"><!> <!> <button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> </button></div>'),at=U('<div class="row mb-5"><div class="col-md-5"><canvas></canvas></div> <div class="col-md-7 mt-3"><table class="table"><thead></thead><tbody><tr><td>Questions</td><td class="font-monospace text-end"> </td></tr><tr><td>Answered</td><td class="font-monospace text-end"> </td></tr><tr><td>Unanswered</td><td class="font-monospace text-end"> </td></tr><tr><td>Correct</td><td class="font-monospace text-end"> </td></tr><tr><td>Correct with help</td><td class="font-monospace text-end"> </td></tr><tr><td>Incorrect</td><td class="font-monospace text-end"> </td></tr></tbody></table> <!></div></div>');function st(J,S){be(S,!0);let s=$(Z([])),w=$(Z([])),f=$(void 0),g=$(void 0);fe(()=>{S.decks,(()=>{if(!S.decks)return;const o=S.decks.map(p=>p.questions).flat();b(s,o.filter(p=>!p.is_invalid),!0);const C=[];for(const p of S.decks){const A=p.sessions.sort((_,M)=>M.id-_.id);if(A.length===0)continue;const n=A[0];C.push(...n.answer_choices)}b(w,C.filter(p=>e(s).some(({id:A})=>A===p.question_id)),!0)})()});let x=N(()=>e(s).length),c=N(()=>e(w).length),D=N(()=>e(x)-e(c)),V=N(()=>e(w).filter(o=>o.is_correct&&!o.help_used).length),G=N(()=>e(w).filter(o=>o.is_correct&&o.help_used).length),L=N(()=>e(w).filter(o=>!o.is_correct).length),O=N(()=>e(w).filter(o=>!o.is_correct).map(o=>o.question_id));fe(()=>{e(g)&&(()=>{const o={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect","Unanswered"],datasets:[{label:"n",data:[e(V),e(G),e(L),e(D)],backgroundColor:["#198754","#ffc107","#dc3545","#bbbbbb"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};e(f)&&e(f).destroy();var C=e(g).getContext("2d");b(f,new ze(C,o),!0)})()});function h(o){const C={module_id:S.moduleId,question_ids:o};axios.post("/api/sessions/newfromquestionids",C).then(function(p){window.location.href="/sessions/"+p.data.id}).catch(function(p){alert(p)})}var v=de(),Q=T(v);{var P=o=>{var C=de(),p=T(C);{var A=n=>{var _=Xe(),M=t(_),l=t(M),q=a(t(l)),i=a(t(q));E(()=>k(i,` ${e(x)??""}`)),m(n,_)};R(p,n=>{e(x)>0&&n(A)})}m(o,C)},Y=o=>{var C=de(),p=T(C);{var A=n=>{var _=at(),M=t(_),l=t(M);Ye(l,H=>b(g,H),()=>e(g));var q=a(M,2),i=t(q),r=a(t(i)),u=t(r),d=a(t(u)),j=t(d),B=a(u),I=a(t(B)),W=t(I),ee=a(B),ae=a(t(ee)),se=t(ae),y=a(ee),te=a(t(y)),ne=t(te),ie=a(y),Ce=a(t(ie)),ve=t(Ce),he=a(ie),qe=a(t(he)),Ie=t(qe),ke=a(i,2);{var we=H=>{var oe=tt(),le=t(oe);{var X=F=>{var re=Ze(),Ne=N(()=>z(()=>h(e(O).slice(0,30))));re.__click=function(...Ae){e(Ne)?.apply(this,Ae)},m(F,re)};R(le,F=>{e(L)>=40&&F(X)})}var K=a(le,2);{var _e=F=>{var re=et(),Ne=N(()=>z(()=>h(e(O).slice(0,60))));re.__click=function(...Ae){e(Ne)?.apply(this,Ae)},m(F,re)};R(K,F=>{e(L)>=70&&F(_e)})}var me=a(K,2),xe=N(()=>z(()=>h(e(O))));me.__click=function(...F){e(xe)?.apply(this,F)};var Ue=a(t(me));E(()=>k(Ue,` Repeat ${e(L)??""} incorrect`)),m(H,oe)};R(ke,H=>{e(L)>0&&H(we)})}E((H,oe,le,X,K)=>{k(j,e(x)),k(W,`${e(c)??""}
                            (${H??""}%)`),k(se,`${e(D)??""}
                            (${oe??""}%)`),k(ne,`${e(V)??""}
                            (${le??""}%)`),k(ve,`${e(G)??""}
                            (${X??""}%)`),k(Ie,`${e(L)??""}
                            (${K??""}%)`)},[()=>Math.round(100*e(c)/e(x)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(D)/e(x)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(V)/e(c)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(G)/e(c)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(L)/e(c)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})]),m(n,_)};R(p,n=>{S.decks&&n(A)},!0)}m(o,C)};R(Q,o=>{S.decks&&e(x)===e(D)?o(P):o(Y,!1)})}m(J,v),ge()}pe(["click"]);var rt=U('<span class="badge text-bg-light"> </span>'),nt=U('<span class="badge text-bg-light"> </span>'),it=U('<span class="badge text-bg-light font-monospace" title="Number of sessions"><i class="bi bi-rocket"></i> </span>'),ot=U('<div class="col-md-6 mb-3"><div class="card"><div class="card-header"><!> <span class="badge text-bg-light font-monospace" title="Number of questions"><i class="bi bi-collection"></i> </span> <!> <!> <button class="btn btn-sm btn-link"><i></i></button> <input type="checkbox" class="form-check-input float-end" value=""/></div> <div class="card-body"><h6 class="card-title text-truncate"> </h6> <button type="button" class="btn btn-sm btn-primary"><i class="bi bi-rocket-takeoff"></i> Start session</button> <a class="card-link">Browse deck</a></div></div></div>');function lt(J,S){be(S,!0);let s=Me(S,"deck",15),w=$(void 0),f=$(s().bookmarks.length>0);Re(()=>{const r=s().questions.filter(I=>!I.is_invalid),u=s().sessions.sort((I,W)=>W.id-I.id);if(u.length===0)return;const j=u[0].answer_choices.filter(I=>r.some(({id:W})=>W===I.question_id)),B=He(r.length,j);B.correct>=60?b(w,'<span class="badge text-bg-success" title="Correct answers in percent">'+B.correct+" %</span>"):b(w,'<span class="badge text-bg-danger" title="Correct answers in percent">'+B.correct+" %</span>")});function g(){e(f)?axios.delete("/api/decks/"+s().id+"/bookmark/"+s().bookmarks[0].id).then(function(r){r.status===204&&b(f,!1)}).catch(function(r){alert(r)}):axios.post("/api/decks/"+s().id+"/bookmark").then(function(r){r.status===200&&(b(f,!0),s(s().bookmarks=[r.data],!0))}).catch(function(r){alert(r)})}var x=ot(),c=t(x),D=t(c),V=t(D);{var G=r=>{var u=rt(),d=t(u);E(j=>k(d,j),[()=>Le(Qe(s().exam_at),"dd.MM.yyyy")]),m(r,u)},L=r=>{var u=nt(),d=t(u);E(j=>k(d,j),[()=>Le(Qe(s().created_at),"dd.MM.yyyy")]),m(r,u)};R(V,r=>{s().exam_at?r(G):r(L,!1)})}var O=a(V,2),h=a(t(O)),v=a(O,2);{var Q=r=>{var u=it(),d=a(t(u));E(()=>k(d,` ${s().sessions.length??""}`)),m(r,u)};R(v,r=>{s().sessions&&r(Q)})}var P=a(v,2);{var Y=r=>{var u=de(),d=T(u);Fe(d,()=>e(w)),m(r,u)};R(P,r=>{e(w)&&r(Y)})}var o=a(P,2);o.__click=g;var C=t(o);let p;var A=a(o,2);A.__click=()=>S.selectDeck(s().id);var n=a(D,2),_=t(n),M=t(_),l=a(_,2),q=N(()=>z(()=>Ke(s().id)));l.__click=function(...r){e(q)?.apply(this,r)};var i=a(l,2);E(r=>{k(h,` ${s().questions.length??""}`),p=ue(C,1,"",null,p,{"bi-bookmark-check-fill":e(f),"bi-bookmark":!e(f)}),Pe(A,"id",`selected${s().id??""}`),Oe(A,r),Pe(_,"title",s().name),k(M,s().name),Pe(i,"href",`/decks/${s().id??""}`)},[()=>S.selectedDecks.has(s().id)]),m(J,x),ge()}pe(["click"]);var ct=U('<div class="col"><div class="alert alert-light">No decks found! Create a new deck <a href="/decks" class="alert-link">here</a>.</div></div>'),dt=U('<div class="d-flex justify-content-center"><div class="spinner-border text-secondary" role="status"><span class="visually-hidden">Loading decks ...</span></div></div>'),ut=U('<li><button class="page-link"> </button></li>'),vt=U('<div class="col"><nav><ul class="pagination"><li><button class="page-link">‹</button></li> <!> <li><button class="page-link">›</button></li></ul></nav></div>'),_t=U('<div class="row sticky-bottom bg-white mt-3 pt-3"><div class="col"><p class="small text-muted">Showing <span class="fw-semibold"> </span> to <span class="fw-semibold"> </span> of <span class="fw-semibold"> </span> decks</p></div> <!></div>'),mt=U('<div class="row mb-3"><div class="col"><div class="input-group"><span class="input-group-text"><i class="bi bi-archive"></i></span> <select id="kind" class="form-select"><option>Main decks</option><option>Your decks</option><option>User decks</option><option>Bookmarked decks</option></select></div></div></div> <!> <div class="row"><!></div> <!>',1);function ft(J,S){be(S,!0);let s=Me(S,"moduleId",15),w=Me(S,"selectedDecks",15),f=$(void 0),g=$(Z(D("kind")??"public-rw-listed")),x=$(Z(D("page")??1)),c=$(void 0);fe(()=>{s(),b(x,D("page")??1,!0),V()});function D(i){return new URLSearchParams(window.location.search).get(i)}function V(){if(!s()){b(f,[],!0);return}b(f,void 0);const i=new URL(window.location);i.searchParams.set("module",s()),i.searchParams.set("kind",e(g)),i.searchParams.set("page",e(x)),window.history.replaceState({},"",i),axios.get("/api/decks?module="+s()+"&kind="+e(g)+"&page="+e(x)).then(function(r){b(c,r.data,!0),b(f,e(c).data,!0),e(f).sort(function(u,d){return u.exam_at===null||d.exam_at===null?u.id<d.id?1:u.id>d.id?-1:0:u.exam_at<d.exam_at?1:u.exam_at>d.exam_at?-1:0})}).catch(function(r){alert(r)})}function G(i){b(x,i,!0),V()}var L=mt(),O=T(L),h=t(O),v=t(h),Q=a(t(v),2);Q.__change=V;var P=t(Q);P.value=P.__value="public-rw-listed";var Y=a(P);Y.value=Y.__value="user";var o=a(Y);o.value=o.__value="public";var C=a(o);C.value=C.__value="bookmarked";var p=a(O,2);st(p,{get decks(){return e(f)},set decks(i){b(f,i,!0)},get moduleId(){return s()},set moduleId(i){s(i)}});var A=a(p,2),n=t(A);{var _=i=>{var r=de(),u=T(r);De(u,19,()=>e(f),d=>d.id,(d,j,B)=>{lt(d,{get selectDeck(){return S.selectDeck},get deck(){return e(f)[e(B)]},set deck(I){e(f)[e(B)]=I},get selectedDecks(){return w()},set selectedDecks(I){w(I)}})},d=>{var j=ct();m(d,j)}),m(i,r)},M=i=>{var r=dt();m(i,r)};R(n,i=>{e(f)?i(_):i(M,!1)})}var l=a(A,2);{var q=i=>{var r=_t(),u=t(r),d=t(u),j=a(t(d)),B=t(j),I=a(j,2),W=t(I),ee=a(I,2),ae=t(ee),se=a(u,2);{var y=te=>{var ne=vt(),ie=t(ne),Ce=t(ie),ve=t(Ce);let he;var qe=t(ve),Ie=N(()=>z(()=>{e(c).prev_page_url&&G(e(c).current_page-1)}));qe.__click=function(...X){e(Ie)?.apply(this,X)};var ke=a(ve,2);De(ke,17,()=>e(c).links.slice(1,e(c).links.length-1),$e,(X,K)=>{var _e=ut();let me;var xe=t(_e),Ue=N(()=>z(()=>{e(K).url&&G(e(K).label)}));xe.__click=function(...re){e(Ue)?.apply(this,re)};var F=t(xe);E(()=>{me=ue(_e,1,"page-item d-none d-sm-block",null,me,{disabled:e(K).active||!e(K).url}),k(F,e(K).label)}),m(X,_e)});var we=a(ke,2);let H;var oe=t(we),le=N(()=>z(()=>{e(c).next_page_url&&G(e(c).current_page+1)}));oe.__click=function(...X){e(le)?.apply(this,X)},E(()=>{he=ue(ve,1,"page-item",null,he,{disabled:e(c).prev_page_url===null}),H=ue(we,1,"page-item",null,H,{disabled:e(c).next_page_url===null})}),m(te,ne)};R(se,te=>{e(c).last_page>1&&te(y)})}E(()=>{k(B,e(c).from),k(W,e(c).to),k(ae,e(c).total)}),m(i,r)};R(l,i=>{e(c)&&e(c).total>0&&i(q)})}E(()=>{ye(P,e(g)==="public-rw-listed"),ye(Y,e(g)==="user"),ye(o,e(g)==="public"),ye(C,e(g)==="bookmarked")}),We(Q,()=>e(g),i=>b(g,i)),m(J,L),ge()}pe(["change","click"]);var pt=U("/ <strong> </strong>",1),bt=U('<div class="row"><div class="col-md"><div class="alert alert-light" role="alert"><p>Create your own super deck:</p> <p>You have <strong> </strong> with <strong> </strong> <!> </p> <div class="mb-3"><label for="name" class="form-label">Deck Name</label> <input type="text" class="form-control" id="name"/></div> <div class="mb-3 form-check"><input type="checkbox" class="form-check-input" id="checkboxRemoveDuplicates"/> <label class="form-check-label" for="checkboxRemoveDuplicates">Filter out duplicates</label></div> <div class="d-grid gap-2 d-md-block"><button class="btn btn-sm btn-primary"> </button> <button class="btn btn-sm btn-primary"> </button> <button class="btn btn-sm btn-link">Cancel</button></div></div></div></div>');function gt(J,S){be(S,!0);let s=Me(S,"selectedDecks",15),w=$(Z([])),f=$("My new super deck"),g=$(!0);fe(()=>{s(),D()});let x=N(()=>(()=>{var h=[];return e(w).forEach(v=>h.push(...v.questions)),e(g)?[...new Map(h.map(v=>[v.id,v])).values()]:h})()),c=N(()=>(()=>{var h=[];return e(w).forEach(v=>{v.questions.forEach(Q=>{Q.images.length>0&&h.push(Q)})}),e(g)?[...new Map(h.map(v=>[v.id,v])).values()]:h})());function D(){if(s().size===0){b(w,[],!0);return}const h=[...s()].map(v=>"decks[]="+v);axios.get("/api/decks?"+h.join("&")).then(function(v){b(w,v.data,!0)}).catch(function(v){alert(v)})}function V(h,v){var Q={name:h,question_ids:v};axios.post("/api/decks",Q).then(function(P){window.location.href="/decks/"+P.data.id}).catch(function(P){alert(P)})}var G=de(),L=T(G);{var O=h=>{var v=bt(),Q=t(v),P=t(Q),Y=a(t(P),2),o=a(t(Y)),C=t(o),p=a(o,2),A=t(p),n=a(p,2);{var _=y=>{var te=pt(),ne=a(T(te)),ie=t(ne);E(()=>k(ie,`${e(c).length??""} question${e(c).length>1?"s":""} with images`)),m(y,te)};R(n,y=>{e(c).length>0&&y(_)})}var M=a(n),l=a(Y,2),q=a(t(l),2),i=a(l,2),r=t(i),u=a(i,2),d=t(u),j=N(()=>z(()=>V(e(f),e(x).map(y=>y.id))));d.__click=function(...y){e(j)?.apply(this,y)};var B=t(d),I=a(d,2),W=N(()=>z(()=>V(e(f),e(c).map(y=>y.id))));I.__click=function(...y){e(W)?.apply(this,y)};var ee=t(I),ae=a(I,2),se=N(()=>z(()=>s(new Set)));ae.__click=function(...y){e(se)?.apply(this,y)},E(()=>{k(C,`selected ${e(w).length??""} deck${e(w).length>1?"s":""}`),k(A,`${e(x).length??""} question${e(x).length>1?"s":""}`),k(M,` (duplicates ${e(g)?"excluded":"included"})`),k(B,`Create deck (${e(x).length??""} question${e(x).length>1?"s":""})`),k(ee,`Create deck (${e(c).length??""} image question${e(c).length>1?"s":""})`)}),Ve("focus",q,y=>y.target.select()),Te(q,()=>e(f),y=>b(f,y)),Je(r,()=>e(g),y=>b(g,y)),m(h,v)};R(L,h=>{e(w).length>0&&h(O)})}m(J,G),ge()}pe(["click"]);var ht=U('<button data-bs-target="#offcanvasModuleSelection" data-bs-dismiss="offcanvas"> </button>'),kt=U('<ul class="list-group m-2 me-0"></ul>'),wt=U("<button> </button> <!>",1),xt=U('<div class="alert alert-light text-center" role="alert">No module selected</div>'),yt=U('<div class="row"><div class="col-12 d-grid mb-2"><button type="button" class="btn btn-sm btn-primary d-lg-none my-2" data-bs-toggle="offcanvas" data-bs-target="#offcanvasModuleSelection" aria-controls="offcanvasModuleSelection">Switch module</button></div></div> <div class="row"><div class="col-lg-4 offcanvas-lg offcanvas-start" tabindex="-1" id="offcanvasModuleSelection"><div class="offcanvas-header"><h5 id="offcanvasAddToDeckLabel">Choose subject and module</h5> <button type="button" class="btn-close text-reset" data-bs-target="#offcanvasModuleSelection" data-bs-dismiss="offcanvas" aria-label="Close"></button></div> <div class="offcanvas-body"><ul class="list-group w-100"></ul></div></div> <div class="col-12 col-lg-8"><!> <!></div></div>',1);function St(J,S){be(S,!0);const s=()=>Ee(Se,"$UserSettings",w),[w,f]=Ge();let g=$(Z([])),x=$(Z([])),c=$(Z([])),D=$(Z(new Set));fe(()=>{s().last_subject_id,b(c,e(g).filter(n=>s().last_subject_id?n.subject?n.subject.id===s().last_subject_id:!1:!0),!0)}),Re(()=>{axios.get("/api/modules").then(function(n){var _=n.data;b(g,_.filter((l,q,i)=>q===i.findIndex(r=>r.id===l.id)).sort(function(l,q){return l.name>q.name?1:l.name<q.name?-1:0}),!0);var M=e(g).map(l=>l.subject).filter(l=>!!l);b(x,M.filter((l,q,i)=>q===i.findIndex(r=>r.id===l.id)).sort(function(l,q){return l.name>q.name?1:l.name<q.name?-1:0}),!0)}).catch(function(n){alert(n)})});function V(n){var _={last_subject_id:n,last_module_id:0};axios.put("/api/users/me/settings",_).then(function(M){const l=new URL(window.location);l.searchParams.delete("module"),l.searchParams.delete("page"),window.history.replaceState({},"",l),je(Se,ce(s).last_subject_id=n,ce(s)),je(Se,ce(s).last_module_id=0,ce(s))}).catch(function(M){alert(M)})}function G(n){var _={last_module_id:n};axios.put("/api/users/me/settings",_).then(function(M){const l=new URL(window.location);l.searchParams.set("module",n),l.searchParams.set("page",1),window.history.replaceState({},"",l),je(Se,ce(s).last_module_id=n,ce(s))}).catch(function(M){alert(M)})}function L(n){e(D).has(n)?e(D).delete(n):e(D).add(n),b(D,new Set([...e(D)]),!0)}var O=yt(),h=a(T(O),2),v=t(h),Q=a(t(v),2),P=t(Q);De(P,21,()=>e(x),$e,(n,_)=>{var M=wt(),l=T(M),q=N(()=>z(()=>V(e(_).id)));l.__click=function(...d){e(q)?.apply(this,d)};var i=t(l),r=a(l,2);{var u=d=>{var j=kt();De(j,21,()=>e(c),$e,(B,I)=>{var W=ht(),ee=N(()=>z(()=>G(e(I).id)));W.__click=function(...se){e(ee)?.apply(this,se)};var ae=t(W);E(()=>{ue(W,1,`list-group-item list-group-item-action ${s().last_module_id===e(I).id?"list-group-item-secondary":"list-group-item-light"}`),k(ae,e(I).name)}),m(B,W)}),m(d,j)};R(r,d=>{s().last_subject_id===e(_).id&&d(u)})}E(()=>{ue(l,1,`list-group-item list-group-item-action ${s().last_subject_id===e(_).id?"list-group-item-dark":"list-group-item-light"}`),k(i,e(_).name)}),m(n,M)});var Y=a(v,2),o=t(Y);gt(o,{get selectedDecks(){return e(D)},set selectedDecks(n){b(D,n,!0)}});var C=a(o,2);{var p=n=>{ft(n,{get moduleId(){return s().last_module_id},selectDeck:L,get selectedDecks(){return e(D)},set selectedDecks(_){b(D,_,!0)}})},A=n=>{var _=xt();m(n,_)};R(C,n=>{s().last_module_id?n(p):n(A,!1)})}m(J,O),ge(),f()}pe(["click"]);const Dt=document.getElementById("NewSessionView");Be(St,{target:Dt});
