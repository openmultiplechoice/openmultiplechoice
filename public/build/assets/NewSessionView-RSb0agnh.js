import{d as pe,p as be,s as L,n as ee,a as k,g as e,u as U,k as de,b as X,i as V,e as m,h as ge,f as I,c as s,j as t,t as G,m as x,v as Ve,w as ce,q as Ee}from"./if-BZUX_OG7.js";import{o as Re}from"./index-client-D2V4MdKn.js";import{p as z,a as je,b as Ge,c as ye,e as De,i as $e}from"./event-modifiers-Cjnfc0B6.js";import{s as ue}from"./class-BfJg_ovI.js";import{p as Me,s as Be,a as Oe,b as Pe}from"./props-DtkZ_l43.js";import{r as me}from"./legacy-client-Czxnps-C.js";import{b as We}from"./select-Db2Y0huo.js";import{b as Ye}from"./this-DNveabDO.js";import{C as ze}from"./auto-aF82oVy8.js";import{h as Fe}from"./html-DVYBXfyI.js";import{s as He}from"./StatsHelper-B91isISU.js";import{c as Ke}from"./NewSessionHelper-Ba9jtPTo.js";import{f as Le,p as Qe}from"./parseISO-BGu1X6cY.js";import{b as Te,a as Je}from"./input-Dhvtgc8-.js";import{U as Se}from"./UserSettingsStore-CcxVmnF3.js";var Xe=I('<div class="row"><div class="col-md"><div class="alert alert-light mb-3 py-2">Number of questions: <span class="badge text-black font-monospace" title="Number of questions"><i class="bi bi-collection"></i> </span></div></div></div>'),Ze=I('<button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> Repeat 30 incorrect</button>'),et=I('<button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> Repeat 60 incorrect</button>'),tt=I('<div class="d-grid gap-2"><!> <!> <button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> </button></div>'),at=I('<div class="row mb-5"><div class="col-md-5"><canvas></canvas></div> <div class="col-md-7 mt-3"><table class="table"><thead></thead><tbody><tr><td>Questions</td><td class="font-monospace text-end"> </td></tr><tr><td>Answered</td><td class="font-monospace text-end"> </td></tr><tr><td>Unanswered</td><td class="font-monospace text-end"> </td></tr><tr><td>Correct</td><td class="font-monospace text-end"> </td></tr><tr><td>Correct with help</td><td class="font-monospace text-end"> </td></tr><tr><td>Incorrect</td><td class="font-monospace text-end"> </td></tr></tbody></table> <!></div></div>');function st(F,_){be(_,!0);let n=L(ee([])),d=L(ee([])),w=L(void 0),b=L(void 0);me(()=>{_.decks,(()=>{if(!_.decks)return;const o=_.decks.map(p=>p.questions).flat();k(n,o.filter(p=>!p.is_invalid),!0);const q=[];for(const p of _.decks){const P=p.sessions.sort((f,y)=>y.id-f.id);if(P.length===0)continue;const r=P[0];q.push(...r.answer_choices)}k(d,q.filter(p=>e(n).some(({id:P})=>P===p.question_id)),!0)})()});let D=U(()=>e(n).length),c=U(()=>e(d).length),M=U(()=>e(D)-e(c)),B=U(()=>e(d).filter(o=>o.is_correct&&!o.help_used).length),O=U(()=>e(d).filter(o=>o.is_correct&&o.help_used).length),A=U(()=>e(d).filter(o=>!o.is_correct).length),W=U(()=>e(d).filter(o=>!o.is_correct).map(o=>o.question_id));me(()=>{e(b)&&(()=>{const o={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect","Unanswered"],datasets:[{label:"n",data:[e(B),e(O),e(A),e(M)],backgroundColor:["#198754","#ffc107","#dc3545","#bbbbbb"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};e(w)&&e(w).destroy();var q=e(b).getContext("2d");k(w,new ze(q,o),!0)})()});function g(o){const q={module_id:_.moduleId,question_ids:o};axios.post("/api/sessions/newfromquestionids",q).then(function(p){window.location.href="/sessions/"+p.data.id}).catch(function(p){alert(p)})}var v=de(),j=X(v);{var Q=o=>{var q=de(),p=X(q);{var P=r=>{var f=Xe(),y=t(f),l=t(y),C=s(t(l)),a=s(t(C));G(()=>x(a,` ${e(D)??""}`)),m(r,f)};V(p,r=>{e(D)>0&&r(P)})}m(o,q)},E=o=>{var q=de(),p=X(q);{var P=r=>{var f=at(),y=t(f),l=t(y);Ye(l,J=>k(b,J),()=>e(b));var C=s(y,2),a=t(C),i=s(t(a)),h=t(i),u=s(t(h)),R=t(u),$=s(h),N=s(t($)),T=t(N),te=s($),se=s(t(te)),ne=t(se),S=s(te),ae=s(t(S)),re=t(ae),ie=s(S),qe=s(t(ie)),ve=t(qe),he=s(ie),Ce=s(t(he)),Ie=t(Ce),ke=s(a,2);{var we=J=>{var oe=tt(),le=t(oe);{var H=K=>{var Z=Ze(),Ne=U(()=>z(()=>g(e(W).slice(0,30))));Z.__click=function(...Ae){e(Ne)?.apply(this,Ae)},m(K,Z)};V(le,K=>{e(A)>=40&&K(H)})}var Y=s(le,2);{var _e=K=>{var Z=et(),Ne=U(()=>z(()=>g(e(W).slice(0,60))));Z.__click=function(...Ae){e(Ne)?.apply(this,Ae)},m(K,Z)};V(Y,K=>{e(A)>=70&&K(_e)})}var fe=s(Y,2),xe=U(()=>z(()=>g(e(W))));fe.__click=function(...K){e(xe)?.apply(this,K)};var Ue=s(t(fe));G(()=>x(Ue,` Repeat ${e(A)??""} incorrect`)),m(J,oe)};V(ke,J=>{e(A)>0&&J(we)})}G((J,oe,le,H,Y)=>{x(R,e(D)),x(T,`${e(c)??""}
                            (${J??""}%)`),x(ne,`${e(M)??""}
                            (${oe??""}%)`),x(re,`${e(B)??""}
                            (${le??""}%)`),x(ve,`${e(O)??""}
                            (${H??""}%)`),x(Ie,`${e(A)??""}
                            (${Y??""}%)`)},[()=>Math.round(100*e(c)/e(D)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(M)/e(D)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(B)/e(c)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(O)/e(c)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(A)/e(c)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})]),m(r,f)};V(p,r=>{_.decks&&r(P)},!0)}m(o,q)};V(j,o=>{_.decks&&e(D)===e(M)?o(Q):o(E,!1)})}m(F,v),ge()}pe(["click"]);function nt(F,_,n){e(_)?axios.delete("/api/decks/"+n().id+"/bookmark/"+n().bookmarks[0].id).then(function(d){d.status===204&&k(_,!1)}).catch(function(d){alert(d)}):axios.post("/api/decks/"+n().id+"/bookmark").then(function(d){d.status===200&&(k(_,!0),n(n().bookmarks=[d.data],!0))}).catch(function(d){alert(d)})}var rt=I('<span class="badge text-bg-light"> </span>'),it=I('<span class="badge text-bg-light"> </span>'),ot=I('<span class="badge text-bg-light font-monospace" title="Number of sessions"><i class="bi bi-rocket"></i> </span>'),lt=(F,_,n)=>_.selectDeck(n().id),ct=I('<div class="col-md-6 mb-3"><div class="card"><div class="card-header"><!> <span class="badge text-bg-light font-monospace" title="Number of questions"><i class="bi bi-collection"></i> </span> <!> <!> <button class="btn btn-sm btn-link"><i></i></button> <input type="checkbox" class="form-check-input float-end" value=""/></div> <div class="card-body"><h6 class="card-title text-truncate"> </h6> <button type="button" class="btn btn-sm btn-primary"><i class="bi bi-rocket-takeoff"></i> Start session</button> <a class="card-link">Browse deck</a></div></div></div>');function dt(F,_){be(_,!0);let n=Me(_,"deck",15),d=L(void 0),w=L(n().bookmarks.length>0);Re(()=>{const a=n().questions.filter($=>!$.is_invalid),i=n().sessions.sort(($,N)=>N.id-$.id);if(i.length===0)return;const u=i[0].answer_choices.filter($=>a.some(({id:N})=>N===$.question_id)),R=He(a.length,u);R.correct>=60?k(d,'<span class="badge text-bg-success" title="Correct answers in percent">'+R.correct+" %</span>"):k(d,'<span class="badge text-bg-danger" title="Correct answers in percent">'+R.correct+" %</span>")});var b=ct(),D=t(b),c=t(D),M=t(c);{var B=a=>{var i=rt(),h=t(i);G(u=>x(h,u),[()=>Le(Qe(n().exam_at),"dd.MM.yyyy")]),m(a,i)},O=a=>{var i=it(),h=t(i);G(u=>x(h,u),[()=>Le(Qe(n().created_at),"dd.MM.yyyy")]),m(a,i)};V(M,a=>{n().exam_at?a(B):a(O,!1)})}var A=s(M,2),W=s(t(A)),g=s(A,2);{var v=a=>{var i=ot(),h=s(t(i));G(()=>x(h,` ${n().sessions.length??""}`)),m(a,i)};V(g,a=>{n().sessions&&a(v)})}var j=s(g,2);{var Q=a=>{var i=de(),h=X(i);Fe(h,()=>e(d)),m(a,i)};V(j,a=>{e(d)&&a(Q)})}var E=s(j,2);E.__click=[nt,w,n];var o=t(E);let q;var p=s(E,2);p.__click=[lt,_,n];var P=s(c,2),r=t(P),f=t(r),y=s(r,2),l=U(()=>z(()=>Ke(n().id)));y.__click=function(...a){e(l)?.apply(this,a)};var C=s(y,2);G((a,i)=>{x(W,` ${n().questions.length??""}`),q=ue(o,1,"",null,q,a),je(p,"id",`selected${n().id??""}`),Ge(p,i),je(r,"title",n().name),x(f,n().name),je(C,"href",`/decks/${n().id??""}`)},[()=>({"bi-bookmark-check-fill":e(w),"bi-bookmark":!e(w)}),()=>_.selectedDecks.has(n().id)]),m(F,b),ge()}pe(["click"]);var ut=I('<div class="col"><div class="alert alert-light">No decks found! Create a new deck <a href="/decks" class="alert-link">here</a>.</div></div>'),vt=I('<div class="d-flex justify-content-center"><div class="spinner-border text-secondary" role="status"><span class="visually-hidden">Loading decks ...</span></div></div>'),_t=I('<li><button class="page-link"> </button></li>'),ft=I('<div class="col"><nav><ul class="pagination"><li><button class="page-link">‹</button></li> <!> <li><button class="page-link">›</button></li></ul></nav></div>'),mt=I('<div class="row sticky-bottom bg-white mt-3 pt-3"><div class="col"><p class="small text-muted">Showing <span class="fw-semibold"> </span> to <span class="fw-semibold"> </span> of <span class="fw-semibold"> </span> decks</p></div> <!></div>'),pt=I('<div class="row mb-3"><div class="col"><div class="input-group"><span class="input-group-text"><i class="bi bi-archive"></i></span> <select id="kind" class="form-select"><option>Main decks</option><option>Your decks</option><option>User decks</option><option>Bookmarked decks</option></select></div></div></div> <!> <div class="row"><!></div> <!>',1);function bt(F,_){be(_,!0);let n=Me(_,"moduleId",15),d=Me(_,"selectedDecks",15),w=L(void 0),b=L(ee(M("kind")??"public-rw-listed")),D=L(ee(M("page")??1)),c=L(void 0);me(()=>{n(),k(D,M("page")??1,!0),B()});function M(a){return new URLSearchParams(window.location.search).get(a)}function B(){if(!n()){k(w,[],!0);return}k(w,void 0);const a=new URL(window.location);a.searchParams.set("module",n()),a.searchParams.set("kind",e(b)),a.searchParams.set("page",e(D)),window.history.replaceState({},"",a),axios.get("/api/decks?module="+n()+"&kind="+e(b)+"&page="+e(D)).then(function(i){k(c,i.data,!0),k(w,e(c).data,!0),e(w).sort(function(h,u){return h.exam_at===null||u.exam_at===null?h.id<u.id?1:h.id>u.id?-1:0:h.exam_at<u.exam_at?1:h.exam_at>u.exam_at?-1:0})}).catch(function(i){alert(i)})}function O(a){k(D,a,!0),B()}var A=pt(),W=X(A),g=t(W),v=t(g),j=s(t(v),2);j.__change=B;var Q=t(j);Q.value=Q.__value="public-rw-listed";var E=s(Q);E.value=E.__value="user";var o=s(E);o.value=o.__value="public";var q=s(o);q.value=q.__value="bookmarked";var p=s(W,2);st(p,{get decks(){return e(w)},set decks(a){k(w,a,!0)},get moduleId(){return n()},set moduleId(a){n(a)}});var P=s(p,2),r=t(P);{var f=a=>{var i=de(),h=X(i);De(h,19,()=>e(w),u=>u.id,(u,R,$)=>{dt(u,{get selectDeck(){return _.selectDeck},get deck(){return e(w)[e($)]},set deck(N){e(w)[e($)]=N},get selectedDecks(){return d()},set selectedDecks(N){d(N)}})},u=>{var R=ut();m(u,R)}),m(a,i)},y=a=>{var i=vt();m(a,i)};V(r,a=>{e(w)?a(f):a(y,!1)})}var l=s(P,2);{var C=a=>{var i=mt(),h=t(i),u=t(h),R=s(t(u)),$=t(R),N=s(R,2),T=t(N),te=s(N,2),se=t(te),ne=s(h,2);{var S=ae=>{var re=ft(),ie=t(re),qe=t(ie),ve=t(qe);let he;var Ce=t(ve),Ie=U(()=>z(()=>{e(c).prev_page_url&&O(e(c).current_page-1)}));Ce.__click=function(...H){e(Ie)?.apply(this,H)};var ke=s(ve,2);De(ke,17,()=>e(c).links.slice(1,e(c).links.length-1),$e,(H,Y)=>{var _e=_t();let fe;var xe=t(_e),Ue=U(()=>z(()=>{e(Y).url&&O(e(Y).label)}));xe.__click=function(...Z){e(Ue)?.apply(this,Z)};var K=t(xe);G(Z=>{fe=ue(_e,1,"page-item d-none d-sm-block",null,fe,Z),x(K,e(Y).label)},[()=>({disabled:e(Y).active||!e(Y).url})]),m(H,_e)});var we=s(ke,2);let J;var oe=t(we),le=U(()=>z(()=>{e(c).next_page_url&&O(e(c).current_page+1)}));oe.__click=function(...H){e(le)?.apply(this,H)},G((H,Y)=>{he=ue(ve,1,"page-item",null,he,H),J=ue(we,1,"page-item",null,J,Y)},[()=>({disabled:e(c).prev_page_url===null}),()=>({disabled:e(c).next_page_url===null})]),m(ae,re)};V(ne,ae=>{e(c).last_page>1&&ae(S)})}G(()=>{x($,e(c).from),x(T,e(c).to),x(se,e(c).total)}),m(a,i)};V(l,a=>{e(c)&&e(c).total>0&&a(C)})}G(()=>{ye(Q,e(b)==="public-rw-listed"),ye(E,e(b)==="user"),ye(o,e(b)==="public"),ye(q,e(b)==="bookmarked")}),We(j,()=>e(b),a=>k(b,a)),m(F,A),ge()}pe(["change","click"]);var gt=I("/ <strong> </strong>",1),ht=I('<div class="row"><div class="col-md"><div class="alert alert-light" role="alert"><p>Create your own super deck:</p> <p>You have <strong> </strong> with <strong> </strong> <!> </p> <div class="mb-3"><label for="name" class="form-label">Deck Name</label> <input type="text" class="form-control" id="name"/></div> <div class="mb-3 form-check"><input type="checkbox" class="form-check-input" id="checkboxRemoveDuplicates"/> <label class="form-check-label" for="checkboxRemoveDuplicates">Filter out duplicates</label></div> <div class="d-grid gap-2 d-md-block"><button class="btn btn-sm btn-primary"> </button> <button class="btn btn-sm btn-primary"> </button> <button class="btn btn-sm btn-link">Cancel</button></div></div></div></div>');function kt(F,_){be(_,!0);let n=Me(_,"selectedDecks",15),d=L(ee([])),w=L("My new super deck"),b=L(!0);me(()=>{n(),M()});let D=U(()=>(()=>{var g=[];return e(d).forEach(v=>g.push(...v.questions)),e(b)?[...new Map(g.map(v=>[v.id,v])).values()]:g})()),c=U(()=>(()=>{var g=[];return e(d).forEach(v=>{v.questions.forEach(j=>{j.images.length>0&&g.push(j)})}),e(b)?[...new Map(g.map(v=>[v.id,v])).values()]:g})());function M(){if(n().size===0){k(d,[],!0);return}const g=[...n()].map(v=>"decks[]="+v);axios.get("/api/decks?"+g.join("&")).then(function(v){k(d,v.data,!0)}).catch(function(v){alert(v)})}function B(g,v){var j={name:g,question_ids:v};axios.post("/api/decks",j).then(function(Q){window.location.href="/decks/"+Q.data.id}).catch(function(Q){alert(Q)})}var O=de(),A=X(O);{var W=g=>{var v=ht(),j=t(v),Q=t(j),E=s(t(Q),2),o=s(t(E)),q=t(o),p=s(o,2),P=t(p),r=s(p,2);{var f=S=>{var ae=gt(),re=s(X(ae)),ie=t(re);G(()=>x(ie,`${e(c).length??""} question${e(c).length>1?"s":""} with images`)),m(S,ae)};V(r,S=>{e(c).length>0&&S(f)})}var y=s(r),l=s(E,2),C=s(t(l),2),a=s(l,2),i=t(a),h=s(a,2),u=t(h),R=U(()=>z(()=>B(e(w),e(D).map(S=>S.id))));u.__click=function(...S){e(R)?.apply(this,S)};var $=t(u),N=s(u,2),T=U(()=>z(()=>B(e(w),e(c).map(S=>S.id))));N.__click=function(...S){e(T)?.apply(this,S)};var te=t(N),se=s(N,2),ne=U(()=>z(()=>n(new Set)));se.__click=function(...S){e(ne)?.apply(this,S)},G(()=>{x(q,`selected ${e(d).length??""} deck${e(d).length>1?"s":""}`),x(P,`${e(D).length??""} question${e(D).length>1?"s":""}`),x(y,` (duplicates ${e(b)?"excluded":"included"})`),x($,`Create deck (${e(D).length??""} question${e(D).length>1?"s":""})`),x(te,`Create deck (${e(c).length??""} image question${e(c).length>1?"s":""})`)}),Ve("focus",C,S=>S.target.select()),Te(C,()=>e(w),S=>k(w,S)),Je(i,()=>e(b),S=>k(b,S)),m(g,v)};V(A,g=>{e(d).length>0&&g(W)})}m(F,O),ge()}pe(["click"]);var wt=I('<button data-bs-target="#offcanvasModuleSelection" data-bs-dismiss="offcanvas"> </button>'),xt=I('<ul class="list-group m-2 me-0"></ul>'),yt=I("<button> </button> <!>",1),St=I('<div class="alert alert-light text-center" role="alert">No module selected</div>'),Dt=I('<div class="row"><div class="col-12 d-grid mb-2"><button type="button" class="btn btn-sm btn-primary d-lg-none my-2" data-bs-toggle="offcanvas" data-bs-target="#offcanvasModuleSelection" aria-controls="offcanvasModuleSelection">Switch module</button></div></div> <div class="row"><div class="col-lg-4 offcanvas-lg offcanvas-start" tabindex="-1" id="offcanvasModuleSelection"><div class="offcanvas-header"><h5 id="offcanvasAddToDeckLabel">Choose subject and module</h5> <button type="button" class="btn-close text-reset" data-bs-target="#offcanvasModuleSelection" data-bs-dismiss="offcanvas" aria-label="Close"></button></div> <div class="offcanvas-body"><ul class="list-group w-100"></ul></div></div> <div class="col-12 col-lg-8"><!> <!></div></div>',1);function Mt(F,_){be(_,!0);const n=()=>Be(Se,"$UserSettings",d),[d,w]=Oe();let b=L(ee([])),D=L(ee([])),c=L(ee([])),M=L(ee(new Set));me(()=>{n().last_subject_id,k(c,e(b).filter(r=>n().last_subject_id?r.subject?r.subject.id===n().last_subject_id:!1:!0),!0)}),Re(()=>{axios.get("/api/modules").then(function(r){var f=r.data;k(b,f.filter((l,C,a)=>C===a.findIndex(i=>i.id===l.id)).sort(function(l,C){return l.name>C.name?1:l.name<C.name?-1:0}),!0);var y=e(b).map(l=>l.subject).filter(l=>!!l);k(D,y.filter((l,C,a)=>C===a.findIndex(i=>i.id===l.id)).sort(function(l,C){return l.name>C.name?1:l.name<C.name?-1:0}),!0)}).catch(function(r){alert(r)})});function B(r){var f={last_subject_id:r,last_module_id:0};axios.put("/api/users/me/settings",f).then(function(y){const l=new URL(window.location);l.searchParams.delete("module"),l.searchParams.delete("page"),window.history.replaceState({},"",l),Pe(Se,ce(n).last_subject_id=r,ce(n)),Pe(Se,ce(n).last_module_id=0,ce(n))}).catch(function(y){alert(y)})}function O(r){var f={last_module_id:r};axios.put("/api/users/me/settings",f).then(function(y){const l=new URL(window.location);l.searchParams.set("module",r),l.searchParams.set("page",1),window.history.replaceState({},"",l),Pe(Se,ce(n).last_module_id=r,ce(n))}).catch(function(y){alert(y)})}function A(r){e(M).has(r)?e(M).delete(r):e(M).add(r),k(M,new Set([...e(M)]),!0)}var W=Dt(),g=s(X(W),2),v=t(g),j=s(t(v),2),Q=t(j);De(Q,21,()=>e(D),$e,(r,f)=>{var y=yt(),l=X(y),C=U(()=>z(()=>B(e(f).id)));l.__click=function(...u){e(C)?.apply(this,u)};var a=t(l),i=s(l,2);{var h=u=>{var R=xt();De(R,21,()=>e(c),$e,($,N)=>{var T=wt(),te=U(()=>z(()=>O(e(N).id)));T.__click=function(...ne){e(te)?.apply(this,ne)};var se=t(T);G(()=>{ue(T,1,`list-group-item list-group-item-action ${n().last_module_id===e(N).id?"list-group-item-secondary":"list-group-item-light"}`),x(se,e(N).name)}),m($,T)}),m(u,R)};V(i,u=>{n().last_subject_id===e(f).id&&u(h)})}G(()=>{ue(l,1,`list-group-item list-group-item-action ${n().last_subject_id===e(f).id?"list-group-item-dark":"list-group-item-light"}`),x(a,e(f).name)}),m(r,y)});var E=s(v,2),o=t(E);kt(o,{get selectedDecks(){return e(M)},set selectedDecks(r){k(M,r,!0)}});var q=s(o,2);{var p=r=>{bt(r,{get moduleId(){return n().last_module_id},selectDeck:A,get selectedDecks(){return e(M)},set selectedDecks(f){k(M,f,!0)}})},P=r=>{var f=St();m(r,f)};V(q,r=>{n().last_module_id?r(p):r(P,!1)})}m(F,W),ge(),w()}pe(["click"]);const qt=document.getElementById("NewSessionView");Ee(Mt,{target:qt});
