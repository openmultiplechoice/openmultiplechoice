import{d as pe,p as be,s as L,n as Z,a as k,g as e,u as I,k as fe,b as ee,i as E,e as p,h as ge,f as q,c as s,j as t,t as G,m as x,v as Ve,w as ce,q as Ee}from"./if-GZgNzgdl.js";import{o as Re}from"./index-client-CpfOMyFP.js";import{p as z,a as je,b as Ge,c as ye,e as De,i as $e}from"./event-modifiers-CaIg6h4B.js";import{s as de}from"./class-BfJg_ovI.js";import{p as Me,s as Be,a as Oe,b as Pe}from"./props-D-4SDZEQ.js";import{r as me}from"./legacy-client-DjQiZhkg.js";import{b as We}from"./select-BE7SEtm-.js";import{b as Ye}from"./this-VlG-phZ8.js";import{C as ze}from"./auto-g150VQ4A.js";import{h as Fe}from"./html-G7Rd4QX6.js";import{s as He}from"./StatsHelper-B91isISU.js";import{c as Ke}from"./NewSessionHelper-Ba9jtPTo.js";import{f as Le,p as Qe}from"./parseISO-BGu1X6cY.js";import{b as Te,a as Je}from"./input-B1qKra93.js";import{U as Se}from"./UserSettingsStore-B6cfb3ZE.js";var Xe=q('<div class="row"><div class="col-md"><p>Number of questions (duplicates included): <span class="badge text-bg-light font-monospace"><i class="bi bi-collection"></i> </span></p></div></div>'),Ze=q('<button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> Repeat 30 incorrect</button>'),et=q('<button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> Repeat 60 incorrect</button>'),tt=q('<div class="d-grid gap-2"><!> <!> <button class="btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-repeat"></i> </button></div>'),at=q('<div class="row mb-5"><div class="col-md-5"><canvas></canvas></div> <div class="col-md-7 mt-3"><table class="table"><thead></thead><tbody><tr><td>Questions</td><td class="font-monospace text-end"> </td></tr><tr><td>Answered</td><td class="font-monospace text-end"> </td></tr><tr><td>Unanswered</td><td class="font-monospace text-end"> </td></tr><tr><td>Correct</td><td class="font-monospace text-end"> </td></tr><tr><td>Correct with help</td><td class="font-monospace text-end"> </td></tr><tr><td>Incorrect</td><td class="font-monospace text-end"> </td></tr></tbody></table> <!></div></div>');function st(F,_){be(_,!0);let n=L(Z([])),d=L(Z([])),w=L(void 0),b=L(void 0);me(()=>{_.decks,(()=>{if(!_.decks)return;const o=_.decks.map(f=>f.questions).flat();k(n,o.filter(f=>!f.is_invalid),!0);const D=[];for(const f of _.decks){const P=f.sessions.sort((m,C)=>C.id-m.id);if(P.length===0)continue;const r=P[0];D.push(...r.answer_choices)}k(d,D.filter(f=>e(n).some(({id:P})=>P===f.question_id)),!0)})()});let M=I(()=>e(n).length),l=I(()=>e(d).length),S=I(()=>e(M)-e(l)),B=I(()=>e(d).filter(o=>o.is_correct&&!o.help_used).length),O=I(()=>e(d).filter(o=>o.is_correct&&o.help_used).length),N=I(()=>e(d).filter(o=>!o.is_correct).length),W=I(()=>e(d).filter(o=>!o.is_correct).map(o=>o.question_id));me(()=>{e(b)&&(()=>{const o={type:"doughnut",data:{labels:["Correct","Correct with help","Incorrect","Unanswered"],datasets:[{label:"n",data:[e(B),e(O),e(N),e(S)],backgroundColor:["#198754","#ffc107","#dc3545","#bbbbbb"],hoverOffet:4}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:null},plugins:{legend:{display:!1}}}};e(w)&&e(w).destroy();var D=e(b).getContext("2d");k(w,new ze(D,o),!0)})()});function g(o){const D={module_id:_.moduleId,question_ids:o};axios.post("/api/sessions/newfromquestionids",D).then(function(f){window.location.href="/sessions/"+f.data.id}).catch(function(f){alert(f)})}var v=fe(),j=ee(v);{var Q=o=>{var D=Xe(),f=t(D),P=t(f),r=s(t(P)),m=s(t(r));G(()=>x(m,` ${e(M)??""}`)),p(o,D)},V=o=>{var D=fe(),f=ee(D);{var P=r=>{var m=at(),C=t(m),c=t(C);Ye(c,J=>k(b,J),()=>e(b));var U=s(C,2),a=t(U),i=s(t(a)),h=t(i),u=s(t(h)),R=t(u),$=s(h),A=s(t($)),T=t(A),te=s($),se=s(t(te)),ne=t(se),y=s(te),ae=s(t(y)),re=t(ae),ie=s(y),Ce=s(t(ie)),ue=t(Ce),he=s(ie),qe=s(t(he)),Ie=t(qe),ke=s(a,2);{var we=J=>{var oe=tt(),le=t(oe);{var H=K=>{var X=Ze(),Ae=I(()=>z(()=>g(e(W).slice(0,30))));X.__click=function(...Ne){e(Ae)?.apply(this,Ne)},p(K,X)};E(le,K=>{e(N)>=40&&K(H)})}var Y=s(le,2);{var ve=K=>{var X=et(),Ae=I(()=>z(()=>g(e(W).slice(0,60))));X.__click=function(...Ne){e(Ae)?.apply(this,Ne)},p(K,X)};E(Y,K=>{e(N)>=70&&K(ve)})}var _e=s(Y,2),xe=I(()=>z(()=>g(e(W))));_e.__click=function(...K){e(xe)?.apply(this,K)};var Ue=s(t(_e));G(()=>x(Ue,` Repeat ${e(N)??""} incorrect`)),p(J,oe)};E(ke,J=>{e(N)>0&&J(we)})}G((J,oe,le,H,Y)=>{x(R,e(M)),x(T,`${e(l)??""}
                            (${J??""}%)`),x(ne,`${e(S)??""}
                            (${oe??""}%)`),x(re,`${e(B)??""}
                            (${le??""}%)`),x(ue,`${e(O)??""}
                            (${H??""}%)`),x(Ie,`${e(N)??""}
                            (${Y??""}%)`)},[()=>Math.round(100*e(l)/e(M)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(S)/e(M)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(B)/e(l)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(O)/e(l)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),()=>Math.round(100*e(N)/e(l)).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})]),p(r,m)};E(f,r=>{_.decks&&r(P)},!0)}p(o,D)};E(j,o=>{_.decks&&e(M)===e(S)?o(Q):o(V,!1)})}p(F,v),ge()}pe(["click"]);function nt(F,_,n){e(_)?axios.delete("/api/decks/"+n().id+"/bookmark/"+n().bookmarks[0].id).then(function(d){d.status===204&&k(_,!1)}).catch(function(d){alert(d)}):axios.post("/api/decks/"+n().id+"/bookmark").then(function(d){d.status===200&&(k(_,!0),n(n().bookmarks=[d.data],!0))}).catch(function(d){alert(d)})}var rt=q('<span class="badge text-bg-light"> </span>'),it=q('<span class="badge text-bg-light"> </span>'),ot=q('<span class="badge text-bg-light font-monospace" title="Number of sessions"><i class="bi bi-rocket"></i> </span>'),lt=(F,_,n)=>_.selectDeck(n().id),ct=q('<div class="col-md-6 mb-3"><div class="card"><div class="card-header"><!> <span class="badge text-bg-light font-monospace" title="Number of questions"><i class="bi bi-collection"></i> </span> <!> <!> <button class="btn btn-sm btn-link"><i></i></button> <input type="checkbox" class="form-check-input float-end" value=""/></div> <div class="card-body"><h6 class="card-title text-truncate"> </h6> <button type="button" class="btn btn-sm btn-primary"><i class="bi bi-rocket-takeoff"></i> Start session</button> <a class="card-link">Browse deck</a></div></div></div>');function dt(F,_){be(_,!0);let n=Me(_,"deck",15),d=L(void 0),w=L(n().bookmarks.length>0);Re(()=>{const a=n().questions.filter($=>!$.is_invalid),i=n().sessions.sort(($,A)=>A.id-$.id);if(i.length===0)return;const u=i[0].answer_choices.filter($=>a.some(({id:A})=>A===$.question_id)),R=He(a.length,u);R.correct>=60?k(d,'<span class="badge text-bg-success" title="Correct answers in percent">'+R.correct+" %</span>"):k(d,'<span class="badge text-bg-danger" title="Correct answers in percent">'+R.correct+" %</span>")});var b=ct(),M=t(b),l=t(M),S=t(l);{var B=a=>{var i=rt(),h=t(i);G(u=>x(h,u),[()=>Le(Qe(n().exam_at),"dd.MM.yyyy")]),p(a,i)},O=a=>{var i=it(),h=t(i);G(u=>x(h,u),[()=>Le(Qe(n().created_at),"dd.MM.yyyy")]),p(a,i)};E(S,a=>{n().exam_at?a(B):a(O,!1)})}var N=s(S,2),W=s(t(N)),g=s(N,2);{var v=a=>{var i=ot(),h=s(t(i));G(()=>x(h,` ${n().sessions.length??""}`)),p(a,i)};E(g,a=>{n().sessions&&a(v)})}var j=s(g,2);{var Q=a=>{var i=fe(),h=ee(i);Fe(h,()=>e(d)),p(a,i)};E(j,a=>{e(d)&&a(Q)})}var V=s(j,2);V.__click=[nt,w,n];var o=t(V);let D;var f=s(V,2);f.__click=[lt,_,n];var P=s(l,2),r=t(P),m=t(r),C=s(r,2),c=I(()=>z(()=>Ke(n().id)));C.__click=function(...a){e(c)?.apply(this,a)};var U=s(C,2);G((a,i)=>{x(W,` ${n().questions.length??""}`),D=de(o,1,"",null,D,a),je(f,"id",`selected${n().id??""}`),Ge(f,i),je(r,"title",n().name),x(m,n().name),je(U,"href",`/decks/${n().id??""}`)},[()=>({"bi-bookmark-check-fill":e(w),"bi-bookmark":!e(w)}),()=>_.selectedDecks.has(n().id)]),p(F,b),ge()}pe(["click"]);var ut=q('<div class="col"><div class="alert alert-light">No decks found! Create a new deck <a href="/decks" class="alert-link">here</a>.</div></div>'),vt=q('<div class="d-flex justify-content-center"><div class="spinner-border text-secondary" role="status"><span class="visually-hidden">Loading decks ...</span></div></div>'),_t=q('<li><button class="page-link"> </button></li>'),ft=q('<div class="col"><nav><ul class="pagination"><li><button class="page-link">‹</button></li> <!> <li><button class="page-link">›</button></li></ul></nav></div>'),mt=q('<div class="row sticky-bottom bg-white mt-3 pt-3"><div class="col"><p class="small text-muted">Showing <span class="fw-semibold"> </span> to <span class="fw-semibold"> </span> of <span class="fw-semibold"> </span> decks</p></div> <!></div>'),pt=q('<div class="row mb-3"><div class="col"><div class="input-group"><span class="input-group-text"><i class="bi bi-archive"></i></span> <select id="kind" class="form-select"><option>Main decks</option><option>Your decks</option><option>User decks</option><option>Bookmarked decks</option></select></div></div></div> <!> <div class="row"><!></div> <!>',1);function bt(F,_){be(_,!0);let n=Me(_,"moduleId",15),d=Me(_,"selectedDecks",15),w=L(void 0),b=L(Z(S("kind")??"public-rw-listed")),M=L(Z(S("page")??1)),l=L(void 0);me(()=>{n(),k(M,S("page")??1,!0),B()});function S(a){return new URLSearchParams(window.location.search).get(a)}function B(){if(!n()){k(w,[],!0);return}k(w,void 0);const a=new URL(window.location);a.searchParams.set("module",n()),a.searchParams.set("kind",e(b)),a.searchParams.set("page",e(M)),window.history.replaceState({},"",a),axios.get("/api/decks?module="+n()+"&kind="+e(b)+"&page="+e(M)).then(function(i){k(l,i.data,!0),k(w,e(l).data,!0),e(w).sort(function(h,u){return h.exam_at===null||u.exam_at===null?h.id<u.id?1:h.id>u.id?-1:0:h.exam_at<u.exam_at?1:h.exam_at>u.exam_at?-1:0})}).catch(function(i){alert(i)})}function O(a){k(M,a,!0),B()}var N=pt(),W=ee(N),g=t(W),v=t(g),j=s(t(v),2);j.__change=B;var Q=t(j);Q.value=Q.__value="public-rw-listed";var V=s(Q);V.value=V.__value="user";var o=s(V);o.value=o.__value="public";var D=s(o);D.value=D.__value="bookmarked";var f=s(W,2);st(f,{get decks(){return e(w)},set decks(a){k(w,a,!0)},get moduleId(){return n()},set moduleId(a){n(a)}});var P=s(f,2),r=t(P);{var m=a=>{var i=fe(),h=ee(i);De(h,19,()=>e(w),u=>u.id,(u,R,$)=>{dt(u,{get selectDeck(){return _.selectDeck},get deck(){return e(w)[e($)]},set deck(A){e(w)[e($)]=A},get selectedDecks(){return d()},set selectedDecks(A){d(A)}})},u=>{var R=ut();p(u,R)}),p(a,i)},C=a=>{var i=vt();p(a,i)};E(r,a=>{e(w)?a(m):a(C,!1)})}var c=s(P,2);{var U=a=>{var i=mt(),h=t(i),u=t(h),R=s(t(u)),$=t(R),A=s(R,2),T=t(A),te=s(A,2),se=t(te),ne=s(h,2);{var y=ae=>{var re=ft(),ie=t(re),Ce=t(ie),ue=t(Ce);let he;var qe=t(ue),Ie=I(()=>z(()=>{e(l).prev_page_url&&O(e(l).current_page-1)}));qe.__click=function(...H){e(Ie)?.apply(this,H)};var ke=s(ue,2);De(ke,17,()=>e(l).links.slice(1,e(l).links.length-1),$e,(H,Y)=>{var ve=_t();let _e;var xe=t(ve),Ue=I(()=>z(()=>{e(Y).url&&O(e(Y).label)}));xe.__click=function(...X){e(Ue)?.apply(this,X)};var K=t(xe);G(X=>{_e=de(ve,1,"page-item d-none d-sm-block",null,_e,X),x(K,e(Y).label)},[()=>({disabled:e(Y).active||!e(Y).url})]),p(H,ve)});var we=s(ke,2);let J;var oe=t(we),le=I(()=>z(()=>{e(l).next_page_url&&O(e(l).current_page+1)}));oe.__click=function(...H){e(le)?.apply(this,H)},G((H,Y)=>{he=de(ue,1,"page-item",null,he,H),J=de(we,1,"page-item",null,J,Y)},[()=>({disabled:e(l).prev_page_url===null}),()=>({disabled:e(l).next_page_url===null})]),p(ae,re)};E(ne,ae=>{e(l).last_page>1&&ae(y)})}G(()=>{x($,e(l).from),x(T,e(l).to),x(se,e(l).total)}),p(a,i)};E(c,a=>{e(l)&&e(l).total>0&&a(U)})}G(()=>{ye(Q,e(b)==="public-rw-listed"),ye(V,e(b)==="user"),ye(o,e(b)==="public"),ye(D,e(b)==="bookmarked")}),We(j,()=>e(b),a=>k(b,a)),p(F,N),ge()}pe(["change","click"]);var gt=q("/ <strong> </strong>",1),ht=q('<div class="row"><div class="col-md"><div class="alert alert-light" role="alert"><p>Create your own super deck:</p> <p>You have <strong> </strong> with <strong> </strong> <!> </p> <div class="mb-3"><label for="name" class="form-label">Deck Name</label> <input type="text" class="form-control" id="name"/></div> <div class="mb-3 form-check"><input type="checkbox" class="form-check-input" id="checkboxRemoveDuplicates"/> <label class="form-check-label" for="checkboxRemoveDuplicates">Filter out duplicates</label></div> <div class="d-grid gap-2 d-md-block"><button class="btn btn-sm btn-primary"> </button> <button class="btn btn-sm btn-primary"> </button> <button class="btn btn-sm btn-link">Cancel</button></div></div></div></div>');function kt(F,_){be(_,!0);let n=Me(_,"selectedDecks",15),d=L(Z([])),w=L("My new super deck"),b=L(!0);me(()=>{n(),S()});let M=I(()=>(()=>{var g=[];return e(d).forEach(v=>g.push(...v.questions)),e(b)?[...new Map(g.map(v=>[v.id,v])).values()]:g})()),l=I(()=>(()=>{var g=[];return e(d).forEach(v=>{v.questions.forEach(j=>{j.images.length>0&&g.push(j)})}),e(b)?[...new Map(g.map(v=>[v.id,v])).values()]:g})());function S(){if(n().size===0){k(d,[],!0);return}const g=[...n()].map(v=>"decks[]="+v);axios.get("/api/decks?"+g.join("&")).then(function(v){k(d,v.data,!0)}).catch(function(v){alert(v)})}function B(g,v){var j={name:g,question_ids:v};axios.post("/api/decks",j).then(function(Q){window.location.href="/decks/"+Q.data.id}).catch(function(Q){alert(Q)})}var O=fe(),N=ee(O);{var W=g=>{var v=ht(),j=t(v),Q=t(j),V=s(t(Q),2),o=s(t(V)),D=t(o),f=s(o,2),P=t(f),r=s(f,2);{var m=y=>{var ae=gt(),re=s(ee(ae)),ie=t(re);G(()=>x(ie,`${e(l).length??""} question${e(l).length>1?"s":""} with images`)),p(y,ae)};E(r,y=>{e(l).length>0&&y(m)})}var C=s(r),c=s(V,2),U=s(t(c),2),a=s(c,2),i=t(a),h=s(a,2),u=t(h),R=I(()=>z(()=>B(e(w),e(M).map(y=>y.id))));u.__click=function(...y){e(R)?.apply(this,y)};var $=t(u),A=s(u,2),T=I(()=>z(()=>B(e(w),e(l).map(y=>y.id))));A.__click=function(...y){e(T)?.apply(this,y)};var te=t(A),se=s(A,2),ne=I(()=>z(()=>n(new Set)));se.__click=function(...y){e(ne)?.apply(this,y)},G(()=>{x(D,`selected ${e(d).length??""} deck${e(d).length>1?"s":""}`),x(P,`${e(M).length??""} question${e(M).length>1?"s":""}`),x(C,` (duplicates ${e(b)?"excluded":"included"})`),x($,`Create deck (${e(M).length??""} question${e(M).length>1?"s":""})`),x(te,`Create deck (${e(l).length??""} image question${e(l).length>1?"s":""})`)}),Ve("focus",U,y=>y.target.select()),Te(U,()=>e(w),y=>k(w,y)),Je(i,()=>e(b),y=>k(b,y)),p(g,v)};E(N,g=>{e(d).length>0&&g(W)})}p(F,O),ge()}pe(["click"]);var wt=q('<button data-bs-target="#offcanvasModuleSelection" data-bs-dismiss="offcanvas"> </button>'),xt=q('<ul class="list-group m-2 me-0"></ul>'),yt=q("<button> </button> <!>",1),St=q('<div class="alert alert-light text-center" role="alert">No module selected</div>'),Dt=q('<div class="row"><div class="col-12 d-grid mb-2"><button type="button" class="btn btn-sm btn-primary d-lg-none my-2" data-bs-toggle="offcanvas" data-bs-target="#offcanvasModuleSelection" aria-controls="offcanvasModuleSelection">Switch module</button></div></div> <div class="row"><div class="col-lg-4 offcanvas-lg offcanvas-start" tabindex="-1" id="offcanvasModuleSelection"><div class="offcanvas-header"><h5 id="offcanvasAddToDeckLabel">Choose subject and module</h5> <button type="button" class="btn-close text-reset" data-bs-target="#offcanvasModuleSelection" data-bs-dismiss="offcanvas" aria-label="Close"></button></div> <div class="offcanvas-body"><ul class="list-group w-100"></ul></div></div> <div class="col-12 col-lg-8"><!> <!></div></div>',1);function Mt(F,_){be(_,!0);const n=()=>Be(Se,"$UserSettings",d),[d,w]=Oe();let b=L(Z([])),M=L(Z([])),l=L(Z([])),S=L(Z(new Set));me(()=>{n().last_subject_id,k(l,e(b).filter(r=>n().last_subject_id?r.subject?r.subject.id===n().last_subject_id:!1:!0),!0)}),Re(()=>{axios.get("/api/modules").then(function(r){var m=r.data;k(b,m.filter((c,U,a)=>U===a.findIndex(i=>i.id===c.id)).sort(function(c,U){return c.name>U.name?1:c.name<U.name?-1:0}),!0);var C=e(b).map(c=>c.subject).filter(c=>!!c);k(M,C.filter((c,U,a)=>U===a.findIndex(i=>i.id===c.id)).sort(function(c,U){return c.name>U.name?1:c.name<U.name?-1:0}),!0)}).catch(function(r){alert(r)})});function B(r){var m={last_subject_id:r,last_module_id:0};axios.put("/api/users/me/settings",m).then(function(C){const c=new URL(window.location);c.searchParams.delete("module"),c.searchParams.delete("page"),window.history.replaceState({},"",c),Pe(Se,ce(n).last_subject_id=r,ce(n)),Pe(Se,ce(n).last_module_id=0,ce(n))}).catch(function(C){alert(C)})}function O(r){var m={last_module_id:r};axios.put("/api/users/me/settings",m).then(function(C){const c=new URL(window.location);c.searchParams.set("module",r),c.searchParams.set("page",1),window.history.replaceState({},"",c),Pe(Se,ce(n).last_module_id=r,ce(n))}).catch(function(C){alert(C)})}function N(r){e(S).has(r)?e(S).delete(r):e(S).add(r),k(S,new Set([...e(S)]),!0)}var W=Dt(),g=s(ee(W),2),v=t(g),j=s(t(v),2),Q=t(j);De(Q,21,()=>e(M),$e,(r,m)=>{var C=yt(),c=ee(C),U=I(()=>z(()=>B(e(m).id)));c.__click=function(...u){e(U)?.apply(this,u)};var a=t(c),i=s(c,2);{var h=u=>{var R=xt();De(R,21,()=>e(l),$e,($,A)=>{var T=wt(),te=I(()=>z(()=>O(e(A).id)));T.__click=function(...ne){e(te)?.apply(this,ne)};var se=t(T);G(()=>{de(T,1,`list-group-item list-group-item-action ${n().last_module_id===e(A).id?"list-group-item-secondary":"list-group-item-light"}`),x(se,e(A).name)}),p($,T)}),p(u,R)};E(i,u=>{n().last_subject_id===e(m).id&&u(h)})}G(()=>{de(c,1,`list-group-item list-group-item-action ${n().last_subject_id===e(m).id?"list-group-item-dark":"list-group-item-light"}`),x(a,e(m).name)}),p(r,C)});var V=s(v,2),o=t(V);kt(o,{get selectedDecks(){return e(S)},set selectedDecks(r){k(S,r,!0)}});var D=s(o,2);{var f=r=>{bt(r,{get moduleId(){return n().last_module_id},selectDeck:N,get selectedDecks(){return e(S)},set selectedDecks(m){k(S,m,!0)}})},P=r=>{var m=St();p(r,m)};E(D,r=>{n().last_module_id?r(f):r(P,!1)})}p(F,W),ge(),w()}pe(["click"]);const Ct=document.getElementById("NewSessionView");Ee(Mt,{target:Ct});
