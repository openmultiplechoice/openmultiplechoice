import{e as mt,u as _t,d as J,p as X,g as e,s as T,f as Z,a as _,b as v,c as $,h as V,t as q,i as r,j as Q,k as O,l as st,m as ft,n as P,o as j,q as bt,r as it,v as ht}from"./render-A2vHlHFc.js";import{o as pt}from"./index-client-CvvtOJ7D.js";import{i as F}from"./if-Clrp5PSS.js";import{s as at,a as M}from"./attributes-BsW_rUSb.js";import{k as gt,Q as xt}from"./QuestionForm-B3W-DAak.js";import{h as wt}from"./html-D_7_osXO.js";import{s as G}from"./class-BfJg_ovI.js";import{b as qt}from"./input-CU7pjbMP.js";import{b as kt}from"./this-B17HhuhU.js";import{p as yt,e as rt,i as nt}from"./event-modifiers-BpCZEBLv.js";import{p as lt}from"./props-6zeU4q7i.js";import{r as Ct}from"./legacy-client-BQ40Zj-S.js";import{d as It,p as ot,K as dt}from"./hotkeys-js-Bzouew-W.js";import{s as ct}from"./style-BtOSwUPa.js";import{s as ut}from"./utils-CsCDY5_e.js";import"./select-DS-CHUim.js";import"./lodash-BBVXAwvF.js";import"./_commonjsHelpers-CE1G-McA.js";class tt{#t=new WeakMap;#e;#s;static entries=new WeakMap;constructor(s){this.#s=s}observe(s,t){var n=this.#t.get(s)||new Set;return n.add(t),this.#t.set(s,n),this.#i().observe(s,this.#s),()=>{var f=this.#t.get(s);f.delete(t),f.size===0&&(this.#t.delete(s),this.#e.unobserve(s))}}#i(){return this.#e??(this.#e=new ResizeObserver(s=>{for(var t of s){tt.entries.set(t.target,t);for(var n of this.#t.get(t.target)||[])n(t)}}))}}var Et=new tt({box:"border-box"});function Tt(k,s,t){var n=Et.observe(k,()=>t(k[s]));mt(()=>(_t(()=>t(k[s])),n))}var Qt=Q('<form action="#" class="mt-3"><div class="mb-3"><label class="form-label">Case text</label> <input type="hidden"/> <trix-editor></trix-editor> <!></div></form>',2),Dt=Q(`<div class="alert alert-light mt-5" role="alert"><p><strong>Delete case?</strong> A case can only be deleted if it's not associated with any question.</p> <button type="button" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i> Delete case</button></div>`),zt=Q("<!> <!>",1);function At(k,s){X(s,!0);let t=lt(s,"kase",15),n=V(void 0),f=V("");Ct(()=>{e(n)&&D(e(n))});function D(o){o.addEventListener("trix-change",function(){t(t().text=document.getElementById("caseText"+t().id).value,!0),T(f,'<p class="text-end">Saving ...</p>'),S()})}var p;function S(){p&&p.cancel(),p=It(()=>{axios.put("/api/cases/"+t().id,t()).then(function(o){T(f,'<p class="text-end">Saved <span class="text-success-dark">&check;</span></p>')}).catch(function(o){T(f,'<p class="text-end">Saving ... <span class="text-danger-dark">failed!</span></p>'),alert(o)})},500,{maxWait:2e3}),p()}var N=zt(),z=Z(N);gt(z,()=>t().id,o=>{var b=Qt(),y=r(b),A=r(y),u=_(A,2),c=_(u,2);q(()=>at(c,"id",`editor-case${t().id??""}`)),G(c,1,"bg-light trix-content"),q(()=>at(c,"input",`caseText${t().id??""}`)),kt(c,g=>T(n,g),()=>e(n));var l=_(c,2);wt(l,()=>e(f)),q(()=>{M(A,"for",`caseText${t().id??""}`),M(u,"id",`caseText${t().id??""}`)}),qt(u,()=>t().text,g=>t(t().text=g,!0)),v(o,b)});var H=_(z,2);{var d=o=>{var b=Dt(),y=_(r(b),2),A=O(()=>yt(()=>{confirm("Are you sure you want to delete this case?")&&s.handleCaseRemove(t().id)}));y.__click=function(...u){e(A)?.apply(this,u)},q(u=>y.disabled=u,[()=>s.cases.some(u=>u.questions?u.questions.some(c=>c.case_id===t().id):!1)]),v(o,b)};F(H,o=>{s.handleCaseRemove&&o(d)})}v(k,N),$()}J(["click"]);var St=Q('<button type="button" aria-current="true"><small><!></small></button>'),Bt=Q('<button type="button" aria-current="true"><small><i class="bi bi-clipboard2-pulse"></i> <!></small></button>'),Ot=Q('<div class="overflow-scroll mt-2" style="max-height: 20vh;"><div class="list-group"></div></div>'),Ft=Q('<div class="sticky-top pt-3"><div class="overflow-scroll"><div class="list-group"></div></div> <!></div>'),Nt=Q("<p>Loading ...</p>");function Rt(k,s){X(s,!0);let t=lt(s,"data",15),n=O(()=>t()?t().questions.find(d=>d.id===t().current_question_id):null),f=O(()=>t()?t().current_question_id:null),D=O(()=>t()?t().current_case_id:null),p=O(()=>t()&&t().cases&&t().cases.length>0);st(()=>{if(!e(f))return;let d=document.getElementById("editor-question"+e(f));ut(d),window.scrollTo({top:0,behavior:"smooth"})}),st(()=>{if(!e(D))return;let d=document.getElementById("editor-case-item"+e(D));ut(d),window.scrollTo({top:0,behavior:"smooth"})});var S=ft(),N=Z(S);{var z=d=>{var o=Ft(),b=r(o),y=r(b);rt(y,21,()=>t().questions,nt,(c,l,g)=>{var C=St();C.__click=()=>{t(t().current_question_id=e(l).id,!0),t(t().current_case_id=null,!0)};let m;var R=r(C),w=r(R);{var L=x=>{var I=P();q(K=>j(I,K),[()=>ot.sanitize(e(l).text).replace(/<\/?[^>]+(>|$)/g,"")]),v(x,I)},W=x=>{var I=P();I.nodeValue=`Question Nr. ${g+1}`,v(x,I)};F(w,x=>{e(l).text?x(L):x(W,!1)})}q(()=>{M(C,"id",`editor-question${e(l).id??""}`),m=G(C,1,"list-group-item list-group-item-action text-truncate",null,m,{"list-group-item-dark":e(l).id===t().current_question_id,"list-group-item-light":e(l).id!==t().current_question_id,"bg-warning-subtle":t().current_case_id&&e(l).case_id===t().current_case_id})}),v(c,C)});var A=_(b,2);{var u=c=>{var l=Ot(),g=r(l);rt(g,21,()=>t().cases,nt,(C,m,R)=>{var w=Bt();w.__click=()=>{t(t().current_case_id=e(m).id,!0),t(t().current_question_id=null,!0)};let L;var W=r(w),x=_(r(W),2);{var I=E=>{var B=P();q(Y=>j(B,Y),[()=>ot.sanitize(e(m).text).replace(/<\/?[^>]+(>|$)/g,"")]),v(E,B)},K=E=>{var B=P();B.nodeValue=`Case Nr. ${R+1}`,v(E,B)};F(x,E=>{e(m).text?E(I):E(K,!1)})}q(()=>{M(w,"id",`editor-case-item${e(m).id??""}`),L=G(w,1,"list-group-item list-group-item-action text-truncate",null,L,{"list-group-item-dark":e(m).id===t().current_case_id,"list-group-item-info":e(m).id!==t().current_case_id&&!(e(n)&&e(n).case_id===e(m).id),"list-group-item-warning":e(n)&&e(n).case_id===e(m).id})}),v(C,w)}),v(c,l)};F(A,c=>{e(p)&&c(u)})}q(()=>{ct(o,`z-index: 19; top: ${s.stickyTopOffset??""}px`),ct(b,`max-height: ${e(p)?"55vh":"80vh"};`)}),v(d,o)},H=d=>{var o=Nt();v(d,o)};F(N,d=>{t()?d(z):d(H,!1)})}v(k,S),$()}J(["click"]);var Lt=Q('<div class="row"><div class="col"><h4 class="text-truncate"><a class="text-reset text-decoration-none"> </a></h4></div></div> <div class="sticky-top bg-white" style="z-index: 20;"><div class="row"><div class="col d-grid d-sm-block gap-2 py-3"><button type="button" class="btn btn-sm btn-primary" title="Add a new MC question (Shortcut: Alt+Q)">Add MC question</button> <button type="button" class="btn btn-sm btn-primary">Add card question</button> <button type="button" class="btn btn-sm btn-light"><i class="bi bi-clipboard2-pulse"></i> Add case</button></div></div> <div class="row"><div class="col"><div class="border-dark" style="border-bottom: dotted; border-width: 1px;"></div></div></div></div> <div class="row"><div class="col-md-4"><!></div> <div class="col-md-8"><!> <!></div></div>',1);function Mt(k,s){X(s,!0);let t=V(bt({cases:[],questions:[]})),n=0;const f=1e3;let D=O(()=>e(t)?e(t).questions.find(i=>i.id===e(t).current_question_id):null),p=O(()=>e(t)?e(t).cases.find(i=>i.id===e(t).current_case_id):null),S=V(0);pt(()=>{dt.filter=function(){return!0},dt("alt+Q",function(i){i.preventDefault();const a=Date.now();a-n>f&&(z("mc"),n=a)}),axios.get("/api/decks/"+s.id).then(function(i){T(t,i.data,!0);const a=N();a&&e(t).questions.some(h=>h.id===parseInt(a))?e(t).current_question_id=parseInt(a):e(t).questions.length>0&&(e(t).current_question_id=e(t).questions[e(t).questions.length-1].id)}).catch(function(i){alert(i)})});function N(){return new URLSearchParams(window.location.search).get("question_id")}function z(i){var a={id:null,text:"",type:i||"mc",correct_answer_id:null,images:[],answers:[]};axios.post("/api/decks/"+s.id+"/questions",a).then(function(h){a.id=h.data.id,e(t).questions=[...e(t).questions,a],e(t).current_question_id=a.id,it().then(()=>{const et=document.getElementById("editor-questionText");et&&et.focus()})}).catch(function(h){alert(h)}),window.scrollTo({top:0,behavior:"smooth"})}function H(){var i={deck_id:s.id};axios.post("/api/cases",i).then(function(a){e(t).cases=[...e(t).cases,a.data],e(t).current_case_id=a.data.id,e(t).current_question_id=null,it().then(()=>{const h=document.getElementById("editor-case"+a.data.id);h&&h.focus()})}).catch(function(a){alert(a)}),window.scrollTo({top:0,behavior:"smooth"})}function d(i){axios.delete("/api/decks/"+s.id+"/questions/"+i).then(function(a){e(t).questions=e(t).questions.filter(h=>h.id!==i),e(t).questions.length>0&&(e(t).current_question_id=e(t).questions[e(t).questions.length-1].id)}).catch(function(a){alert(a)})}function o(i){axios.delete("/api/decks/"+s.id+"/cases/"+i).then(function(a){e(t).cases=e(t).cases.filter(h=>h.id!==i),e(t).questions.length>0&&(e(t).current_question_id=e(t).questions[e(t).questions.length-1].id)}).catch(function(a){alert(a)})}var b=Lt(),y=Z(b),A=r(y),u=r(A),c=r(u),l=r(c),g=_(y,2),C=r(g),m=r(C),R=r(m);R.__click=()=>{z("mc")};var w=_(R,2);w.__click=()=>{z("card")};var L=_(w,2);L.__click=H;var W=_(g,2),x=r(W),I=r(x);Rt(I,{get stickyTopOffset(){return e(S)},get data(){return e(t)},set data(i){T(t,i,!0)}});var K=_(x,2),E=r(K);{var B=i=>{xt(i,{showConfigEditor:"true",showCaseSelector:"true",handleQuestionRemove:d,get question(){return e(D)},set question(a){T(D,a)},get cases(){return e(t).cases},set cases(a){e(t).cases=a}})};F(E,i=>{e(D)&&i(B)})}var Y=_(E,2);{var vt=i=>{At(i,{handleCaseRemove:o,get kase(){return e(p)},set kase(a){T(p,a)},get cases(){return e(t).cases},set cases(a){e(t).cases=a}})};F(Y,i=>{e(p)&&i(vt)})}q(()=>{M(u,"title",s.name),M(c,"href",`/decks/${s.id??""}`),j(l,s.name)}),Tt(g,"clientHeight",i=>T(S,i)),v(k,b),$()}J(["click"]);const U=document.getElementById("DeckForm");ht(Mt,{target:U,props:{id:U.dataset.deckId,name:U.dataset.deckName,moduleId:U.dataset.moduleId}});
